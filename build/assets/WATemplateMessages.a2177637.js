var et=Object.defineProperty;var tt=(r,a,l)=>a in r?et(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l;var z=(r,a,l)=>(tt(r,typeof a!="symbol"?a+"":a,l),l);import{g as at,e as st,s as he,_ as se,r as p,l as rt,c as ot,T as re,j as e,a as s,p as nt,q as lt,A as G,b as ne,aM as le,$ as A,an as it,ao as ct,ap as dt,aq as pt,V as oe,aN as ue,aO as ke,u as fe,am as Oe,B as mt,aP as ht,W as ut,L as ft}from"./index.0f332f5b.js";import{b as X,D as gt,c as xt,L as Se,d as Ct,e as bt,F as te,G as ae,f as $,S as Tt,A as ye}from"./CommonComponents.952db432.js";import{S as me}from"./Search.55f23872.js";import{c as yt,d as R}from"./WhatsApp.c407ea69.js";import{L as wt}from"./ListItem.3c4c8f69.js";import{a as vt,L as St}from"./ListItemText.b126ebda.js";import{C as Et}from"./Chip.d37ccb2e.js";import{M as Mt}from"./MoreVert.960332b6.js";import{M as Ft}from"./Menu.a440cc3b.js";import{M as k}from"./MenuItem.9f3a5b75.js";import{T as Wt,o as Ht,p as Rt,q as Bt,r as Lt,s as It,t as De,u as Ne,v as $e,j as _,k as K,l as Z,m as Pt,aa as de,ab as we,ac as pe,ad as J,ae as ce,K as xe,af as kt,ag as Ot,ah as He,ai as Re,aj as Dt,ak as Nt,al as $t,am as At,an as Ce,ao as Be,b as Ae,H as Ve,ap as Vt,w as Ut,c as _t,x as qt,I as zt,y as Xt,f as Yt,g as Qt,z as jt,A as Gt,B as Kt,D as Zt,E as Jt}from"./Tags.809d11a0.js";import{C as Ue}from"./Clear.e6a2165b.js";import{F as O,u as _e}from"./FormTextField.388f2c02.js";import{F as be}from"./FormIOSSwitch.df078254.js";import{C as Ee,a as ea}from"./CardContent.5f571a0e.js";import{A as ta}from"./mui-tel-input.es.0b26f5fc.js";import{D as qe}from"./Drawer.97f6b1b4.js";import{T as aa}from"./TextField.a41504df.js";import{F as sa}from"./FileUpload.cddda32f.js";import{F as Te}from"./index.d5a76221.js";import{P as ra,a as oa}from"./Play.617aa7bb.js";import{C as Le}from"./CardMedia.961195a0.js";import{L as ve}from"./Link.32d93b06.js";import{D as na}from"./Divider.ec1c93f1.js";import"./styled.fec32704.js";import"./List.b0c9e76e.js";import"./listItemButtonClasses.f19c762e.js";import"./isMuiElement.a4739e0e.js";import"./listItemTextClasses.37a4eef2.js";import"./Switch.a0a6d887.js";import"./SwitchBase.52dba070.js";import"./Select.523a5fc8.js";import"./InputAdornment.3bd38167.js";import"./Img.88e26a24.js";function la(r){return st("MuiCardHeader",r)}const ia=at("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Ie=ia,ca=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],da=r=>{const{classes:a}=r;return lt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},la,a)},pa=he("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(r,a)=>se({[`& .${Ie.title}`]:a.title,[`& .${Ie.subheader}`]:a.subheader},a.root)})({display:"flex",alignItems:"center",padding:16}),ma=he("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(r,a)=>a.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),ha=he("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(r,a)=>a.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ua=he("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(r,a)=>a.content})({flex:"1 1 auto"}),fa=p.exports.forwardRef(function(a,l){const S=rt({props:a,name:"MuiCardHeader"}),{action:B,avatar:g,className:b,component:C="div",disableTypography:i=!1,subheader:H,subheaderTypographyProps:M,title:W,titleTypographyProps:T}=S,x=ot(S,ca),y=se({},S,{component:C,disableTypography:i}),w=da(y);let L=W;L!=null&&L.type!==re&&!i&&(L=e(re,se({variant:g?"body2":"h5",className:w.title,component:"span",display:"block"},T,{children:L})));let E=H;return E!=null&&E.type!==re&&!i&&(E=e(re,se({variant:g?"body2":"body1",className:w.subheader,color:"text.secondary",component:"span",display:"block"},M,{children:E}))),s(pa,se({className:nt(w.root,b),as:C,ref:l,ownerState:y},x,{children:[g&&e(ma,{className:w.avatar,ownerState:y,children:g}),s(ua,{className:w.content,ownerState:y,children:[L,E]}),B&&e(ha,{className:w.action,ownerState:y,children:B})]}))}),ze=fa,ga=()=>s("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"//www.w3.org/2000/svg",children:[e("path",{d:"M10.5378 1.11084H7.60995C7.35479 1.11084 7.14798 1.31765 7.14798 1.57281C7.14798 1.82797 7.35479 2.03478 7.60995 2.03478H9.42251L4.99274 6.46455C4.81232 6.64498 4.81232 6.93746 4.99274 7.11788C5.08298 7.20807 5.20119 7.25319 5.3194 7.25319C5.43762 7.25319 5.55583 7.20807 5.64607 7.11788L10.0758 2.68811V4.50072C10.0758 4.75588 10.2826 4.96269 10.5378 4.96269C10.793 4.96269 10.9998 4.75588 10.9998 4.50072V1.57286C10.9998 1.31765 10.793 1.11084 10.5378 1.11084Z",fill:"#32C5FF",stroke:"#32C5FF",strokeWidth:"0.5"}),e("path",{d:"M8.64816 6.53803C8.393 6.53803 8.18619 6.74484 8.18619 7V9.965H1.92394V3.70275H5.5C5.75516 3.70275 5.96197 3.49594 5.96197 3.24078C5.96197 2.98562 5.75516 2.77881 5.5 2.77881L1.46197 2.77881C1.20681 2.77881 1 2.98562 1 3.24078V10.427C1 10.6821 1.20681 10.8889 1.46197 10.8889H8.64816C8.90333 10.8889 9.11013 10.6821 9.11013 10.427V7C9.11013 6.74484 8.90333 6.53803 8.64816 6.53803Z",fill:"#32C5FF",stroke:"#32C5FF",strokeWidth:"0.5"})]}),xa=({color:r="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:r})});class P{}z(P,"getWaTemplateMessages",async()=>await G("/wa-templates","GET")),z(P,"getWaTemplateMessage",async a=>await G(`/wa-templates/${a}`,"GET")),z(P,"syncWaTemplateMessage",async()=>await G("/wa-templates/sync-templates","GET")),z(P,"createWaTemplateMessage",async a=>await G("/wa-templates/create-template","POST",{data:a})),z(P,"updateWaTemplateMessage",async(a,l)=>await G(`/wa-templates/update-template-form/${a}`,"PUT",{data:l})),z(P,"updateWaTemplateComponents",async(a,l)=>await G(`/wa-templates/update/${a}`,"PUT",{data:l})),z(P,"deleteWaTemplateMessage",async a=>await G(`/wa-templates/delete/${a}`,"DELETE"));const Ca=({template_status:r,name:a,id:l,description:S})=>{const{setErrorMessage:B,setSuccessMessage:g}=ne(),{setEditWaTemplateId:b,setShowWaTemplateForm:C,setPreviewWaTemplateId:i,setShowWaTemplatePreview:H}=le(),[M,W]=p.exports.useState(null),[T,x]=p.exports.useState(!1),y=()=>{x(!0)},w=()=>{x(!1)},L=c=>{W(c.currentTarget)},E=()=>{W(null)},o=async()=>{try{const c=await P.deleteWaTemplateMessage(l);if(!c.success)throw Error(c.message);g(c.message),setTimeout(()=>window.location.reload(),1e3)}catch(c){B(c.message)}finally{w()}};return s(p.exports.Fragment,{children:[s(wt,{component:"div",sx:{px:{xs:0,md:2}},children:[e(vt,{primary:s("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:a}),e(Et,{label:r,size:"small",sx:{bgcolor:yt[r],alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),secondary:S,sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}},"& .MuiListItemText-secondary":{color:"text.secondary",fontSize:12,fontWeight:400,lineHeight:"15px"}}}),e(St,{children:e(A,{onClick:L,children:e(Mt,{})})})]}),Boolean(M)&&s(Ft,{anchorEl:M,open:Boolean(M),onClose:E,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:[r==="DRAFT"&&e(k,{onClick:()=>{b(l),C(!0),E()},children:"Edit"}),(r==="SUBMITTED"||r==="APPROVED")&&e(k,{onClick:()=>{i(l),H(!0),E()},children:"Preview"}),e(k,{onClick:()=>{y(),E()},children:"Delete"})]}),s(it,{open:T,"aria-labelledby":"responsive-dialog-title",children:[e(ct,{id:"responsive-dialog-title",children:"Delete"}),e(dt,{children:"Are you sure you want to delete?"}),s(pt,{children:[e(oe,{color:"secondary",onClick:()=>{w()},children:"Cancel"}),e(oe,{onClick:async()=>{await o()},autoFocus:!0,children:"Delete"})]})]})]})},ba=({isSearchActive:r,setSearchActive:a})=>{const{setErrorMessage:l,setSuccessMessage:S}=ne(),{totalWaTemplates:B}=ue(),{setWaTemplateFilter:g,setShowWaTemplateForm:b,setTotalWaTemplates:C,setWaTemplatesData:i}=le(),[H,M]=p.exports.useState(!1),W=async()=>{try{M(!0);const T=await P.syncWaTemplateMessage();if(T.success){const x=await P.getWaTemplateMessages();if(!x.success)throw Error(T.message);C(x.payload.length),i(x.payload),S(T.message)}else l(T.message)}catch(T){l(T.message)}finally{M(!1)}};return s(Wt,{children:[e(Ht,{children:e(X,{disableIcon:!0,type:"button",onClick:()=>b(!0),sx:{py:0,px:2,height:36,mt:0},children:"New Template Message"})}),s(Rt,{children:[!r&&e(Bt,{children:e(Lt,{children:`${B} Template Messages`})}),s(It,{children:[r&&e(De,{children:s(Ne,{children:[e(A,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(me,{})}),e($e,{onChange:({target:{value:T}})=>g(T),placeholder:"Search Template"}),e(A,{onClick:()=>{g(""),a(!r)},sx:{position:"absolute",right:0,top:0},children:e(Ue,{})})]})}),!r&&e(A,{onClick:()=>a(T=>!T),children:e(me,{})}),!r&&e(X,{icon:e(xa,{color:H?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:H,onClick:()=>W(),sx:{alignSelf:"center",borderRadius:4,borderColor:"#0000003b",color:"#000000de",flexDirection:"row-reverse",fontSize:14,fontWeight:400,letterSpacing:"0.02857em",lineHeight:"16px",gap:1,height:30,py:.625,px:1.875,textTransform:"capitalize"},children:H?"Syncing...":"Sync Messages"})]})]})]})},Ta=({index:r,control:a,removeQuickReply:l})=>s(Ee,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(ze,{title:`Quick Reply ${r+1}`,action:e(A,{"aria-label":`Remove Quick Reply ${r+1}`,onClick:()=>l(r),children:e(ke,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(_,{sx:{my:2},children:e(O,{control:a,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:K})})]},r),ya=({index:r,type:a,url:l,phone_number:S,waTemplateButtonCtaTypes:B,control:g,setValue:b,removeCallAction:C})=>{const{country:i}=fe(),H=/[{][{]\d{1,3}[}][}]/gm,[M,W]=p.exports.useState(0),T=()=>{if(M===1)return;const y=`${l}{{${1}}}`;b(`components[3].buttons[${r}].url`,y),W(1)},x=p.exports.useCallback(()=>{if(l){const y=l.match(H);y&&y.length>0?W(1):W(0)}},[l]);return p.exports.useEffect(()=>{x()},[x]),s(Ee,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(ze,{title:`Call to Action ${r+1}`,action:e(A,{"aria-label":`Remove Call to Action ${r+1}`,onClick:()=>C(r),children:e(ke,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(_,{sx:{my:2},children:s(O,{select:!0,control:g,label:"Action Type",name:`components[3].buttons[${r}].type`,sx:Z,required:!0,defaultValue:a,children:[e(k,{value:"",disabled:!0,children:"Select Action Type"}),B.map(({value:y,name:w},L)=>e(k,{value:y,children:w},L))]})}),a!==""&&e(_,{sx:{my:2},children:e(O,{control:g,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:K})}),a==="PHONE_NUMBER"&&e(_,{sx:{my:2},children:e(ta,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:i,value:S!=null?S:"",onChange:y=>{b(`components[3].buttons[${r}].phone_number`,y.replaceAll(" ",""))},variant:"filled",sx:Pt})}),a==="URL"&&s(_,{sx:{my:2},children:[s(de,{children:[e(O,{control:g,name:`components[3].buttons[${r}].url`,label:"URL",required:!0,sx:{...K,pb:2,height:"auto"}}),e(we,{size:"small",focusRipple:!1,className:"add-variable",disabled:M===1,onClick:T,children:"ADD VARIABLE"})]}),s(pe,{children:[s(J,{children:[l?l.length:0,"/60 Characters"]}),s(J,{children:[M,"/1 Variable"]})]})]})]},r)},wa=({open:r,closeDrawer:a})=>{const l=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:S,setSuccessMessage:B}=ne(),{businessId:g}=fe(),{editWaTemplateId:b,waTemplatesData:C,waTemplateCategories:i,waTemplateLanguages:H,waTemplateTypes:M,waTemplateHeaderTypes:W,waTemplateButtonTypes:T,waTemplateButtonCtaTypes:x}=ue(),{setWaTemplatesData:y,setShowWaPreviewForm:w,setPreviewWaTemplateId:L}=le(),E={name:"",category:"",language:"",template_type:"",businessId:g,components:[{format:"",text:"",type:R.HEADER,active:!1},{text:"",type:R.BODY},{text:"",type:R.FOOTER,active:!1},{buttons:[],type:R.BUTTONS,active:!1}]},{control:o,handleSubmit:c,watch:n,reset:d,setValue:h}=_e({defaultValues:E}),{name:q,category:ee,language:ge,template_type:D,components:Y}=n(),I=Y.find(({type:t})=>t===R.HEADER),U=Y.find(({type:t})=>t===R.BODY),Q=Y.find(({type:t})=>t===R.FOOTER),N=Y.find(({type:t})=>t===R.BUTTONS),[u,v]=p.exports.useState(0),[F,j]=p.exports.useState(""),ie=p.exports.useCallback(()=>{const m=q.match(/^[A-Za-z0-9_]+$/g)===null?q.slice(0,-1):q.replace(/\s/g,"").toLowerCase();h("name",m)},[q]),Xe=()=>{if(u===1)return;const t=`${I.text}{{${1}}}`;h("components[0].text",t),v(1)},Ye=()=>{const t=U.text.match(l),m=t&&t.length>0?`${U.text}{{${t.length+1}}}`:`${U.text}{{${1}}}`;h("components[1].text",m)},Me=p.exports.useCallback(()=>{const t=I.text.match(l);t&&t.length>0?v(1):v(0)},[I.text]),Fe=p.exports.useCallback(()=>{const t=I.text.match(l);if(t===null){v(0);return}if(t.length===0){v(0);return}h("components[0].text",t.reduce((m,f,V)=>V===0?m.replace(f,`{{${V+1}}}`):m.replace(f,""),t.reduce((m,f,V)=>m.replace(f,`{{${V+1}}}`),I.text))),v(1)},[I.text]),Qe=()=>{const t=U.text.match(l);t!==null&&t.length!==0&&h("components[1].text",t.reduce((m,f,V)=>m.replace(f,`{{${V+1}}}`),U.text))},je=t=>{j(t.target.value)},Ge=()=>{if(F===""&&S("Please Select button Type"),F==="QUICK_REPLY")if(N.buttons.length<3){const t=N.buttons;t.push({type:"QUICK_REPLY",text:""}),h("components[3].buttons",t)}else S("Limit exceeded");if(F==="CALL_TO_ACTION")if(N.buttons.length<2){const t=N.buttons;t.push({type:"",text:""}),h("components[3].buttons",t)}else S("Limit exceeded")},Ke=t=>{const m=N.buttons;m.splice(t,1),h("components[3].buttons",m)},Ze=t=>{const m=N.buttons;m.splice(t,1),h("components[3].buttons",m)},Je=async t=>{var m;try{if(b){const f=await P.updateWaTemplateMessage(b,t);if(!f.success)throw Error(f.message);B(f.message),L((m=f.payload.id)!=null?m:b),d(E),a(),w(!0)}else{const f=await P.createWaTemplateMessage(t);if(!f.success)throw Error(f.message);B(f.message),y([f.payload,...C]),L(f.payload.id),d(E),a(),w(!0)}}catch(f){S(f.message)}},We=p.exports.useCallback(async()=>{try{if(b){const t=await P.getWaTemplateMessage(b);if(!t.success)throw Error(t.message);d(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&h("components[0].active",!0),t.payload.components[2].text!==""&&h("components[2].active",!0),t.payload.components[3].buttons.length>0&&h("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?j("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&j("CALL_TO_ACTION"))}}catch(t){S(t.message)}},[b]);return p.exports.useEffect(()=>{We()},[We]),p.exports.useEffect(()=>{ie()},[ie]),p.exports.useEffect(()=>{Fe()},[Fe]),p.exports.useEffect(()=>{Me()},[Me]),p.exports.useEffect(()=>{I.active||h("components[0].format","")},[I.active]),p.exports.useEffect(()=>{Q.active||h("components[2].text","")},[Q.active]),e(qe,{anchor:"right",open:r,onClose:(t,m)=>{Oe(m)||(d(E),a())},sx:{zIndex:"modal"},children:s(gt,{sx:{width:{xs:"100vw",md:360}},children:[s(xt,{children:[e(A,{onClick:()=>{d(E),a()},sx:{width:32,height:32},children:e(Se,{})}),e(Ct,{children:`${b?"Update":"Create New"} Template`})]}),s(bt,{onSubmit:c(Je),onReset:()=>{d(E),a()},children:[e(te,{children:s(ae,{children:[e($,{children:e(O,{control:o,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:K})}),e($,{children:s(O,{select:!0,control:o,label:"Template Category",name:"category",sx:Z,required:!0,defaultValue:ee,children:[e(k,{value:"",disabled:!0,children:"Select Template Category"}),i.map(({value:t,name:m},f)=>e(k,{value:t,children:m},f))]})}),e($,{children:s(O,{select:!0,control:o,label:"Language",name:"language",sx:Z,required:!0,defaultValue:ge,children:[e(k,{value:"",disabled:!0,children:"Select Language"}),H.map(({code:t,name:m},f)=>e(k,{value:t,children:m},f))]})}),e($,{children:s(O,{select:!0,control:o,label:"Template Type",name:"template_type",sx:Z,required:!0,defaultValue:D,children:[e(k,{value:"",disabled:!0,children:"Select Template Type"}),M.map(({value:t,label:m},f)=>e(k,{value:t,children:m},f))]})}),D==="media"&&e($,{children:s(te,{sx:{justifyContent:"space-between"},children:[e(ae,{children:e(ce,{children:"Header"})}),e(be,{control:o,name:"components[0].active"})]})}),D==="media"&&I.active&&e($,{children:s(O,{select:!0,control:o,label:"Header Type",name:"components[0].format",sx:Z,required:!0,defaultValue:I.format,children:[e(k,{value:"",disabled:!0,children:"Select Header Type"}),W.map(({value:t,name:m},f)=>e(k,{value:t,children:m},f))]})}),D==="media"&&I.active&&I.format==="TEXT"&&s($,{children:[s(de,{children:[e(O,{control:o,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:xe}),e(we,{size:"small",focusRipple:!1,className:"add-variable",disabled:u===1,onClick:Xe,children:"ADD VARIABLE"})]}),s(pe,{children:[s(J,{children:[I.text.length,"/60 Characters"]}),s(J,{children:[u,"/1 Variable"]})]})]}),D!==""&&e($,{children:e(ce,{children:"Body"})}),D!==""&&s($,{children:[s(de,{children:[e(O,{control:o,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Qe,inputProps:{maxLength:1024},sx:xe}),e(we,{size:"small",focusRipple:!1,className:"add-variable",onClick:Ye,children:"ADD VARIABLE"})]}),e(pe,{children:s(J,{children:[U.text.length,"/1024 Characters"]})})]}),D==="media"&&e($,{children:s(te,{sx:{justifyContent:"space-between"},children:[e(ae,{children:e(ce,{children:"Footer"})}),e(be,{control:o,name:"components[2].active"})]})}),D==="media"&&Q.active&&s($,{children:[e(de,{children:e(O,{control:o,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:xe})}),e(pe,{children:s(J,{children:[Q.text.length,"/60 Characters"]})})]}),D==="media"&&e($,{children:s(te,{sx:{justifyContent:"space-between"},children:[e(ae,{children:e(ce,{children:"Buttons"})}),e(be,{control:o,name:"components[3].active"})]})}),D==="media"&&N.active&&s($,{children:[s(te,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(ae,{children:s(aa,{select:!0,label:"Button Type",sx:Z,required:!0,value:F,onChange:je,disabled:N.buttons.length>0,children:[e(k,{value:"",disabled:!0,children:"Select Button Type"}),T.map(({label:t,name:m},f)=>e(k,{value:m,children:t},f))]})}),e(Tt,{children:e(X,{variant:"outlined",color:"primary",onClick:Ge,disableIcon:!0,children:"Add a Button"})})]}),D==="media"&&N.active&&N.buttons.length>0&&e(p.exports.Fragment,{children:N.buttons.map(({type:t,url:m,phone_number:f},V)=>{switch(t){case"QUICK_REPLY":return e(Ta,{index:V,removeQuickReply:Ke,control:o},V);default:return e(ya,{index:V,type:t,url:m,phone_number:f,waTemplateButtonCtaTypes:x,control:o,setValue:h,removeCallAction:Ze},V)}})})]})]})}),s(ye,{children:[e(X,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(X,{type:"submit",children:"Preview & Save"})]})]})]})})},Pe=({components:r})=>{const a=p.exports.useRef(null),[l,S]=p.exports.useState(!1),[B,g]=p.exports.useState(!1),[b,C]=p.exports.useState(""),i=r.find(({type:o})=>o===R.HEADER),H=r.find(({type:o})=>o===R.BODY),M=r.find(({type:o})=>o===R.FOOTER),W=r.find(({type:o})=>o===R.BUTTONS),T=(o=>{if(o){const{example:c}=o;if(c){const{header_text:n}=c;return n||[]}else return[]}else return[]})(i),x=(o=>{if(o){const{example:c}=o;if(c){const{header_handle:n}=c;if(n&&n.length>0){const[d]=n;return d}else return""}else return""}else return""})(i),y=(o=>{if(o){const{example:c}=o;if(c){const{header_files:n}=c;if(n&&n.length>0){const[d]=n;return d}else return""}else return""}else return""})(i),w=(o=>{if(o){const{example:c}=o;if(c){const{body_text:n}=c;return n||[]}else return[]}else return[]})(H),L=(o=>i?o.reduce((c,n,d)=>n&&n!==""?c.replace(`{{${d+1}}}`,n):c,i.text):"")(T),E=(o=>H?o.reduce((c,n,d)=>n&&n!==""?c.replace(`{{${d+1}}}`,n):c,H.text):"")(w);return p.exports.useEffect(()=>{a.current&&(a.current.addEventListener("playing",()=>{C("playing")}),a.current.addEventListener("pause",()=>{C("")}),a.current.addEventListener("ended",()=>{C("")}),l?a.current.play():a.current.pause())},[l]),s(kt,{children:[i&&i.format==="IMAGE"&&e(Ot,{children:x&&x!==""&&e(Le,{component:"img",alt:"header-img",image:x,sx:He})}),i&&i.format==="VIDEO"&&s(ve,{underline:"none",component:"button",type:"button",onClick:()=>S(!l),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),sx:Re,children:[e(Le,{component:"video",ref:a,className:"video",disablePictureInPicture:!0,sx:{...He,height:130},children:x&&x!==""&&e("source",{src:x,type:"video/mp4"})}),s(mt,{position:"absolute",display:"flex",children:[b===""&&e(ra,{}),B&&b==="playing"&&e(oa,{})]})]}),i&&i.format==="DOCUMENT"&&e(ve,{underline:"none",className:"media-wrapper doc",href:x,target:"_blank",sx:{...Re,backgroundColor:"#F5F5F5",color:"#A1AEB4",fontSize:90,fontWeight:900,lineHeight:"96px"},children:x&&x!==""?y.split(".").pop().slice(0,4).toUpperCase():""}),i&&i.format==="TEXT"&&e(Dt,{children:L}),e(Nt,{children:ht(E)}),M&&M.text!==""&&e($t,{children:M.text}),W&&W.buttons.length>0&&e(At,{children:W.buttons.map((o,c)=>e(p.exports.Fragment,{children:o.type==="QUICK_REPLY"?e(oe,{variant:"outlined",type:"button",sx:{...Ce,color:"#767676",minWidth:"calc(50% - 8px)"},children:o.text}):o.type==="PHONE_NUMBER"?e(oe,{href:`tel:${o.phone_number}`,variant:"outlined",sx:{...Ce,color:"#32C5FF",minWidth:"100%"},children:o.text}):s(oe,{href:o.example?o.example.reduce((n,d,h)=>d&&d!==""?n.replace(`{{${h+1}}}`,d):n,o.url):"",variant:"outlined",target:"_blank",rel:"noreferrer",sx:{...Ce,color:"#32C5FF",minWidth:"100%"},children:[e(ga,{}),o.text]})},c))})]})},va=({open:r,closeDrawer:a})=>{var I,U,Q,N;const{isMobile:l,isTablet:S}=fe(),B=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:g,setSuccessMessage:b}=ne(),{previewWaTemplateId:C,showWaTemplatePreview:i}=ue(),{setPreviewWaTemplateData:H,setEditWaTemplateId:M,setShowWaTemplateForm:W}=le(),[T,x]=p.exports.useState([]),y={components:[{format:"",text:"",type:R.HEADER},{text:"",type:R.BODY},{text:"",type:R.FOOTER},{buttons:[],type:R.BUTTONS}]},{control:w,handleSubmit:L,watch:E,setValue:o}=_e({defaultValues:y}),{components:c}=E(),n=c.find(({type:u})=>u===R.HEADER),d=c.find(({type:u})=>u===R.BODY),h=c.find(({type:u})=>u===R.BUTTONS),q=(U=(I=n==null?void 0:n.example)==null?void 0:I.header_handle)==null?void 0:U[0],ee=[n&&n.format!=="TEXT",n&&n.format==="TEXT"&&n.text&&n.text!==""?n.text.includes("{{1}}"):!1,d&&d.text&&d.text!==""&&d.text.includes("{{1}}"),h&&h.buttons.length>0&&((Q=h.buttons[0])==null?void 0:Q.type)==="URL"&&((N=h.buttons[0])==null?void 0:N.url.includes("{{1}}"))].reduce((u,v)=>u||v,!1),ge=async u=>{try{const v=u.components.map(F=>{var j;return F==null||delete F.active,F.type==="HEADER"&&((j=F==null?void 0:F.example)==null||delete j.header_files),F});if(C){console.log(v);const F=await P.updateWaTemplateComponents(C,{components:v});if(!F.success)throw Error(F.message);b(F.message),a()}}catch(v){g(v.message)}},D=p.exports.useCallback(()=>{c.length>0&&c.forEach(({type:u,text:v})=>{if(u==="BODY"){const F=v.match(B);F&&x(F.map((j,ie)=>ie+1))}})},[c]),Y=p.exports.useCallback(async()=>{try{if(C){const u=await P.getWaTemplateMessage(C);if(!u.success)throw Error(u.message);H(u.payload),o("components",u.payload.components)}}catch(u){g(u.message)}},[C]);return p.exports.useEffect(()=>{Y()},[Y]),p.exports.useEffect(()=>{D()},[D]),s(qe,{anchor:"right",open:r,onClose:(u,v)=>{(!Oe(v)||i)&&a()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[s(Be,{sx:{width:{xs:"100vw",md:360}},children:[r&&s(Ae,{children:[e(A,{onClick:()=>{a()},sx:{width:32,height:32},children:e(Se,{})}),e(Ve,{children:ee&&!i?"Enter Sample Values":"Preview Template"})]}),r&&s(Vt,{onSubmit:L(ge),children:[(!ee||i||l)&&e(Pe,{components:c}),!i&&n&&(n.format==="IMAGE"||n.format==="VIDEO"||n.format==="DOCUMENT")&&e(_,{children:e(sa,{setValue:o,control:w,fileTypes:n.format==="IMAGE"?Te.IMAGE:n.format==="VIDEO"?Te.VIDEO:Te.FILE,label:`Drag & Drop ${n.format.charAt(0).toUpperCase()}${n.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:q!=null?q:"",width:"100%"})}),!i&&n&&n.format==="TEXT"&&n.text.includes("{{1}}")&&e(_,{children:e(O,{control:w,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:K})}),!i&&T.length>0&&T.map((u,v)=>e(_,{children:e(O,{control:w,name:`components[1].example.body_text[${v}]`,label:`Body Variable ${u}`,placeholder:`Body ${u}`,required:!0,sx:K})},`bodyVar{{${u}}}`)),!i&&h&&h.buttons&&h.buttons.length>0&&h.buttons.map((u,v)=>(console.log(u.url),u.type==="URL"&&u.url.match(B)?e(_,{children:e(O,{control:w,name:`components[3].buttons[${v}].example[0]`,label:`URL Button ${v+1}`,placeholder:`Url button ${v+1} variable 1`,required:!0,sx:K})},v):null)),!i&&e(ye,{children:e(X,{type:"submit",children:"Submit for Approval"})}),!i&&s(ye,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(re,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(ve,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{M(C),W(!0),a()},children:"Continue Editing"})]})]})]}),!i&&r&&ee&&S&&e(Be,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(Pe,{components:c})})]})},Sa=()=>{const{isMobile:r,isTablet:a}=fe(),{setErrorMessage:l}=ne(),[S,B]=p.exports.useState(!0),[g,b]=p.exports.useState(!1),{waTemplatesData:C,waTemplateFilter:i,showWaTemplateForm:H,showWaPreviewForm:M,showWaTemplatePreview:W}=ue(),{setWaTemplatesData:T,setTotalWaTemplates:x,setWaTemplateFilter:y,setShowWaTemplateForm:w,setShowWaPreviewForm:L,setShowWaTemplatePreview:E,setEditWaTemplateId:o,setPreviewWaTemplateId:c}=le(),n=p.exports.useCallback(async()=>{try{const d=await P.getWaTemplateMessages();if(!d.success)throw Error(d.message);x(d.payload.length),T(d.payload),B(!1)}catch(d){l(d.message)}},[]);return p.exports.useEffect(()=>{n()},[n]),s(p.exports.Fragment,{children:[e(ut,{children:e("title",{children:"WhatsApp Template Messages"})}),r&&s(Ae,{sx:Ut,children:[!g&&e(A,{component:ft,to:"/business-settings",sx:{width:32,height:32},children:e(Se,{})}),!g&&e(Ve,{children:"Template Messages"}),g&&e(De,{children:s(Ne,{children:[e(A,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(me,{})}),e($e,{onChange:({target:{value:d}})=>y(d),placeholder:"Search Template"}),e(A,{onClick:()=>{y(""),b(!g)},sx:{position:"absolute",right:0,top:0},children:e(Ue,{})})]})}),!g&&C.length>0&&e(A,{onClick:()=>b(d=>!d),children:e(me,{})})]}),e(_t,{sx:qt,children:e(zt,{sx:Xt,children:!S&&e(Ee,{elevation:0,sx:Yt,children:e(ea,{sx:Qt,children:C.length===0?s(jt,{children:[e(Gt,{children:e(X,{disableIcon:!0,onClick:()=>w(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Kt,{children:s(Zt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):s(p.exports.Fragment,{children:[a&&e(ba,{isSearchActive:g,setSearchActive:b}),a&&e(na,{}),C.filter(d=>{var h;return(h=d==null?void 0:d.name)==null?void 0:h.toLowerCase().includes(i==null?void 0:i.toLowerCase())}).map((d,h)=>e(Ca,{...d},h))]})})})})}),r&&C.length>0&&e(Jt,{children:e(X,{onClick:()=>w(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(wa,{open:H,closeDrawer:()=>{o(void 0),w(!1)}}),e(va,{open:M||W,closeDrawer:()=>{c(void 0),L(!1),E(!1)}})]})},ns=()=>e(Sa,{});export{ns as default};
