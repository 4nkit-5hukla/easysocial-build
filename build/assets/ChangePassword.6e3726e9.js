import{b as L,u as V,r,ai as j,A as C,a as t,j as e,$ as B,L as D,aj as H,W as q}from"./index.f42b544b.js";import{u as G}from"./index.esm.e4e55aa9.js";import{a as U,g as z,b as W,R as X}from"./AuthProvider.32351440.js";import{C as S,g as Y}from"./Card.1c94ce7e.js";import{h as $}from"./Tags.4d2d5bca.js";import{F as J,G as K}from"./Grid.88343ef7.js";import{c as Q,H as Z,d as ee,e as se}from"./Wrappers.0745b8d8.js";import{F as u}from"./FormTextField.c9980551.js";import{F as h,A as re,a as y}from"./Form.08e1be77.js";import{F as f}from"./Style.57c2f24e.js";import{L as te}from"./LeftArrow.62a3fa4d.js";import{p as oe}from"./Position.module.ff7b7fa6.js";import"./tslib.es6.61e9e735.js";import"./Card.394defe5.js";import"./CardContent.9e9e57e4.js";import"./withStyles.d2028c8a.js";import"./MenuItem.8689cb1e.js";import"./List.b6176302.js";import"./listItemTextClasses.59466d3b.js";import"./dividerClasses.a17f7f33.js";import"./ListItem.49c02632.js";import"./listItemButtonClasses.e4888797.js";import"./isMuiElement.3c4e2635.js";import"./styled.b600943f.js";import"./TextField.a2283cc7.js";import"./Select.28b63049.js";import"./useFormControl.9673694a.js";import"./Menu.177000ba.js";import"./useControlled.c17368a9.js";import"./ArrowRight.d30f42bd.js";const ae="Y12k",ne={Textfield_helperText:ae},ie=()=>{const{selectedBusiness:l}=L(),{otpVerification:F,sendOTP:w}=U(),{isMobile:E}=V(),[i,A]=r.exports.useState(""),[O,g]=r.exports.useState(!1),[o,P]=r.exports.useState(0),{setErrorMessage:c,setSuccessMessage:b}=j(),x=window,R=z(W),{control:d,handleSubmit:k,reset:N}=G({defaultValues:{OTP:"",newPassword:"",confirmPassword:""}}),v=r.exports.useRef(async()=>{try{const s=await C.authUserDetails();if(s.errors)throw Error(s.errors.pop().message);if(!s.success&&s.message)throw Error(s.message);const{mobile_number:a}=s.payload;A(a)}catch(s){console.log(s)}}),M=()=>{x.recaptchaVerifier=new X("captcha-container",{size:"invisible",callback:async function(){const s=await w(i);x.confirmationResult=s},"expired-callback":function(){alert("try again!")}},R)},_=async()=>{try{if(!i)throw Error("Please enter a valid mobile number");const s=await w(i);if(!s.success&&s.message)throw c(s.message),Error(s.message);s.success&&g(!0),b(s.message),s.success&&P(180)}catch(s){console.log(s)}},I=async s=>{try{const{OTP:a,newPassword:m,confirmPassword:p}=s;if(m===""||p===""){c("Please enter a valid password");return}if(m!==p){c("Passwords do not match");return}const T=await F(a);if(T.success){const n=await C.updatePassword({password:m,confirm_password:p});if(n.errors)throw Error(n.errors.pop().message);if(!n.success&&n.message)throw Error(n.message);b("Password changed successfully"),N()}else c(T.message)}catch(a){console.log(a)}};return r.exports.useEffect(()=>{v.current()},[]),r.exports.useEffect(()=>{M()},[]),r.exports.useEffect(()=>{o>0?setTimeout(()=>{P(o-1)},1e3):o===0&&g(!1)},[o]),t(r.exports.Fragment,{children:[E&&t(Q,{children:[e(B,{component:D,to:l&&l.default_url?l.default_url:"/engage/chat",className:"icon-md-button",children:e(te,{})}),e(Z,{children:"My Profile"})]}),e(r.exports.Suspense,{fallback:e(S,{className:oe.AbsCenter,children:e(H,{height:72,width:72})}),children:e(ee,{children:e(se,{onSubmit:k(I),children:e(S,{elevation:0,children:t(Y,{children:[e($,{children:"Change Password"}),e(J,{children:t(K,{children:[t(h,{children:[e(u,{control:d,name:"OTP",label:"OTP",placeholder:"Enter One Time Password",required:!0,sx:f}),t("div",{className:ne.Textfield_helperText,children:[t("p",{children:["SMS Message sent on ",e("strong",{children:i})]}),e("span",{children:t("p",{children:["Resend OTP in"," ",e("strong",{children:o>0?new Date(o*1e3).toISOString().substring(14,19):"00:00"})," "]})})]})]}),e(h,{children:e(u,{control:d,type:"password",name:"newPassword",label:"New Password",placeholder:"Enter New Password",required:!0,sx:f})}),e(h,{children:e(u,{control:d,type:"password",name:"confirmPassword",label:"Confirm Password",placeholder:"Enter Confirm Password",required:!0,sx:f})})]})}),t(re,{children:[e(y,{type:"button",onClick:_,disableIcon:!0,disabled:!!O,children:"Resend OTP"}),e(y,{type:"submit",children:"Save New Password"})]})]})})})})}),e("div",{id:"captcha-container"})]})},je=()=>t(r.exports.Fragment,{children:[e(q,{children:e("title",{children:"My Profile"})}),e(ie,{})]});export{je as default};
