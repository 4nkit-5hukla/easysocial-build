import{b as I,u as D,r as t,ai as V,A as C,a as r,j as s,$ as B,L as H,W as L}from"./index.1216e28e.js";import{u as j,a as q,R as G,A as U}from"./AuthProvider.c18f3248.js";import{u as z}from"./index.esm.7a23e4a0.js";import{C as W,g as X}from"./Card.1487010d.js";import{h as Y}from"./Tags.a5c433f1.js";import{F as $,G as J}from"./Grid.b54de443.js";import{c as K,H as Q,d as Z,e as ee}from"./Wrappers.0413203c.js";import{F as u}from"./FormTextField.a2d50268.js";import{F as h,A as se,a as S}from"./Form.cbd8321b.js";import{F as f}from"./Style.57c2f24e.js";import{L as re}from"./LeftArrow.a627eb69.js";import"./tslib.es6.61e9e735.js";import"./Card.9aa5f189.js";import"./CardContent.e6225265.js";import"./withStyles.5eadc4a8.js";import"./MenuItem.51acc6a3.js";import"./List.8f8744c2.js";import"./listItemTextClasses.477e07f5.js";import"./dividerClasses.24ea718d.js";import"./ListItem.152d8599.js";import"./listItemButtonClasses.7ee5290a.js";import"./isMuiElement.3e2de034.js";import"./styled.3be2929c.js";import"./TextField.5384ccb5.js";import"./Select.4cd0be1e.js";import"./useFormControl.4dcd90d2.js";import"./Menu.b5c2af2b.js";import"./useControlled.9518d4c9.js";import"./ArrowRight.7030d8f5.js";const te="Y12k",oe={Textfield_helperText:te},ae=()=>{const{selectedBusiness:l}=I(),{auth:y}=j(),{otpVerification:A,sendOTP:w}=q(),{isMobile:E}=D(),[i,F]=t.exports.useState(""),[O,g]=t.exports.useState(!1),[o,P]=t.exports.useState(0),{setErrorMessage:c,setSuccessMessage:b}=V(),x=window,{control:d,handleSubmit:R,reset:v}=z({defaultValues:{OTP:"",newPassword:"",confirmPassword:""}}),k=t.exports.useRef(async()=>{try{const e=await C.authUserDetails();if(e.errors)throw Error(e.errors.pop().message);if(!e.success&&e.message)throw Error(e.message);const{mobile_number:a}=e.payload;F(a)}catch(e){console.log(e)}}),M=()=>{x.recaptchaVerifier=new G("captcha-container",{size:"invisible",callback:async function(){const e=await w(i);x.confirmationResult=e},"expired-callback":function(){alert("try again!")}},y)},N=async()=>{try{if(!i)throw Error("Please enter a valid mobile number");const e=await w(i);if(!e.success&&e.message)throw c(e.message),Error(e.message);e.success&&g(!0),b(e.message),e.success&&P(180)}catch(e){console.log(e)}},_=async e=>{try{const{OTP:a,newPassword:m,confirmPassword:p}=e;if(m===""||p===""){c("Please enter a valid password");return}if(m!==p){c("Passwords do not match");return}const T=await A(a);if(T.success){const n=await C.updatePassword({password:m,confirm_password:p});if(n.errors)throw Error(n.errors.pop().message);if(!n.success&&n.message)throw Error(n.message);b("Password changed successfully"),v()}else c(T.message)}catch(a){console.log(a)}};return t.exports.useEffect(()=>{k.current()},[]),t.exports.useEffect(()=>{M()},[]),t.exports.useEffect(()=>{o>0?setTimeout(()=>{P(o-1)},1e3):o===0&&g(!1)},[o]),r(t.exports.Fragment,{children:[E&&r(K,{children:[s(B,{component:H,to:l&&l.default_url?l.default_url:"/engage/chat",className:"icon-md-button",children:s(re,{})}),s(Q,{children:"My Profile"})]}),s(Z,{children:s(ee,{onSubmit:R(_),children:s(W,{elevation:0,children:r(X,{children:[s(Y,{children:"Change Password"}),s($,{children:r(J,{children:[r(h,{children:[s(u,{control:d,name:"OTP",label:"OTP",placeholder:"Enter One Time Password",required:!0,sx:f}),r("div",{className:oe.Textfield_helperText,children:[r("p",{children:["SMS Message sent on ",s("strong",{children:i})]}),s("span",{children:r("p",{children:["Resend OTP in"," ",s("strong",{children:o>0?new Date(o*1e3).toISOString().substring(14,19):"00:00"})," "]})})]})]}),s(h,{children:s(u,{control:d,type:"password",name:"newPassword",label:"New Password",placeholder:"Enter New Password",required:!0,sx:f})}),s(h,{children:s(u,{control:d,type:"password",name:"confirmPassword",label:"Confirm Password",placeholder:"Enter Confirm Password",required:!0,sx:f})})]})}),r(se,{children:[s(S,{type:"button",onClick:N,disableIcon:!0,disabled:!!O,children:"Resend OTP"}),s(S,{type:"submit",children:"Save New Password"})]})]})})})}),s("div",{id:"captcha-container"})]})},Ie=()=>r(U,{children:[s(L,{children:s("title",{children:"My Profile"})}),s(ae,{})]});export{Ie as default};
