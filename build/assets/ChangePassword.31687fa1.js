import{b as I,u as D,r as t,ai as V,A as C,a as r,j as s,$ as B,L as H,W as L}from"./index.b6939ac4.js";import{u as j}from"./index.esm.0195c433.js";import{u as q,a as G,R as U}from"./AuthProvider.d84b9e9f.js";import{C as z,g as W}from"./Card.ad2a40c1.js";import{h as X}from"./Tags.f00820e2.js";import{F as Y,G as $}from"./Grid.c94a65f1.js";import{c as J,H as K,d as Q,e as Z}from"./Wrappers.947cf4f4.js";import{F as u}from"./FormTextField.02b305ff.js";import{F as h,A as ee,a as S}from"./Form.d6354f4c.js";import{F as f}from"./Style.57c2f24e.js";import{L as se}from"./LeftArrow.8243e218.js";import"./tslib.es6.61e9e735.js";import"./Card.693f787f.js";import"./CardContent.6cf6a0bd.js";import"./withStyles.ca30600a.js";import"./MenuItem.61818f9c.js";import"./List.cdccc7e3.js";import"./listItemTextClasses.ceb65530.js";import"./dividerClasses.5f8b1a07.js";import"./ListItem.8eaa2bd4.js";import"./listItemButtonClasses.1e7433d2.js";import"./isMuiElement.b8c25462.js";import"./styled.a7bc2035.js";import"./TextField.d30c805e.js";import"./Select.479df9cf.js";import"./useFormControl.d77c63c8.js";import"./Menu.ebd65fdc.js";import"./useControlled.4ac3feb9.js";import"./ArrowRight.60cb55a6.js";const re="Y12k",te={Textfield_helperText:re},oe=()=>{const{selectedBusiness:l}=I(),{auth:y}=q(),{otpVerification:F,sendOTP:w}=G(),{isMobile:E}=D(),[i,O]=t.exports.useState(""),[A,g]=t.exports.useState(!1),[o,P]=t.exports.useState(0),{setErrorMessage:c,setSuccessMessage:b}=V(),x=window,{control:d,handleSubmit:R,reset:k}=j({defaultValues:{OTP:"",newPassword:"",confirmPassword:""}}),v=t.exports.useRef(async()=>{try{const e=await C.authUserDetails();if(e.errors)throw Error(e.errors.pop().message);if(!e.success&&e.message)throw Error(e.message);const{mobile_number:a}=e.payload;O(a)}catch(e){console.log(e)}}),M=()=>{x.recaptchaVerifier=new U("captcha-container",{size:"invisible",callback:async function(){const e=await w(i);x.confirmationResult=e},"expired-callback":function(){alert("try again!")}},y)},N=async()=>{try{if(!i)throw Error("Please enter a valid mobile number");const e=await w(i);if(!e.success&&e.message)throw c(e.message),Error(e.message);e.success&&g(!0),b(e.message),e.success&&P(180)}catch(e){console.log(e)}},_=async e=>{try{const{OTP:a,newPassword:m,confirmPassword:p}=e;if(m===""||p===""){c("Please enter a valid password");return}if(m!==p){c("Passwords do not match");return}const T=await F(a);if(T.success){const n=await C.updatePassword({password:m,confirm_password:p});if(n.errors)throw Error(n.errors.pop().message);if(!n.success&&n.message)throw Error(n.message);b("Password changed successfully"),k()}else c(T.message)}catch(a){console.log(a)}};return t.exports.useEffect(()=>{v.current()},[]),t.exports.useEffect(()=>{M()},[]),t.exports.useEffect(()=>{o>0?setTimeout(()=>{P(o-1)},1e3):o===0&&g(!1)},[o]),r(t.exports.Fragment,{children:[E&&r(J,{children:[s(B,{component:H,to:l&&l.default_url?l.default_url:"/engage/chat",className:"icon-md-button",children:s(se,{})}),s(K,{children:"My Profile"})]}),s(Q,{children:s(Z,{onSubmit:R(_),children:s(z,{elevation:0,children:r(W,{children:[s(X,{children:"Change Password"}),s(Y,{children:r($,{children:[r(h,{children:[s(u,{control:d,name:"OTP",label:"OTP",placeholder:"Enter One Time Password",required:!0,sx:f}),r("div",{className:te.Textfield_helperText,children:[r("p",{children:["SMS Message sent on ",s("strong",{children:i})]}),s("span",{children:r("p",{children:["Resend OTP in"," ",s("strong",{children:o>0?new Date(o*1e3).toISOString().substring(14,19):"00:00"})," "]})})]})]}),s(h,{children:s(u,{control:d,type:"password",name:"newPassword",label:"New Password",placeholder:"Enter New Password",required:!0,sx:f})}),s(h,{children:s(u,{control:d,type:"password",name:"confirmPassword",label:"Confirm Password",placeholder:"Enter Confirm Password",required:!0,sx:f})})]})}),r(ee,{children:[s(S,{type:"button",onClick:N,disableIcon:!0,disabled:!!A,children:"Resend OTP"}),s(S,{type:"submit",children:"Save New Password"})]})]})})})}),s("div",{id:"captcha-container"})]})},_e=()=>r(t.exports.Fragment,{children:[s(L,{children:s("title",{children:"My Profile"})}),s(oe,{})]});export{_e as default};
