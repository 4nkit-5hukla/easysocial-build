import{k as pt,l as mt,m as pe,h as se,r as n,n as ut,_ as ht,T as oe,j as e,a,p as ft,v as Ct,Z as re,aL as ne,a0 as k,aM as me,aN as Ae,u as ue,ap as Ie,aE as gt,an as Tt,W as bt,L as yt}from"./index.406b108e.js";import{C as xt,W as _,a as Fe}from"./WaTemplatePreviewCard.5c2e4953.js";import{L as ve}from"./LeftArrow.1929b5c9.js";import{S as de}from"./Search.924a7922.js";import{c as Ne,H as Re,d as vt,I as We,g as wt,h as St}from"./Wrappers.a19a0174.js";import{a as q,F as D,b as ie,V as be,c as ce,d as G,A as ye,e as le}from"./Form.e8e4afd6.js";import{S as Pe,a as He,b as Oe}from"./Search.4000f78b.js";import{a as Et,b as Ft,c as Wt,d as Mt,e as Lt,f as Bt,C as Me,g as At}from"./Card.2f464abd.js";import{C as It,a as Nt,b as Rt}from"./Cta.7c0f8698.js";import Pt from"./LinkPlatForm.07224e92.js";import{p as Ht}from"./Position.module.ff7b7fa6.js";import{W as Ot,a as N}from"./WhatsApp.0df87c02.js";import{L as kt}from"./ListItem.a763bec7.js";import{L as $t}from"./ListItemText.b9a6f519.js";import{C as Dt}from"./Chip.ddce13bd.js";import{L as Vt}from"./ListItemIcon.b29c167a.js";import{M as Ut}from"./MoreVert.ff970665.js";import{M as _t}from"./Menu.f7251f44.js";import{M as I}from"./MenuItem.bceeb030.js";import{C as ke}from"./Clear.5a4738ce.js";import{u as $e}from"./index.esm.2aab6df4.js";import{D as xe,a as qt,b as Qt,c as De}from"./Drawer.4aaacab5.js";import{F as ee,G as te,S as Yt}from"./Grid.26400928.js";import{F as z,b as ae,d as fe}from"./Style.d96d560c.js";import{F as Ce}from"./FormIOSSwitch.0d097aa7.js";import{F as R}from"./FormTextField.4c9bafa4.js";import{C as Ve}from"./Card.cd1015dd.js";import{g as Xt}from"./mui-tel-input.es.c0c8a924.js";import{d as zt,e as jt}from"./Styles.3fefcec0.js";import{T as Kt}from"./TextField.871d729d.js";import{D as Ue}from"./Drawer.04356e2b.js";import{F as Gt}from"./FileUpload.b259c714.js";import{F as ge}from"./index.1cd65546.js";import{L as Zt}from"./Link.f76dae57.js";import{D as Jt}from"./Divider.481a7825.js";import"./Play.da4a7ccb.js";import"./ArrowRight.96d15e0a.js";import"./CardContent.c3b7b4e1.js";import"./Tags.f1ff3942.js";import"./withStyles.0f295abb.js";import"./List.90013459.js";import"./CommonComponents.5d68fc16.js";import"./listItemTextClasses.198283a0.js";import"./listItemButtonClasses.86609c12.js";import"./isMuiElement.204b9160.js";import"./SwitchBase.9bcc62a8.js";import"./Select.faf7fc1d.js";import"./useControlled.1c86ebca.js";import"./InputAdornment.47527c66.js";import"./AssetsApi.10489d0c.js";function ea(s){return mt("MuiCardHeader",s)}const ta=pt("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Le=ta,aa=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],sa=s=>{const{classes:o}=s;return Ct({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},ea,o)},oa=pe("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(s,o)=>se({[`& .${Le.title}`]:o.title,[`& .${Le.subheader}`]:o.subheader},o.root)})({display:"flex",alignItems:"center",padding:16}),ra=pe("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(s,o)=>o.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),na=pe("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(s,o)=>o.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),la=pe("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(s,o)=>o.content})({flex:"1 1 auto"}),ia=n.exports.forwardRef(function(o,p){const v=ut({props:o,name:"MuiCardHeader"}),{action:L,avatar:d,className:g,component:E="div",disableTypography:C=!1,subheader:y,subheaderTypographyProps:F,title:P,titleTypographyProps:f}=v,h=ht(v,aa),W=se({},v,{component:E,disableTypography:C}),w=sa(W);let T=P;T!=null&&T.type!==oe&&!C&&(T=e(oe,se({variant:d?"body2":"h5",className:w.title,component:"span",display:"block"},f,{children:T})));let m=y;return m!=null&&m.type!==oe&&!C&&(m=e(oe,se({variant:d?"body2":"body1",className:w.subheader,color:"text.secondary",component:"span",display:"block"},F,{children:m}))),a(oa,se({className:ft(w.root,g),as:E,ref:p,ownerState:W},h,{children:[d&&e(ra,{className:w.avatar,ownerState:W,children:d}),a(la,{className:w.content,ownerState:W,children:[T,m]}),L&&e(na,{className:w.action,ownerState:W,children:L})]}))}),_e=ia,ca=({color:s="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:s})}),da={px:{xs:0,md:2}},pa="yMNf",ma="xmX7",Be={WTMItem:pa,OptionMenuPaper:ma},ua=({template_status:s,name:o,id:p,description:v})=>{const{setErrorMessage:L,setSuccessMessage:d}=re(),{setEditWaTemplateId:g,setShowWaTemplateForm:E,setPreviewWaTemplateId:C,setShowWaTemplatePreview:y}=ne(),[F,P]=n.exports.useState(null),[f,h]=n.exports.useState(!1),W=()=>{h(!0)},w=()=>{h(!1)},T=H=>{P(H.currentTarget)},m=()=>{P(null)},Q=async()=>{try{const H=await _.deleteWaTemplateMessage(p);if(!H.success)throw Error(H.message);d(H.message),setTimeout(()=>window.location.reload(),1e3)}catch(H){L(H.message)}finally{w()}};return a(n.exports.Fragment,{children:[a(kt,{component:"div",sx:da,children:[e($t,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:o}),e(Dt,{label:s,size:"small",sx:{bgcolor:Ot[s]}})]}),secondary:v,className:Be.WTMItem}),e(Vt,{children:e(k,{onClick:T,children:e(Ut,{})})})]}),Boolean(F)&&a(_t,{anchorEl:F,open:Boolean(F),onClose:m,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:Be.OptionMenuPaper},children:[s==="DRAFT"&&e(I,{onClick:()=>{g(p),E(!0),m()},children:"Edit"}),(s==="SUBMITTED"||s==="APPROVED")&&e(I,{onClick:()=>{C(p),y(!0),m()},children:"Preview"}),e(I,{onClick:()=>{W(),m()},children:"Delete"})]}),e(xt,{title:"Delete",open:f,setOpen:h,onConfirm:async()=>await Q(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},ha=({isSearchActive:s,setSearchActive:o})=>{const{setErrorMessage:p,setSuccessMessage:v}=re(),{totalWaTemplates:L}=me(),{setWaTemplateFilter:d,setShowWaTemplateForm:g,setTotalWaTemplates:E,setWaTemplatesData:C}=ne(),[y,F]=n.exports.useState(!1),P=async()=>{try{F(!0);const f=await _.syncWaTemplateMessage();if(f.success){const h=await _.getWaTemplateMessages();if(!h.success)throw Error(f.message);E(h.payload.length),C(h.payload),v(f.message)}else p(f.message)}catch(f){p(f.message)}finally{F(!1)}};return a(Et,{children:[e(Ft,{children:e(q,{disableIcon:!0,type:"button",onClick:()=>g(!0),className:"small",children:"New Template Message"})}),a(Wt,{children:[!s&&e(Mt,{children:e(Lt,{children:`${L} Template Messages`})}),a(Bt,{children:[s&&e(Pe,{children:a(He,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(de,{})}),e(Oe,{onChange:({target:{value:f}})=>d(f),placeholder:"Search Template"}),e(k,{onClick:()=>{d(""),o(!s)},sx:{position:"absolute",right:0,top:0},children:e(ke,{})})]})}),!s&&e(k,{onClick:()=>o(f=>!f),children:e(de,{})}),!s&&e(q,{icon:e(ca,{color:y?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:y,onClick:()=>P(),className:"sync",children:y?"Syncing...":"Sync Messages"})]})]})]})},X=/[{][{]\d{1,3}[}][}]/gm,fa="oIEe",Ca="CaIb",qe={QrButtonCard:fa,CtaButtonCard:Ca},ga=({index:s,control:o,removeQuickReply:p})=>a(Ve,{className:qe.QrButtonCard,elevation:0,children:[e(_e,{title:`Quick Reply ${s+1}`,action:e(k,{"aria-label":`Remove Quick Reply ${s+1}`,onClick:()=>p(s),children:e(Ae,{})})}),e(D,{sx:{my:2},children:e(R,{control:o,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:z})})]},s),Ta=({index:s,type:o,url:p,phone_number:v,waTemplateButtonCtaTypes:L,control:d,setValue:g,removeCallAction:E})=>{const{country:C}=ue(),[y,F]=n.exports.useState(0),P=()=>{if(y===1)return;const h=`${p}{{${1}}}`;g(`components[3].buttons[${s}].url`,h),F(1)},f=n.exports.useCallback(()=>{if(p){const h=p.match(X);h&&h.length>0?F(1):F(0)}},[p]);return n.exports.useEffect(()=>{f()},[f]),a(Ve,{className:qe.CtaButtonCard,elevation:0,children:[e(_e,{title:`Call to Action ${s+1}`,action:e(k,{"aria-label":`Remove Call to Action ${s+1}`,onClick:()=>E(s),children:e(Ae,{})})}),e(D,{sx:{my:2},children:a(R,{select:!0,control:d,label:"Action Type",name:`components[3].buttons[${s}].type`,sx:zt,required:!0,defaultValue:o,children:[e(I,{value:"",disabled:!0,children:"Select Action Type"}),L.map(({value:h,name:W},w)=>e(I,{value:h,children:W},w))]})}),o!==""&&e(D,{sx:{my:2},children:e(R,{control:d,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:z})}),o==="PHONE_NUMBER"&&e(D,{sx:{my:2},children:e(Xt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:C,value:v!=null?v:"",onChange:h=>{g(`components[3].buttons[${s}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:jt})}),o==="URL"&&a(D,{sx:{my:2},children:[a(ie,{children:[e(R,{control:d,name:`components[3].buttons[${s}].url`,label:"URL",required:!0,sx:{...z,pb:2,height:"auto"}}),e(be,{size:"small",focusRipple:!1,className:"add-variable",disabled:y===1,onClick:P,children:"ADD VARIABLE"})]}),a(ce,{children:[a(G,{children:[p?p.length:0,"/60 Characters"]}),a(G,{children:[y,"/1 Variable"]})]})]})]},s)},ba=({open:s,closeDrawer:o})=>{const{setErrorMessage:p,setSuccessMessage:v}=re(),{businessId:L}=ue(),{editWaTemplateId:d,waTemplatesData:g,waTemplateCategories:E,waTemplateLanguages:C,waTemplateTypes:y,waTemplateHeaderTypes:F,waTemplateButtonTypes:P,waTemplateButtonCtaTypes:f}=me(),{setWaTemplatesData:h,setShowWaPreviewForm:W,setPreviewWaTemplateId:w}=ne(),T={name:"",category:"",language:"",template_type:"",businessId:L,components:[{format:"",text:"",type:N.HEADER,active:!1},{text:"",type:N.BODY},{text:"",type:N.FOOTER,active:!1},{buttons:[],type:N.BUTTONS,active:!1}]},{control:m,handleSubmit:Q,watch:H,reset:x,setValue:r}=$e({defaultValues:T}),{name:u,category:B,language:Z,template_type:A,components:j}=H(),M=j.find(({type:t})=>t===N.HEADER),V=j.find(({type:t})=>t===N.BODY),Y=j.find(({type:t})=>t===N.FOOTER),O=j.find(({type:t})=>t===N.BUTTONS),[K,U]=n.exports.useState(0),[i,b]=n.exports.useState(""),S=n.exports.useCallback(()=>{const l=u.match(/^[A-Za-z0-9_]+$/g)===null?u.slice(0,-1):u.replace(/\s/g,"").toLowerCase();r("name",l)},[u]),J=()=>{if(K===1)return;const t=`${M.text}{{${1}}}`;r("components[0].text",t),U(1)},he=()=>{const t=V.text.match(X),l=t&&t.length>0?`${V.text}{{${t.length+1}}}`:`${V.text}{{${1}}}`;r("components[1].text",l)},we=n.exports.useCallback(()=>{const t=M.text.match(X);t&&t.length>0?U(1):U(0)},[M.text]),Se=n.exports.useCallback(()=>{const t=M.text.match(X);if(t===null){U(0);return}if(t.length===0){U(0);return}r("components[0].text",t.reduce((l,c,$)=>$===0?l.replace(c,`{{${$+1}}}`):l.replace(c,""),t.reduce((l,c,$)=>l.replace(c,`{{${$+1}}}`),M.text))),U(1)},[M.text]),Qe=()=>{const t=V.text.match(X);t!==null&&t.length!==0&&r("components[1].text",t.reduce((l,c,$)=>l.replace(c,`{{${$+1}}}`),V.text))},Ye=t=>{b(t.target.value)},Xe=()=>{if(i===""&&p("Please Select button Type"),i==="QUICK_REPLY")if(O.buttons.length<3){const t=O.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else p("Limit exceeded");if(i==="CALL_TO_ACTION")if(O.buttons.length<2){const t=O.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else p("Limit exceeded")},ze=t=>{const l=O.buttons;l.splice(t,1),r("components[3].buttons",l)},je=t=>{const l=O.buttons;l.splice(t,1),r("components[3].buttons",l)},Ke=e(R,{control:m,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:z}),Ge=a(R,{select:!0,control:m,label:"Template Category",name:"category",sx:ae,required:!0,defaultValue:B,children:[e(I,{value:"",disabled:!0,children:"Select Template Category"}),E.map(({value:t,name:l},c)=>e(I,{value:t,children:l},c))]}),Ze=a(R,{select:!0,control:m,label:"Language",name:"language",sx:ae,required:!0,defaultValue:Z,children:[e(I,{value:"",disabled:!0,children:"Select Language"}),C.map(({code:t,name:l},c)=>e(I,{value:t,children:l},c))]}),Je=a(R,{select:!0,control:m,label:"Template Type",name:"template_type",sx:ae,required:!0,defaultValue:A,children:[e(I,{value:"",disabled:!0,children:"Select Template Type"}),y.map(({value:t,label:l},c)=>e(I,{value:t,children:l},c))]}),et=a(ee,{className:"justify-content-between",children:[e(te,{children:e(le,{children:"Header"})}),e(Ce,{control:m,name:"components[0].active"})]}),tt=a(R,{select:!0,control:m,label:"Header Type",name:"components[0].format",sx:ae,required:!0,defaultValue:M.format,children:[e(I,{value:"",disabled:!0,children:"Select Header Type"}),F.map(({value:t,name:l},c)=>e(I,{value:t,children:l},c))]}),at=a(n.exports.Fragment,{children:[a(ie,{children:[e(R,{control:m,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:fe}),e(be,{size:"small",focusRipple:!1,className:"add-variable",disabled:K===1,onClick:J,children:"ADD VARIABLE"})]}),a(ce,{children:[a(G,{children:[M.text.length,"/60 Characters"]}),a(G,{children:[K,"/1 Variable"]})]})]}),st=e(le,{children:"Body"}),ot=a(n.exports.Fragment,{children:[a(ie,{children:[e(R,{control:m,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Qe,inputProps:{maxLength:1024},sx:fe}),e(be,{size:"small",focusRipple:!1,className:"add-variable",onClick:he,children:"ADD VARIABLE"})]}),e(ce,{children:a(G,{children:[V.text.length,"/1024 Characters"]})})]}),rt=a(ee,{className:"justify-content-between",children:[e(te,{children:e(le,{children:"Footer"})}),e(Ce,{control:m,name:"components[2].active"})]}),nt=a(n.exports.Fragment,{children:[e(ie,{children:e(R,{control:m,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:fe})}),e(ce,{children:a(G,{children:[Y.text.length,"/60 Characters"]})})]}),lt=a(ee,{className:"justify-content-between",children:[e(te,{children:e(le,{children:"Buttons"})}),e(Ce,{control:m,name:"components[3].active"})]}),it=a(n.exports.Fragment,{children:[a(ee,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(te,{children:a(Kt,{select:!0,label:"Button Type",sx:ae,required:!0,value:i,onChange:Ye,disabled:O.buttons.length>0,children:[e(I,{value:"",disabled:!0,children:"Select Button Type"}),P.map(({label:t,name:l},c)=>e(I,{value:l,children:t},c))]})}),e(Yt,{children:e(q,{variant:"outlined",color:"primary",onClick:Xe,disableIcon:!0,children:"Add a Button"})})]}),A==="media"&&O.active&&O.buttons.length>0&&e(n.exports.Fragment,{children:O.buttons.map(({type:t,url:l,phone_number:c},$)=>{switch(t){case"QUICK_REPLY":return e(ga,{index:$,removeQuickReply:ze,control:m},$);default:return e(Ta,{index:$,type:t,url:l,phone_number:c,waTemplateButtonCtaTypes:f,control:m,setValue:r,removeCallAction:je},$)}})})]}),ct=[Ke,Ge,Ze,Je,...A==="media"?[et]:[],...A==="media"&&M.active?[tt]:[],...A==="media"&&M.active&&M.format==="TEXT"?[at]:[],...A!==""?[st]:[],...A!==""?[ot]:[],...A==="media"?[rt]:[],...A==="media"&&Y.active?[nt]:[],...A==="media"?[lt]:[],...A==="media"&&O.active?[it]:[]],dt=async t=>{var l;try{if(d){const c=await _.updateWaTemplateMessage(d,t);if(!c.success)throw Error(c.message);v(c.message),w((l=c.payload.id)!=null?l:d),x(T),o(),W(!0)}else{const c=await _.createWaTemplateMessage(t);if(!c.success)throw Error(c.message);v(c.message),h([c.payload,...g]),w(c.payload.id),x(T),o(),W(!0)}}catch(c){p(c.message)}},Ee=n.exports.useCallback(async()=>{try{if(d){const t=await _.getWaTemplateMessage(d);if(!t.success)throw Error(t.message);x(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?b("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&b("CALL_TO_ACTION"))}}catch(t){p(t.message)}},[d]);return n.exports.useEffect(()=>{Ee()},[Ee]),n.exports.useEffect(()=>{S()},[S]),n.exports.useEffect(()=>{Se()},[Se]),n.exports.useEffect(()=>{we()},[we]),n.exports.useEffect(()=>{M.active||r("components[0].format","")},[M.active]),n.exports.useEffect(()=>{Y.active||r("components[2].text","")},[Y.active]),e(Ue,{anchor:"right",open:s,onClose:(t,l)=>{Ie(l)||(x(T),o())},sx:{zIndex:"modal"},children:a(xe,{children:[a(qt,{children:[e(k,{onClick:()=>{x(T),o()},className:"icon-md-button",children:e(ve,{})}),e(Qt,{children:`${d?"Update":"Create New"} Template`})]}),a(De,{onSubmit:Q(dt),onReset:()=>{x(T),o()},children:[e(ee,{children:e(te,{children:ct.map((t,l)=>e(D,{children:t},l))})}),a(ye,{children:[e(q,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(q,{type:"submit",children:"Preview & Save"})]})]})]})})},ya="nOWk",xa="_0oHa",va="Ef-W",Te={WaTemplatePreview:ya,WaTemplatePreviewPaper:xa,ActionArea:va},wa=({open:s,closeDrawer:o})=>{var Y,O,K,U;const{isMobile:p,isTablet:v}=ue(),{setErrorMessage:L,setSuccessMessage:d}=re(),{previewWaTemplateId:g,previewWaTemplateData:E,showWaPreviewForm:C,showWaTemplatePreview:y}=me(),{setPreviewWaTemplateData:F,setEditWaTemplateId:P,setShowWaTemplateForm:f}=ne(),[h,W]=n.exports.useState([]),w={components:[{format:"",text:"",type:N.HEADER},{text:"",type:N.BODY},{text:"",type:N.FOOTER},{buttons:[],type:N.BUTTONS}]},{control:T,handleSubmit:m,watch:Q,setValue:H}=$e({defaultValues:w}),{components:x}=Q(),r=x.find(({type:i})=>i===N.HEADER),u=x.find(({type:i})=>i===N.BODY),B=x.find(({type:i})=>i===N.BUTTONS),Z=(O=(Y=r==null?void 0:r.example)==null?void 0:Y.header_handle)==null?void 0:O[0],A=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,u&&u.text&&u.text!==""&&u.text.includes("{{1}}"),B&&B.buttons.length>0&&((K=B.buttons[0])==null?void 0:K.type)==="URL"&&((U=B.buttons[0])==null?void 0:U.url.includes("{{1}}"))].reduce((i,b)=>i||b,!1),j=async i=>{try{const b=i.components.map(S=>{var J;return S==null||delete S.active,S.type==="HEADER"&&((J=S==null?void 0:S.example)==null||delete J.header_files),S});if(g){console.log(b);const S=await _.updateWaTemplateComponents(g,{components:b});if(!S.success)throw Error(S.message);d(S.message),o()}}catch(b){L(b.message)}},M=n.exports.useCallback(()=>{x.length>0&&x.forEach(({type:i,text:b})=>{if(i==="BODY"){const S=b.match(X);S&&W(S.map((J,he)=>he+1))}})},[x]),V=n.exports.useCallback(async()=>{try{if(g){const i=await _.getWaTemplateMessage(g);if(!i.success)throw Error(i.message);F(i.payload),H("components",i.payload.components)}}catch(i){L(i.message)}},[g]);return n.exports.useEffect(()=>{V()},[V]),n.exports.useEffect(()=>{M()},[M]),a(Ue,{anchor:"right",open:s,onClose:(i,b)=>{(!Ie(b)||y)&&o()},classes:{root:Te.WaTemplatePreview,paper:Te.WaTemplatePreviewPaper},children:[a(xe,{children:[s&&a(Ne,{children:[e(k,{onClick:()=>{o()},className:"icon-md-button",children:e(ve,{})}),e(Re,{children:A&&!y?"Enter Sample Values":"Preview Template"})]}),s&&a(De,{onSubmit:m(j),children:[(!A||y||p)&&E&&e(Fe,{components:E.components}),C&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e(D,{children:e(Gt,{setValue:H,control:T,fileTypes:r.format==="IMAGE"?ge.IMAGE:r.format==="VIDEO"?ge.VIDEO:ge.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:Z!=null?Z:"",width:"100%"})}),C&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e(D,{children:e(R,{control:T,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:z})}),C&&h.length>0&&h.map((i,b)=>e(D,{children:e(R,{control:T,name:`components[1].example.body_text[${b}]`,label:`Body Variable ${i}`,placeholder:`Body ${i}`,required:!0,sx:z})},`bodyVar{{${i}}}`)),C&&B&&B.buttons&&B.buttons.length>0&&B.buttons.map((i,b)=>i.type==="URL"&&i.url.match(X)?e(D,{children:e(R,{control:T,name:`components[3].buttons[${b}].example[0]`,label:`URL Button ${b+1}`,placeholder:`Url button ${b+1} variable 1`,required:!0,sx:z})},b):null),C&&e(ye,{children:e(q,{type:"submit",children:"Submit for Approval"})}),C&&a(ye,{className:Te.ActionArea,children:[e(oe,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(Zt,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{P(g),f(!0),o()},children:"Continue Editing"})]})]})]}),!y&&s&&A&&v&&e(xe,{className:"ExtendedDrawer",children:e(Fe,{components:x})})]})},Sa=()=>{const{isMobile:s,isTablet:o}=ue(),{setErrorMessage:p}=re(),[v,L]=n.exports.useState(!0),[d,g]=n.exports.useState(!1),{waTemplatesData:E,waTemplateFilter:C,showWaTemplateForm:y,showWaPreviewForm:F,showWaTemplatePreview:P}=me(),{setWaTemplatesData:f,setTotalWaTemplates:h,setWaTemplateFilter:W,setShowWaTemplateForm:w,setShowWaPreviewForm:T,setShowWaTemplatePreview:m,setEditWaTemplateId:Q,setPreviewWaTemplateId:H}=ne(),{platformExist:x}=gt(),r=n.exports.useRef(async()=>{try{const u=await _.getWaTemplateMessages();if(!u.success)throw Error(u.message);h(u.payload.length),f(u.payload)}catch(u){p(u.message)}finally{L(!1)}});return n.exports.useEffect(()=>{typeof x=="boolean"&&x&&r.current()},[x]),v?e(Me,{className:Ht.AbsCenter,children:e(Tt,{height:72,width:72})}):a(n.exports.Fragment,{children:[e(bt,{children:e("title",{children:"WhatsApp Template Messages"})}),s&&a(Ne,{children:[!d&&e(k,{component:yt,to:"/business-settings",className:"icon-md-button",children:e(ve,{})}),!d&&e(Re,{children:"Template Messages"}),d&&e(Pe,{children:a(He,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(de,{})}),e(Oe,{onChange:({target:{value:u}})=>W(u),placeholder:"Search Template"}),e(k,{onClick:()=>{W(""),g(!d)},sx:{position:"absolute",right:0,top:0},children:e(ke,{})})]})}),!d&&E.length>0&&e(k,{onClick:()=>g(u=>!u),children:e(de,{})})]}),e(vt,{children:typeof x=="boolean"&&x===!1?e(We,{children:e(Pt,{})}):e(We,{children:!v&&e(Me,{elevation:0,children:e(At,{children:E.length===0?a(wt,{children:[e(It,{children:e(q,{disableIcon:!0,onClick:()=>w(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Nt,{children:a(Rt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(n.exports.Fragment,{children:[o&&e(ha,{isSearchActive:d,setSearchActive:g}),o&&e(Jt,{}),E.filter(u=>{var B;return(B=u==null?void 0:u.name)==null?void 0:B.toLowerCase().includes(C==null?void 0:C.toLowerCase())}).map((u,B)=>e(ua,{...u},B))]})})})})}),s&&E.length>0&&e(St,{children:e(q,{onClick:()=>w(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(ba,{open:y,closeDrawer:()=>{Q(void 0),w(!1)}}),e(wa,{open:F||P,closeDrawer:()=>{H(void 0),T(!1),m(!1)}})]})},xs=()=>e(Sa,{});export{xs as default};
