var et=Object.defineProperty;var tt=(r,a,l)=>a in r?et(r,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[a]=l;var z=(r,a,l)=>(tt(r,typeof a!="symbol"?a+"":a,l),l);import{g as at,e as st,s as pe,_ as ae,r as p,l as rt,c as nt,T as se,j as e,a as s,p as ot,q as lt,A as Q,b as ne,aK as oe,$ as A,an as it,ao as ct,ap as dt,aq as pt,V as re,aL as me,aM as Oe,u as he,am as Ne,B as mt,aN as ht,W as ut,L as gt}from"./index.38d3e2dd.js";import{b as X,A as ye}from"./CommonComponents.4b14a98c.js";import{T as ft,p as xt,q as Ct,r as bt,s as Tt,t as yt,u as Ae,v as Ve,w as $e,j as F,k as j,l as G,m as wt,ac as ie,ad as we,ae as ce,af as K,D as ve,b as Ee,H as Me,o as Ue,F as ee,G as te,ag as le,N as xe,S as vt,ah as St,ai as Et,aj as Le,ak as Ie,al as Mt,am as Ft,an as Wt,ao as Rt,ap as Ce,x as Bt,c as Ht,y as Lt,I as It,z as kt,f as Pt,g as Dt,A as Ot,B as Nt,E as At,J as Vt,K as $t}from"./LayoutComponents.281bca3c.js";import{L as Fe}from"./LeftArrow.79d13e8d.js";import{S as de}from"./Search.eb7289a1.js";import{c as Ut,d as B}from"./WhatsApp.c407ea69.js";import{L as _t}from"./ListItem.5c80c32b.js";import{a as qt,L as zt}from"./ListItemText.b12da6d0.js";import{C as Xt}from"./Chip.59b969a4.js";import{M as Yt}from"./MoreVert.6092d02d.js";import{M as Qt}from"./Menu.e94f9734.js";import{M as k}from"./MenuItem.e4a73d64.js";import{C as _e}from"./Clear.22c6fb00.js";import{F as P,u as qe}from"./FormTextField.3be4b1b3.js";import{F as be}from"./FormIOSSwitch.60a3fce3.js";import{C as We,a as jt}from"./CardContent.840d963f.js";import{A as Gt}from"./mui-tel-input.es.f3ba5d40.js";import{D as ze}from"./Drawer.44479df8.js";import{T as Kt}from"./TextField.23840b04.js";import{F as Zt}from"./FileUpload.85e1087a.js";import{F as Te}from"./index.4d99cedd.js";import{P as Jt,a as ea}from"./Play.fb86498e.js";import{C as ke}from"./CardMedia.a1784c14.js";import{L as Se}from"./Link.b9ea19fd.js";import{D as ta}from"./Divider.6dae6579.js";import"./styled.9bec237d.js";import"./List.7ef95385.js";import"./listItemButtonClasses.50a58ae2.js";import"./isMuiElement.7c1115e8.js";import"./listItemTextClasses.a01ad07e.js";import"./Switch.6aeef662.js";import"./SwitchBase.fc61454b.js";import"./useFormControl.318bb611.js";import"./InputAdornment.d3f5d9a0.js";import"./Select.68c58a58.js";import"./Img.78fb84e2.js";function aa(r){return st("MuiCardHeader",r)}const sa=at("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Pe=sa,ra=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],na=r=>{const{classes:a}=r;return lt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},aa,a)},oa=pe("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(r,a)=>ae({[`& .${Pe.title}`]:a.title,[`& .${Pe.subheader}`]:a.subheader},a.root)})({display:"flex",alignItems:"center",padding:16}),la=pe("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(r,a)=>a.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),ia=pe("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(r,a)=>a.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ca=pe("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(r,a)=>a.content})({flex:"1 1 auto"}),da=p.exports.forwardRef(function(a,l){const v=rt({props:a,name:"MuiCardHeader"}),{action:L,avatar:f,className:b,component:C="div",disableTypography:i=!1,subheader:R,subheaderTypographyProps:M,title:W,titleTypographyProps:T}=v,x=nt(v,ra),y=ae({},v,{component:C,disableTypography:i}),w=na(y);let H=W;H!=null&&H.type!==se&&!i&&(H=e(se,ae({variant:f?"body2":"h5",className:w.title,component:"span",display:"block"},T,{children:H})));let S=R;return S!=null&&S.type!==se&&!i&&(S=e(se,ae({variant:f?"body2":"body1",className:w.subheader,color:"text.secondary",component:"span",display:"block"},M,{children:S}))),s(oa,ae({className:ot(w.root,b),as:C,ref:l,ownerState:y},x,{children:[f&&e(la,{className:w.avatar,ownerState:y,children:f}),s(ca,{className:w.content,ownerState:y,children:[H,S]}),L&&e(ia,{className:w.action,ownerState:y,children:L})]}))}),Xe=da,pa=()=>s("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"//www.w3.org/2000/svg",children:[e("path",{d:"M10.5378 1.11084H7.60995C7.35479 1.11084 7.14798 1.31765 7.14798 1.57281C7.14798 1.82797 7.35479 2.03478 7.60995 2.03478H9.42251L4.99274 6.46455C4.81232 6.64498 4.81232 6.93746 4.99274 7.11788C5.08298 7.20807 5.20119 7.25319 5.3194 7.25319C5.43762 7.25319 5.55583 7.20807 5.64607 7.11788L10.0758 2.68811V4.50072C10.0758 4.75588 10.2826 4.96269 10.5378 4.96269C10.793 4.96269 10.9998 4.75588 10.9998 4.50072V1.57286C10.9998 1.31765 10.793 1.11084 10.5378 1.11084Z",fill:"#32C5FF",stroke:"#32C5FF",strokeWidth:"0.5"}),e("path",{d:"M8.64816 6.53803C8.393 6.53803 8.18619 6.74484 8.18619 7V9.965H1.92394V3.70275H5.5C5.75516 3.70275 5.96197 3.49594 5.96197 3.24078C5.96197 2.98562 5.75516 2.77881 5.5 2.77881L1.46197 2.77881C1.20681 2.77881 1 2.98562 1 3.24078V10.427C1 10.6821 1.20681 10.8889 1.46197 10.8889H8.64816C8.90333 10.8889 9.11013 10.6821 9.11013 10.427V7C9.11013 6.74484 8.90333 6.53803 8.64816 6.53803Z",fill:"#32C5FF",stroke:"#32C5FF",strokeWidth:"0.5"})]}),ma=({color:r="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:r})});class I{}z(I,"getWaTemplateMessages",async()=>await Q("/wa-templates","GET")),z(I,"getWaTemplateMessage",async a=>await Q(`/wa-templates/${a}`,"GET")),z(I,"syncWaTemplateMessage",async()=>await Q("/wa-templates/sync-templates","GET")),z(I,"createWaTemplateMessage",async a=>await Q("/wa-templates/create-template","POST",{data:a})),z(I,"updateWaTemplateMessage",async(a,l)=>await Q(`/wa-templates/update-template-form/${a}`,"PUT",{data:l})),z(I,"updateWaTemplateComponents",async(a,l)=>await Q(`/wa-templates/update/${a}`,"PUT",{data:l})),z(I,"deleteWaTemplateMessage",async a=>await Q(`/wa-templates/delete/${a}`,"DELETE"));const ha=({template_status:r,name:a,id:l,description:v})=>{const{setErrorMessage:L,setSuccessMessage:f}=ne(),{setEditWaTemplateId:b,setShowWaTemplateForm:C,setPreviewWaTemplateId:i,setShowWaTemplatePreview:R}=oe(),[M,W]=p.exports.useState(null),[T,x]=p.exports.useState(!1),y=()=>{x(!0)},w=()=>{x(!1)},H=c=>{W(c.currentTarget)},S=()=>{W(null)},n=async()=>{try{const c=await I.deleteWaTemplateMessage(l);if(!c.success)throw Error(c.message);f(c.message),setTimeout(()=>window.location.reload(),1e3)}catch(c){L(c.message)}finally{w()}};return s(p.exports.Fragment,{children:[s(_t,{component:"div",sx:{px:{xs:0,md:2}},children:[e(qt,{primary:s("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:a}),e(Xt,{label:r,size:"small",sx:{bgcolor:Ut[r],alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),secondary:v,sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}},"& .MuiListItemText-secondary":{color:"text.secondary",fontSize:12,fontWeight:400,lineHeight:"15px"}}}),e(zt,{children:e(A,{onClick:H,children:e(Yt,{})})})]}),Boolean(M)&&s(Qt,{anchorEl:M,open:Boolean(M),onClose:S,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:[r==="DRAFT"&&e(k,{onClick:()=>{b(l),C(!0),S()},children:"Edit"}),(r==="SUBMITTED"||r==="APPROVED")&&e(k,{onClick:()=>{i(l),R(!0),S()},children:"Preview"}),e(k,{onClick:()=>{y(),S()},children:"Delete"})]}),s(it,{open:T,"aria-labelledby":"responsive-dialog-title",children:[e(ct,{id:"responsive-dialog-title",children:"Delete"}),e(dt,{children:"Are you sure you want to delete?"}),s(pt,{children:[e(re,{color:"secondary",onClick:()=>{w()},children:"Cancel"}),e(re,{onClick:async()=>{await n()},autoFocus:!0,children:"Delete"})]})]})]})},ua=({isSearchActive:r,setSearchActive:a})=>{const{setErrorMessage:l,setSuccessMessage:v}=ne(),{totalWaTemplates:L}=me(),{setWaTemplateFilter:f,setShowWaTemplateForm:b,setTotalWaTemplates:C,setWaTemplatesData:i}=oe(),[R,M]=p.exports.useState(!1),W=async()=>{try{M(!0);const T=await I.syncWaTemplateMessage();if(T.success){const x=await I.getWaTemplateMessages();if(!x.success)throw Error(T.message);C(x.payload.length),i(x.payload),v(T.message)}else l(T.message)}catch(T){l(T.message)}finally{M(!1)}};return s(ft,{children:[e(xt,{children:e(X,{disableIcon:!0,type:"button",onClick:()=>b(!0),sx:{py:0,px:2,height:36,mt:0},children:"New Template Message"})}),s(Ct,{children:[!r&&e(bt,{children:e(Tt,{children:`${L} Template Messages`})}),s(yt,{children:[r&&e(Ae,{children:s(Ve,{children:[e(A,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(de,{})}),e($e,{onChange:({target:{value:T}})=>f(T),placeholder:"Search Template"}),e(A,{onClick:()=>{f(""),a(!r)},sx:{position:"absolute",right:0,top:0},children:e(_e,{})})]})}),!r&&e(A,{onClick:()=>a(T=>!T),children:e(de,{})}),!r&&e(X,{icon:e(ma,{color:R?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:R,onClick:()=>W(),sx:{alignSelf:"center",borderRadius:4,borderColor:"#0000003b",color:"#000000de",flexDirection:"row-reverse",fontSize:14,fontWeight:400,letterSpacing:"0.02857em",lineHeight:"16px",gap:1,height:30,py:.625,px:1.875,textTransform:"capitalize"},children:R?"Syncing...":"Sync Messages"})]})]})]})},ga=({index:r,control:a,removeQuickReply:l})=>s(We,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Xe,{title:`Quick Reply ${r+1}`,action:e(A,{"aria-label":`Remove Quick Reply ${r+1}`,onClick:()=>l(r),children:e(Oe,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(F,{sx:{my:2},children:e(P,{control:a,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:j})})]},r),fa=({index:r,type:a,url:l,phone_number:v,waTemplateButtonCtaTypes:L,control:f,setValue:b,removeCallAction:C})=>{const{country:i}=he(),R=/[{][{]\d{1,3}[}][}]/gm,[M,W]=p.exports.useState(0),T=()=>{if(M===1)return;const y=`${l}{{${1}}}`;b(`components[3].buttons[${r}].url`,y),W(1)},x=p.exports.useCallback(()=>{if(l){const y=l.match(R);y&&y.length>0?W(1):W(0)}},[l]);return p.exports.useEffect(()=>{x()},[x]),s(We,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Xe,{title:`Call to Action ${r+1}`,action:e(A,{"aria-label":`Remove Call to Action ${r+1}`,onClick:()=>C(r),children:e(Oe,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(F,{sx:{my:2},children:s(P,{select:!0,control:f,label:"Action Type",name:`components[3].buttons[${r}].type`,sx:G,required:!0,defaultValue:a,children:[e(k,{value:"",disabled:!0,children:"Select Action Type"}),L.map(({value:y,name:w},H)=>e(k,{value:y,children:w},H))]})}),a!==""&&e(F,{sx:{my:2},children:e(P,{control:f,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:j})}),a==="PHONE_NUMBER"&&e(F,{sx:{my:2},children:e(Gt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:i,value:v!=null?v:"",onChange:y=>{b(`components[3].buttons[${r}].phone_number`,y.replaceAll(" ",""))},variant:"filled",sx:wt})}),a==="URL"&&s(F,{sx:{my:2},children:[s(ie,{children:[e(P,{control:f,name:`components[3].buttons[${r}].url`,label:"URL",required:!0,sx:{...j,pb:2,height:"auto"}}),e(we,{size:"small",focusRipple:!1,className:"add-variable",disabled:M===1,onClick:T,children:"ADD VARIABLE"})]}),s(ce,{children:[s(K,{children:[l?l.length:0,"/60 Characters"]}),s(K,{children:[M,"/1 Variable"]})]})]})]},r)},xa=({open:r,closeDrawer:a})=>{const l=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:v,setSuccessMessage:L}=ne(),{businessId:f}=he(),{editWaTemplateId:b,waTemplatesData:C,waTemplateCategories:i,waTemplateLanguages:R,waTemplateTypes:M,waTemplateHeaderTypes:W,waTemplateButtonTypes:T,waTemplateButtonCtaTypes:x}=me(),{setWaTemplatesData:y,setShowWaPreviewForm:w,setPreviewWaTemplateId:H}=oe(),S={name:"",category:"",language:"",template_type:"",businessId:f,components:[{format:"",text:"",type:B.HEADER,active:!1},{text:"",type:B.BODY},{text:"",type:B.FOOTER,active:!1},{buttons:[],type:B.BUTTONS,active:!1}]},{control:n,handleSubmit:c,watch:o,reset:d,setValue:u}=qe({defaultValues:S}),{name:q,category:Z,language:ue,template_type:D,components:Y}=o(),O=Y.find(({type:t})=>t===B.HEADER),_=Y.find(({type:t})=>t===B.BODY),J=Y.find(({type:t})=>t===B.FOOTER),N=Y.find(({type:t})=>t===B.BUTTONS),[g,E]=p.exports.useState(0),[U,V]=p.exports.useState(""),ge=p.exports.useCallback(()=>{const m=q.match(/^[A-Za-z0-9_]+$/g)===null?q.slice(0,-1):q.replace(/\s/g,"").toLowerCase();u("name",m)},[q]),fe=()=>{if(g===1)return;const t=`${O.text}{{${1}}}`;u("components[0].text",t),E(1)},Ye=()=>{const t=_.text.match(l),m=t&&t.length>0?`${_.text}{{${t.length+1}}}`:`${_.text}{{${1}}}`;u("components[1].text",m)},Re=p.exports.useCallback(()=>{const t=O.text.match(l);t&&t.length>0?E(1):E(0)},[O.text]),Be=p.exports.useCallback(()=>{const t=O.text.match(l);if(t===null){E(0);return}if(t.length===0){E(0);return}u("components[0].text",t.reduce((m,h,$)=>$===0?m.replace(h,`{{${$+1}}}`):m.replace(h,""),t.reduce((m,h,$)=>m.replace(h,`{{${$+1}}}`),O.text))),E(1)},[O.text]),Qe=()=>{const t=_.text.match(l);t!==null&&t.length!==0&&u("components[1].text",t.reduce((m,h,$)=>m.replace(h,`{{${$+1}}}`),_.text))},je=t=>{V(t.target.value)},Ge=()=>{if(U===""&&v("Please Select button Type"),U==="QUICK_REPLY")if(N.buttons.length<3){const t=N.buttons;t.push({type:"QUICK_REPLY",text:""}),u("components[3].buttons",t)}else v("Limit exceeded");if(U==="CALL_TO_ACTION")if(N.buttons.length<2){const t=N.buttons;t.push({type:"",text:""}),u("components[3].buttons",t)}else v("Limit exceeded")},Ke=t=>{const m=N.buttons;m.splice(t,1),u("components[3].buttons",m)},Ze=t=>{const m=N.buttons;m.splice(t,1),u("components[3].buttons",m)},Je=async t=>{var m;try{if(b){const h=await I.updateWaTemplateMessage(b,t);if(!h.success)throw Error(h.message);L(h.message),H((m=h.payload.id)!=null?m:b),d(S),a(),w(!0)}else{const h=await I.createWaTemplateMessage(t);if(!h.success)throw Error(h.message);L(h.message),y([h.payload,...C]),H(h.payload.id),d(S),a(),w(!0)}}catch(h){v(h.message)}},He=p.exports.useCallback(async()=>{try{if(b){const t=await I.getWaTemplateMessage(b);if(!t.success)throw Error(t.message);d(t.payload),t.payload.components[0].format!==""&&u("components[0].active",!0),t.payload.components[2].text!==""&&u("components[2].active",!0),t.payload.components[3].buttons.length>0&&u("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?V("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&V("CALL_TO_ACTION"))}}catch(t){v(t.message)}},[b]);return p.exports.useEffect(()=>{He()},[He]),p.exports.useEffect(()=>{ge()},[ge]),p.exports.useEffect(()=>{Be()},[Be]),p.exports.useEffect(()=>{Re()},[Re]),e(ze,{anchor:"right",open:r,onClose:(t,m)=>{Ne(m)||(d(S),a())},sx:{zIndex:"modal"},children:s(ve,{sx:{width:{xs:"100vw",md:360}},children:[s(Ee,{children:[e(A,{onClick:()=>{d(S),a()},sx:{width:32,height:32},children:e(Fe,{})}),e(Me,{children:`${b?"Update":"Create New"} Template`})]}),s(Ue,{onSubmit:c(Je),onReset:()=>{d(S),a()},children:[e(ee,{children:s(te,{children:[e(F,{children:e(P,{control:n,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:j})}),e(F,{children:s(P,{select:!0,control:n,label:"Template Category",name:"category",sx:G,required:!0,defaultValue:Z,children:[e(k,{value:"",disabled:!0,children:"Select Template Category"}),i.map(({value:t,name:m},h)=>e(k,{value:t,children:m},h))]})}),e(F,{children:s(P,{select:!0,control:n,label:"Language",name:"language",sx:G,required:!0,defaultValue:ue,children:[e(k,{value:"",disabled:!0,children:"Select Language"}),R.map(({code:t,name:m},h)=>e(k,{value:t,children:m},h))]})}),e(F,{children:s(P,{select:!0,control:n,label:"Template Type",name:"template_type",sx:G,required:!0,defaultValue:D,children:[e(k,{value:"",disabled:!0,children:"Select Template Type"}),M.map(({value:t,label:m},h)=>e(k,{value:t,children:m},h))]})}),D==="media"&&e(F,{children:s(ee,{sx:{justifyContent:"space-between"},children:[e(te,{children:e(le,{children:"Header"})}),e(be,{control:n,name:"components[0].active"})]})}),D==="media"&&O.active&&e(F,{children:s(P,{select:!0,control:n,label:"Header Type",name:"components[0].format",sx:G,required:!0,defaultValue:O.format,children:[e(k,{value:"",disabled:!0,children:"Select Header Type"}),W.map(({value:t,name:m},h)=>e(k,{value:t,children:m},h))]})}),D==="media"&&O.active&&O.format==="TEXT"&&s(F,{children:[s(ie,{children:[e(P,{control:n,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:xe}),e(we,{size:"small",focusRipple:!1,className:"add-variable",disabled:g===1,onClick:fe,children:"ADD VARIABLE"})]}),s(ce,{children:[s(K,{children:[O.text.length,"/60 Characters"]}),s(K,{children:[g,"/1 Variable"]})]})]}),D!==""&&e(F,{children:e(le,{children:"Body"})}),D!==""&&s(F,{children:[s(ie,{children:[e(P,{control:n,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Qe,inputProps:{maxLength:1024},sx:xe}),e(we,{size:"small",focusRipple:!1,className:"add-variable",onClick:Ye,children:"ADD VARIABLE"})]}),e(ce,{children:s(K,{children:[_.text.length,"/1024 Characters"]})})]}),D==="media"&&e(F,{children:s(ee,{sx:{justifyContent:"space-between"},children:[e(te,{children:e(le,{children:"Footer"})}),e(be,{control:n,name:"components[2].active"})]})}),D==="media"&&J.active&&s(F,{children:[e(ie,{children:e(P,{control:n,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:xe})}),e(ce,{children:s(K,{children:[J.text.length,"/60 Characters"]})})]}),D==="media"&&e(F,{children:s(ee,{sx:{justifyContent:"space-between"},children:[e(te,{children:e(le,{children:"Buttons"})}),e(be,{control:n,name:"components[3].active"})]})}),D==="media"&&N.active&&s(F,{children:[s(ee,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(te,{children:s(Kt,{select:!0,label:"Button Type",sx:G,required:!0,value:U,onChange:je,disabled:N.buttons.length>0,children:[e(k,{value:"",disabled:!0,children:"Select Button Type"}),T.map(({label:t,name:m},h)=>e(k,{value:m,children:t},h))]})}),e(vt,{children:e(X,{variant:"outlined",color:"primary",onClick:Ge,disableIcon:!0,children:"Add a Button"})})]}),D==="media"&&N.active&&N.buttons.length>0&&e(p.exports.Fragment,{children:N.buttons.map(({type:t,url:m,phone_number:h},$)=>{switch(t){case"QUICK_REPLY":return e(ga,{index:$,removeQuickReply:Ke,control:n},$);default:return e(fa,{index:$,type:t,url:m,phone_number:h,waTemplateButtonCtaTypes:x,control:n,setValue:u,removeCallAction:Ze},$)}})})]})]})}),s(ye,{children:[e(X,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(X,{type:"submit",children:"Preview & Save"})]})]})]})})},De=({components:r})=>{const a=p.exports.useRef(null),[l,v]=p.exports.useState(!1),[L,f]=p.exports.useState(!1),[b,C]=p.exports.useState(""),i=r.find(({type:n})=>n===B.HEADER),R=r.find(({type:n})=>n===B.BODY),M=r.find(({type:n})=>n===B.FOOTER),W=r.find(({type:n})=>n===B.BUTTONS),T=(n=>{if(n){const{example:c}=n;if(c){const{header_text:o}=c;return o||[]}else return[]}else return[]})(i),x=(n=>{if(n){const{example:c}=n;if(c){const{header_handle:o}=c;if(o&&o.length>0){const[d]=o;return d}else return""}else return""}else return""})(i),y=(n=>{if(n){const{example:c}=n;if(c){const{header_files:o}=c;if(o&&o.length>0){const[d]=o;return d}else return""}else return""}else return""})(i),w=(n=>{if(n){const{example:c}=n;if(c){const{body_text:o}=c;return o||[]}else return[]}else return[]})(R),H=(n=>i?n.reduce((c,o,d)=>o&&o!==""?c.replace(`{{${d+1}}}`,o):c,i.text):"")(T),S=(n=>R?n.reduce((c,o,d)=>o&&o!==""?c.replace(`{{${d+1}}}`,o):c,R.text):"")(w);return p.exports.useEffect(()=>{a.current&&(a.current.addEventListener("playing",()=>{C("playing")}),a.current.addEventListener("pause",()=>{C("")}),a.current.addEventListener("ended",()=>{C("")}),l?a.current.play():a.current.pause())},[l]),s(St,{children:[i&&i.format==="IMAGE"&&e(Et,{children:x&&x!==""&&e(ke,{component:"img",alt:"header-img",image:x,sx:Le})}),i&&i.format==="VIDEO"&&s(Se,{underline:"none",component:"button",type:"button",onClick:()=>v(!l),onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),sx:Ie,children:[e(ke,{component:"video",ref:a,className:"video",disablePictureInPicture:!0,sx:{...Le,height:130},children:x&&x!==""&&e("source",{src:x,type:"video/mp4"})}),s(mt,{position:"absolute",display:"flex",children:[b===""&&e(Jt,{}),L&&b==="playing"&&e(ea,{})]})]}),i&&i.format==="DOCUMENT"&&e(Se,{underline:"none",className:"media-wrapper doc",href:x,target:"_blank",sx:{...Ie,backgroundColor:"#F5F5F5",color:"#A1AEB4",fontSize:90,fontWeight:900,lineHeight:"96px"},children:x&&x!==""?y.split(".").pop().slice(0,4).toUpperCase():""}),i&&i.format==="TEXT"&&e(Mt,{children:H}),e(Ft,{children:ht(S)}),M&&M.text!==""&&e(Wt,{children:M.text}),W&&W.buttons.length>0&&e(Rt,{children:W.buttons.map((n,c)=>e(p.exports.Fragment,{children:n.type==="QUICK_REPLY"?e(re,{variant:"outlined",type:"button",sx:{...Ce,color:"#767676",minWidth:"calc(50% - 8px)"},children:n.text}):n.type==="PHONE_NUMBER"?e(re,{href:`tel:${n.phone_number}`,variant:"outlined",sx:{...Ce,color:"#32C5FF",minWidth:"100%"},children:n.text}):s(re,{href:n.example?n.example.reduce((o,d,u)=>d&&d!==""?o.replace(`{{${u+1}}}`,d):o,n.url):"",variant:"outlined",target:"_blank",rel:"noreferrer",sx:{...Ce,color:"#32C5FF",minWidth:"100%"},children:[e(pa,{}),n.text]})},c))})]})},Ca=({open:r,closeDrawer:a})=>{var O,_,J,N;const{isMobile:l,isTablet:v}=he(),L=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:f,setSuccessMessage:b}=ne(),{previewWaTemplateId:C,showWaTemplatePreview:i}=me(),{setPreviewWaTemplateData:R,setEditWaTemplateId:M,setShowWaTemplateForm:W}=oe(),[T,x]=p.exports.useState([]),y={components:[{format:"",text:"",type:B.HEADER},{text:"",type:B.BODY},{text:"",type:B.FOOTER},{buttons:[],type:B.BUTTONS}]},{control:w,handleSubmit:H,watch:S,setValue:n}=qe({defaultValues:y}),{components:c}=S(),o=c.find(({type:g})=>g===B.HEADER),d=c.find(({type:g})=>g===B.BODY),u=c.find(({type:g})=>g===B.BUTTONS),q=(_=(O=o==null?void 0:o.example)==null?void 0:O.header_handle)==null?void 0:_[0],Z=[o&&o.format!=="TEXT",o&&o.format==="TEXT"&&o.text&&o.text!==""?o.text.includes("{{1}}"):!1,d&&d.text&&d.text!==""&&d.text.includes("{{1}}"),u&&u.buttons.length>0&&((J=u.buttons[0])==null?void 0:J.type)==="URL"&&((N=u.buttons[0])==null?void 0:N.url.includes("{{1}}"))].reduce((g,E)=>g||E,!1),ue=async g=>{try{const E=g.components.map(({active:U,...V})=>(V.type==="HEADER"&&delete V.example.header_files,V));if(C){const U=await I.updateWaTemplateComponents(C,{components:E});if(!U.success)throw Error(U.message);b(U.message),a()}}catch(E){f(E.message)}},D=p.exports.useCallback(()=>{c.length>0&&c.forEach(({type:g,text:E,buttons:U})=>{if(g==="BODY"){const V=E.match(L);V&&x(V.map((ge,fe)=>fe+1))}})},[c]),Y=p.exports.useCallback(async()=>{try{if(C){const g=await I.getWaTemplateMessage(C);if(!g.success)throw Error(g.message);R(g.payload),n("components",g.payload.components)}}catch(g){f(g.message)}},[C]);return p.exports.useEffect(()=>{Y()},[Y]),p.exports.useEffect(()=>{D()},[D]),s(ze,{anchor:"right",open:r,onClose:(g,E)=>{(!Ne(E)||i)&&a()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[s(ve,{sx:{width:{xs:"100vw",md:360}},children:[r&&s(Ee,{children:[e(A,{onClick:()=>{a()},sx:{width:32,height:32},children:e(Fe,{})}),e(Me,{children:Z&&!i?"Enter Sample Values":"Preview Template"})]}),r&&s(Ue,{onSubmit:H(ue),children:[(!Z||i||l)&&e(De,{components:c}),!i&&o&&(o.format==="IMAGE"||o.format==="VIDEO"||o.format==="DOCUMENT")&&e(F,{children:e(Zt,{setValue:n,control:w,fileTypes:o.format==="IMAGE"?Te.IMAGE:o.format==="VIDEO"?Te.VIDEO:Te.FILE,label:`Drag & Drop ${o.format.charAt(0).toUpperCase()}${o.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:q!=null?q:"",width:"100%"})}),!i&&o&&o.format==="TEXT"&&o.text.includes("{{1}}")&&e(F,{children:e(P,{control:w,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:j})}),!i&&T.length>0&&T.map((g,E)=>e(F,{children:e(P,{control:w,name:`components[1].example.body_text[${E}]`,label:`Body Variable ${g}`,placeholder:`Body ${g}`,required:!0,sx:j})},`bodyVar{{${g}}}`)),!i&&u&&u.buttons&&u.buttons.length>0&&u.buttons.map((g,E)=>g.type==="URL"?e(F,{children:e(P,{control:w,name:`components[3].buttons[${E}].example[0]`,label:`URL Button ${E+1}`,placeholder:`Url button ${E+1} variable 1`,required:!0,sx:j})},E):null),!i&&e(ye,{children:e(X,{type:"submit",children:"Submit for Approval"})}),!i&&s(ye,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(se,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(Se,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{M(C),W(!0),a()},children:"Continue Editing"})]})]})]}),!i&&r&&Z&&v&&e(ve,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(De,{components:c})})]})},ba=()=>{const{isMobile:r,isTablet:a}=he(),{setErrorMessage:l}=ne(),[v,L]=p.exports.useState(!0),[f,b]=p.exports.useState(!1),{waTemplatesData:C,waTemplateFilter:i,showWaTemplateForm:R,showWaPreviewForm:M,showWaTemplatePreview:W}=me(),{setWaTemplatesData:T,setTotalWaTemplates:x,setWaTemplateFilter:y,setShowWaTemplateForm:w,setShowWaPreviewForm:H,setShowWaTemplatePreview:S,setEditWaTemplateId:n,setPreviewWaTemplateId:c}=oe(),o=p.exports.useCallback(async()=>{try{const d=await I.getWaTemplateMessages();if(!d.success)throw Error(d.message);x(d.payload.length),T(d.payload),L(!1)}catch(d){l(d.message)}},[]);return p.exports.useEffect(()=>{o()},[o]),s(p.exports.Fragment,{children:[e(ut,{children:e("title",{children:"WhatsApp Template Messages"})}),r&&s(Ee,{sx:Bt,children:[!f&&e(A,{component:gt,to:"/business-settings",sx:{width:32,height:32},children:e(Fe,{})}),!f&&e(Me,{children:"Template Messages"}),f&&e(Ae,{children:s(Ve,{children:[e(A,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(de,{})}),e($e,{onChange:({target:{value:d}})=>y(d),placeholder:"Search Template"}),e(A,{onClick:()=>{y(""),b(!f)},sx:{position:"absolute",right:0,top:0},children:e(_e,{})})]})}),!f&&C.length>0&&e(A,{onClick:()=>b(d=>!d),children:e(de,{})})]}),e(Ht,{sx:Lt,children:e(It,{sx:kt,children:!v&&e(We,{elevation:0,sx:Pt,children:e(jt,{sx:Dt,children:C.length===0?s(Ot,{children:[e(Nt,{children:e(X,{disableIcon:!0,onClick:()=>w(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(At,{children:s(Vt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):s(p.exports.Fragment,{children:[a&&e(ua,{isSearchActive:f,setSearchActive:b}),a&&e(ta,{}),C.filter(d=>{var u;return(u=d==null?void 0:d.name)==null?void 0:u.toLowerCase().includes(i==null?void 0:i.toLowerCase())}).map((d,u)=>e(ha,{...d},u))]})})})})}),r&&C.length>0&&e($t,{children:e(X,{onClick:()=>w(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(xa,{open:R,closeDrawer:()=>{n(void 0),w(!1)}}),e(Ca,{open:M||W,closeDrawer:()=>{c(void 0),H(!1),S(!1)}})]})},ss=()=>e(ba,{});export{ss as default};
