var ae=Object.defineProperty;var oe=(a,e,i)=>e in a?ae(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var E=(a,e,i)=>(oe(a,typeof e!="symbol"?e+"":e,i),i);import{a as se,A as ie,u as ne,L as re}from"./LeadDataFieldsProvider.44bd203b.js";import{r as s,j as t,g as le,e as de,s as V,V as $,_ as M,y as S,l as ce,c as ue,ad as me,a as d,q as ge,A as k,b as z,$ as _,an as pe,ao as he,ap as fe,aq as xe,am as Le,T as be,u as De,ar as Ce,W as Ie,L as ye}from"./index.38d3e2dd.js";import{a as ve,u as Re,B as q,b as Te}from"./BizParticipantsApi.6eecae4b.js";import{L as X}from"./LeftArrow.79d13e8d.js";import{b as B,A as Pe}from"./CommonComponents.4b14a98c.js";import{T as Fe,p as Me,q as we,r as Ee,s as Se,D as Be,b as j,H as G,o as ke,F as Ae,G as $e,j as A,l as ze,k as _e,x as He,c as We,y as Oe,I as qe,z as Ne,f as Ve,g as Xe,A as je,B as Ge,E as Ue,J as Ke,M as Je,K as Qe}from"./LayoutComponents.281bca3c.js";import{L as Ye}from"./ListItem.5c80c32b.js";import{a as Ze,L as et}from"./ListItemText.b12da6d0.js";import{C as tt}from"./Chip.59b969a4.js";import{M as at}from"./MoreVert.6092d02d.js";import{M as ot}from"./Menu.e94f9734.js";import{M as F}from"./MenuItem.e4a73d64.js";import{u as st,F as N}from"./FormTextField.3be4b1b3.js";import{D as it}from"./Drawer.44479df8.js";import{T as nt}from"./TextField.23840b04.js";import{C as U}from"./CircularProgress.ff5b8623.js";import{C as rt,a as lt}from"./CardContent.840d963f.js";import{D as dt}from"./Divider.6dae6579.js";import"./Select.68c58a58.js";import"./useFormControl.318bb611.js";import"./isMuiElement.7c1115e8.js";import"./Popper.6620797e.js";import"./styled.9bec237d.js";import"./List.7ef95385.js";import"./listItemButtonClasses.50a58ae2.js";import"./listItemTextClasses.a01ad07e.js";const K=s.exports.createContext(void 0),J=s.exports.createContext(void 0),ct=({children:a})=>{const[e,i]=s.exports.useState([]),[c,l]=s.exports.useState(!1),[m,h]=s.exports.useState(0),g={leadDistRules:e,showLeadDistRuleForm:c,totalLeadDistRules:m},x=s.exports.useMemo(()=>({setLeadDistRules:i,setShowLeadDistRuleForm:l,setTotalLeadDistRules:h}),[]);return t(K.Provider,{value:g,children:t(J.Provider,{value:x,children:a})})},Q=()=>{const a=s.exports.useContext(K);if(a===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return a},Y=()=>{const a=s.exports.useContext(J);if(a===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return a};function ut(a){return de("MuiLoadingButton",a)}const mt=le("MuiLoadingButton",["root","loading","loadingIndicator","loadingIndicatorCenter","loadingIndicatorStart","loadingIndicatorEnd","endIconLoadingEnd","startIconLoadingStart"]),I=mt,gt=["children","disabled","id","loading","loadingIndicator","loadingPosition","variant"],pt=a=>{const{loading:e,loadingPosition:i,classes:c}=a,l={root:["root",e&&"loading"],startIcon:[e&&`startIconLoading${S(i)}`],endIcon:[e&&`endIconLoading${S(i)}`],loadingIndicator:["loadingIndicator",e&&`loadingIndicator${S(i)}`]},m=ge(l,ut,c);return M({},c,m)},ht=a=>a!=="ownerState"&&a!=="theme"&&a!=="sx"&&a!=="as"&&a!=="classes",ft=V($,{shouldForwardProp:a=>ht(a)||a==="classes",name:"MuiLoadingButton",slot:"Root",overridesResolver:(a,e)=>[e.root,e.startIconLoadingStart&&{[`& .${I.startIconLoadingStart}`]:e.startIconLoadingStart},e.endIconLoadingEnd&&{[`& .${I.endIconLoadingEnd}`]:e.endIconLoadingEnd}]})(({ownerState:a,theme:e})=>M({[`& .${I.startIconLoadingStart}, & .${I.endIconLoadingEnd}`]:{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0}},a.loadingPosition==="center"&&{transition:e.transitions.create(["background-color","box-shadow","border-color"],{duration:e.transitions.duration.short}),[`&.${I.loading}`]:{color:"transparent"}},a.loadingPosition==="start"&&a.fullWidth&&{[`& .${I.startIconLoadingStart}, & .${I.endIconLoadingEnd}`]:{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0,marginRight:-8}},a.loadingPosition==="end"&&a.fullWidth&&{[`& .${I.startIconLoadingStart}, & .${I.endIconLoadingEnd}`]:{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0,marginLeft:-8}})),xt=V("div",{name:"MuiLoadingButton",slot:"LoadingIndicator",overridesResolver:(a,e)=>{const{ownerState:i}=a;return[e.loadingIndicator,e[`loadingIndicator${S(i.loadingPosition)}`]]}})(({theme:a,ownerState:e})=>M({position:"absolute",visibility:"visible",display:"flex"},e.loadingPosition==="start"&&(e.variant==="outlined"||e.variant==="contained")&&{left:e.size==="small"?10:14},e.loadingPosition==="start"&&e.variant==="text"&&{left:6},e.loadingPosition==="center"&&{left:"50%",transform:"translate(-50%)",color:(a.vars||a).palette.action.disabled},e.loadingPosition==="end"&&(e.variant==="outlined"||e.variant==="contained")&&{right:e.size==="small"?10:14},e.loadingPosition==="end"&&e.variant==="text"&&{right:6},e.loadingPosition==="start"&&e.fullWidth&&{position:"relative",left:-10},e.loadingPosition==="end"&&e.fullWidth&&{position:"relative",right:-10})),Lt=s.exports.forwardRef(function(e,i){const c=ce({props:e,name:"MuiLoadingButton"}),{children:l,disabled:m=!1,id:h,loading:g=!1,loadingIndicator:x,loadingPosition:f="center",variant:b="text"}=c,L=ue(c,gt),D=me(h),C=x!=null?x:t(U,{"aria-labelledby":D,color:"inherit",size:16}),p=M({},c,{disabled:m,loading:g,loadingIndicator:C,loadingPosition:f,variant:b}),u=pt(p),y=g?t(xt,{className:u.loadingIndicator,ownerState:p,children:C}):null;return d(ft,M({disabled:m||g,id:D,ref:i},L,{variant:b,classes:u,ownerState:p,children:[p.loadingPosition==="end"?l:y,p.loadingPosition==="end"?y:l]}))}),bt=Lt;class R{}E(R,"getLeadDistRules",async(e=1,i=20)=>await k(`/lms-rules?page=${e}&limit=${i}`,"GET")),E(R,"createLeadDistRule",async e=>await k("/lms-rules","POST",{data:e})),E(R,"deleteLeadDistRule",async e=>await k(`/lms-rules/${e}`,"DELETE"));const Dt=a=>{const{setErrorMessage:e,setSuccessMessage:i}=z(),{title:c,description:l,ruleId:m}=a,[h,g]=s.exports.useState(null),[x,f]=s.exports.useState(!1),b=()=>{f(!0)},L=()=>{f(!1)},D=u=>{g(u.currentTarget)},C=()=>{g(null)},p=async()=>{try{const u=await R.deleteLeadDistRule(m);if(!u.success)throw Error(u.message);i(u.message),setTimeout(()=>window.location.reload(),1e3)}catch(u){e(u.message)}finally{L()}};return d(s.exports.Fragment,{children:[d(Ye,{component:"div",sx:{px:{xs:0,md:2}},children:[t(Ze,{primary:d("div",{className:"primary-block",children:[t("h2",{className:"list-title",children:c}),t(tt,{label:l,size:"small",sx:{backgroundColor:"#12B0EE",alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}}}}),t(et,{children:t(_,{onClick:D,children:t(at,{})})})]}),Boolean(h)&&t(ot,{anchorEl:h,open:Boolean(h),onClose:C,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:t(F,{onClick:()=>{b(),C()},children:"Delete"})}),d(pe,{open:x,"aria-labelledby":"responsive-dialog-title",children:[t(he,{id:"responsive-dialog-title",children:"Delete"}),t(fe,{children:"Are you sure you want to delete?"}),d(xe,{children:[t($,{color:"secondary",onClick:()=>{L()},children:"Cancel"}),t($,{onClick:async()=>{await p()},autoFocus:!0,children:"Delete"})]})]})]})},Ct=()=>{const{totalLeadDistRules:a}=Q(),{setShowLeadDistRuleForm:e}=Y();return d(Fe,{children:[t(Me,{children:t(B,{disableIcon:!0,type:"button",onClick:()=>e(!0),sx:{py:0,px:.625,height:36,mt:0},children:"New Lead Distribution Rule"})}),t(we,{children:t(Ee,{children:t(Se,{children:`${a} Lead Distribution Rules`})})})]})},It=s.exports.forwardRef((a,e)=>{const{children:i,...c}=a,l=s.exports.useRef(null);return s.exports.useImperativeHandle(e,()=>l.current),t("ul",{...c,ref:l,role:"list-box",children:i})}),yt=({open:a,closeDrawer:e})=>{const{setErrorMessage:i,setSuccessMessage:c}=z(),{leadDataFields:l}=se(),{teamMembers:m,teamMembersTotal:h}=ve(),{setTeamMembers:g,setTeamMembersTotal:x}=Re(),[f,b]=s.exports.useState(!1),[L,D]=s.exports.useState(!0),[C,p]=s.exports.useState(""),u=s.exports.useDeferredValue(C),[y,T]=s.exports.useState(1),{control:r,handleSubmit:P,watch:H,setValue:w}=st({defaultValues:{param_name:"",rule:{},assign_to:"",param_type:"",logic:"match"}}),{param_name:v}=H(),Z=async n=>{try{T(n);const o=await q.getTeamMembers(u,n);if(!o.success)throw Error(o.message);g([...m,...o.payload.data])}catch(o){i(o.message)}},W=s.exports.useCallback(async()=>{try{if(a){D(!0),T(1);const o=await q.getTeamMembers(u,1);if(!o.success)throw Error(o.message);g(o.payload.data),x(o.payload.meta.total),D(!1)}}catch(n){i(n.message)}},[a,u]),O=s.exports.useCallback(()=>{if(v!==""){const[n]=l.filter(o=>o.field_name===v);n&&w("param_type",n.field_type)}},[v]),ee=async n=>{try{const o=await R.createLeadDistRule(n);if(!o.success)throw Error(o.message);c(o.message),setTimeout(()=>window.location.reload(),1e3)}catch(o){i(o.message)}finally{setTimeout(()=>e(),1e3)}};return s.exports.useEffect(()=>{W()},[W]),s.exports.useEffect(()=>{O()},[O]),t(it,{anchor:"right",open:a,onClose:(n,o)=>!Le(o)&&e(),sx:{zIndex:"modal"},children:d(Be,{sx:{width:{xs:"100vw",md:360}},children:[d(j,{children:[t(_,{onClick:e,sx:{width:32,height:32},children:t(X,{})}),t(G,{children:"Create New Rule"})]}),d(ke,{onSubmit:P(ee),autoComplete:"off",children:[t(be,{component:"p",color:"#24272C",fontSize:18,lineHeight:"21px",marginBottom:3,children:"Assign enquiry to team member when lead data field matches value."}),t(Ae,{children:d($e,{children:[t(A,{children:d(N,{select:!0,control:r,label:"Lead Data Field",name:"param_name",sx:ze,required:!0,defaultValue:v,children:[l.length===0?t(F,{value:"",disabled:!0,children:"No Lead Data Field Available"}):t(F,{value:"",disabled:!0,children:"Select Lead Data Field"}),l.map(({id:n,display_name:o,field_name:te})=>t(F,{value:te,children:o},n))]})}),t(A,{children:t(N,{control:r,name:"rule.value",label:"Match Value",placeholder:"Match Value",required:!0,sx:_e})}),t(A,{children:t(ie,{open:f,onOpen:()=>{b(!0)},onClose:()=>{p(""),b(!1)},noOptionsText:"Team Member not found.",isOptionEqualToValue:(n,o)=>n.user.name===o.user.name,getOptionLabel:n=>n.user.name,options:m,loading:L,onChange:(n,o)=>{o&&w("assign_to",o.user.id)},onInputChange:(n,o)=>{p(o.length>2?o:"")},ListboxComponent:It,ListboxProps:{onScroll:n=>{const o=n.currentTarget;o.scrollTop+o.clientHeight===o.scrollHeight&&h&&h>m.length&&Z(y+1)}},renderOption:(n,o)=>s.exports.createElement(F,{...n,value:o.user.id,key:o.user_id},o.user.name),renderInput:n=>t(nt,{...n,label:"Assign To",required:!0,InputProps:{...n.InputProps,endAdornment:d(s.exports.Fragment,{children:[L?t(U,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})}})})})]})}),t(Pe,{children:t(B,{type:"submit",children:"Save"})})]})]})})},vt=()=>{const{isMobile:a,isTablet:e}=De(),{setErrorMessage:i}=z(),[c,l]=s.exports.useState(!0),[m,h]=s.exports.useState(!1),[g,x]=s.exports.useState(1),{leadDistRules:f,showLeadDistRuleForm:b,totalLeadDistRules:L}=Q(),{setLeadDataFields:D}=ne(),{setLeadDistRules:C,setShowLeadDistRuleForm:p,setTotalLeadDistRules:u}=Y(),y=s.exports.useCallback(async()=>{try{const r=await R.getLeadDistRules(g);if(!r.success)throw Error(r.message);C(P=>P.concat(r.payload.data)),L===0&&u(r.payload.meta.total),l(!1),h(!1)}catch(r){i(r.message)}},[g]),T=s.exports.useCallback(async()=>{try{const r=await Ce.getLeadDataFields();if(!r.success)throw Error(r.message);D(r.payload)}catch(r){i(r.message)}},[]);return s.exports.useEffect(()=>{T()},[T]),s.exports.useEffect(()=>{y()},[y]),d(s.exports.Fragment,{children:[t(Ie,{children:t("title",{children:"Lead Distribution Rules"})}),a&&d(j,{sx:He,children:[t(_,{component:ye,to:"/business-settings",sx:{width:32,height:32},children:t(X,{})}),t(G,{children:"Lead Distribution Rules"})]}),t(We,{sx:Oe,children:t(qe,{sx:Ne,children:!c&&t(rt,{elevation:0,sx:Ve,children:t(lt,{sx:Xe,children:f.length===0?d(je,{children:[t(Ge,{children:t(B,{disableIcon:!0,onClick:()=>p(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Lead Distribution Rule"})}),t(Ue,{children:t(Ke,{children:"Create logical rules, based on which an enquiry is automatically assigned to a team member."})})]}):d(s.exports.Fragment,{children:[e&&t(Ct,{}),e&&t(dt,{}),f.map(({rule:r,user:P,param_name:H,id:w},v)=>t(Dt,{title:P.name,description:r.value,ruleId:w},v)),L>f.length&&t(Je,{children:t(bt,{variant:"contained",color:"primary",onClick:()=>{x(r=>r+1),h(!0)},loading:m,children:"Load More"})})]})})})})}),a&&f.length>0&&t(Qe,{children:t(B,{onClick:()=>p(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Lead Distribution Rule"})}),t(yt,{open:b,closeDrawer:()=>{p(!1)}})]})},Yt=()=>t(ct,{children:t(re,{children:t(Te,{children:t(vt,{})})})});export{Yt as default};
