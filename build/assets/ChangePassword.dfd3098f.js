import{b as I,u as V,r as t,al as D,A as C,a as r,j as s,V as B,L as H,W as L}from"./index.538d2f9a.js";import{u as j,a as q,R as G,A as U}from"./AuthProvider.2c3ee904.js";import{u as z,F as p}from"./FormTextField.bc721fef.js";import{C as W,a as X}from"./Card.2915903b.js";import{C as Y}from"./Tags.4c16f9a5.js";import{F as J,G as K}from"./Grid.a1b2073c.js";import{c as Q,H as Z,d as $,e as ee}from"./Wrappers.703b744c.js";import{F as h,A as se,a as S}from"./Form.67c23f9a.js";import{F as f}from"./Style.ced39dc3.js";import{L as re}from"./LeftArrow.41efc6ac.js";import"./tslib.es6.61e9e735.js";import"./TextField.97fa0105.js";import"./Select.73eb3e52.js";import"./useFormControl.607b6878.js";import"./isMuiElement.ae78b690.js";import"./Menu.0eef51cd.js";import"./List.80eed540.js";import"./useControlled.a7d9109e.js";import"./Card.196455a2.js";import"./CardContent.92b7395c.js";import"./toConsumableArray.52b4c8e6.js";import"./MenuItem.18436c16.js";import"./listItemTextClasses.98d3f7a3.js";import"./dividerClasses.9b2c4cf4.js";import"./ListItem.a9871932.js";import"./listItemButtonClasses.b6cc5d1f.js";import"./styled.8824f955.js";import"./ArrowRight.8ac3d21e.js";const te="Y12k",oe={Textfield_helperText:te},ae=()=>{const{selectedBusiness:l}=I(),{auth:y}=j(),{otpVerification:A,sendOTP:w}=q(),{isMobile:E}=V(),[i,F]=t.exports.useState(""),[O,g]=t.exports.useState(!1),[o,P]=t.exports.useState(0),{setErrorMessage:c,setSuccessMessage:b}=D(),x=window,{control:d,handleSubmit:R,reset:v}=z({defaultValues:{OTP:"",newPassword:"",confirmPassword:""}}),k=t.exports.useRef(async()=>{try{const e=await C.authUserDetails();if(e.errors)throw Error(e.errors.pop().message);if(!e.success&&e.message)throw Error(e.message);const{mobile_number:a}=e.payload;F(a)}catch(e){console.log(e)}}),M=()=>{x.recaptchaVerifier=new G("captcha-container",{size:"invisible",callback:async function(){const e=await w(i);x.confirmationResult=e},"expired-callback":function(){alert("try again!")}},y)},N=async()=>{try{if(!i)throw Error("Please enter a valid mobile number");const e=await w(i);if(!e.success&&e.message)throw c(e.message),Error(e.message);e.success&&g(!0),b(e.message),e.success&&P(180)}catch(e){console.log(e)}},_=async e=>{try{const{OTP:a,newPassword:m,confirmPassword:u}=e;if(m===""||u===""){c("Please enter a valid password");return}if(m!==u){c("Passwords do not match");return}const T=await A(a);if(T.success){const n=await C.updatePassword({password:m,confirm_password:u});if(n.errors)throw Error(n.errors.pop().message);if(!n.success&&n.message)throw Error(n.message);b("Password changed successfully"),v()}else c(T.message)}catch(a){console.log(a)}};return t.exports.useEffect(()=>{k.current()},[]),t.exports.useEffect(()=>{M()},[]),t.exports.useEffect(()=>{o>0?setTimeout(()=>{P(o-1)},1e3):o===0&&g(!1)},[o]),r(t.exports.Fragment,{children:[E&&r(Q,{children:[s(B,{component:H,to:l&&l.default_url?l.default_url:"/engage/chat",className:"icon-md-button",children:s(re,{})}),s(Z,{children:"My Profile"})]}),s($,{children:s(ee,{onSubmit:R(_),children:s(W,{elevation:0,children:r(X,{children:[s(Y,{children:"Change Password"}),s(J,{children:r(K,{children:[r(h,{children:[s(p,{control:d,name:"OTP",label:"OTP",placeholder:"Enter One Time Password",required:!0,sx:f}),r("div",{className:oe.Textfield_helperText,children:[r("p",{children:["SMS Message sent on ",s("strong",{children:i})]}),s("span",{children:r("p",{children:["Resend OTP in"," ",s("strong",{children:o>0?new Date(o*1e3).toISOString().substring(14,19):"00:00"})," "]})})]})]}),s(h,{children:s(p,{control:d,type:"password",name:"newPassword",label:"New Password",placeholder:"Enter New Password",required:!0,sx:f})}),s(h,{children:s(p,{control:d,type:"password",name:"confirmPassword",label:"Confirm Password",placeholder:"Enter Confirm Password",required:!0,sx:f})})]})}),r(se,{children:[s(S,{type:"button",onClick:N,disableIcon:!0,disabled:!!O,children:"Resend OTP"}),s(S,{type:"submit",children:"Save New Password"})]})]})})})}),s("div",{id:"captcha-container"})]})},_e=()=>r(U,{children:[s(L,{children:s("title",{children:"My Profile"})}),s(ae,{})]});export{_e as default};
