var U=Object.defineProperty;var Y=(r,s,i)=>s in r?U(r,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[s]=i;var S=(r,s,i)=>(Y(r,typeof s!="symbol"?s+"":s,i),i);import{r as a,j as e,al as E,ai as A,a as l,$ as B,ao as ee,ap as te,aq as ae,ar as se,Z as H,av as re,an as oe,T as ie,u as ne,at as le,au as ce,aj as de,W as ue,L as me}from"./index.1216e28e.js";import{a as pe,u as he,B as fe}from"./BizParticipantsProvider.45a49ae4.js";import{L as $}from"./LeftArrow.a627eb69.js";import{a as I,F as k,A as ge}from"./Form.cbd8321b.js";import{c as Le,H as De,d as be,I as xe,g as Ce,h as we}from"./Wrappers.0413203c.js";import{F as ye,G as Re,L as Te}from"./Grid.b54de443.js";import{a as Me,b as Fe,c as ve,d as Se,e as Ie,C as _,g as Pe}from"./Card.1487010d.js";import{C as Ee,a as ke,b as Ae}from"./Cta.fee67514.js";import{L as Be}from"./ListItem.152d8599.js";import{L as Ne}from"./ListItemText.d3103614.js";import{C as Oe}from"./Chip.0f9d17d3.js";import{L as He}from"./ListItemIcon.50311155.js";import{M as _e}from"./MoreVert.afd24cb2.js";import{M as ze}from"./Menu.b5c2af2b.js";import{M as T}from"./MenuItem.51acc6a3.js";import{u as qe}from"./index.esm.7a23e4a0.js";import{F as z}from"./FormTextField.a2d50268.js";import{B as q}from"./BizParticipantsApi.db4d004c.js";import{D as Ve,a as $e,b as je,c as Ge}from"./Drawer.96c0421f.js";import{b as We,F as Xe}from"./Style.57c2f24e.js";import{D as Ke}from"./Drawer.4b449f09.js";import{A as Ze}from"./Autocomplete.0435d392.js";import{T as Je}from"./TextField.5384ccb5.js";import{C as Qe}from"./CircularProgress.046bdea8.js";import{p as Ue}from"./Position.module.ff7b7fa6.js";import{D as Ye}from"./Divider.4f3dc1ba.js";import{L as et}from"./LoadingButton.33756ffe.js";import"./ArrowRight.7030d8f5.js";import"./Card.9aa5f189.js";import"./CardContent.e6225265.js";import"./List.8f8744c2.js";import"./listItemButtonClasses.7ee5290a.js";import"./isMuiElement.3e2de034.js";import"./listItemTextClasses.477e07f5.js";import"./dividerClasses.24ea718d.js";import"./Select.4cd0be1e.js";import"./useFormControl.4dcd90d2.js";import"./useControlled.9518d4c9.js";import"./Close.17b44fc1.js";import"./Popper.9fa6f859.js";const j=a.exports.createContext(void 0),G=a.exports.createContext(void 0),tt=({children:r})=>{const[s,i]=a.exports.useState([]),[m,d]=a.exports.useState(!1),[h,u]=a.exports.useState(0),p={leadDistRules:s,showLeadDistRuleForm:m,totalLeadDistRules:h},D=a.exports.useMemo(()=>({setLeadDistRules:i,setShowLeadDistRuleForm:d,setTotalLeadDistRules:u}),[]);return e(j.Provider,{value:p,children:e(G.Provider,{value:D,children:r})})},W=()=>{const r=a.exports.useContext(j);if(r===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return r},X=()=>{const r=a.exports.useContext(G);if(r===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return r};class w{}S(w,"getLeadDistRules",async(s=1,i=20)=>await E(`/lms-rules?page=${s}&limit=${i}`,"GET")),S(w,"createLeadDistRule",async s=>await E("/lms-rules","POST",{data:s})),S(w,"deleteLeadDistRule",async s=>await E(`/lms-rules/${s}`,"DELETE"));const at="vzpS",st="vsan",V={LeadDistRuleItem:at,OptionMenuPaper:st},rt={px:{xs:0,md:2}},ot=r=>{const{setErrorMessage:s,setSuccessMessage:i}=A(),{title:m,description:d,ruleId:h}=r,[u,p]=a.exports.useState(null),[D,f]=a.exports.useState(!1),b=()=>{f(!0)},g=()=>{f(!1)},x=c=>{p(c.currentTarget)},C=()=>{p(null)},L=async()=>{try{const c=await w.deleteLeadDistRule(h);if(!c.success)throw Error(c.message);i(c.message),setTimeout(()=>window.location.reload(),1e3)}catch(c){s(c.message)}finally{g()}};return l(a.exports.Fragment,{children:[l(Be,{component:"div",sx:rt,children:[e(Ne,{primary:l("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:m}),e(Oe,{label:d,size:"small"})]}),className:V.LeadDistRuleItem}),e(He,{children:e(B,{onClick:x,children:e(_e,{})})})]}),Boolean(u)&&e(ze,{anchorEl:u,open:Boolean(u),onClose:C,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:V.OptionMenuPaper},children:e(T,{onClick:()=>{b(),C()},children:"Delete"})}),l(ee,{open:D,"aria-labelledby":"responsive-dialog-title",children:[e(te,{id:"responsive-dialog-title",children:"Delete"}),e(ae,{children:"Are you sure you want to delete?"}),l(se,{children:[e(H,{color:"secondary",onClick:()=>{g()},children:"Cancel"}),e(H,{onClick:async()=>{await L()},autoFocus:!0,children:"Delete"})]})]})]})},it=()=>{const{totalLeadDistRules:r}=W(),{setShowLeadDistRuleForm:s}=X();return l(Me,{children:[e(Fe,{children:e(I,{disableIcon:!0,type:"button",onClick:()=>s(!0),className:"small",children:"New Lead Distribution Rule"})}),e(ve,{children:e(Se,{children:e(Ie,{children:`${r} Lead Distribution Rules`})})})]})},K=a.exports.forwardRef((r,s)=>{const{children:i,...m}=r,d=a.exports.useRef(null);return a.exports.useImperativeHandle(s,()=>d.current),e("ul",{...m,ref:d,role:"list-box",children:i})});K.displayName="ListBox";const nt=({open:r,closeDrawer:s})=>{const{setErrorMessage:i,setSuccessMessage:m}=A(),{leadDataFields:d}=re(),{teamMembers:h,teamMembersTotal:u}=pe(),{setTeamMembers:p,setTeamMembersTotal:D}=he(),[f,b]=a.exports.useState(!1),[g,x]=a.exports.useState(!0),[C,L]=a.exports.useState(""),c=a.exports.useDeferredValue(C),[M,y]=a.exports.useState(1),{control:n,handleSubmit:R,watch:P,setValue:F}=qe({defaultValues:{param_name:"",rule:{},assign_to:"",param_type:"",logic:"match"}}),{param_name:v}=P(),Z=async o=>{try{y(o);const t=await q.getTeamMembers(c,o);if(!t.success)throw Error(t.message);p([...h,...t.payload.data])}catch(t){i(t.message)}},N=a.exports.useCallback(async()=>{try{if(r){x(!0),y(1);const t=await q.getTeamMembers(c,1);if(!t.success)throw Error(t.message);p(t.payload.data),D(t.payload.meta.total),x(!1)}}catch(o){i(o.message)}},[r,c]),O=a.exports.useCallback(()=>{if(v!==""){const[o]=d.filter(t=>t.field_name===v);o&&F("param_type",o.field_type)}},[v]),J=async o=>{try{const t=await w.createLeadDistRule(o);if(!t.success)throw Error(t.message);m(t.message),setTimeout(()=>window.location.reload(),1e3)}catch(t){i(t.message)}finally{setTimeout(()=>s(),1e3)}};return a.exports.useEffect(()=>{N()},[N]),a.exports.useEffect(()=>{O()},[O]),e(Ke,{anchor:"right",open:r,onClose:(o,t)=>!oe(t)&&s(),sx:{zIndex:"modal"},children:l(Ve,{children:[l($e,{children:[e(B,{onClick:s,className:"icon-md-button",children:e($,{})}),e(je,{children:"Create New Rule"})]}),l(Ge,{onSubmit:R(J),autoComplete:"off",children:[e(ie,{component:"p",color:"#24272C",fontSize:18,lineHeight:"21px",marginBottom:3,children:"Assign enquiry to team member when lead data field matches value."}),e(ye,{children:l(Re,{children:[e(k,{children:l(z,{select:!0,control:n,label:"Lead Data Field",name:"param_name",sx:We,required:!0,defaultValue:v,children:[d.length===0?e(T,{value:"",disabled:!0,children:"No Lead Data Field Available"}):e(T,{value:"",disabled:!0,children:"Select Lead Data Field"}),d.map(({id:o,display_name:t,field_name:Q})=>e(T,{value:Q,children:t},o))]})}),e(k,{children:e(z,{control:n,name:"rule.value",label:"Match Value",placeholder:"Match Value",required:!0,sx:Xe})}),e(k,{children:e(Ze,{open:f,onOpen:()=>{b(!0)},onClose:()=>{L(""),b(!1)},noOptionsText:"Team Member not found.",isOptionEqualToValue:(o,t)=>o.user.name===t.user.name,getOptionLabel:o=>o.user.name,options:h,loading:g,onChange:(o,t)=>{t&&F("assign_to",t.user.id)},onInputChange:(o,t)=>{L(t.length>2?t:"")},ListboxComponent:K,ListboxProps:{onScroll:o=>{const t=o.currentTarget;t.scrollTop+t.clientHeight===t.scrollHeight&&u&&u>h.length&&Z(M+1)}},renderOption:(o,t)=>a.exports.createElement(T,{...o,value:t.user.id,key:t.user_id},t.user.name),renderInput:o=>e(Je,{...o,label:"Assign To",required:!0,InputProps:{...o.InputProps,endAdornment:l(a.exports.Fragment,{children:[g?e(Qe,{color:"inherit",size:20}):null,o.InputProps.endAdornment]})}})})})]})}),e(ge,{children:e(I,{type:"submit",children:"Save"})})]})]})})},lt=()=>{const{isMobile:r,isTablet:s}=ne(),{setErrorMessage:i}=A(),[m,d]=a.exports.useState(!0),[h,u]=a.exports.useState(!1),[p,D]=a.exports.useState(1),{leadDistRules:f,showLeadDistRuleForm:b,totalLeadDistRules:g}=W(),{setLeadDataFields:x}=le(),{setLeadDistRules:C,setShowLeadDistRuleForm:L,setTotalLeadDistRules:c}=X(),M=a.exports.useCallback(async()=>{try{const n=await w.getLeadDistRules(p);if(!n.success)throw Error(n.message);C(R=>R.concat(n.payload.data)),g===0&&c(n.payload.meta.total),d(!1),u(!1)}catch(n){i(n.message)}},[p]),y=a.exports.useCallback(async()=>{try{const n=await ce.getLeadDataFields();if(!n.success)throw Error(n.message);x(n.payload)}catch(n){i(n.message)}},[]);return a.exports.useEffect(()=>{y()},[y]),a.exports.useEffect(()=>{M()},[M]),m?e(_,{className:Ue.AbsCenter,children:e(de,{height:72,width:72})}):l(a.exports.Fragment,{children:[e(ue,{children:e("title",{children:"Lead Distribution Rules"})}),r&&l(Le,{children:[e(B,{component:me,to:"/business-settings",className:"icon-md-button",children:e($,{})}),e(De,{children:"Lead Distribution Rules"})]}),e(be,{children:e(xe,{children:!m&&e(_,{elevation:0,children:e(Pe,{children:f.length===0?l(Ce,{children:[e(Ee,{children:e(I,{disableIcon:!0,onClick:()=>L(!0),className:"small",children:"New Lead Distribution Rule"})}),e(ke,{children:e(Ae,{children:"Create logical rules, based on which an enquiry is automatically assigned to a team member."})})]}):l(a.exports.Fragment,{children:[s&&e(it,{}),s&&e(Ye,{}),f.map(({rule:n,user:R,id:P},F)=>e(ot,{title:R.name,description:n.value,ruleId:P},F)),g>f.length&&e(Te,{children:e(et,{variant:"contained",color:"primary",onClick:()=>{D(n=>n+1),u(!0)},loading:h,children:"Load More"})})]})})})})}),r&&f.length>0&&e(we,{children:e(I,{onClick:()=>L(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Lead Distribution Rule"})}),e(nt,{open:b,closeDrawer:()=>{L(!1)}})]})},Jt=()=>e(tt,{children:e(fe,{children:e(lt,{})})});export{Jt as default};
