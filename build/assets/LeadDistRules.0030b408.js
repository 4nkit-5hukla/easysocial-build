var U=Object.defineProperty;var Y=(r,a,i)=>a in r?U(r,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[a]=i;var S=(r,a,i)=>(Y(r,typeof a!="symbol"?a+"":a,i),i);import{r as s,j as e,ap as E,aj as A,a as l,V as B,aA as Z,ax as ee,T as te,u as se,ay as ae,az as re,an as oe,W as ie,L as ne}from"./index.073e8519.js";import{a as le,u as ce,B as de}from"./BizParticipantsProvider.88b261ea.js";import{L as V}from"./LeftArrow.235889a2.js";import{a as I,F as k,A as me}from"./Form.9ae76886.js";import{c as ue,H as pe,d as he,I as fe,g as ge,h as Le}from"./Wrappers.02633da0.js";import{F as De,G as xe,L as be}from"./Grid.1c4b00b4.js";import{b as Ce,c as we,d as ye,e as Re,f as Te,C as H,a as Me}from"./Card.4c2ddd0d.js";import{C as ve,a as Fe,b as Se}from"./Cta.51bc8125.js";import{C as Ie}from"./PopupBoxes.5f446c1c.js";import{L as Pe}from"./ListItem.715cd520.js";import{a as Ee,L as ke}from"./ListItemText.e51bd2bd.js";import{C as Ae}from"./Chip.31d6a505.js";import{M as Be}from"./MoreVert.2083fd59.js";import{M as Ne}from"./Menu.0d419ddd.js";import{M as T}from"./MenuItem.b94cf611.js";import{u as Oe,F as _}from"./FormTextField.647df67e.js";import{B as z}from"./BizParticipantsApi.4f9f3c31.js";import{D as He,a as _e,b as ze,c as qe}from"./Drawer.252a2e9a.js";import{a as Ve,F as $e}from"./Style.8807be1a.js";import{D as je}from"./Drawer.dbd2d7a0.js";import{A as Ge}from"./Autocomplete.f0dc154d.js";import{T as We}from"./TextField.0a86a659.js";import{C as Xe}from"./CircularProgress.86a381e8.js";import{p as Ke}from"./Position.module.ff7b7fa6.js";import{D as Je}from"./Divider.eed56417.js";import{L as Qe}from"./LoadingButton.331c1254.js";import"./ArrowRight.02d10553.js";import"./Card.8e7b8d20.js";import"./CardContent.e16f8b10.js";import"./List.f98f8b01.js";import"./listItemButtonClasses.0c3200c1.js";import"./isMuiElement.425f7666.js";import"./listItemTextClasses.6cf4fbe2.js";import"./dividerClasses.4f58093b.js";import"./Select.34c8d5fc.js";import"./useFormControl.888bcf17.js";import"./useControlled.5350d55d.js";import"./Popper.3814177e.js";const $=s.exports.createContext(void 0),j=s.exports.createContext(void 0),Ue=({children:r})=>{const[a,i]=s.exports.useState([]),[u,d]=s.exports.useState(!1),[f,m]=s.exports.useState(0),p={leadDistRules:a,showLeadDistRuleForm:u,totalLeadDistRules:f},L=s.exports.useMemo(()=>({setLeadDistRules:i,setShowLeadDistRuleForm:d,setTotalLeadDistRules:m}),[]);return e($.Provider,{value:p,children:e(j.Provider,{value:L,children:r})})},G=()=>{const r=s.exports.useContext($);if(r===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return r},W=()=>{const r=s.exports.useContext(j);if(r===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return r};class w{}S(w,"getLeadDistRules",async(a=1,i=20)=>await E(`/lms-rules?page=${a}&limit=${i}`,"GET")),S(w,"createLeadDistRule",async a=>await E("/lms-rules","POST",{data:a})),S(w,"deleteLeadDistRule",async a=>await E(`/lms-rules/${a}`,"DELETE"));const Ye="vzpS",Ze="vsan",q={LeadDistRuleItem:Ye,OptionMenuPaper:Ze},et={px:{xs:3.75,md:2},"&:hover":{bgcolor:"#edfaff"}},tt=r=>{const{setErrorMessage:a,setSuccessMessage:i}=A(),{title:u,description:d,ruleId:f}=r,[m,p]=s.exports.useState(null),[L,h]=s.exports.useState(!1),x=()=>{h(!0)},D=()=>{h(!1)},b=c=>{p(c.currentTarget)},C=()=>{p(null)},g=async()=>{try{const c=await w.deleteLeadDistRule(f);if(!c.success)throw Error(c.message);i(c.message),setTimeout(()=>window.location.reload(),1e3)}catch(c){a(c.message)}finally{D()}};return l(s.exports.Fragment,{children:[l(Pe,{component:"div",sx:et,children:[e(Ee,{primary:l("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:u}),e(Ae,{label:d,size:"small"})]}),className:q.LeadDistRuleItem}),e(ke,{children:e(B,{onClick:b,children:e(Be,{})})})]}),Boolean(m)&&e(Ne,{anchorEl:m,open:Boolean(m),onClose:C,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:q.OptionMenuPaper},children:e(T,{onClick:()=>{x(),C()},children:"Delete"})}),e(Ie,{title:"Delete",open:L,setOpen:h,onConfirm:async()=>{await g()},positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},st=()=>{const{totalLeadDistRules:r}=G(),{setShowLeadDistRuleForm:a}=W();return l(Ce,{children:[e(we,{children:e(I,{disableIcon:!0,type:"button",onClick:()=>a(!0),className:"small",children:"New Lead Distribution Rule"})}),e(ye,{children:e(Re,{children:e(Te,{children:`${r} Lead Distribution Rules`})})})]})},X=s.exports.forwardRef((r,a)=>{const{children:i,...u}=r,d=s.exports.useRef(null);return s.exports.useImperativeHandle(a,()=>d.current),e("ul",{...u,ref:d,role:"list-box",children:i})});X.displayName="ListBox";const at=({open:r,closeDrawer:a})=>{const{setErrorMessage:i,setSuccessMessage:u}=A(),{leadDataFields:d}=Z(),{teamMembers:f,teamMembersTotal:m}=le(),{setTeamMembers:p,setTeamMembersTotal:L}=ce(),[h,x]=s.exports.useState(!1),[D,b]=s.exports.useState(!0),[C,g]=s.exports.useState(""),c=s.exports.useDeferredValue(C),[M,y]=s.exports.useState(1),{control:n,handleSubmit:R,watch:P,setValue:v}=Oe({defaultValues:{param_name:"",rule:{},assign_to:"",param_type:"",logic:"match"}}),{param_name:F}=P(),K=async o=>{try{y(o);const t=await z.getTeamMembers(c,o);if(!t.success)throw Error(t.message);p([...f,...t.payload.data])}catch(t){i(t.message)}},N=s.exports.useCallback(async()=>{try{if(r){b(!0),y(1);const t=await z.getTeamMembers(c,1);if(!t.success)throw Error(t.message);p(t.payload.data),L(t.payload.meta.total),b(!1)}}catch(o){i(o.message)}},[r,c]),O=s.exports.useCallback(()=>{if(F!==""){const[o]=d.filter(t=>t.field_name===F);o&&v("param_type",o.field_type)}},[F]),J=async o=>{try{const t=await w.createLeadDistRule(o);if(!t.success)throw Error(t.message);u(t.message),setTimeout(()=>window.location.reload(),1e3)}catch(t){i(t.message)}finally{setTimeout(()=>a(),1e3)}};return s.exports.useEffect(()=>{N()},[N]),s.exports.useEffect(()=>{O()},[O]),e(je,{anchor:"right",open:r,onClose:(o,t)=>!ee(t)&&a(),sx:{zIndex:"modal"},children:l(He,{children:[l(_e,{children:[e(B,{onClick:a,className:"icon-md-button",children:e(V,{})}),e(ze,{children:"Create New Rule"})]}),l(qe,{onSubmit:R(J),autoComplete:"off",children:[e(te,{component:"p",color:"#24272C",fontSize:18,lineHeight:"21px",marginBottom:3,children:"Assign enquiry to team member when lead data field matches value."}),e(De,{children:l(xe,{children:[e(k,{children:l(_,{select:!0,control:n,label:"Lead Data Field",name:"param_name",sx:Ve,required:!0,defaultValue:F,children:[d.length===0?e(T,{value:"",disabled:!0,children:"No Lead Data Field Available"}):e(T,{value:"",disabled:!0,children:"Select Lead Data Field"}),d.map(({id:o,display_name:t,field_name:Q})=>e(T,{value:Q,children:t},o))]})}),e(k,{children:e(_,{control:n,name:"rule.value",label:"Match Value",placeholder:"Match Value",required:!0,sx:$e})}),e(k,{children:e(Ge,{open:h,onOpen:()=>{x(!0)},onClose:()=>{g(""),x(!1)},noOptionsText:"Team Member not found.",isOptionEqualToValue:(o,t)=>o.user.name===t.user.name,getOptionLabel:o=>o.user.name,options:f,loading:D,onChange:(o,t)=>{t&&v("assign_to",t.user.id)},onInputChange:(o,t)=>{g(t.length>2?t:"")},ListboxComponent:X,ListboxProps:{onScroll:o=>{const t=o.currentTarget;t.scrollTop+t.clientHeight===t.scrollHeight&&m&&m>f.length&&K(M+1)}},renderOption:(o,t)=>s.exports.createElement(T,{...o,value:t.user.id,key:t.user_id},t.user.name),renderInput:o=>e(We,{...o,label:"Assign To",required:!0,InputProps:{...o.InputProps,endAdornment:l(s.exports.Fragment,{children:[D?e(Xe,{color:"inherit",size:20}):null,o.InputProps.endAdornment]})}})})})]})}),e(me,{children:e(I,{type:"submit",children:"Save"})})]})]})})},rt=()=>{const{isMobile:r,isTablet:a}=se(),{setErrorMessage:i}=A(),[u,d]=s.exports.useState(!0),[f,m]=s.exports.useState(!1),[p,L]=s.exports.useState(1),{leadDistRules:h,showLeadDistRuleForm:x,totalLeadDistRules:D}=G(),{setLeadDataFields:b}=ae(),{setLeadDistRules:C,setShowLeadDistRuleForm:g,setTotalLeadDistRules:c}=W(),M=s.exports.useCallback(async()=>{try{const n=await w.getLeadDistRules(p);if(!n.success)throw Error(n.message);C(R=>R.concat(n.payload.data)),D===0&&c(n.payload.meta.total),d(!1),m(!1)}catch(n){i(n.message)}},[p]),y=s.exports.useCallback(async()=>{try{const n=await re.getLeadDataFields();if(!n.success)throw Error(n.message);b(n.payload)}catch(n){i(n.message)}},[]);return s.exports.useEffect(()=>{y()},[y]),s.exports.useEffect(()=>{M()},[M]),u?e(H,{className:Ke.AbsCenter,children:e(oe,{height:72,width:72})}):l(s.exports.Fragment,{children:[e(ie,{children:e("title",{children:"Lead Distribution Rules"})}),r&&l(ue,{children:[e(B,{component:ne,to:"/business-settings",className:"icon-md-button",children:e(V,{})}),e(pe,{children:"Lead Distribution Rules"})]}),e(he,{children:e(fe,{children:!u&&e(H,{elevation:0,children:e(Me,{sx:{mx:{xs:-3.75,md:0}},children:h.length===0?l(ge,{children:[e(ve,{children:e(I,{disableIcon:!0,onClick:()=>g(!0),className:"small",children:"New Lead Distribution Rule"})}),e(Fe,{children:e(Se,{children:"Create logical rules, based on which an enquiry is automatically assigned to a team member."})})]}):l(s.exports.Fragment,{children:[a&&e(st,{}),a&&e(Je,{}),h.map(({rule:n,user:R,id:P},v)=>e(tt,{title:R.name,description:n.value,ruleId:P},v)),D>h.length&&e(be,{children:e(Qe,{variant:"contained",color:"primary",onClick:()=>{L(n=>n+1),m(!0)},loading:f,children:"Load More"})})]})})})})}),r&&h.length>0&&e(Le,{children:e(I,{onClick:()=>g(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Lead Distribution Rule"})}),e(at,{open:x,closeDrawer:()=>{g(!1)}})]})},jt=()=>e(Ue,{children:e(de,{children:e(rt,{})})});export{jt as default};
