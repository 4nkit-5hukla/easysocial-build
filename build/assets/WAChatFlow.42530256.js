import{j as e,S as J,r as a,u as I,aj as M,aJ as U,a as s,V as D,aO as w,ax as B,an as Z,aH as K,c as Y,W as Q}from"./index.7f82941f.js";import{L as N}from"./LeftArrow.d8255c35.js";import ee from"./LinkPlatForm.f23c4951.js";import{I as te,h as re,c as oe,H as ae,d as se}from"./Wrappers.c2aef7a9.js";import{F as v,G as E,C as ne}from"./Grid.a7877d24.js";import{b as le,d as ie,e as ce,f as de,c as me,C as _,a as pe}from"./Card.94b21a7c.js";import{A as he}from"./CommonComponents.123cce4d.js";import{p as ue}from"./Position.module.ff7b7fa6.js";import{C as Ce}from"./PopupBoxes.b055c154.js";import{L as we}from"./ListItem.f29cbb3e.js";import{a as fe,L as ge}from"./ListItemText.e793f45c.js";import{M as Fe}from"./MoreVert.9bd7ff56.js";import{M as be}from"./Menu.22af6717.js";import{M as f}from"./MenuItem.50616e83.js";import{a as T,F as y,A as W}from"./Form.51dca0ed.js";import{D as xe}from"./Divider.6de19a4b.js";import{u as H,F as L}from"./FormTextField.05f4b970.js";import{D as P,a as O,b as R,c as q}from"./Drawer.2b52f4ed.js";import{a as j,d as z}from"./Style.8807be1a.js";import{D as V}from"./Drawer.7d1b4dc8.js";import"./Styles.3864ecd6.js";import"./Tags.367dafc5.js";import"./toConsumableArray.52b4c8e6.js";import"./styled.00f71db4.js";import"./List.771b1df1.js";import"./Card.273c3e06.js";import"./CardContent.f8f32f32.js";import"./listItemTextClasses.9956a810.js";import"./dividerClasses.ea04d24b.js";import"./listItemButtonClasses.661acbb5.js";import"./isMuiElement.ea3f4046.js";import"./ArrowRight.7cb9a070.js";import"./Styles.c059562f.js";import"./TextField.bc8832bf.js";import"./Select.460c2a9d.js";import"./useFormControl.95a504f2.js";import"./useControlled.15b67f87.js";const ye=({className:l,sx:o})=>e(J,{viewBox:"0 0 12 12",fill:"none",...l?{className:l}:{},sx:o||{},children:e("path",{d:"M11.9733 4.54201C11.9091 4.33529 11.7384 4.18464 11.5329 4.15343L9.10155 3.78374C8.44291 3.6836 7.87738 3.26207 7.59323 2.6595L6.48922 0.31828C6.39731 0.123399 6.20764 0 6 0C5.79233 0 5.60266 0.123399 5.51079 0.31828L4.40687 2.65942C4.12273 3.26201 3.55719 3.68356 2.89853 3.7837L0.467118 4.15339C0.261626 4.18464 0.0908684 4.33529 0.0267114 4.54197C-0.0374455 4.74869 0.016055 4.97558 0.164773 5.12726L1.9772 6.97597C2.42317 7.43087 2.62576 8.071 2.5227 8.69965L2.09108 11.3325C2.05598 11.5468 2.14011 11.7632 2.3081 11.891C2.40314 11.9632 2.5157 12 2.62881 12C2.71563 12 2.80281 11.9783 2.88264 11.9344L5.03589 10.7498C5.63618 10.4195 6.36375 10.4195 6.96404 10.7498L9.11725 11.9344C9.19756 11.9786 9.2855 11.9997 9.37261 12C9.67357 11.9995 9.91739 11.7441 9.91739 11.4291C9.91739 11.3852 9.91267 11.3425 9.90372 11.3015L9.47724 8.69966C9.3742 8.07103 9.57678 7.43091 10.0227 6.97603L11.8352 5.12726C11.9839 4.97558 12.0374 4.74869 11.9733 4.54201Z"})}),Le={px:{xs:0,md:2}},De="IgqU",Se="_9w-D",Ae="o-vx",x={TeamMemberItem:De,OptionMenuPaper:Se,DefaultTag:Ae},ke=l=>{const{title:o,description:n,chatbotId:i,chatflowID:d,setChatflowID:m}=l,[p,C]=a.exports.useState(""),{isTablet:h}=I(),{setSuccessMessage:c,setErrorMessage:u}=M(),[t,g]=a.exports.useState(null),[S,F]=a.exports.useState(!1),b=()=>{F(!0)},A=r=>{g(r.currentTarget)},k=()=>{g(null)},$=async()=>{try{const r=await w.deleteChatFlow(d);if(!r.success){u(r.message);return}c("ChatFlow deleted successfully"),window.location.reload()}catch(r){console.log(r)}},G=async()=>{try{const r=await w.makeDefaultChatFlow(d);if(!r.success){u(r.message);return}c("ChatFlow set as default successfully"),window.location.reload()}catch(r){console.log(r)}},X=a.exports.useRef(async()=>{try{const r=await U.getWAPlatformDetails({platform:"WHATSAPP",product:"engage"});if(r.errors)throw Error(r.errors.pop().message);if(!r.success&&r.message)throw Error(r.message);C(r.payload.whatsapp.phone_number)}catch(r){console.log(r)}});return a.exports.useEffect(()=>{X.current()},[]),s(a.exports.Fragment,{children:[s(we,{component:"div",sx:Le,children:[e(fe,{primary:e("div",{className:"primary-block",children:e("h2",{className:"list-title",children:o})}),secondary:n,className:x.TeamMemberItem}),i&&s("span",{className:x.DefaultTag,children:[e(ye,{}),h&&e("h5",{children:"Default"})]}),e(ge,{children:e(D,{onClick:A,children:e(Fe,{})})})]}),Boolean(t)&&s(be,{anchorEl:t,open:Boolean(t),onClose:k,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},className:x.OptionMenu,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:x.OptionMenuPaper},children:[e(f,{disabled:!!i,onClick:()=>{b(),k()},children:"Delete"}),e(f,{disabled:!!i,onClick:()=>{G(),k()},children:"Make Default"}),e(f,{href:`/chat-flow/${d}`,target:"_blank",children:"Edit ChatFlow"}),e(f,{disabled:!i,onClick:()=>{window.open(`https://api.whatsapp.com/send?phone=+${p}&text=0`,"_blank")},children:"Test on WhatsApp"}),e(f,{onClick:()=>{m(d)},children:"Rename"})]}),e(Ce,{title:"Delete",open:S,setOpen:F,onConfirm:async()=>{await $()},positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},Ie="_0lZ7",Me="Wn4Y",Ne="TDcJ",Te={pd_none:Ie,pd_block_1:Me,pd_block_2:Ne},_e=l=>{const{open:o,totalChatFLows:n}=l;return e(a.exports.Fragment,{children:s(le,{children:[e(ie,{children:e(ce,{children:e(de,{children:"ChatFlow"})})}),e(xe,{}),e(me,{children:e("div",{className:Te.pd_block_2,children:e(T,{disabled:n>=5,disableIcon:!0,type:"button",onClick:()=>{o()},className:"small",children:"New ChatFlow"})})})]})})},Be=({open:l,onClose:o})=>{const{setErrorMessage:n,setSuccessMessage:i}=M(),{control:d,handleSubmit:m,reset:p}=H({defaultValues:{name:"",description:""}});return e(V,{anchor:"right",open:l,onClose:(h,c)=>!B(c)&&o(),sx:{zIndex:"modal"},children:s(P,{children:[s(O,{children:[e(D,{onClick:o,className:"icon-md-button",children:e(N,{})}),e(R,{children:"Create a new Chatbot"})]}),s(q,{onSubmit:m(async h=>{try{const c=await w.createNewChatFLow({...h,platform:"WHATSAPP"});c.success?(i("New ChatFlow Created"),setTimeout(()=>window.location.reload(),1e3)):n(c.message),p()}catch{n("Something went wrong")}finally{o()}}),children:[e(v,{children:s(E,{children:[e(y,{children:e(L,{control:d,label:"Name",name:"name",sx:j,required:!0})}),e(y,{children:e(L,{control:d,name:"description",label:"Description",placeholder:"Description",required:!0,sx:z,rows:5,inputProps:{maxLength:50},multiline:!0})})]})}),e(W,{children:e(T,{type:"submit",children:"Save"})})]})]})})},ve=({open:l,onClose:o,chatflowID:n})=>{const{setErrorMessage:i,setSuccessMessage:d}=M(),{control:m,handleSubmit:p,reset:C}=H({defaultValues:{name:"",description:""}}),h=a.exports.useRef(async u=>{try{const t=await w.getChatFlowById(u);if(!t.success)throw Error(t.message);C({name:t.payload.name,description:t.payload.description})}catch(t){i(t.message)}});return a.exports.useEffect(()=>{n!==null&&h.current(n)},[n]),e(V,{anchor:"right",open:l,onClose:(u,t)=>!B(t)&&o(),sx:{zIndex:"modal"},children:s(P,{children:[s(O,{children:[e(D,{onClick:o,className:"icon-md-button",children:e(N,{})}),e(R,{children:"Rename your ChatFlow"})]}),s(q,{onSubmit:p(async u=>{try{if(n===null)throw Error("Chatflow ID is not available");const t=await w.updateChatFlow({...u,platform:"WHATSAPP"},n);t.success?(d("Chatflow updated successfully"),setTimeout(()=>window.location.reload(),500)):i(t.message),C()}catch{i("Something went wrong")}finally{o()}}),children:[e(v,{children:s(E,{children:[e(y,{children:e(L,{control:m,label:"Name",name:"name",sx:j,required:!0})}),e(y,{children:e(L,{control:m,name:"description",label:"Description",placeholder:"Description",required:!0,sx:z,rows:5,inputProps:{maxLength:50},multiline:!0})})]})}),e(W,{children:e(T,{type:"submit",children:"Save"})})]})]})})},Ee=()=>{const{isMobile:l,isTablet:o}=I(),[n,i]=a.exports.useState(!1),[d,m]=a.exports.useState(!1),[p,C]=a.exports.useState([]),[h,c]=a.exports.useState(null),u=a.exports.useRef(async()=>{try{i(!0);const t=await w.getAllChatFlow();if(!t.success)throw Error(t.message);C(t.payload),i(!1)}catch{C([]),i(!1)}});return a.exports.useEffect(()=>{u.current()},[]),n?e(_,{className:ue.AbsCenter,children:e(Z,{height:72,width:72})}):s(a.exports.Fragment,{children:[e(te,{children:!n&&e(_,{elevation:0,children:e(pe,{children:s(a.exports.Fragment,{children:[o&&e(_e,{open:()=>{m(!0)},totalChatFLows:p.length}),p.map(({name:t,description:g,chatbot_id:S,id:F},b)=>e(ke,{title:t,description:g,chatbotId:S,index:b,chatflowID:F,setChatflowID:A=>{c(A)}},b))]})})})}),l&&p.length>0&&e(re,{children:e(he,{onClick:()=>{m(!0)},variant:"outlined",color:"primary",disableIcon:!0,children:"New ChatFlow"})}),e(Be,{open:d,onClose:()=>m(!1)}),e(ve,{open:h!==null,onClose:()=>c(null),chatflowID:h})]})},We=()=>{const{isMobile:l}=I(),{platformExist:o}=K();return s(a.exports.Fragment,{children:[l&&s(oe,{children:[e(D,{component:Y,to:"/business-settings",className:"icon-md-button",children:e(N,{})}),e(ae,{children:"WhatsApp ChatFlow"})]}),e(se,{children:typeof o=="boolean"&&o===!1?e(ne,{children:e(ee,{})}):e(Ee,{})})]})},bt=()=>s(a.exports.Fragment,{children:[e(Q,{children:e("title",{children:"WhatsApp Chat FLow"})}),e(We,{})]});export{bt as default};
