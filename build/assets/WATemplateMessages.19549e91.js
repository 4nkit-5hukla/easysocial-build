import{i as Ct,k as bt,s as Te,g as ie,r as l,l as xt,_ as yt,T as ce,j as e,a as o,m as de,q as Tt,aj as oe,aP as pe,aQ as vt,V as k,aR as ve,aS as De,u as we,ax as Ue,U as Ie,I as wt,B as St,aH as Ft,an as Et,W as Wt,L as Bt}from"./index.3f755f43.js";import{C as Pt,W as D,a as Le}from"./WaTemplatePreviewCard.0c3ee641.js";import{L as Ne}from"./LeftArrow.2a02d883.js";import{S as ye}from"./Search.e33159dc.js";import{c as At,H as Mt,d as It,I as Oe,g as Nt,h as Rt}from"./Wrappers.3b659e6c.js";import{a as Y,F as $,c as Ce,V as Pe,d as be,e as ae,A as Ae,b as ge}from"./Form.86858169.js";import{S as Ve,a as qe,b as je}from"./Search.073b2d91.js";import{b as Lt,c as Ot,d as _t,e as kt,f as Ht,g as $t,C as _e,a as Dt}from"./Card.498f76ed.js";import{C as Ut,a as Vt,b as qt}from"./Cta.c9b8e257.js";import jt from"./LinkPlatForm.b9a0cc26.js";import{p as zt}from"./Position.module.ff7b7fa6.js";import{W as Yt,a as L}from"./WhatsApp.0df87c02.js";import{L as Qt}from"./ListItem.9d03250f.js";import{a as Xt,L as Gt}from"./ListItemText.14bf1e60.js";import{C as Kt}from"./Chip.95eb9b58.js";import{M as Zt}from"./MoreVert.9c3b7460.js";import{M as Jt}from"./Menu.92c0f563.js";import{M as R}from"./MenuItem.93c4c08f.js";import{C as ze}from"./Clear.7da58567.js";import{F as O,u as Ye}from"./FormTextField.42593052.js";import{D as Me,a as Qe,b as Xe,c as Ge}from"./Drawer.df337a14.js";import{F as re,G as ne,S as ea}from"./Grid.55238631.js";import{F as G,a as le,d as Se}from"./Style.ced39dc3.js";import{F as Fe}from"./FormIOSSwitch.d336f5d0.js";import{C as Ke}from"./Card.7fc2e334.js";import{g as ta}from"./mui-tel-input.es.4c1344f0.js";import{F as aa,e as oa}from"./Styles.c059562f.js";import{T as sa}from"./TextField.b05be362.js";import{D as Ze}from"./Drawer.3de54176.js";import{F as xe,a as ra,A as na}from"./FileType.118a3b25.js";import{A as ke}from"./AssetsApi.4c4b89b1.js";import{I as la,u as ia}from"./index.355ca7d2.js";import{L as ca}from"./Link.7b79cd83.js";import{D as da}from"./Divider.a2357665.js";import"./Play.5eba6438.js";import"./ArrowRight.51809bda.js";import"./CardContent.c2610bb8.js";import"./Styles.3864ecd6.js";import"./Tags.8209ed70.js";import"./toConsumableArray.52b4c8e6.js";import"./styled.3dd1de67.js";import"./List.65d7d5bb.js";import"./CommonComponents.51c638c4.js";import"./listItemTextClasses.ff0ce9ef.js";import"./dividerClasses.de1a71f9.js";import"./listItemButtonClasses.577a91ae.js";import"./isMuiElement.382d0fe2.js";import"./Switch.a765307a.js";import"./SwitchBase.82e52644.js";import"./useFormControl.ae5beb16.js";import"./useControlled.b7ea6072.js";import"./InputAdornment.4f38b966.js";import"./Select.c042a67e.js";import"./tslib.es6.61e9e735.js";function pa(a){return bt("MuiCardHeader",a)}const ma=Ct("MuiCardHeader",["root","avatar","action","content","title","subheader"]),He=ma,ua=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],ha=a=>{const{classes:s}=a;return Tt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},pa,s)},fa=Te("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(a,s)=>ie({[`& .${He.title}`]:s.title,[`& .${He.subheader}`]:s.subheader},s.root)})({display:"flex",alignItems:"center",padding:16}),ga=Te("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(a,s)=>s.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Ca=Te("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(a,s)=>s.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ba=Te("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(a,s)=>s.content})({flex:"1 1 auto"}),xa=l.exports.forwardRef(function(s,n){const T=xt({props:s,name:"MuiCardHeader"}),{action:w,avatar:i,className:f,component:S="div",disableTypography:g=!1,subheader:C,subheaderTypographyProps:v,title:W,titleTypographyProps:b}=T,u=yt(T,ua),B=ie({},T,{component:S,disableTypography:g}),E=ha(B);let d=W;d!=null&&d.type!==ce&&!g&&(d=e(ce,ie({variant:i?"body2":"h5",className:E.title,component:"span",display:"block"},b,{children:d})));let h=C;return h!=null&&h.type!==ce&&!g&&(h=e(ce,ie({variant:i?"body2":"body1",className:E.subheader,color:"text.secondary",component:"span",display:"block"},v,{children:h}))),o(fa,ie({className:de(E.root,f),as:S,ref:n,ownerState:B},u,{children:[i&&e(ga,{className:E.avatar,ownerState:B,children:i}),o(ba,{className:E.content,ownerState:B,children:[d,h]}),w&&e(Ca,{className:E.action,ownerState:B,children:w})]}))}),Je=xa,ya=({color:a="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:a})}),Ta={px:{xs:3.75,md:2},"&:hover":{bgcolor:"#edfaff"}},va="yMNf",wa="xmX7",$e={WTMItem:va,OptionMenuPaper:wa},Sa=({template_status:a,name:s,id:n,description:T})=>{const{setErrorMessage:w,setSuccessMessage:i}=oe(),{setEditWaTemplateId:f,setShowWaTemplateForm:S,setPreviewWaTemplateId:g,setShowWaTemplatePreview:C}=pe(),[v,W]=l.exports.useState(null),[b,u]=l.exports.useState(!1),B=()=>{u(!0)},E=()=>{u(!1)},d=F=>{W(F.currentTarget)},h=()=>{W(null)},q=async()=>{try{const F=await D.deleteWaTemplateMessage(n);if(!F.success)throw Error(F.message);i(F.message),setTimeout(()=>window.location.reload(),1e3)}catch(F){w(F.message)}finally{E()}};return o(l.exports.Fragment,{children:[o(Qt,{component:"div",sx:Ta,children:[e(Xt,{primary:o("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:s}),e(Kt,{label:a,size:"small",sx:{bgcolor:Yt[a]}})]}),secondary:vt(`${T.replaceAll(`
`," ").trim().slice(0,400)}${T.length>400?"...":""}`),className:$e.WTMItem}),e(Gt,{children:e(k,{onClick:d,children:e(Zt,{})})})]}),Boolean(v)&&o(Jt,{anchorEl:v,open:Boolean(v),onClose:h,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:$e.OptionMenuPaper},children:[a==="DRAFT"&&e(R,{onClick:()=>{f(n),S(!0),h()},children:"Edit"}),(a==="SUBMITTED"||a==="APPROVED")&&e(R,{onClick:()=>{g(n),C(!0),h()},children:"Preview"}),e(R,{onClick:()=>{B(),h()},children:"Delete"})]}),e(Pt,{title:"Delete",open:b,setOpen:u,onConfirm:async()=>await q(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},Fa=({isSearchActive:a,setSearchActive:s})=>{const{setErrorMessage:n,setSuccessMessage:T}=oe(),{totalWaTemplates:w}=ve(),{setWaTemplateFilter:i,setShowWaTemplateForm:f,setTotalWaTemplates:S,setWaTemplatesData:g}=pe(),[C,v]=l.exports.useState(!1),W=async()=>{try{v(!0);const b=await D.syncWaTemplateMessage();if(b.success){const u=await D.getWaTemplateMessages();if(!u.success)throw Error(b.message);S(u.payload.length),g(u.payload),T(b.message)}else n(b.message)}catch(b){n(b.message)}finally{v(!1)}};return o(Lt,{children:[e(Ot,{children:e(Y,{disableIcon:!0,type:"button",onClick:()=>f(!0),className:"small",children:"New Template Message"})}),o(_t,{children:[!a&&e(kt,{children:e(Ht,{children:`${w} Template Messages`})}),o($t,{children:[a&&e(Ve,{children:o(qe,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(ye,{})}),e(je,{onChange:({target:{value:b}})=>i(b),placeholder:"Search Template"}),e(k,{onClick:()=>{i(""),s(!a)},sx:{position:"absolute",right:0,top:0},children:e(ze,{})})]})}),!a&&e(k,{onClick:()=>s(b=>!b),children:e(ye,{})}),!a&&e(Y,{icon:e(ya,{color:C?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:C,onClick:()=>W(),className:"sync",children:C?"Syncing...":"Sync Messages"})]})]})]})},X=/[{][{]\d{1,3}[}][}]/gm,Ea="oIEe",Wa="CaIb",et={QrButtonCard:Ea,CtaButtonCard:Wa},Ba=({index:a,control:s,removeQuickReply:n})=>o(Ke,{className:et.QrButtonCard,elevation:0,children:[e(Je,{title:`Quick Reply ${a+1}`,action:e(k,{"aria-label":`Remove Quick Reply ${a+1}`,onClick:()=>n(a),children:e(De,{})})}),e($,{sx:{my:2},children:e(O,{control:s,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:G})})]},a),Pa=({index:a,type:s,url:n,phone_number:T,waTemplateButtonCtaTypes:w,control:i,setValue:f,removeCallAction:S})=>{const{country:g}=we(),[C,v]=l.exports.useState(0),W=()=>{if(C===1)return;const u=`${n}{{${1}}}`;f(`components[3].buttons[${a}].url`,u),v(1)},b=l.exports.useCallback(()=>{if(n){const u=n.match(X);u&&u.length>0?v(1):v(0)}},[n]);return l.exports.useEffect(()=>{b()},[b]),o(Ke,{className:et.CtaButtonCard,elevation:0,children:[e(Je,{title:`Call to Action ${a+1}`,action:e(k,{"aria-label":`Remove Call to Action ${a+1}`,onClick:()=>S(a),children:e(De,{})})}),e($,{sx:{my:2},children:o(O,{select:!0,control:i,label:"Action Type",name:`components[3].buttons[${a}].type`,sx:aa,required:!0,defaultValue:s,children:[e(R,{value:"",disabled:!0,children:"Select Action Type"}),w.map(({value:u,name:B},E)=>e(R,{value:u,children:B},E))]})}),s!==""&&e($,{sx:{my:2},children:e(O,{control:i,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:G})}),s==="PHONE_NUMBER"&&e($,{sx:{my:2},children:e(ta,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:g,value:T!=null?T:"",onChange:u=>{f(`components[3].buttons[${a}].phone_number`,u.replaceAll(" ",""))},variant:"filled",sx:oa})}),s==="URL"&&o($,{sx:{my:2},children:[o(Ce,{children:[e(O,{control:i,name:`components[3].buttons[${a}].url`,label:"URL",required:!0,sx:{...G,pb:2,height:"auto"}}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",disabled:C===1,onClick:W,children:"ADD VARIABLE"})]}),o(be,{children:[o(ae,{children:[n?n.length:0,"/60 Characters"]}),o(ae,{children:[C,"/1 Variable"]})]})]})]},a)},Aa=({open:a,closeDrawer:s})=>{const{setErrorMessage:n,setSuccessMessage:T}=oe(),{businessId:w}=we(),{editWaTemplateId:i,waTemplatesData:f,waTemplateCategories:S,waTemplateLanguages:g,waTemplateTypes:C,waTemplateHeaderTypes:v,waTemplateButtonTypes:W,waTemplateButtonCtaTypes:b}=ve(),{setWaTemplatesData:u,setShowWaPreviewForm:B,setPreviewWaTemplateId:E}=pe(),d={name:"",category:"",language:"",template_type:"",businessId:w,components:[{format:"",text:"",type:L.HEADER,active:!1},{text:"",type:L.BODY},{text:"",type:L.FOOTER,active:!1},{buttons:[],type:L.BUTTONS,active:!1}]},{control:h,handleSubmit:q,watch:F,reset:x,setValue:r}=Ye({defaultValues:d}),{name:y,category:I,language:se,template_type:N,components:Z}=F(),M=Z.find(({type:t})=>t===L.HEADER),U=Z.find(({type:t})=>t===L.BODY),Q=Z.find(({type:t})=>t===L.FOOTER),_=Z.find(({type:t})=>t===L.BUTTONS),[J,V]=l.exports.useState(0),[p,P]=l.exports.useState(""),j=l.exports.useCallback(()=>{const c=y.match(/^[A-Za-z0-9_]+$/g)===null?y.slice(0,-1):y.replace(/\s/g,"").toLowerCase();r("name",c)},[y]),z=()=>{if(J===1)return;const t=`${M.text}{{${1}}}`;r("components[0].text",t),V(1)},ee=()=>{const t=U.text.match(X),c=t&&t.length>0?`${U.text}{{${t.length+1}}}`:`${U.text}{{${1}}}`;r("components[1].text",c)},te=l.exports.useCallback(()=>{const t=M.text.match(X);t&&t.length>0?V(1):V(0)},[M.text]),me=l.exports.useCallback(()=>{const t=M.text.match(X);if(t===null){V(0);return}if(t.length===0){V(0);return}r("components[0].text",t.reduce((c,m,H)=>H===0?c.replace(m,`{{${H+1}}}`):c.replace(m,""),t.reduce((c,m,H)=>c.replace(m,`{{${H+1}}}`),M.text))),V(1)},[M.text]),ue=()=>{const t=U.text.match(X);t!==null&&t.length!==0&&r("components[1].text",t.reduce((c,m,H)=>c.replace(m,`{{${H+1}}}`),U.text))},A=t=>{P(t.target.value)},he=()=>{if(p===""&&n("Please Select button Type"),p==="QUICK_REPLY")if(_.buttons.length<3){const t=_.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else n("Limit exceeded");if(p==="CALL_TO_ACTION")if(_.buttons.length<2){const t=_.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else n("Limit exceeded")},fe=t=>{const c=_.buttons;c.splice(t,1),r("components[3].buttons",c)},tt=t=>{const c=_.buttons;c.splice(t,1),r("components[3].buttons",c)},at=e(O,{control:h,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:G}),ot=o(O,{select:!0,control:h,label:"Template Category",name:"category",sx:le,required:!0,defaultValue:I,children:[e(R,{value:"",disabled:!0,children:"Select Template Category"}),S.map(({value:t,name:c},m)=>e(R,{value:t,children:c},m))]}),st=o(O,{select:!0,control:h,label:"Language",name:"language",sx:le,required:!0,defaultValue:se,children:[e(R,{value:"",disabled:!0,children:"Select Language"}),g.map(({code:t,name:c},m)=>e(R,{value:t,children:c},m))]}),rt=o(O,{select:!0,control:h,label:"Template Type",name:"template_type",sx:le,required:!0,defaultValue:N,children:[e(R,{value:"",disabled:!0,children:"Select Template Type"}),C.map(({value:t,label:c},m)=>e(R,{value:t,children:c},m))]}),nt=o(re,{className:"justify-content-between",children:[e(ne,{children:e(ge,{children:"Header"})}),e(Fe,{control:h,name:"components[0].active"})]}),lt=o(O,{select:!0,control:h,label:"Header Type",name:"components[0].format",sx:le,required:!0,defaultValue:M.format,children:[e(R,{value:"",disabled:!0,children:"Select Header Type"}),v.map(({value:t,name:c},m)=>e(R,{value:t,children:c},m))]}),it=o(l.exports.Fragment,{children:[o(Ce,{children:[e(O,{control:h,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Se}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",disabled:J===1,onClick:z,children:"ADD VARIABLE"})]}),o(be,{children:[o(ae,{children:[M.text.length,"/60 Characters"]}),o(ae,{children:[J,"/1 Variable"]})]})]}),ct=e(ge,{children:"Body"}),dt=o(l.exports.Fragment,{children:[o(Ce,{children:[e(O,{control:h,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:ue,inputProps:{maxLength:1024},sx:Se}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",onClick:ee,children:"ADD VARIABLE"})]}),e(be,{children:o(ae,{children:[U.text.length,"/1024 Characters"]})})]}),pt=o(re,{className:"justify-content-between",children:[e(ne,{children:e(ge,{children:"Footer"})}),e(Fe,{control:h,name:"components[2].active"})]}),mt=o(l.exports.Fragment,{children:[e(Ce,{children:e(O,{control:h,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Se})}),e(be,{children:o(ae,{children:[Q.text.length,"/60 Characters"]})})]}),ut=o(re,{className:"justify-content-between",children:[e(ne,{children:e(ge,{children:"Buttons"})}),e(Fe,{control:h,name:"components[3].active"})]}),ht=o(l.exports.Fragment,{children:[o(re,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(ne,{children:o(sa,{select:!0,label:"Button Type",sx:le,required:!0,value:p,onChange:A,disabled:_.buttons.length>0,children:[e(R,{value:"",disabled:!0,children:"Select Button Type"}),W.map(({label:t,name:c},m)=>e(R,{value:c,children:t},m))]})}),e(ea,{children:e(Y,{variant:"outlined",color:"primary",onClick:he,disableIcon:!0,children:"Add a Button"})})]}),N==="media"&&_.active&&_.buttons.length>0&&e(l.exports.Fragment,{children:_.buttons.map(({type:t,url:c,phone_number:m},H)=>{switch(t){case"QUICK_REPLY":return e(Ba,{index:H,removeQuickReply:fe,control:h},H);default:return e(Pa,{index:H,type:t,url:c,phone_number:m,waTemplateButtonCtaTypes:b,control:h,setValue:r,removeCallAction:tt},H)}})})]}),ft=[at,ot,st,rt,...N==="media"?[nt]:[],...N==="media"&&M.active?[lt]:[],...N==="media"&&M.active&&M.format==="TEXT"?[it]:[],...N!==""?[ct]:[],...N!==""?[dt]:[],...N==="media"?[pt]:[],...N==="media"&&Q.active?[mt]:[],...N==="media"?[ut]:[],...N==="media"&&_.active?[ht]:[]],gt=async t=>{var c;try{if(i){const m=await D.updateWaTemplateMessage(i,t);if(!m.success)throw Error(m.message);T(m.message),E((c=m.payload.id)!=null?c:i),x(d),s(),B(!0)}else{const m=await D.createWaTemplateMessage(t);if(!m.success)throw Error(m.message);T(m.message),u([m.payload,...f]),E(m.payload.id),x(d),s(),B(!0)}}catch(m){n(m.message)}},Re=l.exports.useCallback(async()=>{try{if(i){const t=await D.getWaTemplateMessage(i);if(!t.success)throw Error(t.message);x(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?P("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&P("CALL_TO_ACTION"))}}catch(t){n(t.message)}},[i]);return l.exports.useEffect(()=>{Re()},[Re]),l.exports.useEffect(()=>{j()},[j]),l.exports.useEffect(()=>{me()},[me]),l.exports.useEffect(()=>{te()},[te]),l.exports.useEffect(()=>{M.active||r("components[0].format","")},[M.active]),l.exports.useEffect(()=>{Q.active||r("components[2].text","")},[Q.active]),e(Ze,{anchor:"right",open:a,onClose:(t,c)=>{Ue(c)||(x(d),s())},sx:{zIndex:"modal"},children:o(Me,{children:[o(Qe,{children:[e(k,{onClick:()=>{x(d),s()},className:"icon-md-button",children:e(Ne,{})}),e(Xe,{children:`${i?"Update":"Create New"} Template`})]}),o(Ge,{onSubmit:q(gt),onReset:()=>{x(d),s()},children:[e(re,{children:e(ne,{children:ft.map((t,c)=>e($,{children:t},c))})}),o(Ae,{children:[e(Y,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(Y,{type:"submit",children:"Preview & Save"})]})]})]})})},Ma="gY2p",Ia="-h1X",Ee={File_Added:Ma,PreFile:Ia,"input-text":"xc1P"},Na={display:"flex",justifyContent:"center",alignItems:"center",flex:1,padding:"20px",height:"100%",width:"100%",cursor:"pointer",textAlign:"center",borderRadius:"8px",borderColor:"#B8BAC2",borderStyle:"dashed",backgroundColor:" #F2F3F7",color:"#000000",opacity:"0.5",outline:"none",transition:"border .24s ease-in-out",boxSizing:"border-box"},Ra={borderColor:"#2196f3"},La={borderColor:"#00e676"},Oa={borderColor:"#ff1744"},_a="VHLL",ka="-OYq",Ha="NCM0",$a="EjoM",K={Upload_Overlay:_a,image_preview:ka,File_Preview:Ha,RemoveButton:$a},Da=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:K.Upload_Overlay,children:e(Ie,{className:de("mt-1",K.RemoveButton),onClick:a,children:"Remove"})}),e(wt,{src:s,alt:"preview"})]}),Ua=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:K.Upload_Overlay,children:e(Ie,{className:de("mt-1",K.RemoveButton),onClick:a,children:"Remove"})}),e("video",{className:de(K.image_preview,"w-100"),src:s,controls:!0,autoPlay:!0,muted:!0,loop:!0})]}),Va=({fileUrl:a,removeFile:s,fileName:n})=>e("div",{className:"d-flex justify-content-center",style:{height:"100%"},children:o("div",{className:K.File_Preview,children:[o("div",{className:"d-flex align-items-center",children:[e(la,{fontSize:"large"})," ",e("p",{children:n!==""?n:a==null?void 0:a.split("/").pop()})]}),e(Ie,{className:de("mt-1",K.RemoveButton),onClick:s,children:"Remove"})]})}),We={image:{label:"PNG / JPG",value:{"image/*":[]},component:({removeFile:a,fileUrl:s})=>e(Da,{removeFile:a,fileUrl:s})},video:{label:"MP4 / 3GP / 4K",value:{"video/*":[]},component:({removeFile:a,fileUrl:s})=>e(Ua,{removeFile:a,fileUrl:s})},file:{label:"DOC / XLS / PDF / ZIP",value:{"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-powerpoint":[".ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".pptx"],"application/vnd.ms-excel":[],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[],"application/pdf":[],"application/x-zip-compressed":[]},component:({fileUrl:a,removeFile:s,fileName:n})=>e(Va,{fileUrl:a,removeFile:s,fileName:n})}},qa=({onChange:a,fileType:s,removeFile:n,fileUrl:T,fileName:w,label:i})=>{var u;const{getRootProps:f,getInputProps:S,isDragActive:g,isDragAccept:C,isDragReject:v,open:W}=ia({maxFiles:1,maxSize:9e6,accept:We[s].value,noClick:!0,noKeyboard:!0,onDrop:a}),b=l.exports.useMemo(()=>({...Na,...g?Ra:{},...C?La:{},...v?Oa:{}}),[g,C,v]);return e(l.exports.Fragment,{children:T===""?e("button",{type:"button",className:Ee.PreFile,onClick:W,children:o("div",{...f({style:b}),children:[e("input",{...S()}),o("div",{className:Ee["input-text"],children:[e("h1",{children:i}),e("p",{children:(u=We[s])==null?void 0:u.label})]})]})}):e("div",{className:Ee.File_Added,children:We[s].component({removeFile:n,fileUrl:T,fileName:w})})})},ja=({control:a,fileTypes:s=xe.IMAGE,setValue:n,label:T="Upload Image",defaultFieldName:w,fileURL:i,fileNameField:f,fileField:S,fileURLField:g,width:C,height:v})=>{const{setErrorMessage:W}=oe(),[b,u]=l.exports.useState(""),B=async(d,h,q)=>{try{if(d.length>0){const F=new FormData;F.append("file",d[0]),F.append("max_size","10000"),F.append("allowed_ext",ra[s]);const x=await ke.fileUpload(na.ENGAGE_ASSETS,F);if(!x.success)throw Error(x.message);u(x.payload.file_name),n(w,x.payload.url),n(S,d[0]),n(g,x.payload.url),f&&f!==""&&n(f,x.payload.file_name)}}catch(F){console.error(F),W(F.message)}},E=async()=>{try{if(i!==""){const d=await ke.fileRemoveByURL(i);if(!d.success)throw Error(d.message);n(w,"")}}catch(d){n(w,""),console.error(d),W(d.message)}};return e(St,{sx:{transition:"all 0.2s ease-in-out",width:{xs:C!=null?C:157,lg:180,xl:200},height:{xs:v!=null?v:157,lg:180,xl:200},margin:"auto"},children:e(qa,{label:T,fileType:s,removeFile:E,fileUrl:i,fileName:b,onChange:B})})},za="nOWk",Ya="_0oHa",Qa="Ef-W",Be={WaTemplatePreview:za,WaTemplatePreviewPaper:Ya,ActionArea:Qa},Xa=({open:a,closeDrawer:s})=>{var Q,_,J,V;const{isMobile:n,isTablet:T}=we(),{setErrorMessage:w,setSuccessMessage:i}=oe(),{previewWaTemplateId:f,previewWaTemplateData:S,showWaPreviewForm:g,showWaTemplatePreview:C}=ve(),{setPreviewWaTemplateData:v,setEditWaTemplateId:W,setShowWaTemplateForm:b}=pe(),[u,B]=l.exports.useState([]),E={components:[{format:"",text:"",type:L.HEADER},{text:"",type:L.BODY},{text:"",type:L.FOOTER},{buttons:[],type:L.BUTTONS}]},{control:d,handleSubmit:h,watch:q,setValue:F}=Ye({defaultValues:E}),{components:x}=q(),r=x.find(({type:p})=>p===L.HEADER),y=x.find(({type:p})=>p===L.BODY),I=x.find(({type:p})=>p===L.BUTTONS),se=(_=(Q=r==null?void 0:r.example)==null?void 0:Q.header_handle)==null?void 0:_[0],N=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,y&&y.text&&y.text!==""&&y.text.includes("{{1}}"),I&&I.buttons.length>0&&((J=I.buttons[0])==null?void 0:J.type)==="URL"&&((V=I.buttons[0])==null?void 0:V.url.includes("{{1}}"))].reduce((p,P)=>p||P,!1),Z=async p=>{var P,j;try{const z=(P=r==null?void 0:r.example)==null?void 0:P.header_file_url,ee=new FormData;ee.append("file",(j=r==null?void 0:r.example)==null?void 0:j.header_file);const te=await D.uploadTemplateFile(ee);if(!te.success)return w(te.message);console.log(z);const me=te.payload,ue=p.components.map(A=>{var he,fe;return A==null||delete A.active,A.type==="HEADER"?((he=A==null?void 0:A.example)==null||delete he.header_files,(fe=A==null?void 0:A.example)==null||delete fe.header_file_url,{...A,example:{header_files:[me]}}):A});if(f){console.log({components:ue,mediaUrl:z});const A=await D.updateWaTemplateComponents(f,{components:ue,mediaUrl:z});if(!A.success)throw Error(A.message);i(A.message),s()}}catch(z){w(z.message)}},M=l.exports.useCallback(()=>{x.length>0&&x.forEach(({type:p,text:P})=>{if(p==="BODY"){const j=P.match(X);j&&B(j.map((z,ee)=>ee+1))}})},[x]),U=l.exports.useCallback(async()=>{try{if(f){const p=await D.getWaTemplateMessage(f);if(!p.success)throw Error(p.message);v(p.payload),F("components",p.payload.components)}}catch(p){w(p.message)}},[f]);return l.exports.useEffect(()=>{U()},[U]),l.exports.useEffect(()=>{M()},[M]),o(Ze,{anchor:"right",open:a,onClose:(p,P)=>{(!Ue(P)||C)&&s()},classes:{root:Be.WaTemplatePreview,paper:Be.WaTemplatePreviewPaper},children:[o(Me,{children:[a&&o(Qe,{children:[e(k,{onClick:()=>{s()},className:"icon-md-button",children:e(Ne,{})}),e(Xe,{children:N&&!C?"Enter Sample Values":"Preview Template"})]}),a&&o(Ge,{onSubmit:h(Z),children:[(!N||C||n)&&S&&e(Le,{components:S.components}),g&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e($,{children:e(ja,{setValue:F,control:d,fileTypes:r.format==="IMAGE"?xe.IMAGE:r.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileField:"components[0].example.header_file",fileURLField:"components[0].example.header_file_url",fileURL:se!=null?se:"",width:"100%"})}),g&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e($,{children:e(O,{control:d,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:G})}),g&&u.length>0&&u.map((p,P)=>e($,{children:e(O,{control:d,name:`components[1].example.body_text[${P}]`,label:`Body Variable ${p}`,placeholder:`Body ${p}`,required:!0,sx:G})},`bodyVar{{${p}}}`)),g&&I&&I.buttons&&I.buttons.length>0&&I.buttons.map((p,P)=>p.type==="URL"&&p.url.match(X)?e($,{children:e(O,{control:d,name:`components[3].buttons[${P}].example[0]`,label:`URL Button ${P+1}`,placeholder:`Url button ${P+1} variable 1`,required:!0,sx:G})},P):null),g&&e(Ae,{children:e(Y,{type:"submit",children:"Submit for Approval"})}),g&&o(Ae,{className:Be.ActionArea,children:[e(ce,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(ca,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{W(f),b(!0),s()},children:"Continue Editing"})]})]})]}),!C&&a&&N&&T&&e(Me,{className:"ExtendedDrawer",children:e(Le,{components:x})})]})},Ga=()=>{const{isMobile:a,isTablet:s}=we(),{setErrorMessage:n}=oe(),[T,w]=l.exports.useState(!0),[i,f]=l.exports.useState(!1),{waTemplatesData:S,waTemplateFilter:g,showWaTemplateForm:C,showWaPreviewForm:v,showWaTemplatePreview:W}=ve(),{setWaTemplatesData:b,setTotalWaTemplates:u,setWaTemplateFilter:B,setShowWaTemplateForm:E,setShowWaPreviewForm:d,setShowWaTemplatePreview:h,setEditWaTemplateId:q,setPreviewWaTemplateId:F}=pe(),{platformExist:x}=Ft(),r=l.exports.useRef(async()=>{try{const y=await D.getWaTemplateMessages();if(!y.success)throw Error(y.message);u(y.payload.length),b(y.payload)}catch(y){n(y.message)}finally{w(!1)}});return l.exports.useEffect(()=>{typeof x=="boolean"&&x&&r.current()},[x]),T?e(_e,{className:zt.AbsCenter,children:e(Et,{height:72,width:72})}):o(l.exports.Fragment,{children:[e(Wt,{children:e("title",{children:"WhatsApp Template Messages"})}),a&&o(At,{children:[!i&&e(k,{component:Bt,to:"/business-settings",className:"icon-md-button",children:e(Ne,{})}),!i&&e(Mt,{children:"Template Messages"}),i&&e(Ve,{children:o(qe,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(ye,{})}),e(je,{onChange:({target:{value:y}})=>B(y),placeholder:"Search Template"}),e(k,{onClick:()=>{B(""),f(!i)},sx:{position:"absolute",right:0,top:0},children:e(ze,{})})]})}),!i&&S.length>0&&e(k,{onClick:()=>f(y=>!y),children:e(ye,{})})]}),e(It,{children:typeof x=="boolean"&&x===!1?e(Oe,{children:e(jt,{})}):e(Oe,{children:!T&&e(_e,{elevation:0,children:e(Dt,{sx:{mx:{xs:-3.75,md:0}},children:S.length===0?o(Nt,{children:[e(Ut,{children:e(Y,{disableIcon:!0,onClick:()=>E(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Vt,{children:o(qt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):o(l.exports.Fragment,{children:[s&&e(Fa,{isSearchActive:i,setSearchActive:f}),s&&e(da,{}),S.filter(y=>{var I;return(I=y==null?void 0:y.name)==null?void 0:I.toLowerCase().includes(g==null?void 0:g.toLowerCase())}).map((y,I)=>e(Sa,{...y},I))]})})})})}),a&&S.length>0&&e(Rt,{children:e(Y,{onClick:()=>E(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(Aa,{open:C,closeDrawer:()=>{q(void 0),E(!1)}}),e(Xa,{open:v||W,closeDrawer:()=>{F(void 0),d(!1),h(!1)}})]})},Zo=()=>e(Ga,{});export{Zo as default};
