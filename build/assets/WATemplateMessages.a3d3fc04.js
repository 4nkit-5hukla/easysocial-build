import{g as Ze,f as Je,s as he,_ as se,r as i,n as et,b as tt,T as oe,j as e,a,q as at,t as rt,ao as le,aS as ie,a0 as N,as as st,at as ot,au as nt,av as lt,X as ne,aT as ue,aU as Pe,u as fe,ar as Oe,aE as Re,B as it,aV as ct,W as dt,L as pt}from"./index.2ef53a00.js";import{W as q,S as mt}from"./WATemplatesApi.1e3e0a92.js";import{b as Y,D as ht,c as ut,L as Se,d as ft,e as gt,F as ae,G as re,f as D,S as xt,A as ye}from"./CommonComponents.f015a13a.js";import{S as me}from"./Search.a8b96762.js";import{c as Ct,d as B}from"./WhatsApp.00540be5.js";import{L as bt}from"./ListItem.12cf3cff.js";import{a as Tt,L as yt}from"./ListItemText.832345b9.js";import{C as vt}from"./Chip.40d30261.js";import{M as wt}from"./MoreVert.d3741747.js";import{M as St}from"./Menu.bbc2e75d.js";import{M as P}from"./MenuItem.18c07811.js";import{T as Et,o as Wt,p as Ft,q as Mt,r as Rt,s as Bt,t as ke,u as De,v as Ne,j as X,k as j,l as Z,m as It,ae as de,af as ve,ag as pe,ah as J,U as ce,K as xe,ai as Ht,aj as Lt,ak as Be,al as Ie,am as At,an as Pt,ao as Ot,ap as kt,aq as Ce,ar as He,b as Ue,H as $e,as as Dt,w as Nt,c as Ut,x as $t,I as Vt,y as _t,f as zt,g as Xt,z as qt,A as Yt,B as Qt,D as jt,E as Kt}from"./Tags.3bbc552a.js";import{C as Ve}from"./Clear.e1488ada.js";import{F as O,u as _e}from"./FormTextField.a198370e.js";import{F as be}from"./FormIOSSwitch.906439aa.js";import{C as Ee,a as Gt}from"./CardContent.ec25cd14.js";import{g as Zt}from"./mui-tel-input.es.a49a5636.js";import{D as ze}from"./Drawer.0f9cbd63.js";import{T as Jt}from"./TextField.2efdd6e9.js";import{F as ea}from"./FileUpload.efbe58b1.js";import{F as Te}from"./index.95e5353a.js";import{P as ta,a as aa}from"./Play.e0287e0b.js";import{L as we}from"./Link.693ceaef.js";import{D as ra}from"./Divider.cff3a0e7.js";import"./styled.2c32443e.js";import"./List.06f53a6c.js";import"./listItemButtonClasses.250fbad2.js";import"./isMuiElement.e16e038e.js";import"./listItemTextClasses.284a61b1.js";import"./Switch.49a60c08.js";import"./SwitchBase.278c3002.js";import"./Select.c624df35.js";import"./InputAdornment.27416694.js";import"./AssetsApi.f6fd095b.js";function sa(r){return Je("MuiCardHeader",r)}const oa=Ze("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Le=oa,na=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],la=r=>{const{classes:o}=r;return rt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},sa,o)},ia=he("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(r,o)=>se({[`& .${Le.title}`]:o.title,[`& .${Le.subheader}`]:o.subheader},o.root)})({display:"flex",alignItems:"center",padding:16}),ca=he("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(r,o)=>o.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),da=he("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(r,o)=>o.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),pa=he("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(r,o)=>o.content})({flex:"1 1 auto"}),ma=i.exports.forwardRef(function(o,u){const E=et({props:o,name:"MuiCardHeader"}),{action:I,avatar:g,className:y,component:C="div",disableTypography:p=!1,subheader:w,subheaderTypographyProps:v,title:M,titleTypographyProps:S}=E,x=tt(E,na),b=se({},E,{component:C,disableTypography:p}),W=la(b);let H=M;H!=null&&H.type!==oe&&!p&&(H=e(oe,se({variant:g?"body2":"h5",className:W.title,component:"span",display:"block"},S,{children:H})));let T=w;return T!=null&&T.type!==oe&&!p&&(T=e(oe,se({variant:g?"body2":"body1",className:W.subheader,color:"text.secondary",component:"span",display:"block"},v,{children:T}))),a(ia,se({className:at(W.root,y),as:C,ref:u,ownerState:b},x,{children:[g&&e(ca,{className:W.avatar,ownerState:b,children:g}),a(pa,{className:W.content,ownerState:b,children:[H,T]}),I&&e(da,{className:W.action,ownerState:b,children:I})]}))}),Xe=ma,ha=({color:r="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:r})}),ua=({template_status:r,name:o,id:u,description:E})=>{const{setErrorMessage:I,setSuccessMessage:g}=le(),{setEditWaTemplateId:y,setShowWaTemplateForm:C,setPreviewWaTemplateId:p,setShowWaTemplatePreview:w}=ie(),[v,M]=i.exports.useState(null),[S,x]=i.exports.useState(!1),b=()=>{x(!0)},W=()=>{x(!1)},H=d=>{M(d.currentTarget)},T=()=>{M(null)},s=async()=>{try{const d=await q.deleteWaTemplateMessage(u);if(!d.success)throw Error(d.message);g(d.message),setTimeout(()=>window.location.reload(),1e3)}catch(d){I(d.message)}finally{W()}};return a(i.exports.Fragment,{children:[a(bt,{component:"div",sx:{px:{xs:0,md:2}},children:[e(Tt,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:o}),e(vt,{label:r,size:"small",sx:{bgcolor:Ct[r],alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),secondary:E,sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}},"& .MuiListItemText-secondary":{color:"text.secondary",fontSize:12,fontWeight:400,lineHeight:"15px"}}}),e(yt,{children:e(N,{onClick:H,children:e(wt,{})})})]}),Boolean(v)&&a(St,{anchorEl:v,open:Boolean(v),onClose:T,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:[r==="DRAFT"&&e(P,{onClick:()=>{y(u),C(!0),T()},children:"Edit"}),(r==="SUBMITTED"||r==="APPROVED")&&e(P,{onClick:()=>{p(u),w(!0),T()},children:"Preview"}),e(P,{onClick:()=>{b(),T()},children:"Delete"})]}),a(st,{open:S,"aria-labelledby":"responsive-dialog-title",children:[e(ot,{id:"responsive-dialog-title",children:"Delete"}),e(nt,{children:"Are you sure you want to delete?"}),a(lt,{children:[e(ne,{color:"secondary",onClick:()=>{W()},children:"Cancel"}),e(ne,{onClick:async()=>{await s()},autoFocus:!0,children:"Delete"})]})]})]})},fa=({isSearchActive:r,setSearchActive:o})=>{const{setErrorMessage:u,setSuccessMessage:E}=le(),{totalWaTemplates:I}=ue(),{setWaTemplateFilter:g,setShowWaTemplateForm:y,setTotalWaTemplates:C,setWaTemplatesData:p}=ie(),[w,v]=i.exports.useState(!1),M=async()=>{try{v(!0);const S=await q.syncWaTemplateMessage();if(S.success){const x=await q.getWaTemplateMessages();if(!x.success)throw Error(S.message);C(x.payload.length),p(x.payload),E(S.message)}else u(S.message)}catch(S){u(S.message)}finally{v(!1)}};return a(Et,{children:[e(Wt,{children:e(Y,{disableIcon:!0,type:"button",onClick:()=>y(!0),sx:{py:0,px:2,height:36,mt:0},children:"New Template Message"})}),a(Ft,{children:[!r&&e(Mt,{children:e(Rt,{children:`${I} Template Messages`})}),a(Bt,{children:[r&&e(ke,{children:a(De,{children:[e(N,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(me,{})}),e(Ne,{onChange:({target:{value:S}})=>g(S),placeholder:"Search Template"}),e(N,{onClick:()=>{g(""),o(!r)},sx:{position:"absolute",right:0,top:0},children:e(Ve,{})})]})}),!r&&e(N,{onClick:()=>o(S=>!S),children:e(me,{})}),!r&&e(Y,{icon:e(ha,{color:w?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:w,onClick:()=>M(),sx:{alignSelf:"center",borderRadius:4,borderColor:"#0000003b",color:"#000000de",flexDirection:"row-reverse",fontSize:14,fontWeight:400,letterSpacing:"0.02857em",lineHeight:"16px",gap:1,height:30,py:.625,px:1.875,textTransform:"capitalize"},children:w?"Syncing...":"Sync Messages"})]})]})]})},ga=({index:r,control:o,removeQuickReply:u})=>a(Ee,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Xe,{title:`Quick Reply ${r+1}`,action:e(N,{"aria-label":`Remove Quick Reply ${r+1}`,onClick:()=>u(r),children:e(Pe,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(X,{sx:{my:2},children:e(O,{control:o,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:j})})]},r),xa=({index:r,type:o,url:u,phone_number:E,waTemplateButtonCtaTypes:I,control:g,setValue:y,removeCallAction:C})=>{const{country:p}=fe(),w=/[{][{]\d{1,3}[}][}]/gm,[v,M]=i.exports.useState(0),S=()=>{if(v===1)return;const b=`${u}{{${1}}}`;y(`components[3].buttons[${r}].url`,b),M(1)},x=i.exports.useCallback(()=>{if(u){const b=u.match(w);b&&b.length>0?M(1):M(0)}},[u]);return i.exports.useEffect(()=>{x()},[x]),a(Ee,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Xe,{title:`Call to Action ${r+1}`,action:e(N,{"aria-label":`Remove Call to Action ${r+1}`,onClick:()=>C(r),children:e(Pe,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(X,{sx:{my:2},children:a(O,{select:!0,control:g,label:"Action Type",name:`components[3].buttons[${r}].type`,sx:Z,required:!0,defaultValue:o,children:[e(P,{value:"",disabled:!0,children:"Select Action Type"}),I.map(({value:b,name:W},H)=>e(P,{value:b,children:W},H))]})}),o!==""&&e(X,{sx:{my:2},children:e(O,{control:g,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:j})}),o==="PHONE_NUMBER"&&e(X,{sx:{my:2},children:e(Zt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:p,value:E!=null?E:"",onChange:b=>{y(`components[3].buttons[${r}].phone_number`,b.replaceAll(" ",""))},variant:"filled",sx:It})}),o==="URL"&&a(X,{sx:{my:2},children:[a(de,{children:[e(O,{control:g,name:`components[3].buttons[${r}].url`,label:"URL",required:!0,sx:{...j,pb:2,height:"auto"}}),e(ve,{size:"small",focusRipple:!1,className:"add-variable",disabled:v===1,onClick:S,children:"ADD VARIABLE"})]}),a(pe,{children:[a(J,{children:[u?u.length:0,"/60 Characters"]}),a(J,{children:[v,"/1 Variable"]})]})]})]},r)},Ca=({open:r,closeDrawer:o})=>{const u=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:E,setSuccessMessage:I}=le(),{businessId:g}=fe(),{editWaTemplateId:y,waTemplatesData:C,waTemplateCategories:p,waTemplateLanguages:w,waTemplateTypes:v,waTemplateHeaderTypes:M,waTemplateButtonTypes:S,waTemplateButtonCtaTypes:x}=ue(),{setWaTemplatesData:b,setShowWaPreviewForm:W,setPreviewWaTemplateId:H}=ie(),T={name:"",category:"",language:"",template_type:"",businessId:g,components:[{format:"",text:"",type:B.HEADER,active:!1},{text:"",type:B.BODY},{text:"",type:B.FOOTER,active:!1},{buttons:[],type:B.BUTTONS,active:!1}]},{control:s,handleSubmit:d,watch:c,reset:l,setValue:n}=_e({defaultValues:T}),{name:V,category:$,language:ee,template_type:A,components:K}=c(),L=K.find(({type:t})=>t===B.HEADER),_=K.find(({type:t})=>t===B.BODY),Q=K.find(({type:t})=>t===B.FOOTER),k=K.find(({type:t})=>t===B.BUTTONS),[G,z]=i.exports.useState(0),[h,F]=i.exports.useState(""),R=i.exports.useCallback(()=>{const m=V.match(/^[A-Za-z0-9_]+$/g)===null?V.slice(0,-1):V.replace(/\s/g,"").toLowerCase();n("name",m)},[V]),te=()=>{if(G===1)return;const t=`${L.text}{{${1}}}`;n("components[0].text",t),z(1)},ge=()=>{const t=_.text.match(u),m=t&&t.length>0?`${_.text}{{${t.length+1}}}`:`${_.text}{{${1}}}`;n("components[1].text",m)},We=i.exports.useCallback(()=>{const t=L.text.match(u);t&&t.length>0?z(1):z(0)},[L.text]),Fe=i.exports.useCallback(()=>{const t=L.text.match(u);if(t===null){z(0);return}if(t.length===0){z(0);return}n("components[0].text",t.reduce((m,f,U)=>U===0?m.replace(f,`{{${U+1}}}`):m.replace(f,""),t.reduce((m,f,U)=>m.replace(f,`{{${U+1}}}`),L.text))),z(1)},[L.text]),qe=()=>{const t=_.text.match(u);t!==null&&t.length!==0&&n("components[1].text",t.reduce((m,f,U)=>m.replace(f,`{{${U+1}}}`),_.text))},Ye=t=>{F(t.target.value)},Qe=()=>{if(h===""&&E("Please Select button Type"),h==="QUICK_REPLY")if(k.buttons.length<3){const t=k.buttons;t.push({type:"QUICK_REPLY",text:""}),n("components[3].buttons",t)}else E("Limit exceeded");if(h==="CALL_TO_ACTION")if(k.buttons.length<2){const t=k.buttons;t.push({type:"",text:""}),n("components[3].buttons",t)}else E("Limit exceeded")},je=t=>{const m=k.buttons;m.splice(t,1),n("components[3].buttons",m)},Ke=t=>{const m=k.buttons;m.splice(t,1),n("components[3].buttons",m)},Ge=async t=>{var m;try{if(y){const f=await q.updateWaTemplateMessage(y,t);if(!f.success)throw Error(f.message);I(f.message),H((m=f.payload.id)!=null?m:y),l(T),o(),W(!0)}else{const f=await q.createWaTemplateMessage(t);if(!f.success)throw Error(f.message);I(f.message),b([f.payload,...C]),H(f.payload.id),l(T),o(),W(!0)}}catch(f){E(f.message)}},Me=i.exports.useCallback(async()=>{try{if(y){const t=await q.getWaTemplateMessage(y);if(!t.success)throw Error(t.message);l(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&n("components[0].active",!0),t.payload.components[2].text!==""&&n("components[2].active",!0),t.payload.components[3].buttons.length>0&&n("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?F("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&F("CALL_TO_ACTION"))}}catch(t){E(t.message)}},[y]);return i.exports.useEffect(()=>{Me()},[Me]),i.exports.useEffect(()=>{R()},[R]),i.exports.useEffect(()=>{Fe()},[Fe]),i.exports.useEffect(()=>{We()},[We]),i.exports.useEffect(()=>{L.active||n("components[0].format","")},[L.active]),i.exports.useEffect(()=>{Q.active||n("components[2].text","")},[Q.active]),e(ze,{anchor:"right",open:r,onClose:(t,m)=>{Oe(m)||(l(T),o())},sx:{zIndex:"modal"},children:a(ht,{sx:{width:{xs:"100vw",md:360}},children:[a(ut,{children:[e(N,{onClick:()=>{l(T),o()},sx:{width:32,height:32},children:e(Se,{})}),e(ft,{children:`${y?"Update":"Create New"} Template`})]}),a(gt,{onSubmit:d(Ge),onReset:()=>{l(T),o()},children:[e(ae,{children:a(re,{children:[e(D,{children:e(O,{control:s,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:j})}),e(D,{children:a(O,{select:!0,control:s,label:"Template Category",name:"category",sx:Z,required:!0,defaultValue:$,children:[e(P,{value:"",disabled:!0,children:"Select Template Category"}),p.map(({value:t,name:m},f)=>e(P,{value:t,children:m},f))]})}),e(D,{children:a(O,{select:!0,control:s,label:"Language",name:"language",sx:Z,required:!0,defaultValue:ee,children:[e(P,{value:"",disabled:!0,children:"Select Language"}),w.map(({code:t,name:m},f)=>e(P,{value:t,children:m},f))]})}),e(D,{children:a(O,{select:!0,control:s,label:"Template Type",name:"template_type",sx:Z,required:!0,defaultValue:A,children:[e(P,{value:"",disabled:!0,children:"Select Template Type"}),v.map(({value:t,label:m},f)=>e(P,{value:t,children:m},f))]})}),A==="media"&&e(D,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(re,{children:e(ce,{children:"Header"})}),e(be,{control:s,name:"components[0].active"})]})}),A==="media"&&L.active&&e(D,{children:a(O,{select:!0,control:s,label:"Header Type",name:"components[0].format",sx:Z,required:!0,defaultValue:L.format,children:[e(P,{value:"",disabled:!0,children:"Select Header Type"}),M.map(({value:t,name:m},f)=>e(P,{value:t,children:m},f))]})}),A==="media"&&L.active&&L.format==="TEXT"&&a(D,{children:[a(de,{children:[e(O,{control:s,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:xe}),e(ve,{size:"small",focusRipple:!1,className:"add-variable",disabled:G===1,onClick:te,children:"ADD VARIABLE"})]}),a(pe,{children:[a(J,{children:[L.text.length,"/60 Characters"]}),a(J,{children:[G,"/1 Variable"]})]})]}),A!==""&&e(D,{children:e(ce,{children:"Body"})}),A!==""&&a(D,{children:[a(de,{children:[e(O,{control:s,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:qe,inputProps:{maxLength:1024},sx:xe}),e(ve,{size:"small",focusRipple:!1,className:"add-variable",onClick:ge,children:"ADD VARIABLE"})]}),e(pe,{children:a(J,{children:[_.text.length,"/1024 Characters"]})})]}),A==="media"&&e(D,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(re,{children:e(ce,{children:"Footer"})}),e(be,{control:s,name:"components[2].active"})]})}),A==="media"&&Q.active&&a(D,{children:[e(de,{children:e(O,{control:s,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:xe})}),e(pe,{children:a(J,{children:[Q.text.length,"/60 Characters"]})})]}),A==="media"&&e(D,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(re,{children:e(ce,{children:"Buttons"})}),e(be,{control:s,name:"components[3].active"})]})}),A==="media"&&k.active&&a(D,{children:[a(ae,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(re,{children:a(Jt,{select:!0,label:"Button Type",sx:Z,required:!0,value:h,onChange:Ye,disabled:k.buttons.length>0,children:[e(P,{value:"",disabled:!0,children:"Select Button Type"}),S.map(({label:t,name:m},f)=>e(P,{value:m,children:t},f))]})}),e(xt,{children:e(Y,{variant:"outlined",color:"primary",onClick:Qe,disableIcon:!0,children:"Add a Button"})})]}),A==="media"&&k.active&&k.buttons.length>0&&e(i.exports.Fragment,{children:k.buttons.map(({type:t,url:m,phone_number:f},U)=>{switch(t){case"QUICK_REPLY":return e(ga,{index:U,removeQuickReply:je,control:s},U);default:return e(xa,{index:U,type:t,url:m,phone_number:f,waTemplateButtonCtaTypes:x,control:s,setValue:n,removeCallAction:Ke},U)}})})]})]})}),a(ye,{children:[e(Y,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(Y,{type:"submit",children:"Preview & Save"})]})]})]})})},Ae=({components:r})=>{const o=i.exports.useRef(null),[u,E]=i.exports.useState(!1),[I,g]=i.exports.useState(!1),[y,C]=i.exports.useState(""),p=r.find(({type:s})=>s===B.HEADER),w=r.find(({type:s})=>s===B.BODY),v=r.find(({type:s})=>s===B.FOOTER),M=r.find(({type:s})=>s===B.BUTTONS),S=(s=>{if(s){const{example:d}=s;if(d){const{header_text:c}=d;return c||[]}else return[]}else return[]})(p),x=(s=>{if(s){const{example:d}=s;if(d){const{header_handle:c}=d;if(c&&c.length>0){const[l]=c;return l}else return""}else return""}else return""})(p),b=(s=>{if(s){const{example:d}=s;if(d){const{header_files:c}=d;if(c&&c.length>0){const[l]=c;return l}else return""}else return""}else return""})(p),W=(s=>{if(s){const{example:d}=s;if(d){console.log(d);const{body_text:c}=d;return c?c.length===1&&Array.isArray(c[0])?c.pop():c:[]}else return[]}else return[]})(w),H=(s=>p?s.reduce((d,c,l)=>c&&c!==""?d.replace(`{{${l+1}}}`,c):d,p.text):"")(S),T=(s=>w?s.reduce((d,c,l)=>c&&c!==""?d.replace(`{{${l+1}}}`,c):d,w.text):"")(W);return i.exports.useEffect(()=>{o.current&&(o.current.addEventListener("playing",()=>{C("playing")}),o.current.addEventListener("pause",()=>{C("")}),o.current.addEventListener("ended",()=>{C("")}),u?o.current.play():o.current.pause())},[u]),a(Ht,{children:[p&&p.format==="IMAGE"&&e(Lt,{children:x&&x!==""&&e(Re,{component:"img",alt:"header-img",image:x,sx:Be})}),p&&p.format==="VIDEO"&&a(we,{underline:"none",component:"button",type:"button",onClick:()=>E(!u),onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),sx:Ie,children:[e(Re,{component:"video",ref:o,className:"video",disablePictureInPicture:!0,sx:{...Be,height:130},children:x&&x!==""&&e("source",{src:x,type:"video/mp4"})}),a(it,{position:"absolute",display:"flex",children:[y===""&&e(ta,{}),I&&y==="playing"&&e(aa,{})]})]}),p&&p.format==="DOCUMENT"&&e(we,{underline:"none",className:"media-wrapper doc",href:x,target:"_blank",sx:{...Ie,backgroundColor:"#F5F5F5",color:"#A1AEB4",fontSize:90,fontWeight:900,lineHeight:"96px"},children:x&&x!==""?b.split(".").pop().slice(0,4).toUpperCase():""}),p&&p.format==="TEXT"&&e(At,{children:H}),e(Pt,{children:ct(T)}),v&&v.text!==""&&e(Ot,{children:v.text}),M&&M.buttons.length>0&&e(kt,{children:M.buttons.map((s,d)=>e(i.exports.Fragment,{children:s.type==="QUICK_REPLY"?e(ne,{variant:"outlined",type:"button",sx:{...Ce,color:"#767676",minWidth:"calc(50% - 8px)"},children:s.text}):s.type==="PHONE_NUMBER"?e(ne,{href:`tel:${s.phone_number}`,variant:"outlined",sx:{...Ce,color:"#32C5FF",minWidth:"100%"},children:s.text}):a(ne,{href:s.example?s.example.reduce((c,l,n)=>l&&l!==""?c.replace(`{{${n+1}}}`,l):c,s.url):"",variant:"outlined",target:"_blank",rel:"noreferrer",sx:{...Ce,color:"#32C5FF",minWidth:"100%"},children:[e(mt,{}),s.text]})},d))})]})},ba=({open:r,closeDrawer:o})=>{var Q,k,G,z;const{isMobile:u,isTablet:E}=fe(),I=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:g,setSuccessMessage:y}=le(),{previewWaTemplateId:C,previewWaTemplateData:p,showWaPreviewForm:w,showWaTemplatePreview:v}=ue(),{setPreviewWaTemplateData:M,setEditWaTemplateId:S,setShowWaTemplateForm:x}=ie(),[b,W]=i.exports.useState([]),H={components:[{format:"",text:"",type:B.HEADER},{text:"",type:B.BODY},{text:"",type:B.FOOTER},{buttons:[],type:B.BUTTONS}]},{control:T,handleSubmit:s,watch:d,setValue:c}=_e({defaultValues:H}),{components:l}=d(),n=l.find(({type:h})=>h===B.HEADER),V=l.find(({type:h})=>h===B.BODY),$=l.find(({type:h})=>h===B.BUTTONS),ee=(k=(Q=n==null?void 0:n.example)==null?void 0:Q.header_handle)==null?void 0:k[0],A=[n&&n.format!=="TEXT",n&&n.format==="TEXT"&&n.text&&n.text!==""?n.text.includes("{{1}}"):!1,V&&V.text&&V.text!==""&&V.text.includes("{{1}}"),$&&$.buttons.length>0&&((G=$.buttons[0])==null?void 0:G.type)==="URL"&&((z=$.buttons[0])==null?void 0:z.url.includes("{{1}}"))].reduce((h,F)=>h||F,!1),K=async h=>{try{const F=h.components.map(R=>{var te;return R==null||delete R.active,R.type==="HEADER"&&((te=R==null?void 0:R.example)==null||delete te.header_files),R});if(C){console.log(F);const R=await q.updateWaTemplateComponents(C,{components:F});if(!R.success)throw Error(R.message);y(R.message),o()}}catch(F){g(F.message)}},L=i.exports.useCallback(()=>{l.length>0&&l.forEach(({type:h,text:F})=>{if(h==="BODY"){const R=F.match(I);R&&W(R.map((te,ge)=>ge+1))}})},[l]),_=i.exports.useCallback(async()=>{try{if(C&&p===null){const h=await q.getWaTemplateMessage(C);if(!h.success)throw Error(h.message);M(h.payload),c("components",h.payload.components)}}catch(h){g(h.message)}},[C]);return i.exports.useEffect(()=>{_()},[_]),i.exports.useEffect(()=>{L()},[L]),a(ze,{anchor:"right",open:r,onClose:(h,F)=>{(!Oe(F)||v)&&o()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[a(He,{sx:{width:{xs:"100vw",md:360}},children:[r&&a(Ue,{children:[e(N,{onClick:()=>{o()},sx:{width:32,height:32},children:e(Se,{})}),e($e,{children:A&&!v?"Enter Sample Values":"Preview Template"})]}),r&&a(Dt,{onSubmit:s(K),children:[(!A||v||u)&&p&&e(Ae,{components:p.components}),w&&n&&(n.format==="IMAGE"||n.format==="VIDEO"||n.format==="DOCUMENT")&&e(X,{children:e(ea,{setValue:c,control:T,fileTypes:n.format==="IMAGE"?Te.IMAGE:n.format==="VIDEO"?Te.VIDEO:Te.FILE,label:`Drag & Drop ${n.format.charAt(0).toUpperCase()}${n.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:ee!=null?ee:"",width:"100%"})}),w&&n&&n.format==="TEXT"&&n.text.includes("{{1}}")&&e(X,{children:e(O,{control:T,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:j})}),w&&b.length>0&&b.map((h,F)=>e(X,{children:e(O,{control:T,name:`components[1].example.body_text[${F}]`,label:`Body Variable ${h}`,placeholder:`Body ${h}`,required:!0,sx:j})},`bodyVar{{${h}}}`)),w&&$&&$.buttons&&$.buttons.length>0&&$.buttons.map((h,F)=>(console.log(h.url),h.type==="URL"&&h.url.match(I)?e(X,{children:e(O,{control:T,name:`components[3].buttons[${F}].example[0]`,label:`URL Button ${F+1}`,placeholder:`Url button ${F+1} variable 1`,required:!0,sx:j})},F):null)),w&&e(ye,{children:e(Y,{type:"submit",children:"Submit for Approval"})}),w&&a(ye,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(oe,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(we,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{S(C),x(!0),o()},children:"Continue Editing"})]})]})]}),!v&&r&&A&&E&&e(He,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(Ae,{components:l})})]})},Ta=()=>{const{isMobile:r,isTablet:o}=fe(),{setErrorMessage:u}=le(),[E,I]=i.exports.useState(!0),[g,y]=i.exports.useState(!1),{waTemplatesData:C,waTemplateFilter:p,showWaTemplateForm:w,showWaPreviewForm:v,showWaTemplatePreview:M}=ue(),{setWaTemplatesData:S,setTotalWaTemplates:x,setWaTemplateFilter:b,setShowWaTemplateForm:W,setShowWaPreviewForm:H,setShowWaTemplatePreview:T,setEditWaTemplateId:s,setPreviewWaTemplateId:d}=ie(),c=i.exports.useCallback(async()=>{try{const l=await q.getWaTemplateMessages();if(!l.success)throw Error(l.message);x(l.payload.length),S(l.payload),I(!1)}catch(l){u(l.message)}},[]);return i.exports.useEffect(()=>{c()},[c]),a(i.exports.Fragment,{children:[e(dt,{children:e("title",{children:"WhatsApp Template Messages"})}),r&&a(Ue,{sx:Nt,children:[!g&&e(N,{component:pt,to:"/business-settings",sx:{width:32,height:32},children:e(Se,{})}),!g&&e($e,{children:"Template Messages"}),g&&e(ke,{children:a(De,{children:[e(N,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(me,{})}),e(Ne,{onChange:({target:{value:l}})=>b(l),placeholder:"Search Template"}),e(N,{onClick:()=>{b(""),y(!g)},sx:{position:"absolute",right:0,top:0},children:e(Ve,{})})]})}),!g&&C.length>0&&e(N,{onClick:()=>y(l=>!l),children:e(me,{})})]}),e(Ut,{sx:$t,children:e(Vt,{sx:_t,children:!E&&e(Ee,{elevation:0,sx:zt,children:e(Gt,{sx:Xt,children:C.length===0?a(qt,{children:[e(Yt,{children:e(Y,{disableIcon:!0,onClick:()=>W(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Qt,{children:a(jt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(i.exports.Fragment,{children:[o&&e(fa,{isSearchActive:g,setSearchActive:y}),o&&e(ra,{}),C.filter(l=>{var n;return(n=l==null?void 0:l.name)==null?void 0:n.toLowerCase().includes(p==null?void 0:p.toLowerCase())}).map((l,n)=>e(ua,{...l},n))]})})})})}),r&&C.length>0&&e(Kt,{children:e(Y,{onClick:()=>W(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(Ca,{open:w,closeDrawer:()=>{s(void 0),W(!1)}}),e(ba,{open:v||M,closeDrawer:()=>{d(void 0),H(!1),T(!1)}})]})},tr=()=>e(Ta,{});export{tr as default};
