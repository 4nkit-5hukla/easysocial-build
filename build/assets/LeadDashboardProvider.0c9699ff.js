var re=Object.defineProperty;var oe=(t,a,n)=>a in t?re(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;var c=(t,a,n)=>(oe(t,typeof a!="symbol"?a+"":a,n),n);import{r as o,j as N}from"./index.2ac26d62.js";import{h as U}from"./moment.9709ab41.js";import{u as ne}from"./SnackProvider.63ea6bb4.js";import{u as ie}from"./useArray.8bb8838e.js";import{A as de}from"./AuthApi.da8276b2.js";import{A as g}from"./Axios.d864dcf9.js";const ce=[{role:5013,views:["region","zone","area","dealership"]},{role:4872,views:["region","zone","area","dealership"]},{role:3765,views:["zone","area","dealership"],id:"departmentId"},{role:2422,views:["area","dealership"],id:"teamId"},{role:1475,views:["lead"],id:"userId"}];var C=(t=>(t.DASHBOARD="dashboard",t.UNASSIGNED="unassigned",t))(C||{}),p=(t=>(t[t.TEAM_MEMBER=1475]="TEAM_MEMBER",t[t.TEAM_HEAD=2422]="TEAM_HEAD",t[t.DEPARTMENT_HEAD=3765]="DEPARTMENT_HEAD",t[t.ADMIN=4872]="ADMIN",t[t.OWNER=5013]="OWNER",t))(p||{});class d{}c(d,"getTableData",async(a,n)=>await g(`/honda-dashboard/${a}`,"POST",{data:n})),c(d,"assignWithLocationLeads",async()=>await g("/honda-dashboard/assign-leads/wll","GET")),c(d,"getUnassignedLeadsCount",async a=>await g("/honda-dashboard/unassigned-count","POST",{data:a})),c(d,"getUnassignedLeads",async(a,n)=>await g(`/honda-dashboard/unassigned-leads${a}`,"POST",{data:n})),c(d,"fetchLeadOriginForTable",async a=>await g("/honda-dashboard/origin-count","POST",{data:a}));const L=o.exports.createContext(void 0),z=o.exports.createContext(void 0),De=({children:t})=>{const{setErrorMessage:a}=ne(),[n,_]=o.exports.useState(C.DASHBOARD),[v,i]=o.exports.useState(!1),[H,f]=o.exports.useState(null),[O,S]=o.exports.useState(null),[T,W]=o.exports.useState({}),[m,E]=o.exports.useState(!1),[q,F]=o.exports.useState(!1),[I,R]=o.exports.useState(null),[k,y]=o.exports.useState([]),[j,G]=o.exports.useState([]),[B,J]=o.exports.useState([]),[le,D]=o.exports.useState([]),[ue,K]=o.exports.useState(0),[x,ge]=o.exports.useState({vehicle:[]}),[l,Q]=o.exports.useState({from:U().subtract("1","months"),to:U()}),[M,h]=o.exports.useState({current:1,pageSize:10,total:0}),[X,w]=ie([]),{setValue:Y}=w,A=async({query:r,data:e={filter:{}}})=>{try{const s=await d.getTableData(r,e);return s.success?s.payload?(h(u=>{var b,V;return{...u,total:((b=s.payload.meta)==null?void 0:b.total)||s.payload.data.length,pageSize:10,current:+((V=s.payload.meta)==null?void 0:V.current_page)||1}}),D([]),y(s.payload.data)):void 0:a(s.message)}catch(s){return a(s.message)}},Z=async(r,e,s,u)=>{if(D([]),n!=="dashboard")return await P({pagination:M,date:r});try{if(v)return;i(!0),e&&[(p.ADMIN,p.OWNER)].includes(e)&&(await d.getUnassignedLeadsCount({date:r}),$()),await A({query:`?r=${e}&view=${s}&id=${u||T?T.id:""}`,data:{filter:x,date:r,unassigned:m}}),i(!1)}catch(b){a(b.message)}},ee=async({id:r,tableView:e})=>{try{i(!0),await A({query:`?r=${I}&view=${e}${r&&`&id=${r}`}`,data:{filter:x||{},date:l,unassigned:m}}),f(e),S(r),i(!1)}catch(s){i(!1),a(s.message)}},$=async()=>{try{const r=await d.getUnassignedLeadsCount({date:l});if(!r.success)return a(r.message);const e=Number(r.payload.total||0);K(e)}catch(r){return a(r.message)}},P=async({pagination:r,date:e})=>{try{i(!0);const s=await d.getUnassignedLeads(`?limit=${r.pageSize}&page=${r.current}`,{date:e||l});return s.success?(h(u=>({...u,total:s.payload.meta.total,pageSize:s.payload.meta.per_page})),i(!1),y(s.payload.data)):(i(!1),a(s.message))}catch(s){return i(!1),a(s.message)}},te=async()=>{try{i(!0);const r=await de.fetchIsDepartmentHead();if(!r.success)return i(!1),a(r.message);const e=ce.find(s=>s.role===r.payload.role_id);e&&(R(e.role),[p.ADMIN,p.OWNER].includes(e.role)&&$(),await A({query:`?r=${e.role}&view=${e.views[0]}${e.id&&localStorage.getItem(e.id)?`&id=${localStorage.getItem(e.id)}`:""}`,data:{date:l,filter:x||{},unassigned:m}}),W({...e,id:e.id?localStorage.getItem(e.id)||e.id:null}),f(e&&e.views?e.views[0]:null),w.setValue(s=>(s.push({id:e.id?localStorage.getItem(e.id)||e.id:"",parent:!0,role:e.views[0]}),s)),i(!1))}catch(r){return a(r.message)}},ae={pageView:n,unAssigned:m,filterDate:l,pagination:M,breadcrumbView:X,userRole:I,isLoading:v,isOpenAssignPage:q,tableData:k,currentTableView:H,currentTableId:O,selectedLeads:j,originTableData:B},se=o.exports.useMemo(()=>({setPageView:_,setUnAssigned:E,setFilterDate:Q,setPagination:h,breadcrumbActions:w,setBreadcrumbView:Y,checkUserStatus:te,fetchUnassignedLeads:P,getTableDataBasedOnView:ee,setOpenAssignPage:F,setCurrentTableView:f,applyDateFilter:Z,setSelectedLeads:G,setOriginTableData:J}),[]);return o.exports.useEffect(()=>{h({current:1,pageSize:10,total:0}),y([]),E(!1),w.setValue([]),S(null),f(null),D([])},[n]),N(L.Provider,{value:ae,children:N(z.Provider,{value:se,children:t})})},xe=()=>{const t=o.exports.useContext(L);if(t===void 0)throw Error("Item must be used inside of LeadDashboardProvider, otherwise it will not function correctly.");return t},Ae=()=>{const t=o.exports.useContext(z);if(t===void 0)throw Error("Item must be used inside of LeadDashboardProvider, otherwise it will not function correctly.");return t};export{De as L,p as R,Ae as a,C as b,d as c,xe as u};
