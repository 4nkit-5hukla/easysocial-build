var U=Object.defineProperty;var Y=(s,a,i)=>a in s?U(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i;var v=(s,a,i)=>(Y(s,typeof a!="symbol"?a+"":a,i),i);import{r,j as e,a as l,W as J,L as Z}from"./index.ca4653e7.js";import{a as ee,u as te,B as z,b as re}from"./BizParticipantsApi.e789c126.js";import{L as ae}from"./LeadDataFieldsApi.3e9ced86.js";import{A as E}from"./Axios.d864dcf9.js";import{a as se}from"./Global.54008107.js";import{u as k}from"./SnackProvider.08a64b2a.js";import{a as oe,u as ie}from"./LeadDataFieldsProvider.9b46c713.js";import{L as W}from"./LeftArrow.877c7df6.js";import{c as I,D as ne,d as le,e as ce,f as de,F as me,G as ue,g as P,b as pe}from"./CommonComponents.19f64604.js";import{L as he}from"./ListItem.16c41429.js";import{a as fe,L as ge}from"./ListItemText.e1308fa4.js";import{C as xe}from"./Chip.fd325146.js";import{I as A}from"./IconButton.e7dfb1ec.js";import{M as De}from"./MoreVert.ca80c85a.js";import{M as Le}from"./Menu.8fd80eea.js";import{M as F}from"./MenuItem.95488629.js";import{D as be,a as Ce,b as we}from"./DialogContent.1c77d0ec.js";import{D as ye}from"./DialogTitle.d9211877.js";import{B as O}from"./Button.2aa5cafc.js";import{T as Te,A as Re,D as Fe,E as Se,I as Me,w as ve,v as Ie,m as Ee,N as Pe,H as ke,n as Ae,O as Be,P as He,Q as _e,q as ze,r as Oe,R as Ne,U as We,V as qe,X as Xe,_ as Ve,Y as Ge}from"./Tags.2f698106.js";import{u as $e,F as N}from"./FormTextField.dd7b3262.js";import{i as je}from"./index.7866a838.js";import{D as Ke}from"./Drawer.02f28692.js";import{T as Qe}from"./Typography.a45e4cf2.js";import{A as Ue}from"./Autocomplete.8e7cbe57.js";import{T as Ye}from"./TextField.ce1d40b7.js";import{C as Je}from"./CircularProgress.72f217ab.js";import{C as Ze}from"./Card.7631fdd5.js";import{C as et}from"./CardContent.0479a1ff.js";import{D as tt}from"./Divider.96bbd6e2.js";import{L as rt}from"./LoadingButton.c9da20bc.js";import"./useEnhancedEffect.b8f5feb9.js";import"./styled.0e1c85d3.js";import"./ButtonBase.4773acc8.js";import"./styled.5343f2d4.js";import"./List.c558af58.js";import"./listItemButtonClasses.39d1e949.js";import"./isMuiElement.c37f6e76.js";import"./Modal.658ef5c2.js";import"./useId.cda5bee3.js";import"./Select.a7103252.js";import"./Close.b9905e22.js";import"./Popper.3d85e4ac.js";const q=r.exports.createContext(void 0),X=r.exports.createContext(void 0),at=({children:s})=>{const[a,i]=r.exports.useState([]),[p,d]=r.exports.useState(!1),[h,m]=r.exports.useState(0),u={leadDistRules:a,showLeadDistRuleForm:p,totalLeadDistRules:h},D=r.exports.useMemo(()=>({setLeadDistRules:i,setShowLeadDistRuleForm:d,setTotalLeadDistRules:m}),[]);return e(q.Provider,{value:u,children:e(X.Provider,{value:D,children:s})})},V=()=>{const s=r.exports.useContext(q);if(s===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return s},G=()=>{const s=r.exports.useContext(X);if(s===void 0)throw Error("Item must be used inside of LeadDistRulesProvider, otherwise it will not function correctly.");return s};class y{}v(y,"getLeadDistRules",async(a=1,i=20)=>await E(`/lms-rules?page=${a}&limit=${i}`,"GET")),v(y,"createLeadDistRule",async a=>await E("/lms-rules","POST",{data:a})),v(y,"deleteLeadDistRule",async a=>await E(`/lms-rules/${a}`,"DELETE"));const st=s=>{const{setErrorMessage:a,setSuccessMessage:i}=k(),{title:p,description:d,ruleId:h}=s,[m,u]=r.exports.useState(null),[D,f]=r.exports.useState(!1),L=()=>{f(!0)},g=()=>{f(!1)},b=c=>{u(c.currentTarget)},C=()=>{u(null)},x=async()=>{try{const c=await y.deleteLeadDistRule(h);if(!c.success)throw Error(c.message);i(c.message),setTimeout(()=>window.location.reload(),1e3)}catch(c){a(c.message)}finally{g()}};return l(r.exports.Fragment,{children:[l(he,{component:"div",sx:{px:{xs:0,md:2}},children:[e(fe,{primary:l("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:p}),e(xe,{label:d,size:"small",sx:{backgroundColor:"#12B0EE",alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}}}}),e(ge,{children:e(A,{onClick:b,children:e(De,{})})})]}),Boolean(m)&&e(Le,{anchorEl:m,open:Boolean(m),onClose:C,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:e(F,{onClick:()=>{L(),C()},children:"Delete"})}),l(be,{open:D,"aria-labelledby":"responsive-dialog-title",children:[e(ye,{id:"responsive-dialog-title",children:"Delete"}),e(Ce,{children:"Are you sure you want to delete?"}),l(we,{children:[e(O,{color:"secondary",onClick:()=>{g()},children:"Cancel"}),e(O,{onClick:async()=>{await x()},autoFocus:!0,children:"Delete"})]})]})]})},ot=()=>{const{totalLeadDistRules:s}=V(),{setShowLeadDistRuleForm:a}=G();return l(Te,{children:[e(Re,{children:e(I,{disableIcon:!0,type:"button",onClick:()=>a(!0),sx:{py:0,px:.625,height:36,mt:0},children:"New Lead Distribution Rule"})}),e(Fe,{children:e(Se,{children:e(Me,{children:`${s} Lead Distribution Rules`})})})]})},$=r.exports.forwardRef((s,a)=>{const{children:i,...p}=s,d=r.exports.useRef(null);return r.exports.useImperativeHandle(a,()=>d.current),e("ul",{...p,ref:d,role:"list-box",children:i})});$.displayName="ListBox";const it=({open:s,closeDrawer:a})=>{const{setErrorMessage:i,setSuccessMessage:p}=k(),{leadDataFields:d}=oe(),{teamMembers:h,teamMembersTotal:m}=ee(),{setTeamMembers:u,setTeamMembersTotal:D}=te(),[f,L]=r.exports.useState(!1),[g,b]=r.exports.useState(!0),[C,x]=r.exports.useState(""),c=r.exports.useDeferredValue(C),[S,T]=r.exports.useState(1),{control:n,handleSubmit:R,watch:B,setValue:M}=$e({defaultValues:{param_name:"",rule:{},assign_to:"",param_type:"",logic:"match"}}),{param_name:w}=B(),j=async o=>{try{T(o);const t=await z.getTeamMembers(c,o);if(!t.success)throw Error(t.message);u([...h,...t.payload.data])}catch(t){i(t.message)}},H=r.exports.useCallback(async()=>{try{if(s){b(!0),T(1);const t=await z.getTeamMembers(c,1);if(!t.success)throw Error(t.message);u(t.payload.data),D(t.payload.meta.total),b(!1)}}catch(o){i(o.message)}},[s,c]),_=r.exports.useCallback(()=>{if(w!==""){const[o]=d.filter(t=>t.field_name===w);o&&M("param_type",o.field_type)}},[w]),K=async o=>{try{const t=await y.createLeadDistRule(o);if(!t.success)throw Error(t.message);p(t.message),setTimeout(()=>window.location.reload(),1e3)}catch(t){i(t.message)}finally{setTimeout(()=>a(),1e3)}};return r.exports.useEffect(()=>{H()},[H]),r.exports.useEffect(()=>{_()},[_]),e(Ke,{anchor:"right",open:s,onClose:(o,t)=>!je(t)&&a(),sx:{zIndex:"modal"},children:l(ne,{sx:{width:{xs:"100vw",md:360}},children:[l(le,{children:[e(A,{onClick:a,sx:{width:32,height:32},children:e(W,{})}),e(ce,{children:"Create New Rule"})]}),l(de,{onSubmit:R(K),autoComplete:"off",children:[e(Qe,{component:"p",color:"#24272C",fontSize:18,lineHeight:"21px",marginBottom:3,children:"Assign enquiry to team member when lead data field matches value."}),e(me,{children:l(ue,{children:[e(P,{children:l(N,{select:!0,control:n,label:"Lead Data Field",name:"param_name",sx:ve,required:!0,defaultValue:w,children:[d.length===0?e(F,{value:"",disabled:!0,children:"No Lead Data Field Available"}):e(F,{value:"",disabled:!0,children:"Select Lead Data Field"}),d.map(({id:o,display_name:t,field_name:Q})=>e(F,{value:Q,children:t},o))]})}),e(P,{children:e(N,{control:n,name:"rule.value",label:"Match Value",placeholder:"Match Value",required:!0,sx:Ie})}),e(P,{children:e(Ue,{open:f,onOpen:()=>{L(!0)},onClose:()=>{x(""),L(!1)},noOptionsText:"Team Member not found.",isOptionEqualToValue:(o,t)=>o.user.name===t.user.name,getOptionLabel:o=>o.user.name,options:h,loading:g,onChange:(o,t)=>{t&&M("assign_to",t.user.id)},onInputChange:(o,t)=>{x(t.length>2?t:"")},ListboxComponent:$,ListboxProps:{onScroll:o=>{const t=o.currentTarget;t.scrollTop+t.clientHeight===t.scrollHeight&&m&&m>h.length&&j(S+1)}},renderOption:(o,t)=>r.exports.createElement(F,{...o,value:t.user.id,key:t.user_id},t.user.name),renderInput:o=>e(Ye,{...o,label:"Assign To",required:!0,InputProps:{...o.InputProps,endAdornment:l(r.exports.Fragment,{children:[g?e(Je,{color:"inherit",size:20}):null,o.InputProps.endAdornment]})}})})})]})}),e(pe,{children:e(I,{type:"submit",children:"Save"})})]})]})})},nt=()=>{const{isMobile:s,isTablet:a}=se(),{setErrorMessage:i}=k(),[p,d]=r.exports.useState(!0),[h,m]=r.exports.useState(!1),[u,D]=r.exports.useState(1),{leadDistRules:f,showLeadDistRuleForm:L,totalLeadDistRules:g}=V(),{setLeadDataFields:b}=ie(),{setLeadDistRules:C,setShowLeadDistRuleForm:x,setTotalLeadDistRules:c}=G(),S=r.exports.useCallback(async()=>{try{const n=await y.getLeadDistRules(u);if(!n.success)throw Error(n.message);C(R=>R.concat(n.payload.data)),g===0&&c(n.payload.meta.total),d(!1),m(!1)}catch(n){i(n.message)}},[u]),T=r.exports.useCallback(async()=>{try{const n=await ae.getLeadDataFields();if(!n.success)throw Error(n.message);b(n.payload)}catch(n){i(n.message)}},[]);return r.exports.useEffect(()=>{T()},[T]),r.exports.useEffect(()=>{S()},[S]),l(r.exports.Fragment,{children:[e(J,{children:e("title",{children:"Lead Distribution Rules"})}),s&&l(Ee,{sx:Pe,children:[e(A,{component:Z,to:"/business-settings",sx:{width:32,height:32},children:e(W,{})}),e(ke,{children:"Lead Distribution Rules"})]}),e(Ae,{sx:Be,children:e(He,{sx:_e,children:!p&&e(Ze,{elevation:0,sx:ze,children:e(et,{sx:Oe,children:f.length===0?l(Ne,{children:[e(We,{children:e(I,{disableIcon:!0,onClick:()=>x(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Lead Distribution Rule"})}),e(qe,{children:e(Xe,{children:"Create logical rules, based on which an enquiry is automatically assigned to a team member."})})]}):l(r.exports.Fragment,{children:[a&&e(ot,{}),a&&e(tt,{}),f.map(({rule:n,user:R,param_name:B,id:M},w)=>e(st,{title:R.name,description:n.value,ruleId:M},w)),g>f.length&&e(Ve,{children:e(rt,{variant:"contained",color:"primary",onClick:()=>{D(n=>n+1),m(!0)},loading:h,children:"Load More"})})]})})})})}),s&&f.length>0&&e(Ge,{children:e(I,{onClick:()=>x(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Lead Distribution Rule"})}),e(it,{open:L,closeDrawer:()=>{x(!1)}})]})},Jt=()=>e(at,{children:e(re,{children:e(nt,{})})});export{Jt as default};
