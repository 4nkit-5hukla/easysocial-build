import{b as I,u as D,r as t,ai as V,A as C,a as r,j as s,$ as B,L as H,W as L}from"./index.0fc63d4e.js";import{u as j}from"./index.esm.614544dc.js";import{u as q,a as G,R as U}from"./AuthProvider.6d311e07.js";import{C as z,g as W}from"./Card.7dabd84d.js";import{h as X}from"./Tags.10a34bb4.js";import{F as Y,G as $}from"./Grid.c09f2429.js";import{c as J,H as K,d as Q,e as Z}from"./Wrappers.1ebcf3af.js";import{F as u}from"./FormTextField.b738d457.js";import{F as h,A as ee,a as S}from"./Form.b9fdde4d.js";import{F as f}from"./Style.57c2f24e.js";import{L as se}from"./LeftArrow.6537b7c2.js";import"./tslib.es6.61e9e735.js";import"./Card.8962761a.js";import"./CardContent.b2f0281d.js";import"./withStyles.54d4ccd0.js";import"./MenuItem.1da1e3f8.js";import"./List.d46fa225.js";import"./listItemTextClasses.69e23c5a.js";import"./dividerClasses.e6a19444.js";import"./ListItem.6d0b39ca.js";import"./listItemButtonClasses.9bb2654b.js";import"./isMuiElement.eba0df62.js";import"./styled.9b77f846.js";import"./TextField.dfa21b7c.js";import"./Select.7c32bfe7.js";import"./useFormControl.777b9f12.js";import"./Menu.e1eaa76e.js";import"./useControlled.8b48121e.js";import"./ArrowRight.2c02d15e.js";const re="Y12k",te={Textfield_helperText:re},oe=()=>{const{selectedBusiness:l}=I(),{auth:y}=q(),{otpVerification:F,sendOTP:w}=G(),{isMobile:E}=D(),[i,O]=t.exports.useState(""),[A,g]=t.exports.useState(!1),[o,P]=t.exports.useState(0),{setErrorMessage:c,setSuccessMessage:b}=V(),x=window,{control:d,handleSubmit:R,reset:k}=j({defaultValues:{OTP:"",newPassword:"",confirmPassword:""}}),v=t.exports.useRef(async()=>{try{const e=await C.authUserDetails();if(e.errors)throw Error(e.errors.pop().message);if(!e.success&&e.message)throw Error(e.message);const{mobile_number:a}=e.payload;O(a)}catch(e){console.log(e)}}),M=()=>{x.recaptchaVerifier=new U("captcha-container",{size:"invisible",callback:async function(){const e=await w(i);x.confirmationResult=e},"expired-callback":function(){alert("try again!")}},y)},N=async()=>{try{if(!i)throw Error("Please enter a valid mobile number");const e=await w(i);if(!e.success&&e.message)throw c(e.message),Error(e.message);e.success&&g(!0),b(e.message),e.success&&P(180)}catch(e){console.log(e)}},_=async e=>{try{const{OTP:a,newPassword:m,confirmPassword:p}=e;if(m===""||p===""){c("Please enter a valid password");return}if(m!==p){c("Passwords do not match");return}const T=await F(a);if(T.success){const n=await C.updatePassword({password:m,confirm_password:p});if(n.errors)throw Error(n.errors.pop().message);if(!n.success&&n.message)throw Error(n.message);b("Password changed successfully"),k()}else c(T.message)}catch(a){console.log(a)}};return t.exports.useEffect(()=>{v.current()},[]),t.exports.useEffect(()=>{M()},[]),t.exports.useEffect(()=>{o>0?setTimeout(()=>{P(o-1)},1e3):o===0&&g(!1)},[o]),r(t.exports.Fragment,{children:[E&&r(J,{children:[s(B,{component:H,to:l&&l.default_url?l.default_url:"/engage/chat",className:"icon-md-button",children:s(se,{})}),s(K,{children:"My Profile"})]}),s(Q,{children:s(Z,{onSubmit:R(_),children:s(z,{elevation:0,children:r(W,{children:[s(X,{children:"Change Password"}),s(Y,{children:r($,{children:[r(h,{children:[s(u,{control:d,name:"OTP",label:"OTP",placeholder:"Enter One Time Password",required:!0,sx:f}),r("div",{className:te.Textfield_helperText,children:[r("p",{children:["SMS Message sent on ",s("strong",{children:i})]}),s("span",{children:r("p",{children:["Resend OTP in"," ",s("strong",{children:o>0?new Date(o*1e3).toISOString().substring(14,19):"00:00"})," "]})})]})]}),s(h,{children:s(u,{control:d,type:"password",name:"newPassword",label:"New Password",placeholder:"Enter New Password",required:!0,sx:f})}),s(h,{children:s(u,{control:d,type:"password",name:"confirmPassword",label:"Confirm Password",placeholder:"Enter Confirm Password",required:!0,sx:f})})]})}),r(ee,{children:[s(S,{type:"button",onClick:N,disableIcon:!0,disabled:!!A,children:"Resend OTP"}),s(S,{type:"submit",children:"Save New Password"})]})]})})})}),s("div",{id:"captcha-container"})]})},_e=()=>r(t.exports.Fragment,{children:[s(L,{children:s("title",{children:"My Profile"})}),s(oe,{})]});export{_e as default};
