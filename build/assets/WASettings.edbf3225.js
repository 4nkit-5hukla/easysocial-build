import{v as $,j as e,a,S as b,u as L,al as S,aH as k,aL as X,r as o,aJ as I,aM as F,V as f,aa as O,ab as j,I as z,ad as G,U as q,T as J,L as K,W as Q}from"./index.cad60e08.js";import{L as Y}from"./LeftArrow.00445c20.js";import{d as ee,H as te,e as oe,f as ae}from"./Tags.5e8ab465.js";import{b as se,C as ne}from"./Styles.3864ecd6.js";import{u as re,F as ie}from"./FormTextField.f0a13f9f.js";import{i as ce,h as P,a as le}from"./Card.7f9d1fc8.js";import{G as pe,F as de}from"./Grid.c28c508e.js";import{F as v,A as N,b as W,a as me}from"./Form.fc077c20.js";import{A as ue}from"./ArrowRight.5b466eb1.js";import{a as he,A as Ce}from"./Style.ced39dc3.js";import{T as fe}from"./Tooltip.c3f08655.js";import{I as ge}from"./Info.88e0c1a6.js";import{L as be}from"./LoadingButton.32dd02a5.js";import{W as ye}from"./WAUsageApi.8ede0465.js";import{T as _}from"./TextField.cc36efb4.js";import{I as D}from"./InputAdornment.fa40757e.js";import{D as H}from"./Divider.f4cede0c.js";import{V as Ae}from"./VisibilityOff.4858abad.js";import{L as xe}from"./Link.fcc3aab5.js";import{C as Te}from"./CheckCircle.e5d7b40d.js";import{C as Ie}from"./Card.3f1d897a.js";import"./toConsumableArray.52b4c8e6.js";import"./MenuItem.afc7ffcc.js";import"./List.0c445adb.js";import"./listItemTextClasses.1a92deaa.js";import"./dividerClasses.c1bb2bd9.js";import"./ListItem.238af40c.js";import"./listItemButtonClasses.20b11298.js";import"./isMuiElement.281b9e72.js";import"./styled.d3dfc040.js";import"./CardContent.6d902907.js";import"./Popper.158f5a2b.js";import"./Menu.1f1f7d6f.js";import"./useControlled.d5dc6300.js";import"./CircularProgress.864d5515.js";import"./Select.b8b6b3cf.js";import"./useFormControl.de7f2220.js";const ve=$(e("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"}),"RemoveRedEye"),M=()=>a(b,{viewBox:"0 0 16 18",fill:"none",children:[e("path",{d:"M0.818182 14.7273H3.27273V17.1818C3.27273 17.6337 3.63905 18 4.09091 18H15C15.4519 18 15.8182 17.6337 15.8182 17.1818V4.09091C15.8182 3.63905 15.4519 3.27273 15 3.27273H12.5455V0.818182C12.5455 0.366327 12.1791 0 11.7273 0H0.818182C0.366327 0 0 0.366327 0 0.818182V13.9091C0 14.3609 0.366327 14.7273 0.818182 14.7273ZM14.1818 16.3636H4.90909V4.90909H14.1818V16.3636ZM1.63636 1.63636H10.9091V3.27273H4.09091C3.63905 3.27273 3.27273 3.63905 3.27273 4.09091V13.0909H1.63636V1.63636Z"}),e("path",{d:"M7.36506 6.5459C6.9132 6.5459 6.54688 6.91223 6.54688 7.36408C6.54688 7.81593 6.9132 8.18226 7.36506 8.18226H11.7287C12.1805 8.18226 12.5469 7.81593 12.5469 7.36408C12.5469 6.91223 12.1805 6.5459 11.7287 6.5459H7.36506Z"}),e("path",{d:"M11.7287 9.81836H7.36506C6.9132 9.81836 6.54688 10.1847 6.54688 10.6365C6.54688 11.0884 6.9132 11.4547 7.36506 11.4547H11.7287C12.1805 11.4547 12.5469 11.0884 12.5469 10.6365C12.5469 10.1847 12.1805 9.81836 11.7287 9.81836Z"}),e("path",{d:"M11.7287 13.0908H7.36506C6.9132 13.0908 6.54688 13.4571 6.54688 13.909C6.54688 14.3609 6.9132 14.7272 7.36506 14.7272H11.7287C12.1805 14.7272 12.5469 14.3609 12.5469 13.909C12.5469 13.4571 12.1805 13.0908 11.7287 13.0908Z"})]}),Se=()=>e(b,{viewBox:"0 0 17 15",fill:"none",children:e("path",{d:"M16.6602 11.2817L10.7043 1.24369C9.73154 -0.414562 7.27153 -0.414562 6.30222 1.24369L0.342906 11.2817C-0.6299 12.94 0.580859 15 2.54397 15H14.4381C16.4012 15 17.633 12.9195 16.6602 11.2817ZM8.49978 12.7731C7.98189 12.7731 7.55147 12.3543 7.55147 11.8503C7.55147 11.3464 7.98189 10.9276 8.49978 10.9276C9.01768 10.9276 9.4481 11.3464 9.4271 11.8742C9.45159 12.3543 8.99669 12.7731 8.49978 12.7731ZM9.36411 6.8075C9.32212 7.52256 9.27663 8.23421 9.23464 8.94926C9.21364 9.18081 9.21364 9.39192 9.21364 9.62006C9.19265 9.99801 8.88821 10.2908 8.49978 10.2908C8.11136 10.2908 7.81042 10.0184 7.78593 9.64049C7.72294 8.52704 7.65645 7.43403 7.59346 6.32058C7.57247 6.02775 7.55147 5.73151 7.52698 5.43868C7.52698 4.95517 7.80692 4.55678 8.26183 4.43079C8.71674 4.32524 9.16815 4.53635 9.36411 4.95517C9.4306 5.10158 9.4516 5.248 9.4516 5.41825C9.4306 5.88474 9.38511 6.34782 9.36411 6.8075Z"})}),ke="O-eZ",Be="_0wF1",we="mdg7",Fe="_1c4w",We="BsOS",_e="eu31",De="MKC-",s={CopyCredentialCard:ke,CopyField:Be,CopyFieldInput:we,InputAdornment:Fe,IconButton:We,Divider:_e,InfoToolTipButton:De},He=()=>{const{businessId:h}=L(),{setErrorMessage:l,setSuccessMessage:d}=S(),{platformID:p}=k(),{setPlatformID:m,setBusinessAuth_key:c}=X(),[n,r]=o.exports.useState(""),[C,y]=o.exports.useState(""),[A,i]=o.exports.useState(!1),[g,x]=o.exports.useState("Save"),{control:V,handleSubmit:E,reset:B}=re({defaultValues:{phone_number_id:"",waba_id:"",app_id:"",phone_number:"",access_token:""}}),R=[{name:"phone_number_id",label:"Phone Number ID",toolTipImg:"/static/images/gif/video-to-gif-converter.gif"},{name:"waba_id",label:"WABA ID",toolTipImg:"https://via.placeholder.com/400x200?text=Tool+Tip"},{name:"app_id",label:"Facebook App ID",toolTipImg:"https://via.placeholder.com/400x200?text=Tool+Tip"},{name:"phone_number",label:"WhatsApp Number",toolTipImg:"https://via.placeholder.com/400x200?text=Tool+Tip"},{name:"access_token",label:"Access Token",toolTipImg:"https://via.placeholder.com/400x200?text=Tool+Tip"}],Z=o.exports.useRef(async()=>{try{i(!0);const t=await I.getWAPlatformDetails({platform:"WHATSAPP",product:"engage"});if(t.errors)throw Error(t.errors.pop().message);if(!t.success&&t.message)throw Error(t.message);B(t.payload.whatsapp),t.payload.id&&m(t.payload.id);const u=await F.getDefaultBusiness();u.payload.auth_key&&c(u.payload.auth_key),x("Update Details"),i(!1)}catch{i(!1)}}),U=async t=>{i(!0),x("Saving");const u={...t,phone_number:`+${t.phone_number}`};try{const T=await I.saveWAPlatformDetails({business_id:h,name:"WhatsApp",type:"WHATSAPP",product:"engage",whatsapp:{version:"v13.0",...u}});if(T.status===200){d("WhatsApp Settings updated successfully"),B(t),m(T.payload.id);const w=await F.getDefaultBusiness();w.payload.auth_key&&c(w.payload.auth_key)}else l("Something went wrong")}catch{l("Something went wrong")}i(!1),x("Update Details")};return o.exports.useEffect(()=>{Z.current()},[p]),a(o.exports.Fragment,{children:[a(ce,{onSubmit:E(U),children:[e(P,{children:"WhatsApp Settings"}),R.map((t,u)=>e(pe,{children:e(v,{children:e(ie,{control:V,label:t.label,name:t.name,sx:he,InputProps:{endAdornment:e(fe,{title:"Click Me for more info",placement:"left",arrow:!0,children:e(f,{className:s.InfoToolTipButton,onClick:()=>{r(t.toolTipImg),y(t.label)},children:e(ge,{})})})}})})},u)),e(N,{children:e(be,{loading:A,loadingPosition:"end",endIcon:e(ue,{color:"#ffffff"}),variant:"contained",sx:Ce,type:"submit",children:g})})]}),a(O,{open:n!=="",onClose:()=>r(""),maxWidth:"lg",children:[e(j,{children:C}),n!==""&&e(z,{src:n,alt:"ToolTip"}),e(G,{children:e(q,{onClick:()=>r(""),color:"primary",children:"Close ToolTip"})})]})]})},Me=()=>{const{setErrorMessage:h,setSuccessMessage:l}=S(),{platformID:d,businessAuth_key:p}=k(),[m,c]=o.exports.useState({}),[n,r]=o.exports.useState("Test Connection"),[C,y]=o.exports.useState(!0),A=async()=>{try{const i=await ye.getWaHealthReport();if(!i.success)throw Error(i.message);const{account_status:g}=i.payload;switch(console.log("account_status",g),g){case"connected":c({backgroundColor:"#1BB954",color:"#fff"}),r(a(o.exports.Fragment,{children:[e(b,{component:Te}),"Connected"]})),setTimeout(()=>{c({}),r("Test Connection")},3e3);break;default:c({backgroundColor:"#F7B500",color:"#fff"}),r(a(o.exports.Fragment,{children:[e(b,{component:Se}),"Not Connected"]})),setTimeout(()=>{c({}),r("Test Connection")},3e3);break}}catch(i){h(i.message)}};return a(le,{className:s.CopyCredentialCard,children:[e(P,{children:"Copy Credentials to your Facebook App"}),a(v,{children:[e(W,{children:"Callback URL"}),e(_,{classes:{root:s.CopyField},variant:"standard",inputProps:{readOnly:!0},InputProps:{classes:{input:s.CopyFieldInput},endAdornment:a(D,{position:"end",className:s.InputAdornment,children:[e(H,{orientation:"vertical",variant:"fullWidth",flexItem:!0,className:s.Divider}),e(f,{className:s.IconButton,onClick:()=>{navigator.clipboard&&(navigator.clipboard?navigator.clipboard.writeText(`https://api.easysocial.in/api/v1/chatbot/chat-service/whatsapp/${d}`):document.execCommand("Copy"),l("Callback URL copied to your clipboard"))},children:e(M,{})})]})},value:`https://api.easysocial.in/api/v1/chatbot/chat-service/whatsapp/${d}`})]}),a(v,{children:[e(W,{children:"Access Token"}),e(_,{classes:{root:s.CopyField},variant:"standard",inputProps:{readOnly:!0},InputProps:{classes:{input:s.CopyFieldInput},endAdornment:a(D,{position:"end",className:s.InputAdornment,children:[e(f,{className:s.IconButton,onClick:()=>{y(!C)},children:C?e(ve,{}):e(Ae,{})}),e(H,{orientation:"vertical",variant:"fullWidth",flexItem:!0,className:s.Divider}),e(f,{className:s.IconButton,onClick:()=>{navigator.clipboard&&(navigator.clipboard?navigator.clipboard.writeText(p):document.execCommand("Copy"),l("Access Token copied to your clipboard"))},children:e(M,{})})]})},value:C?"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":p})]}),a(de,{sx:{alignItems:{xs:"flex-start"},flexDirection:{xs:"column",sm:"row"},marginTop:"50px"},children:[e(J,{children:"After Updating Callback URL & Access Token perform a test to validate connection between WhatsApp & Easy Social."}),e(N,{children:e(me,{disableIcon:"true",component:xe,sx:{marginTop:"0px",...m},onClick:()=>{A()},children:n})})]})]})},Le=()=>{const{isMobile:h}=L(),{setErrorMessage:l}=S(),{platformID:d}=k(),[p,m]=o.exports.useState(void 0),c=o.exports.useCallback(async()=>{try{if(p===void 0){const n=await I.getWAChatBots();if(!n.success)throw Error(n.message);const[r]=n.payload;r&&m(r.id)}}catch(n){l(n.message)}},[d]);return o.exports.useEffect(()=>{c()},[c]),a(o.exports.Fragment,{children:[h&&a(ee,{children:[e(f,{component:K,to:"/business-settings",className:"icon-md-button",children:e(Y,{})}),e(te,{children:"WhatsApp Settings"})]}),e(oe,{children:e(ae,{sx:se,children:a(Ie,{elevation:0,sx:ne,children:[e(He,{}),p&&e(Me,{})]})})})]})},yt=()=>a(o.exports.Fragment,{children:[e(Q,{children:e("title",{children:"WhatsApp Settings"})}),e(Le,{})]});export{yt as default};
