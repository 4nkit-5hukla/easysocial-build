import{g as Ye,f as Qe,s as me,_ as re,r as i,n as je,b as Ke,T as oe,j as e,a,q as Ge,t as Ze,ao as ne,aS as le,a0 as P,as as Je,at as et,au as tt,av as at,X as We,aT as he,aU as Ie,u as ue,ar as Be,W as st,L as rt}from"./index.d51e5c95.js";import{W as q,T as Fe}from"./TemplatePreviewCard.247103f7.js";import{b as X,D as ot,c as nt,L as ye,d as lt,e as it,F as ae,G as se,f as O,S as ct,A as be}from"./CommonComponents.e6551361.js";import{S as pe}from"./Search.730f70c6.js";import{c as dt,d as L}from"./WhatsApp.c407ea69.js";import{L as pt}from"./ListItem.05d514ea.js";import{a as mt,L as ht}from"./ListItemText.5492a1ce.js";import{C as ut}from"./Chip.a24d063f.js";import{M as gt}from"./MoreVert.c7e5a1c4.js";import{M as ft}from"./Menu.8fa3728b.js";import{M as H}from"./MenuItem.85f0c1f8.js";import{T as Ct,o as xt,p as bt,q as Tt,r as yt,s as wt,t as He,u as Le,v as Ae,j as z,k as j,l as Z,m as vt,aa as ce,ab as Te,ac as de,ad as J,ae as ie,K as fe,af as Me,b as De,H as ke,ag as St,w as Et,c as Wt,x as Ft,I as Mt,y as Rt,f as It,g as Bt,z as Ht,A as Lt,B as At,D as Dt,E as kt}from"./Tags.232f38f7.js";import{C as Oe}from"./Clear.8d60b6cf.js";import{F as A,u as Pe}from"./FormTextField.f1eb6981.js";import{F as Ce}from"./FormIOSSwitch.f3cb8991.js";import{C as we,a as Ot}from"./CardContent.e3638dd1.js";import{A as Pt}from"./mui-tel-input.es.aa819ef8.js";import{D as Ne}from"./Drawer.7feb9539.js";import{T as Nt}from"./TextField.aa31b962.js";import{F as Vt}from"./FileUpload.a953ed5d.js";import{F as xe}from"./index.a4915aed.js";import{L as $t}from"./Link.6febdab1.js";import{D as Ut}from"./Divider.0af01585.js";import"./Play.2a62926f.js";import"./styled.4859ef71.js";import"./List.7df4626b.js";import"./listItemButtonClasses.b3393e9f.js";import"./isMuiElement.3fd04cf6.js";import"./listItemTextClasses.ddd5bbdf.js";import"./Switch.1072c5c5.js";import"./SwitchBase.228a81d1.js";import"./Select.d0687e71.js";import"./InputAdornment.16230c27.js";function _t(s){return Qe("MuiCardHeader",s)}const zt=Ye("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Re=zt,qt=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],Xt=s=>{const{classes:o}=s;return Ze({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},_t,o)},Yt=me("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(s,o)=>re({[`& .${Re.title}`]:o.title,[`& .${Re.subheader}`]:o.subheader},o.root)})({display:"flex",alignItems:"center",padding:16}),Qt=me("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(s,o)=>o.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),jt=me("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(s,o)=>o.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),Kt=me("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(s,o)=>o.content})({flex:"1 1 auto"}),Gt=i.exports.forwardRef(function(o,p){const x=je({props:o,name:"MuiCardHeader"}),{action:F,avatar:m,className:g,component:f="div",disableTypography:v=!1,subheader:y,subheaderTypographyProps:b,title:M,titleTypographyProps:C}=x,W=Ke(x,qt),h=re({},x,{component:f,disableTypography:v}),w=Xt(h);let R=M;R!=null&&R.type!==oe&&!v&&(R=e(oe,re({variant:m?"body2":"h5",className:w.title,component:"span",display:"block"},C,{children:R})));let u=y;return u!=null&&u.type!==oe&&!v&&(u=e(oe,re({variant:m?"body2":"body1",className:w.subheader,color:"text.secondary",component:"span",display:"block"},b,{children:u}))),a(Yt,re({className:Ge(w.root,g),as:f,ref:p,ownerState:h},W,{children:[m&&e(Qt,{className:w.avatar,ownerState:h,children:m}),a(Kt,{className:w.content,ownerState:h,children:[R,u]}),F&&e(jt,{className:w.action,ownerState:h,children:F})]}))}),Ve=Gt,Zt=({color:s="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:s})}),Jt=({template_status:s,name:o,id:p,description:x})=>{const{setErrorMessage:F,setSuccessMessage:m}=ne(),{setEditWaTemplateId:g,setShowWaTemplateForm:f,setPreviewWaTemplateId:v,setShowWaTemplatePreview:y}=le(),[b,M]=i.exports.useState(null),[C,W]=i.exports.useState(!1),h=()=>{W(!0)},w=()=>{W(!1)},R=k=>{M(k.currentTarget)},u=()=>{M(null)},S=async()=>{try{const k=await q.deleteWaTemplateMessage(p);if(!k.success)throw Error(k.message);m(k.message),setTimeout(()=>window.location.reload(),1e3)}catch(k){F(k.message)}finally{w()}};return a(i.exports.Fragment,{children:[a(pt,{component:"div",sx:{px:{xs:0,md:2}},children:[e(mt,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:o}),e(ut,{label:s,size:"small",sx:{bgcolor:dt[s],alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),secondary:x,sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}},"& .MuiListItemText-secondary":{color:"text.secondary",fontSize:12,fontWeight:400,lineHeight:"15px"}}}),e(ht,{children:e(P,{onClick:R,children:e(gt,{})})})]}),Boolean(b)&&a(ft,{anchorEl:b,open:Boolean(b),onClose:u,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:[s==="DRAFT"&&e(H,{onClick:()=>{g(p),f(!0),u()},children:"Edit"}),(s==="SUBMITTED"||s==="APPROVED")&&e(H,{onClick:()=>{v(p),y(!0),u()},children:"Preview"}),e(H,{onClick:()=>{h(),u()},children:"Delete"})]}),a(Je,{open:C,"aria-labelledby":"responsive-dialog-title",children:[e(et,{id:"responsive-dialog-title",children:"Delete"}),e(tt,{children:"Are you sure you want to delete?"}),a(at,{children:[e(We,{color:"secondary",onClick:()=>{w()},children:"Cancel"}),e(We,{onClick:async()=>{await S()},autoFocus:!0,children:"Delete"})]})]})]})},ea=({isSearchActive:s,setSearchActive:o})=>{const{setErrorMessage:p,setSuccessMessage:x}=ne(),{totalWaTemplates:F}=he(),{setWaTemplateFilter:m,setShowWaTemplateForm:g,setTotalWaTemplates:f,setWaTemplatesData:v}=le(),[y,b]=i.exports.useState(!1),M=async()=>{try{b(!0);const C=await q.syncWaTemplateMessage();if(C.success){const W=await q.getWaTemplateMessages();if(!W.success)throw Error(C.message);f(W.payload.length),v(W.payload),x(C.message)}else p(C.message)}catch(C){p(C.message)}finally{b(!1)}};return a(Ct,{children:[e(xt,{children:e(X,{disableIcon:!0,type:"button",onClick:()=>g(!0),sx:{py:0,px:2,height:36,mt:0},children:"New Template Message"})}),a(bt,{children:[!s&&e(Tt,{children:e(yt,{children:`${F} Template Messages`})}),a(wt,{children:[s&&e(He,{children:a(Le,{children:[e(P,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ae,{onChange:({target:{value:C}})=>m(C),placeholder:"Search Template"}),e(P,{onClick:()=>{m(""),o(!s)},sx:{position:"absolute",right:0,top:0},children:e(Oe,{})})]})}),!s&&e(P,{onClick:()=>o(C=>!C),children:e(pe,{})}),!s&&e(X,{icon:e(Zt,{color:y?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:y,onClick:()=>M(),sx:{alignSelf:"center",borderRadius:4,borderColor:"#0000003b",color:"#000000de",flexDirection:"row-reverse",fontSize:14,fontWeight:400,letterSpacing:"0.02857em",lineHeight:"16px",gap:1,height:30,py:.625,px:1.875,textTransform:"capitalize"},children:y?"Syncing...":"Sync Messages"})]})]})]})},ta=({index:s,control:o,removeQuickReply:p})=>a(we,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Ve,{title:`Quick Reply ${s+1}`,action:e(P,{"aria-label":`Remove Quick Reply ${s+1}`,onClick:()=>p(s),children:e(Ie,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(z,{sx:{my:2},children:e(A,{control:o,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:j})})]},s),aa=({index:s,type:o,url:p,phone_number:x,waTemplateButtonCtaTypes:F,control:m,setValue:g,removeCallAction:f})=>{const{country:v}=ue(),y=/[{][{]\d{1,3}[}][}]/gm,[b,M]=i.exports.useState(0),C=()=>{if(b===1)return;const h=`${p}{{${1}}}`;g(`components[3].buttons[${s}].url`,h),M(1)},W=i.exports.useCallback(()=>{if(p){const h=p.match(y);h&&h.length>0?M(1):M(0)}},[p]);return i.exports.useEffect(()=>{W()},[W]),a(we,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Ve,{title:`Call to Action ${s+1}`,action:e(P,{"aria-label":`Remove Call to Action ${s+1}`,onClick:()=>f(s),children:e(Ie,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(z,{sx:{my:2},children:a(A,{select:!0,control:m,label:"Action Type",name:`components[3].buttons[${s}].type`,sx:Z,required:!0,defaultValue:o,children:[e(H,{value:"",disabled:!0,children:"Select Action Type"}),F.map(({value:h,name:w},R)=>e(H,{value:h,children:w},R))]})}),o!==""&&e(z,{sx:{my:2},children:e(A,{control:m,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:j})}),o==="PHONE_NUMBER"&&e(z,{sx:{my:2},children:e(Pt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:v,value:x!=null?x:"",onChange:h=>{g(`components[3].buttons[${s}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:vt})}),o==="URL"&&a(z,{sx:{my:2},children:[a(ce,{children:[e(A,{control:m,name:`components[3].buttons[${s}].url`,label:"URL",required:!0,sx:{...j,pb:2,height:"auto"}}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",disabled:b===1,onClick:C,children:"ADD VARIABLE"})]}),a(de,{children:[a(J,{children:[p?p.length:0,"/60 Characters"]}),a(J,{children:[b,"/1 Variable"]})]})]})]},s)},sa=({open:s,closeDrawer:o})=>{const p=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:x,setSuccessMessage:F}=ne(),{businessId:m}=ue(),{editWaTemplateId:g,waTemplatesData:f,waTemplateCategories:v,waTemplateLanguages:y,waTemplateTypes:b,waTemplateHeaderTypes:M,waTemplateButtonTypes:C,waTemplateButtonCtaTypes:W}=he(),{setWaTemplatesData:h,setShowWaPreviewForm:w,setPreviewWaTemplateId:R}=le(),u={name:"",category:"",language:"",template_type:"",businessId:m,components:[{format:"",text:"",type:L.HEADER,active:!1},{text:"",type:L.BODY},{text:"",type:L.FOOTER,active:!1},{buttons:[],type:L.BUTTONS,active:!1}]},{control:S,handleSubmit:k,watch:Y,reset:c,setValue:r}=Pe({defaultValues:u}),{name:$,category:V,language:ee,template_type:B,components:K}=Y(),I=K.find(({type:t})=>t===L.HEADER),U=K.find(({type:t})=>t===L.BODY),Q=K.find(({type:t})=>t===L.FOOTER),D=K.find(({type:t})=>t===L.BUTTONS),[G,_]=i.exports.useState(0),[l,T]=i.exports.useState(""),E=i.exports.useCallback(()=>{const n=$.match(/^[A-Za-z0-9_]+$/g)===null?$.slice(0,-1):$.replace(/\s/g,"").toLowerCase();r("name",n)},[$]),te=()=>{if(G===1)return;const t=`${I.text}{{${1}}}`;r("components[0].text",t),_(1)},ge=()=>{const t=U.text.match(p),n=t&&t.length>0?`${U.text}{{${t.length+1}}}`:`${U.text}{{${1}}}`;r("components[1].text",n)},ve=i.exports.useCallback(()=>{const t=I.text.match(p);t&&t.length>0?_(1):_(0)},[I.text]),Se=i.exports.useCallback(()=>{const t=I.text.match(p);if(t===null){_(0);return}if(t.length===0){_(0);return}r("components[0].text",t.reduce((n,d,N)=>N===0?n.replace(d,`{{${N+1}}}`):n.replace(d,""),t.reduce((n,d,N)=>n.replace(d,`{{${N+1}}}`),I.text))),_(1)},[I.text]),$e=()=>{const t=U.text.match(p);t!==null&&t.length!==0&&r("components[1].text",t.reduce((n,d,N)=>n.replace(d,`{{${N+1}}}`),U.text))},Ue=t=>{T(t.target.value)},_e=()=>{if(l===""&&x("Please Select button Type"),l==="QUICK_REPLY")if(D.buttons.length<3){const t=D.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else x("Limit exceeded");if(l==="CALL_TO_ACTION")if(D.buttons.length<2){const t=D.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else x("Limit exceeded")},ze=t=>{const n=D.buttons;n.splice(t,1),r("components[3].buttons",n)},qe=t=>{const n=D.buttons;n.splice(t,1),r("components[3].buttons",n)},Xe=async t=>{var n;try{if(g){const d=await q.updateWaTemplateMessage(g,t);if(!d.success)throw Error(d.message);F(d.message),R((n=d.payload.id)!=null?n:g),c(u),o(),w(!0)}else{const d=await q.createWaTemplateMessage(t);if(!d.success)throw Error(d.message);F(d.message),h([d.payload,...f]),R(d.payload.id),c(u),o(),w(!0)}}catch(d){x(d.message)}},Ee=i.exports.useCallback(async()=>{try{if(g){const t=await q.getWaTemplateMessage(g);if(!t.success)throw Error(t.message);c(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?T("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&T("CALL_TO_ACTION"))}}catch(t){x(t.message)}},[g]);return i.exports.useEffect(()=>{Ee()},[Ee]),i.exports.useEffect(()=>{E()},[E]),i.exports.useEffect(()=>{Se()},[Se]),i.exports.useEffect(()=>{ve()},[ve]),i.exports.useEffect(()=>{I.active||r("components[0].format","")},[I.active]),i.exports.useEffect(()=>{Q.active||r("components[2].text","")},[Q.active]),e(Ne,{anchor:"right",open:s,onClose:(t,n)=>{Be(n)||(c(u),o())},sx:{zIndex:"modal"},children:a(ot,{sx:{width:{xs:"100vw",md:360}},children:[a(nt,{children:[e(P,{onClick:()=>{c(u),o()},sx:{width:32,height:32},children:e(ye,{})}),e(lt,{children:`${g?"Update":"Create New"} Template`})]}),a(it,{onSubmit:k(Xe),onReset:()=>{c(u),o()},children:[e(ae,{children:a(se,{children:[e(O,{children:e(A,{control:S,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:j})}),e(O,{children:a(A,{select:!0,control:S,label:"Template Category",name:"category",sx:Z,required:!0,defaultValue:V,children:[e(H,{value:"",disabled:!0,children:"Select Template Category"}),v.map(({value:t,name:n},d)=>e(H,{value:t,children:n},d))]})}),e(O,{children:a(A,{select:!0,control:S,label:"Language",name:"language",sx:Z,required:!0,defaultValue:ee,children:[e(H,{value:"",disabled:!0,children:"Select Language"}),y.map(({code:t,name:n},d)=>e(H,{value:t,children:n},d))]})}),e(O,{children:a(A,{select:!0,control:S,label:"Template Type",name:"template_type",sx:Z,required:!0,defaultValue:B,children:[e(H,{value:"",disabled:!0,children:"Select Template Type"}),b.map(({value:t,label:n},d)=>e(H,{value:t,children:n},d))]})}),B==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Header"})}),e(Ce,{control:S,name:"components[0].active"})]})}),B==="media"&&I.active&&e(O,{children:a(A,{select:!0,control:S,label:"Header Type",name:"components[0].format",sx:Z,required:!0,defaultValue:I.format,children:[e(H,{value:"",disabled:!0,children:"Select Header Type"}),M.map(({value:t,name:n},d)=>e(H,{value:t,children:n},d))]})}),B==="media"&&I.active&&I.format==="TEXT"&&a(O,{children:[a(ce,{children:[e(A,{control:S,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:fe}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",disabled:G===1,onClick:te,children:"ADD VARIABLE"})]}),a(de,{children:[a(J,{children:[I.text.length,"/60 Characters"]}),a(J,{children:[G,"/1 Variable"]})]})]}),B!==""&&e(O,{children:e(ie,{children:"Body"})}),B!==""&&a(O,{children:[a(ce,{children:[e(A,{control:S,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:$e,inputProps:{maxLength:1024},sx:fe}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",onClick:ge,children:"ADD VARIABLE"})]}),e(de,{children:a(J,{children:[U.text.length,"/1024 Characters"]})})]}),B==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Footer"})}),e(Ce,{control:S,name:"components[2].active"})]})}),B==="media"&&Q.active&&a(O,{children:[e(ce,{children:e(A,{control:S,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:fe})}),e(de,{children:a(J,{children:[Q.text.length,"/60 Characters"]})})]}),B==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Buttons"})}),e(Ce,{control:S,name:"components[3].active"})]})}),B==="media"&&D.active&&a(O,{children:[a(ae,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(se,{children:a(Nt,{select:!0,label:"Button Type",sx:Z,required:!0,value:l,onChange:Ue,disabled:D.buttons.length>0,children:[e(H,{value:"",disabled:!0,children:"Select Button Type"}),C.map(({label:t,name:n},d)=>e(H,{value:n,children:t},d))]})}),e(ct,{children:e(X,{variant:"outlined",color:"primary",onClick:_e,disableIcon:!0,children:"Add a Button"})})]}),B==="media"&&D.active&&D.buttons.length>0&&e(i.exports.Fragment,{children:D.buttons.map(({type:t,url:n,phone_number:d},N)=>{switch(t){case"QUICK_REPLY":return e(ta,{index:N,removeQuickReply:ze,control:S},N);default:return e(aa,{index:N,type:t,url:n,phone_number:d,waTemplateButtonCtaTypes:W,control:S,setValue:r,removeCallAction:qe},N)}})})]})]})}),a(be,{children:[e(X,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(X,{type:"submit",children:"Preview & Save"})]})]})]})})},ra=({open:s,closeDrawer:o})=>{var Q,D,G,_;const{isMobile:p,isTablet:x}=ue(),F=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:m,setSuccessMessage:g}=ne(),{previewWaTemplateId:f,previewWaTemplateData:v,showWaPreviewForm:y,showWaTemplatePreview:b}=he(),{setPreviewWaTemplateData:M,setEditWaTemplateId:C,setShowWaTemplateForm:W}=le(),[h,w]=i.exports.useState([]),R={components:[{format:"",text:"",type:L.HEADER},{text:"",type:L.BODY},{text:"",type:L.FOOTER},{buttons:[],type:L.BUTTONS}]},{control:u,handleSubmit:S,watch:k,setValue:Y}=Pe({defaultValues:R}),{components:c}=k(),r=c.find(({type:l})=>l===L.HEADER),$=c.find(({type:l})=>l===L.BODY),V=c.find(({type:l})=>l===L.BUTTONS),ee=(D=(Q=r==null?void 0:r.example)==null?void 0:Q.header_handle)==null?void 0:D[0],B=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,$&&$.text&&$.text!==""&&$.text.includes("{{1}}"),V&&V.buttons.length>0&&((G=V.buttons[0])==null?void 0:G.type)==="URL"&&((_=V.buttons[0])==null?void 0:_.url.includes("{{1}}"))].reduce((l,T)=>l||T,!1),K=async l=>{try{const T=l.components.map(E=>{var te;return E==null||delete E.active,E.type==="HEADER"&&((te=E==null?void 0:E.example)==null||delete te.header_files),E});if(f){console.log(T);const E=await q.updateWaTemplateComponents(f,{components:T});if(!E.success)throw Error(E.message);g(E.message),o()}}catch(T){m(T.message)}},I=i.exports.useCallback(()=>{c.length>0&&c.forEach(({type:l,text:T})=>{if(l==="BODY"){const E=T.match(F);E&&w(E.map((te,ge)=>ge+1))}})},[c]),U=i.exports.useCallback(async()=>{try{if(f&&v===null){const l=await q.getWaTemplateMessage(f);if(!l.success)throw Error(l.message);M(l.payload),Y("components",l.payload.components)}}catch(l){m(l.message)}},[f]);return i.exports.useEffect(()=>{U()},[U]),i.exports.useEffect(()=>{I()},[I]),a(Ne,{anchor:"right",open:s,onClose:(l,T)=>{(!Be(T)||b)&&o()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[a(Me,{sx:{width:{xs:"100vw",md:360}},children:[s&&a(De,{children:[e(P,{onClick:()=>{o()},sx:{width:32,height:32},children:e(ye,{})}),e(ke,{children:B&&!b?"Enter Sample Values":"Preview Template"})]}),s&&a(St,{onSubmit:S(K),children:[(!B||b||p)&&v&&e(Fe,{components:v.components}),y&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e(z,{children:e(Vt,{setValue:Y,control:u,fileTypes:r.format==="IMAGE"?xe.IMAGE:r.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:ee!=null?ee:"",width:"100%"})}),y&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e(z,{children:e(A,{control:u,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:j})}),y&&h.length>0&&h.map((l,T)=>e(z,{children:e(A,{control:u,name:`components[1].example.body_text[${T}]`,label:`Body Variable ${l}`,placeholder:`Body ${l}`,required:!0,sx:j})},`bodyVar{{${l}}}`)),y&&V&&V.buttons&&V.buttons.length>0&&V.buttons.map((l,T)=>(console.log(l.url),l.type==="URL"&&l.url.match(F)?e(z,{children:e(A,{control:u,name:`components[3].buttons[${T}].example[0]`,label:`URL Button ${T+1}`,placeholder:`Url button ${T+1} variable 1`,required:!0,sx:j})},T):null)),y&&e(be,{children:e(X,{type:"submit",children:"Submit for Approval"})}),y&&a(be,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(oe,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e($t,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{C(f),W(!0),o()},children:"Continue Editing"})]})]})]}),!b&&s&&B&&x&&e(Me,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(Fe,{components:c})})]})},oa=()=>{const{isMobile:s,isTablet:o}=ue(),{setErrorMessage:p}=ne(),[x,F]=i.exports.useState(!0),[m,g]=i.exports.useState(!1),{waTemplatesData:f,waTemplateFilter:v,showWaTemplateForm:y,showWaPreviewForm:b,showWaTemplatePreview:M}=he(),{setWaTemplatesData:C,setTotalWaTemplates:W,setWaTemplateFilter:h,setShowWaTemplateForm:w,setShowWaPreviewForm:R,setShowWaTemplatePreview:u,setEditWaTemplateId:S,setPreviewWaTemplateId:k}=le(),Y=i.exports.useCallback(async()=>{try{const c=await q.getWaTemplateMessages();if(!c.success)throw Error(c.message);W(c.payload.length),C(c.payload),F(!1)}catch(c){p(c.message)}},[]);return i.exports.useEffect(()=>{Y()},[Y]),a(i.exports.Fragment,{children:[e(st,{children:e("title",{children:"WhatsApp Template Messages"})}),s&&a(De,{sx:Et,children:[!m&&e(P,{component:rt,to:"/business-settings",sx:{width:32,height:32},children:e(ye,{})}),!m&&e(ke,{children:"Template Messages"}),m&&e(He,{children:a(Le,{children:[e(P,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ae,{onChange:({target:{value:c}})=>h(c),placeholder:"Search Template"}),e(P,{onClick:()=>{h(""),g(!m)},sx:{position:"absolute",right:0,top:0},children:e(Oe,{})})]})}),!m&&f.length>0&&e(P,{onClick:()=>g(c=>!c),children:e(pe,{})})]}),e(Wt,{sx:Ft,children:e(Mt,{sx:Rt,children:!x&&e(we,{elevation:0,sx:It,children:e(Ot,{sx:Bt,children:f.length===0?a(Ht,{children:[e(Lt,{children:e(X,{disableIcon:!0,onClick:()=>w(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(At,{children:a(Dt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(i.exports.Fragment,{children:[o&&e(ea,{isSearchActive:m,setSearchActive:g}),o&&e(Ut,{}),f.filter(c=>{var r;return(r=c==null?void 0:c.name)==null?void 0:r.toLowerCase().includes(v==null?void 0:v.toLowerCase())}).map((c,r)=>e(Jt,{...c},r))]})})})})}),s&&f.length>0&&e(kt,{children:e(X,{onClick:()=>w(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(sa,{open:y,closeDrawer:()=>{S(void 0),w(!1)}}),e(ra,{open:b||M,closeDrawer:()=>{k(void 0),R(!1),u(!1)}})]})},Na=()=>e(oa,{});export{Na as default};
