import{l as Ye,m as Qe,n as me,i as re,r as i,p as je,_ as Ke,T as oe,j as e,a,q as Ge,w as Ze,$ as ne,aY as le,a0 as N,as as Je,at as et,au as tt,av as at,e as We,aZ as ue,a_ as Ie,u as he,ar as Le,aF as st,W as rt,L as ot}from"./index.e3f0bed6.js";import{W as X,a as Fe}from"./WaTemplatePreviewCard.82108850.js";import{c as Y,D as nt,d as lt,e as it,f as ct,F as ae,G as se,g as O,S as dt,b as be}from"./CommonComponents.bdd24ec0.js";import{L as ye}from"./LeftArrow.6b9df4e8.js";import{S as pe}from"./Search.84059973.js";import{L as pt}from"./LinkPlatForm.4f73cb11.js";import{c as mt,d as B}from"./WhatsApp.00540be5.js";import{L as ut}from"./ListItem.7171109a.js";import{a as ht,L as ft}from"./ListItemText.7368081e.js";import{C as gt}from"./Chip.03cbfcee.js";import{M as Ct}from"./MoreVert.82365302.js";import{M as xt}from"./Menu.a9e9a192.js";import{M as H}from"./MenuItem.7658b5bd.js";import{T as bt,A as Tt,D as yt,E as wt,I as vt,J as St,K as He,L as Be,M as Ae,u as z,v as j,w as Z,x as Et,ar as ce,as as Te,at as de,au as J,a9 as ie,a1 as ge,av as Me,m as De,H as ke,aw as Wt,N as Ft,n as Mt,O as Rt,$ as It,a0 as Lt,P as Ht,Q as Bt,q as At,r as Dt,R as kt,U as Pt,V as Ot,X as Nt,Y as $t}from"./Tags.f65b3ae3.js";import{C as Pe}from"./Clear.ee6db896.js";import{F as A,u as Oe}from"./FormTextField.a6bf6d35.js";import{F as Ce}from"./FormIOSSwitch.a17b8f69.js";import{C as we}from"./Card.d99ba1fd.js";import{g as Vt}from"./mui-tel-input.es.d2b734df.js";import{D as Ne}from"./Drawer.83c2585d.js";import{T as Ut}from"./TextField.05a88446.js";import{F as _t}from"./FileUpload.0679c127.js";import{F as xe}from"./index.56d8fb69.js";import{L as qt}from"./Link.42acc7f7.js";import{C as zt}from"./CardContent.8e9c9589.js";import{D as Xt}from"./Divider.ee3fd026.js";import"./Play.b8e8074d.js";import"./List.f7b67727.js";import"./listItemButtonClasses.567c0e0b.js";import"./isMuiElement.60ad7b03.js";import"./listItemTextClasses.eb8a14b4.js";import"./withStyles.d25af336.js";import"./Switch.d0fdbf12.js";import"./SwitchBase.28558142.js";import"./Select.3aab61a2.js";import"./useControlled.af948729.js";import"./InputAdornment.87ba5bb3.js";import"./AssetsApi.acfe8e69.js";function Yt(r){return Qe("MuiCardHeader",r)}const Qt=Ye("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Re=Qt,jt=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],Kt=r=>{const{classes:o}=r;return Ze({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},Yt,o)},Gt=me("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(r,o)=>re({[`& .${Re.title}`]:o.title,[`& .${Re.subheader}`]:o.subheader},o.root)})({display:"flex",alignItems:"center",padding:16}),Zt=me("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(r,o)=>o.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Jt=me("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(r,o)=>o.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ea=me("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(r,o)=>o.content})({flex:"1 1 auto"}),ta=i.exports.forwardRef(function(o,d){const C=je({props:o,name:"MuiCardHeader"}),{action:F,avatar:p,className:h,component:f="div",disableTypography:S=!1,subheader:T,subheaderTypographyProps:x,title:M,titleTypographyProps:g}=C,E=Ke(C,jt),m=re({},C,{component:f,disableTypography:S}),y=Kt(m);let R=M;R!=null&&R.type!==oe&&!S&&(R=e(oe,re({variant:p?"body2":"h5",className:y.title,component:"span",display:"block"},g,{children:R})));let u=T;return u!=null&&u.type!==oe&&!S&&(u=e(oe,re({variant:p?"body2":"body1",className:y.subheader,color:"text.secondary",component:"span",display:"block"},x,{children:u}))),a(Gt,re({className:Ge(y.root,h),as:f,ref:d,ownerState:m},E,{children:[p&&e(Zt,{className:y.avatar,ownerState:m,children:p}),a(ea,{className:y.content,ownerState:m,children:[R,u]}),F&&e(Jt,{className:y.action,ownerState:m,children:F})]}))}),$e=ta,aa=({color:r="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:r})}),sa=({template_status:r,name:o,id:d,description:C})=>{const{setErrorMessage:F,setSuccessMessage:p}=ne(),{setEditWaTemplateId:h,setShowWaTemplateForm:f,setPreviewWaTemplateId:S,setShowWaTemplatePreview:T}=le(),[x,M]=i.exports.useState(null),[g,E]=i.exports.useState(!1),m=()=>{E(!0)},y=()=>{E(!1)},R=P=>{M(P.currentTarget)},u=()=>{M(null)},w=async()=>{try{const P=await X.deleteWaTemplateMessage(d);if(!P.success)throw Error(P.message);p(P.message),setTimeout(()=>window.location.reload(),1e3)}catch(P){F(P.message)}finally{y()}};return a(i.exports.Fragment,{children:[a(ut,{component:"div",sx:{px:{xs:0,md:2}},children:[e(ht,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:o}),e(gt,{label:r,size:"small",sx:{bgcolor:mt[r],alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),secondary:C,sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}},"& .MuiListItemText-secondary":{color:"text.secondary",fontSize:12,fontWeight:400,lineHeight:"15px"}}}),e(ft,{children:e(N,{onClick:R,children:e(Ct,{})})})]}),Boolean(x)&&a(xt,{anchorEl:x,open:Boolean(x),onClose:u,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:[r==="DRAFT"&&e(H,{onClick:()=>{h(d),f(!0),u()},children:"Edit"}),(r==="SUBMITTED"||r==="APPROVED")&&e(H,{onClick:()=>{S(d),T(!0),u()},children:"Preview"}),e(H,{onClick:()=>{m(),u()},children:"Delete"})]}),a(Je,{open:g,"aria-labelledby":"responsive-dialog-title",children:[e(et,{id:"responsive-dialog-title",children:"Delete"}),e(tt,{children:"Are you sure you want to delete?"}),a(at,{children:[e(We,{color:"secondary",onClick:()=>{y()},children:"Cancel"}),e(We,{onClick:async()=>{await w()},autoFocus:!0,children:"Delete"})]})]})]})},ra=({isSearchActive:r,setSearchActive:o})=>{const{setErrorMessage:d,setSuccessMessage:C}=ne(),{totalWaTemplates:F}=ue(),{setWaTemplateFilter:p,setShowWaTemplateForm:h,setTotalWaTemplates:f,setWaTemplatesData:S}=le(),[T,x]=i.exports.useState(!1),M=async()=>{try{x(!0);const g=await X.syncWaTemplateMessage();if(g.success){const E=await X.getWaTemplateMessages();if(!E.success)throw Error(g.message);f(E.payload.length),S(E.payload),C(g.message)}else d(g.message)}catch(g){d(g.message)}finally{x(!1)}};return a(bt,{children:[e(Tt,{children:e(Y,{disableIcon:!0,type:"button",onClick:()=>h(!0),sx:{py:0,px:2,height:36,mt:0},children:"New Template Message"})}),a(yt,{children:[!r&&e(wt,{children:e(vt,{children:`${F} Template Messages`})}),a(St,{children:[r&&e(He,{children:a(Be,{children:[e(N,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ae,{onChange:({target:{value:g}})=>p(g),placeholder:"Search Template"}),e(N,{onClick:()=>{p(""),o(!r)},sx:{position:"absolute",right:0,top:0},children:e(Pe,{})})]})}),!r&&e(N,{onClick:()=>o(g=>!g),children:e(pe,{})}),!r&&e(Y,{icon:e(aa,{color:T?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:T,onClick:()=>M(),sx:{alignSelf:"center",borderRadius:4,borderColor:"#0000003b",color:"#000000de",flexDirection:"row-reverse",fontSize:14,fontWeight:400,letterSpacing:"0.02857em",lineHeight:"16px",gap:1,height:30,py:.625,px:1.875,textTransform:"capitalize"},children:T?"Syncing...":"Sync Messages"})]})]})]})},oa=({index:r,control:o,removeQuickReply:d})=>a(we,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e($e,{title:`Quick Reply ${r+1}`,action:e(N,{"aria-label":`Remove Quick Reply ${r+1}`,onClick:()=>d(r),children:e(Ie,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(z,{sx:{my:2},children:e(A,{control:o,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:j})})]},r),na=({index:r,type:o,url:d,phone_number:C,waTemplateButtonCtaTypes:F,control:p,setValue:h,removeCallAction:f})=>{const{country:S}=he(),T=/[{][{]\d{1,3}[}][}]/gm,[x,M]=i.exports.useState(0),g=()=>{if(x===1)return;const m=`${d}{{${1}}}`;h(`components[3].buttons[${r}].url`,m),M(1)},E=i.exports.useCallback(()=>{if(d){const m=d.match(T);m&&m.length>0?M(1):M(0)}},[d]);return i.exports.useEffect(()=>{E()},[E]),a(we,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e($e,{title:`Call to Action ${r+1}`,action:e(N,{"aria-label":`Remove Call to Action ${r+1}`,onClick:()=>f(r),children:e(Ie,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(z,{sx:{my:2},children:a(A,{select:!0,control:p,label:"Action Type",name:`components[3].buttons[${r}].type`,sx:Z,required:!0,defaultValue:o,children:[e(H,{value:"",disabled:!0,children:"Select Action Type"}),F.map(({value:m,name:y},R)=>e(H,{value:m,children:y},R))]})}),o!==""&&e(z,{sx:{my:2},children:e(A,{control:p,name:`components[3].buttons[${r}].text`,label:"Label",required:!0,sx:j})}),o==="PHONE_NUMBER"&&e(z,{sx:{my:2},children:e(Vt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:S,value:C!=null?C:"",onChange:m=>{h(`components[3].buttons[${r}].phone_number`,m.replaceAll(" ",""))},variant:"filled",sx:Et})}),o==="URL"&&a(z,{sx:{my:2},children:[a(ce,{children:[e(A,{control:p,name:`components[3].buttons[${r}].url`,label:"URL",required:!0,sx:{...j,pb:2,height:"auto"}}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",disabled:x===1,onClick:g,children:"ADD VARIABLE"})]}),a(de,{children:[a(J,{children:[d?d.length:0,"/60 Characters"]}),a(J,{children:[x,"/1 Variable"]})]})]})]},r)},la=({open:r,closeDrawer:o})=>{const d=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:C,setSuccessMessage:F}=ne(),{businessId:p}=he(),{editWaTemplateId:h,waTemplatesData:f,waTemplateCategories:S,waTemplateLanguages:T,waTemplateTypes:x,waTemplateHeaderTypes:M,waTemplateButtonTypes:g,waTemplateButtonCtaTypes:E}=ue(),{setWaTemplatesData:m,setShowWaPreviewForm:y,setPreviewWaTemplateId:R}=le(),u={name:"",category:"",language:"",template_type:"",businessId:p,components:[{format:"",text:"",type:B.HEADER,active:!1},{text:"",type:B.BODY},{text:"",type:B.FOOTER,active:!1},{buttons:[],type:B.BUTTONS,active:!1}]},{control:w,handleSubmit:P,watch:V,reset:W,setValue:s}=Oe({defaultValues:u}),{name:D,category:U,language:ee,template_type:L,components:K}=V(),I=K.find(({type:t})=>t===B.HEADER),_=K.find(({type:t})=>t===B.BODY),Q=K.find(({type:t})=>t===B.FOOTER),k=K.find(({type:t})=>t===B.BUTTONS),[G,q]=i.exports.useState(0),[l,b]=i.exports.useState(""),v=i.exports.useCallback(()=>{const n=D.match(/^[A-Za-z0-9_]+$/g)===null?D.slice(0,-1):D.replace(/\s/g,"").toLowerCase();s("name",n)},[D]),te=()=>{if(G===1)return;const t=`${I.text}{{${1}}}`;s("components[0].text",t),q(1)},fe=()=>{const t=_.text.match(d),n=t&&t.length>0?`${_.text}{{${t.length+1}}}`:`${_.text}{{${1}}}`;s("components[1].text",n)},ve=i.exports.useCallback(()=>{const t=I.text.match(d);t&&t.length>0?q(1):q(0)},[I.text]),Se=i.exports.useCallback(()=>{const t=I.text.match(d);if(t===null){q(0);return}if(t.length===0){q(0);return}s("components[0].text",t.reduce((n,c,$)=>$===0?n.replace(c,`{{${$+1}}}`):n.replace(c,""),t.reduce((n,c,$)=>n.replace(c,`{{${$+1}}}`),I.text))),q(1)},[I.text]),Ve=()=>{const t=_.text.match(d);t!==null&&t.length!==0&&s("components[1].text",t.reduce((n,c,$)=>n.replace(c,`{{${$+1}}}`),_.text))},Ue=t=>{b(t.target.value)},_e=()=>{if(l===""&&C("Please Select button Type"),l==="QUICK_REPLY")if(k.buttons.length<3){const t=k.buttons;t.push({type:"QUICK_REPLY",text:""}),s("components[3].buttons",t)}else C("Limit exceeded");if(l==="CALL_TO_ACTION")if(k.buttons.length<2){const t=k.buttons;t.push({type:"",text:""}),s("components[3].buttons",t)}else C("Limit exceeded")},qe=t=>{const n=k.buttons;n.splice(t,1),s("components[3].buttons",n)},ze=t=>{const n=k.buttons;n.splice(t,1),s("components[3].buttons",n)},Xe=async t=>{var n;try{if(h){const c=await X.updateWaTemplateMessage(h,t);if(!c.success)throw Error(c.message);F(c.message),R((n=c.payload.id)!=null?n:h),W(u),o(),y(!0)}else{const c=await X.createWaTemplateMessage(t);if(!c.success)throw Error(c.message);F(c.message),m([c.payload,...f]),R(c.payload.id),W(u),o(),y(!0)}}catch(c){C(c.message)}},Ee=i.exports.useCallback(async()=>{try{if(h){const t=await X.getWaTemplateMessage(h);if(!t.success)throw Error(t.message);W(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&s("components[0].active",!0),t.payload.components[2].text!==""&&s("components[2].active",!0),t.payload.components[3].buttons.length>0&&s("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?b("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&b("CALL_TO_ACTION"))}}catch(t){C(t.message)}},[h]);return i.exports.useEffect(()=>{Ee()},[Ee]),i.exports.useEffect(()=>{v()},[v]),i.exports.useEffect(()=>{Se()},[Se]),i.exports.useEffect(()=>{ve()},[ve]),i.exports.useEffect(()=>{I.active||s("components[0].format","")},[I.active]),i.exports.useEffect(()=>{Q.active||s("components[2].text","")},[Q.active]),e(Ne,{anchor:"right",open:r,onClose:(t,n)=>{Le(n)||(W(u),o())},sx:{zIndex:"modal"},children:a(nt,{sx:{width:{xs:"100vw",md:360}},children:[a(lt,{children:[e(N,{onClick:()=>{W(u),o()},className:"icon-md-button",children:e(ye,{})}),e(it,{children:`${h?"Update":"Create New"} Template`})]}),a(ct,{onSubmit:P(Xe),onReset:()=>{W(u),o()},children:[e(ae,{children:a(se,{children:[e(O,{children:e(A,{control:w,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:j})}),e(O,{children:a(A,{select:!0,control:w,label:"Template Category",name:"category",sx:Z,required:!0,defaultValue:U,children:[e(H,{value:"",disabled:!0,children:"Select Template Category"}),S.map(({value:t,name:n},c)=>e(H,{value:t,children:n},c))]})}),e(O,{children:a(A,{select:!0,control:w,label:"Language",name:"language",sx:Z,required:!0,defaultValue:ee,children:[e(H,{value:"",disabled:!0,children:"Select Language"}),T.map(({code:t,name:n},c)=>e(H,{value:t,children:n},c))]})}),e(O,{children:a(A,{select:!0,control:w,label:"Template Type",name:"template_type",sx:Z,required:!0,defaultValue:L,children:[e(H,{value:"",disabled:!0,children:"Select Template Type"}),x.map(({value:t,label:n},c)=>e(H,{value:t,children:n},c))]})}),L==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Header"})}),e(Ce,{control:w,name:"components[0].active"})]})}),L==="media"&&I.active&&e(O,{children:a(A,{select:!0,control:w,label:"Header Type",name:"components[0].format",sx:Z,required:!0,defaultValue:I.format,children:[e(H,{value:"",disabled:!0,children:"Select Header Type"}),M.map(({value:t,name:n},c)=>e(H,{value:t,children:n},c))]})}),L==="media"&&I.active&&I.format==="TEXT"&&a(O,{children:[a(ce,{children:[e(A,{control:w,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:ge}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",disabled:G===1,onClick:te,children:"ADD VARIABLE"})]}),a(de,{children:[a(J,{children:[I.text.length,"/60 Characters"]}),a(J,{children:[G,"/1 Variable"]})]})]}),L!==""&&e(O,{children:e(ie,{children:"Body"})}),L!==""&&a(O,{children:[a(ce,{children:[e(A,{control:w,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Ve,inputProps:{maxLength:1024},sx:ge}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",onClick:fe,children:"ADD VARIABLE"})]}),e(de,{children:a(J,{children:[_.text.length,"/1024 Characters"]})})]}),L==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Footer"})}),e(Ce,{control:w,name:"components[2].active"})]})}),L==="media"&&Q.active&&a(O,{children:[e(ce,{children:e(A,{control:w,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:ge})}),e(de,{children:a(J,{children:[Q.text.length,"/60 Characters"]})})]}),L==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Buttons"})}),e(Ce,{control:w,name:"components[3].active"})]})}),L==="media"&&k.active&&a(O,{children:[a(ae,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(se,{children:a(Ut,{select:!0,label:"Button Type",sx:Z,required:!0,value:l,onChange:Ue,disabled:k.buttons.length>0,children:[e(H,{value:"",disabled:!0,children:"Select Button Type"}),g.map(({label:t,name:n},c)=>e(H,{value:n,children:t},c))]})}),e(dt,{children:e(Y,{variant:"outlined",color:"primary",onClick:_e,disableIcon:!0,children:"Add a Button"})})]}),L==="media"&&k.active&&k.buttons.length>0&&e(i.exports.Fragment,{children:k.buttons.map(({type:t,url:n,phone_number:c},$)=>{switch(t){case"QUICK_REPLY":return e(oa,{index:$,removeQuickReply:qe,control:w},$);default:return e(na,{index:$,type:t,url:n,phone_number:c,waTemplateButtonCtaTypes:E,control:w,setValue:s,removeCallAction:ze},$)}})})]})]})}),a(be,{children:[e(Y,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(Y,{type:"submit",children:"Preview & Save"})]})]})]})})},ia=({open:r,closeDrawer:o})=>{var Q,k,G,q;const{isMobile:d,isTablet:C}=he(),F=/[{][{]\d{1,3}[}][}]/gm,{setErrorMessage:p,setSuccessMessage:h}=ne(),{previewWaTemplateId:f,previewWaTemplateData:S,showWaPreviewForm:T,showWaTemplatePreview:x}=ue(),{setPreviewWaTemplateData:M,setEditWaTemplateId:g,setShowWaTemplateForm:E}=le(),[m,y]=i.exports.useState([]),R={components:[{format:"",text:"",type:B.HEADER},{text:"",type:B.BODY},{text:"",type:B.FOOTER},{buttons:[],type:B.BUTTONS}]},{control:u,handleSubmit:w,watch:P,setValue:V}=Oe({defaultValues:R}),{components:W}=P(),s=W.find(({type:l})=>l===B.HEADER),D=W.find(({type:l})=>l===B.BODY),U=W.find(({type:l})=>l===B.BUTTONS),ee=(k=(Q=s==null?void 0:s.example)==null?void 0:Q.header_handle)==null?void 0:k[0],L=[s&&s.format!=="TEXT",s&&s.format==="TEXT"&&s.text&&s.text!==""?s.text.includes("{{1}}"):!1,D&&D.text&&D.text!==""&&D.text.includes("{{1}}"),U&&U.buttons.length>0&&((G=U.buttons[0])==null?void 0:G.type)==="URL"&&((q=U.buttons[0])==null?void 0:q.url.includes("{{1}}"))].reduce((l,b)=>l||b,!1),K=async l=>{try{const b=l.components.map(v=>{var te;return v==null||delete v.active,v.type==="HEADER"&&((te=v==null?void 0:v.example)==null||delete te.header_files),v});if(f){console.log(b);const v=await X.updateWaTemplateComponents(f,{components:b});if(!v.success)throw Error(v.message);h(v.message),o()}}catch(b){p(b.message)}},I=i.exports.useCallback(()=>{W.length>0&&W.forEach(({type:l,text:b})=>{if(l==="BODY"){const v=b.match(F);v&&y(v.map((te,fe)=>fe+1))}})},[W]),_=i.exports.useCallback(async()=>{try{if(f){const l=await X.getWaTemplateMessage(f);if(!l.success)throw Error(l.message);M(l.payload),V("components",l.payload.components)}}catch(l){p(l.message)}},[f]);return i.exports.useEffect(()=>{_()},[_]),i.exports.useEffect(()=>{I()},[I]),a(Ne,{anchor:"right",open:r,onClose:(l,b)=>{(!Le(b)||x)&&o()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[a(Me,{sx:{width:{xs:"100vw",md:360}},children:[r&&a(De,{children:[e(N,{onClick:()=>{o()},className:"icon-md-button",children:e(ye,{})}),e(ke,{children:L&&!x?"Enter Sample Values":"Preview Template"})]}),r&&a(Wt,{onSubmit:w(K),children:[(!L||x||d)&&S&&e(Fe,{components:S.components}),T&&s&&(s.format==="IMAGE"||s.format==="VIDEO"||s.format==="DOCUMENT")&&e(z,{children:e(_t,{setValue:V,control:u,fileTypes:s.format==="IMAGE"?xe.IMAGE:s.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${s.format.charAt(0).toUpperCase()}${s.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:ee!=null?ee:"",width:"100%"})}),T&&s&&s.format==="TEXT"&&s.text.includes("{{1}}")&&e(z,{children:e(A,{control:u,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:j})}),T&&m.length>0&&m.map((l,b)=>e(z,{children:e(A,{control:u,name:`components[1].example.body_text[${b}]`,label:`Body Variable ${l}`,placeholder:`Body ${l}`,required:!0,sx:j})},`bodyVar{{${l}}}`)),T&&U&&U.buttons&&U.buttons.length>0&&U.buttons.map((l,b)=>(console.log(l.url),l.type==="URL"&&l.url.match(F)?e(z,{children:e(A,{control:u,name:`components[3].buttons[${b}].example[0]`,label:`URL Button ${b+1}`,placeholder:`Url button ${b+1} variable 1`,required:!0,sx:j})},b):null)),T&&e(be,{children:e(Y,{type:"submit",children:"Submit for Approval"})}),T&&a(be,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(oe,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(qt,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{g(f),E(!0),o()},children:"Continue Editing"})]})]})]}),!x&&r&&L&&C&&e(Me,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(Fe,{components:W})})]})},ca=()=>{const{isMobile:r,isTablet:o}=he(),{setErrorMessage:d}=ne(),[C,F]=i.exports.useState(!0),[p,h]=i.exports.useState(!1),{waTemplatesData:f,waTemplateFilter:S,showWaTemplateForm:T,showWaPreviewForm:x,showWaTemplatePreview:M}=ue(),{setWaTemplatesData:g,setTotalWaTemplates:E,setWaTemplateFilter:m,setShowWaTemplateForm:y,setShowWaPreviewForm:R,setShowWaTemplatePreview:u,setEditWaTemplateId:w,setPreviewWaTemplateId:P}=le(),{platformExist:V}=st(),W=i.exports.useCallback(async()=>{try{if(typeof V=="boolean"&&V){const s=await X.getWaTemplateMessages();if(!s.success)throw Error(s.message);E(s.payload.length),g(s.payload)}}catch(s){d(s.message)}finally{F(!1)}},[V]);return i.exports.useEffect(()=>{W()},[W]),a(i.exports.Fragment,{children:[e(rt,{children:e("title",{children:"WhatsApp Template Messages"})}),r&&a(De,{sx:Ft,children:[!p&&e(N,{component:ot,to:"/business-settings",className:"icon-md-button",children:e(ye,{})}),!p&&e(ke,{children:"Template Messages"}),p&&e(He,{children:a(Be,{children:[e(N,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ae,{onChange:({target:{value:s}})=>m(s),placeholder:"Search Template"}),e(N,{onClick:()=>{m(""),h(!p)},sx:{position:"absolute",right:0,top:0},children:e(Pe,{})})]})}),!p&&f.length>0&&e(N,{onClick:()=>h(s=>!s),children:e(pe,{})})]}),e(Mt,{sx:Rt,children:typeof V=="boolean"&&V===!1?e(It,{sx:Lt,children:e(pt,{})}):e(Ht,{sx:Bt,children:!C&&e(we,{elevation:0,sx:At,children:e(zt,{sx:Dt,children:f.length===0?a(kt,{children:[e(Pt,{children:e(Y,{disableIcon:!0,onClick:()=>y(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Ot,{children:a(Nt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(i.exports.Fragment,{children:[o&&e(ra,{isSearchActive:p,setSearchActive:h}),o&&e(Xt,{}),f.filter(s=>{var D;return(D=s==null?void 0:s.name)==null?void 0:D.toLowerCase().includes(S==null?void 0:S.toLowerCase())}).map((s,D)=>e(sa,{...s},D))]})})})})}),r&&f.length>0&&e($t,{children:e(Y,{onClick:()=>y(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(la,{open:T,closeDrawer:()=>{w(void 0),y(!1)}}),e(ia,{open:x||M,closeDrawer:()=>{P(void 0),R(!1),u(!1)}})]})},Qa=()=>e(ca,{});export{Qa as default};
