import{i as Ct,k as bt,s as Te,g as ie,r as l,l as xt,_ as yt,T as de,j as e,a as o,m as pe,q as Tt,aj as re,aP as me,aQ as vt,V as H,aR as ve,aS as Ue,u as we,ax as Ve,U as Ne,I as wt,B as St,aH as Ft,an as Et,W as Wt,L as Bt}from"./index.0c7937d1.js";import{W as V,a as Le}from"./WaTemplatePreviewCard.8479bb00.js";import{L as Ie}from"./LeftArrow.343d6d0f.js";import{S as ye}from"./Search.831a3a4c.js";import{c as Pt,H as At,d as Mt,I as Oe,g as Nt,h as It}from"./Wrappers.ad083052.js";import{a as Q,F as U,c as Ce,V as Pe,d as be,e as se,A as Ae,b as ge}from"./Form.45a8318b.js";import{S as qe,a as De,b as je}from"./Search.05324c08.js";import{b as Rt,c as Lt,d as Ot,e as _t,f as kt,g as Ht,C as _e,a as $t}from"./Card.205e4239.js";import{C as Ut,a as Vt,b as qt}from"./Cta.b4c4e79b.js";import Dt from"./LinkPlatForm.10e8b3c1.js";import{p as jt}from"./Position.module.ff7b7fa6.js";import{W as zt,a as O}from"./WhatsApp.0df87c02.js";import{C as Yt}from"./PopupBoxes.d3a5c198.js";import{L as Xt}from"./ListItem.64aafc01.js";import{a as Qt,L as Gt}from"./ListItemText.e275a68e.js";import{C as Kt}from"./Chip.1e5bc1e1.js";import{M as Zt}from"./MoreVert.bfb82082.js";import{M as Jt}from"./Menu.15848a2c.js";import{M as L}from"./MenuItem.11b6ef6e.js";import{C as ze}from"./Clear.97e7f6ce.js";import{F as _,u as Ye}from"./FormTextField.490654b3.js";import{D as Me,a as Xe,b as Qe,c as Ge}from"./Drawer.4d7b168b.js";import{F as ne,G as le,S as ea}from"./Grid.122346a7.js";import{F as te,a as ce,d as Se}from"./Style.8807be1a.js";import{F as Fe}from"./FormIOSSwitch.f6e07954.js";import{C as Ke}from"./Card.c2b9d419.js";import{g as ta}from"./mui-tel-input.es.2b48c13e.js";import{F as aa,e as oa}from"./Styles.c059562f.js";import{T as sa}from"./TextField.5745f0da.js";import{D as Ze}from"./Drawer.17538e60.js";import{F as xe,a as ra,A as na}from"./FileType.118a3b25.js";import{A as ke}from"./AssetsApi.903ac953.js";import{I as la,u as ca}from"./index.e9d7e42a.js";import{L as ia}from"./Link.cb952a32.js";import{D as da}from"./Divider.ff60a579.js";import"./Play.139bea89.js";import"./ArrowRight.d6e17dbc.js";import"./CardContent.24bc29ea.js";import"./Styles.3864ecd6.js";import"./Tags.c1adc98f.js";import"./toConsumableArray.52b4c8e6.js";import"./styled.c3c41e3c.js";import"./List.d7eed8e1.js";import"./CommonComponents.daa2e77e.js";import"./listItemTextClasses.d7de1de1.js";import"./dividerClasses.66984175.js";import"./listItemButtonClasses.39489ea2.js";import"./isMuiElement.dd254e09.js";import"./Switch.d5e85aac.js";import"./SwitchBase.5ccfe431.js";import"./useFormControl.763a4420.js";import"./useControlled.8beb15eb.js";import"./InputAdornment.f824c32c.js";import"./Select.be735c75.js";import"./tslib.es6.61e9e735.js";function pa(a){return bt("MuiCardHeader",a)}const ma=Ct("MuiCardHeader",["root","avatar","action","content","title","subheader"]),He=ma,ua=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],ha=a=>{const{classes:s}=a;return Tt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},pa,s)},fa=Te("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(a,s)=>ie({[`& .${He.title}`]:s.title,[`& .${He.subheader}`]:s.subheader},s.root)})({display:"flex",alignItems:"center",padding:16}),ga=Te("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(a,s)=>s.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Ca=Te("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(a,s)=>s.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ba=Te("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(a,s)=>s.content})({flex:"1 1 auto"}),xa=l.exports.forwardRef(function(s,n){const T=xt({props:s,name:"MuiCardHeader"}),{action:S,avatar:i,className:C,component:F="div",disableTypography:b=!1,subheader:x,subheaderTypographyProps:v,title:B,titleTypographyProps:y}=T,f=yt(T,ua),P=ie({},T,{component:F,disableTypography:b}),W=ha(P);let u=B;u!=null&&u.type!==de&&!b&&(u=e(de,ie({variant:i?"body2":"h5",className:W.title,component:"span",display:"block"},y,{children:u})));let p=x;return p!=null&&p.type!==de&&!b&&(p=e(de,ie({variant:i?"body2":"body1",className:W.subheader,color:"text.secondary",component:"span",display:"block"},v,{children:p}))),o(fa,ie({className:pe(W.root,C),as:F,ref:n,ownerState:P},f,{children:[i&&e(ga,{className:W.avatar,ownerState:P,children:i}),o(ba,{className:W.content,ownerState:P,children:[u,p]}),S&&e(Ca,{className:W.action,ownerState:P,children:S})]}))}),Je=xa,ya=({color:a="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:a})}),Ta={px:{xs:3.75,md:2},"&:hover":{bgcolor:"#edfaff"}},va="yMNf",wa="xmX7",$e={WTMItem:va,OptionMenuPaper:wa},Sa=({template_status:a,name:s,id:n,description:T})=>{const{setErrorMessage:S,setSuccessMessage:i}=re(),{setEditWaTemplateId:C,setShowWaTemplateForm:F,setPreviewWaTemplateId:b,setShowWaTemplatePreview:x}=me(),[v,B]=l.exports.useState(null),[y,f]=l.exports.useState(!1),P=()=>{f(!0)},W=()=>{f(!1)},u=E=>{B(E.currentTarget)},p=()=>{B(null)},j=async()=>{try{const E=await V.deleteWaTemplateMessage(n);if(!E.success)throw Error(E.message);i(E.message),setTimeout(()=>window.location.reload(),1e3)}catch(E){S(E.message)}finally{W()}};return o(l.exports.Fragment,{children:[o(Xt,{component:"div",sx:Ta,children:[e(Qt,{primary:o("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:s}),e(Kt,{label:a,size:"small",sx:{bgcolor:zt[a]}})]}),secondary:vt(`${T.replaceAll(`
`," ").trim().slice(0,400)}${T.length>400?"...":""}`),className:$e.WTMItem}),e(Gt,{children:e(H,{onClick:u,children:e(Zt,{})})})]}),Boolean(v)&&o(Jt,{anchorEl:v,open:Boolean(v),onClose:p,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:$e.OptionMenuPaper},children:[a==="DRAFT"&&e(L,{onClick:()=>{C(n),F(!0),p()},children:"Edit"}),(a==="SUBMITTED"||a==="APPROVED")&&e(L,{onClick:()=>{b(n),x(!0),p()},children:"Preview"}),e(L,{onClick:()=>{P(),p()},children:"Delete"})]}),e(Yt,{title:"Delete",open:y,setOpen:f,onConfirm:async()=>await j(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},Fa=({isSearchActive:a,setSearchActive:s})=>{const{setErrorMessage:n,setSuccessMessage:T}=re(),{totalWaTemplates:S}=ve(),{setWaTemplateFilter:i,setShowWaTemplateForm:C,setTotalWaTemplates:F,setWaTemplatesData:b}=me(),[x,v]=l.exports.useState(!1),B=async()=>{try{v(!0);const y=await V.syncWaTemplateMessage();if(y.success){const f=await V.getWaTemplateMessages();if(!f.success)throw Error(y.message);F(f.payload.length),b(f.payload),T(y.message)}else n(y.message)}catch(y){n(y.message)}finally{v(!1)}};return o(Rt,{children:[e(Lt,{children:e(Q,{disableIcon:!0,type:"button",onClick:()=>C(!0),className:"small",children:"New Template Message"})}),o(Ot,{children:[!a&&e(_t,{children:e(kt,{children:`${S} Template Messages`})}),o(Ht,{children:[a&&e(qe,{children:o(De,{children:[e(H,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(ye,{})}),e(je,{onChange:({target:{value:y}})=>i(y),placeholder:"Search Template"}),e(H,{onClick:()=>{i(""),s(!a)},sx:{position:"absolute",right:0,top:0},children:e(ze,{})})]})}),!a&&e(H,{onClick:()=>s(y=>!y),children:e(ye,{})}),!a&&e(Q,{icon:e(ya,{color:x?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:x,onClick:()=>B(),className:"sync",children:x?"Syncing...":"Sync Messages"})]})]})]})},ee=/[{][{]\d{1,3}[}][}]/gm,Ea="oIEe",Wa="CaIb",et={QrButtonCard:Ea,CtaButtonCard:Wa},Ba=({index:a,control:s,removeQuickReply:n})=>o(Ke,{className:et.QrButtonCard,elevation:0,children:[e(Je,{title:`Quick Reply ${a+1}`,action:e(H,{"aria-label":`Remove Quick Reply ${a+1}`,onClick:()=>n(a),children:e(Ue,{})})}),e(U,{sx:{my:2},children:e(_,{control:s,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:te})})]},a),Pa=({index:a,type:s,url:n,phone_number:T,waTemplateButtonCtaTypes:S,control:i,setValue:C,removeCallAction:F})=>{const{country:b}=we(),[x,v]=l.exports.useState(0),B=()=>{if(x===1)return;const f=`${n}{{${1}}}`;C(`components[3].buttons[${a}].url`,f),v(1)},y=l.exports.useCallback(()=>{if(n){const f=n.match(ee);f&&f.length>0?v(1):v(0)}},[n]);return l.exports.useEffect(()=>{y()},[y]),o(Ke,{className:et.CtaButtonCard,elevation:0,children:[e(Je,{title:`Call to Action ${a+1}`,action:e(H,{"aria-label":`Remove Call to Action ${a+1}`,onClick:()=>F(a),children:e(Ue,{})})}),e(U,{sx:{my:2},children:o(_,{select:!0,control:i,label:"Action Type",name:`components[3].buttons[${a}].type`,sx:aa,required:!0,defaultValue:s,children:[e(L,{value:"",disabled:!0,children:"Select Action Type"}),S.map(({value:f,name:P},W)=>e(L,{value:f,children:P},W))]})}),s!==""&&e(U,{sx:{my:2},children:e(_,{control:i,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:te})}),s==="PHONE_NUMBER"&&e(U,{sx:{my:2},children:e(ta,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:b,value:T!=null?T:"",onChange:f=>{C(`components[3].buttons[${a}].phone_number`,f.replaceAll(" ",""))},variant:"filled",sx:oa})}),s==="URL"&&o(U,{sx:{my:2},children:[o(Ce,{children:[e(_,{control:i,name:`components[3].buttons[${a}].url`,label:"URL",required:!0,sx:{...te,pb:2,height:"auto"}}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",disabled:x===1,onClick:B,children:"ADD VARIABLE"})]}),o(be,{children:[o(se,{children:[n?n.length:0,"/60 Characters"]}),o(se,{children:[x,"/1 Variable"]})]})]})]},a)},Aa=({open:a,closeDrawer:s})=>{const{setErrorMessage:n,setSuccessMessage:T}=re(),{businessId:S}=we(),{editWaTemplateId:i,waTemplatesData:C,waTemplateCategories:F,waTemplateLanguages:b,waTemplateTypes:x,waTemplateHeaderTypes:v,waTemplateButtonTypes:B,waTemplateButtonCtaTypes:y}=ve(),{setWaTemplatesData:f,setShowWaPreviewForm:P,setPreviewWaTemplateId:W}=me(),u={name:"",category:"",language:"",template_type:"",businessId:S,components:[{format:"",text:"",type:O.HEADER,active:!1},{text:"",type:O.BODY},{text:"",type:O.FOOTER,active:!1},{buttons:[],type:O.BUTTONS,active:!1}]},{control:p,handleSubmit:j,watch:E,reset:A,setValue:g}=Ye({defaultValues:u}),{name:c,category:w,language:N,template_type:I,components:z}=E(),R=z.find(({type:t})=>t===O.HEADER),q=z.find(({type:t})=>t===O.BODY),G=z.find(({type:t})=>t===O.FOOTER),k=z.find(({type:t})=>t===O.BUTTONS),[oe,D]=l.exports.useState(0),[K,h]=l.exports.useState(""),M=l.exports.useCallback(()=>{const d=c.match(/^[A-Za-z0-9_]+$/g)===null?c.slice(0,-1):c.replace(/\s/g,"").toLowerCase();g("name",d)},[c]),Z=()=>{if(oe===1)return;const t=`${R.text}{{${1}}}`;g("components[0].text",t),D(1)},Y=()=>{const t=q.text.match(ee),d=t&&t.length>0?`${q.text}{{${t.length+1}}}`:`${q.text}{{${1}}}`;g("components[1].text",d)},J=l.exports.useCallback(()=>{const t=R.text.match(ee);t&&t.length>0?D(1):D(0)},[R.text]),ue=l.exports.useCallback(()=>{const t=R.text.match(ee);if(t===null){D(0);return}if(t.length===0){D(0);return}g("components[0].text",t.reduce((d,m,$)=>$===0?d.replace(m,`{{${$+1}}}`):d.replace(m,""),t.reduce((d,m,$)=>d.replace(m,`{{${$+1}}}`),R.text))),D(1)},[R.text]),r=()=>{const t=q.text.match(ee);t!==null&&t.length!==0&&g("components[1].text",t.reduce((d,m,$)=>d.replace(m,`{{${$+1}}}`),q.text))},X=t=>{h(t.target.value)},he=()=>{if(K===""&&n("Please Select button Type"),K==="QUICK_REPLY")if(k.buttons.length<3){const t=k.buttons;t.push({type:"QUICK_REPLY",text:""}),g("components[3].buttons",t)}else n("Limit exceeded");if(K==="CALL_TO_ACTION")if(k.buttons.length<2){const t=k.buttons;t.push({type:"",text:""}),g("components[3].buttons",t)}else n("Limit exceeded")},fe=t=>{const d=k.buttons;d.splice(t,1),g("components[3].buttons",d)},tt=t=>{const d=k.buttons;d.splice(t,1),g("components[3].buttons",d)},at=e(_,{control:p,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:te}),ot=o(_,{select:!0,control:p,label:"Template Category",name:"category",sx:ce,required:!0,defaultValue:w,children:[e(L,{value:"",disabled:!0,children:"Select Template Category"}),F.map(({value:t,name:d},m)=>e(L,{value:t,children:d},m))]}),st=o(_,{select:!0,control:p,label:"Language",name:"language",sx:ce,required:!0,defaultValue:N,children:[e(L,{value:"",disabled:!0,children:"Select Language"}),b.map(({code:t,name:d},m)=>e(L,{value:t,children:d},m))]}),rt=o(_,{select:!0,control:p,label:"Template Type",name:"template_type",sx:ce,required:!0,defaultValue:I,children:[e(L,{value:"",disabled:!0,children:"Select Template Type"}),x.map(({value:t,label:d},m)=>e(L,{value:t,children:d},m))]}),nt=o(ne,{className:"justify-content-between flex-row",children:[e(le,{children:e(ge,{children:"Header"})}),e(Fe,{control:p,name:"components[0].active"})]}),lt=o(_,{select:!0,control:p,label:"Header Type",name:"components[0].format",sx:ce,required:!0,defaultValue:R.format,children:[e(L,{value:"",disabled:!0,children:"Select Header Type"}),v.map(({value:t,name:d},m)=>e(L,{value:t,children:d},m))]}),ct=o(l.exports.Fragment,{children:[o(Ce,{children:[e(_,{control:p,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Se}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",disabled:oe===1,onClick:Z,children:"ADD VARIABLE"})]}),o(be,{children:[o(se,{children:[R.text.length,"/60 Characters"]}),o(se,{children:[oe,"/1 Variable"]})]})]}),it=e(ge,{children:"Body"}),dt=o(l.exports.Fragment,{children:[o(Ce,{children:[e(_,{control:p,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:r,inputProps:{maxLength:1024},sx:Se}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",onClick:Y,children:"ADD VARIABLE"})]}),e(be,{children:o(se,{children:[q.text.length,"/1024 Characters"]})})]}),pt=o(ne,{className:"justify-content-between flex-row",children:[e(le,{children:e(ge,{children:"Footer"})}),e(Fe,{control:p,name:"components[2].active"})]}),mt=o(l.exports.Fragment,{children:[e(Ce,{children:e(_,{control:p,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Se})}),e(be,{children:o(se,{children:[G.text.length,"/60 Characters"]})})]}),ut=o(ne,{className:"justify-content-between flex-row",children:[e(le,{children:e(ge,{children:"Buttons"})}),e(Fe,{control:p,name:"components[3].active"})]}),ht=o(l.exports.Fragment,{children:[o(ne,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(le,{children:o(sa,{select:!0,label:"Button Type",sx:ce,required:!0,value:K,onChange:X,disabled:k.buttons.length>0,children:[e(L,{value:"",disabled:!0,children:"Select Button Type"}),B.map(({label:t,name:d},m)=>e(L,{value:d,children:t},m))]})}),e(ea,{children:e(Q,{variant:"outlined",color:"primary",onClick:he,disableIcon:!0,children:"Add a Button"})})]}),I==="media"&&k.active&&k.buttons.length>0&&e(l.exports.Fragment,{children:k.buttons.map(({type:t,url:d,phone_number:m},$)=>{switch(t){case"QUICK_REPLY":return e(Ba,{index:$,removeQuickReply:fe,control:p},$);default:return e(Pa,{index:$,type:t,url:d,phone_number:m,waTemplateButtonCtaTypes:y,control:p,setValue:g,removeCallAction:tt},$)}})})]}),ft=[at,ot,st,rt,...I==="media"?[nt]:[],...I==="media"&&R.active?[lt]:[],...I==="media"&&R.active&&R.format==="TEXT"?[ct]:[],...I!==""?[it]:[],...I!==""?[dt]:[],...I==="media"?[pt]:[],...I==="media"&&G.active?[mt]:[],...I==="media"?[ut]:[],...I==="media"&&k.active?[ht]:[]],gt=async t=>{var d;try{if(i){const m=await V.updateWaTemplateMessage(i,t);if(!m.success)throw Error(m.message);T(m.message),W((d=m.payload.id)!=null?d:i),A(u),s(),P(!0)}else{const m=await V.createWaTemplateMessage(t);if(!m.success)throw Error(m.message);T(m.message),f([m.payload,...C]),W(m.payload.id),A(u),s(),P(!0)}}catch(m){n(m.message)}},Re=l.exports.useCallback(async()=>{try{if(i){const t=await V.getWaTemplateMessage(i);if(!t.success)throw Error(t.message);A(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&g("components[0].active",!0),t.payload.components[2].text!==""&&g("components[2].active",!0),t.payload.components[3].buttons.length>0&&g("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?h("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&h("CALL_TO_ACTION"))}}catch(t){n(t.message)}},[i]);return l.exports.useEffect(()=>{Re()},[Re]),l.exports.useEffect(()=>{M()},[M]),l.exports.useEffect(()=>{ue()},[ue]),l.exports.useEffect(()=>{J()},[J]),l.exports.useEffect(()=>{R.active||g("components[0].format","")},[R.active]),l.exports.useEffect(()=>{G.active||g("components[2].text","")},[G.active]),e(Ze,{anchor:"right",open:a,onClose:(t,d)=>{Ve(d)||(A(u),s())},sx:{zIndex:"modal"},children:o(Me,{children:[o(Xe,{children:[e(H,{onClick:()=>{A(u),s()},className:"icon-md-button",children:e(Ie,{})}),e(Qe,{children:`${i?"Update":"Create New"} Template`})]}),o(Ge,{onSubmit:j(gt),onReset:()=>{A(u),s()},children:[e(ne,{children:e(le,{children:ft.map((t,d)=>e(U,{children:t},d))})}),o(Ae,{children:[e(Q,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(Q,{type:"submit",children:"Preview & Save"})]})]})]})})},Ma="gY2p",Na="-h1X",Ee={File_Added:Ma,PreFile:Na,"input-text":"xc1P"},Ia={display:"flex",justifyContent:"center",alignItems:"center",flex:1,padding:"20px",height:"100%",width:"100%",cursor:"pointer",textAlign:"center",borderRadius:"8px",borderColor:"#B8BAC2",borderStyle:"dashed",backgroundColor:" #F2F3F7",color:"#000000",opacity:"0.5",outline:"none",transition:"border .24s ease-in-out",boxSizing:"border-box"},Ra={borderColor:"#2196f3"},La={borderColor:"#00e676"},Oa={borderColor:"#ff1744"},_a="VHLL",ka="-OYq",Ha="NCM0",$a="EjoM",ae={Upload_Overlay:_a,image_preview:ka,File_Preview:Ha,RemoveButton:$a},Ua=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:ae.Upload_Overlay,children:e(Ne,{className:pe("mt-1",ae.RemoveButton),onClick:a,children:"Remove"})}),e(wt,{src:s,alt:"preview"})]}),Va=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:ae.Upload_Overlay,children:e(Ne,{className:pe("mt-1",ae.RemoveButton),onClick:a,children:"Remove"})}),e("video",{className:pe(ae.image_preview,"w-100"),src:s,controls:!0,autoPlay:!0,muted:!0,loop:!0})]}),qa=({fileUrl:a,removeFile:s,fileName:n})=>e("div",{className:"d-flex justify-content-center",style:{height:"100%"},children:o("div",{className:ae.File_Preview,children:[o("div",{className:"d-flex align-items-center",children:[e(la,{fontSize:"large"})," ",e("p",{children:n!==""?n:a==null?void 0:a.split("/").pop()})]}),e(Ne,{className:pe("mt-1",ae.RemoveButton),onClick:s,children:"Remove"})]})}),We={image:{label:"PNG / JPG",value:{"image/*":[]},component:({removeFile:a,fileUrl:s})=>e(Ua,{removeFile:a,fileUrl:s})},video:{label:"MP4 / 3GP / 4K",value:{"video/*":[]},component:({removeFile:a,fileUrl:s})=>e(Va,{removeFile:a,fileUrl:s})},file:{label:"DOC / XLS / PDF / ZIP",value:{"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-powerpoint":[".ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".pptx"],"application/vnd.ms-excel":[],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[],"application/pdf":[],"application/x-zip-compressed":[]},component:({fileUrl:a,removeFile:s,fileName:n})=>e(qa,{fileUrl:a,removeFile:s,fileName:n})}},Da=({onChange:a,fileType:s,removeFile:n,fileUrl:T,fileName:S,label:i})=>{var f;const{getRootProps:C,getInputProps:F,isDragActive:b,isDragAccept:x,isDragReject:v,open:B}=ca({maxFiles:1,maxSize:9e6,accept:We[s].value,noClick:!0,noKeyboard:!0,onDrop:a}),y=l.exports.useMemo(()=>({...Ia,...b?Ra:{},...x?La:{},...v?Oa:{}}),[b,x,v]);return e(l.exports.Fragment,{children:T===""?e("button",{type:"button",className:Ee.PreFile,onClick:B,children:o("div",{...C({style:y}),children:[e("input",{...F()}),o("div",{className:Ee["input-text"],children:[e("h1",{children:i}),e("p",{children:(f=We[s])==null?void 0:f.label})]})]})}):e("div",{className:Ee.File_Added,children:We[s].component({removeFile:n,fileUrl:T,fileName:S})})})},ja=({control:a,fileTypes:s=xe.IMAGE,setValue:n,label:T="Upload Image",defaultFieldName:S,fileURL:i,fileNameField:C,fileField:F,fileURLField:b,width:x,height:v})=>{const{setErrorMessage:B}=re(),[y,f]=l.exports.useState(""),P=async(u,p,j)=>{try{if(u.length>0){const E=new FormData;E.append("file",u[0]),E.append("max_size","10000"),E.append("allowed_ext",ra[s]);const A=await ke.fileUpload(na.ENGAGE_ASSETS,E);if(!A.success)throw Error(A.message);f(A.payload.file_name),n(S,A.payload.url),n(F,u[0]),n(b,A.payload.url),C&&C!==""&&n(C,A.payload.file_name)}}catch(E){console.error(E),B(E.message)}},W=async()=>{try{if(i!==""){const u=await ke.fileRemoveByURL(i);if(!u.success)throw Error(u.message);n(S,"")}}catch(u){n(S,""),console.error(u),B(u.message)}};return e(St,{sx:{transition:"all 0.2s ease-in-out",width:{xs:x!=null?x:157,lg:180,xl:200},height:{xs:v!=null?v:157,lg:180,xl:200},margin:"auto"},children:e(Da,{label:T,fileType:s,removeFile:W,fileUrl:i,fileName:y,onChange:P})})},za="nOWk",Ya="_0oHa",Xa="Ef-W",Be={WaTemplatePreview:za,WaTemplatePreviewPaper:Ya,ActionArea:Xa},Qa=({open:a,closeDrawer:s})=>{var k,oe,D,K;const{isMobile:n,isTablet:T}=we(),{setErrorMessage:S,setSuccessMessage:i}=re(),{previewWaTemplateId:C,previewWaTemplateData:F,showWaPreviewForm:b,showWaTemplatePreview:x}=ve(),{setPreviewWaTemplateData:v,setEditWaTemplateId:B,setShowWaTemplateForm:y,setReload:f}=me(),[P,W]=l.exports.useState([]),u={components:[{format:"",text:"",type:O.HEADER},{text:"",type:O.BODY},{text:"",type:O.FOOTER},{buttons:[],type:O.BUTTONS}]},{control:p,handleSubmit:j,watch:E,setValue:A}=Ye({defaultValues:u}),{components:g}=E(),c=g.find(({type:h})=>h===O.HEADER),w=g.find(({type:h})=>h===O.BODY),N=g.find(({type:h})=>h===O.BUTTONS),I=(oe=(k=c==null?void 0:c.example)==null?void 0:k.header_handle)==null?void 0:oe[0],z=[c&&c.format!=="TEXT",c&&c.format==="TEXT"&&c.text&&c.text!==""?c.text.includes("{{1}}"):!1,w&&w.text&&w.text!==""&&w.text.includes("{{1}}"),N&&N.buttons.length>0&&((D=N.buttons[0])==null?void 0:D.type)==="URL"&&((K=N.buttons[0])==null?void 0:K.url.includes("{{1}}"))].reduce((h,M)=>h||M,!1),R=async h=>{var M,Z;try{let Y="",J="";if(c&&c.active&&c.format!=="TEXT"){Y=(M=c==null?void 0:c.example)==null?void 0:M.header_file_url;const r=new FormData;r.append("file",(Z=c==null?void 0:c.example)==null?void 0:Z.header_file);const X=await V.uploadTemplateFile(r);if(!X.success)return S(X.message);J=X.payload}const ue=h.components.map(r=>{var X,he,fe;if(r==null||delete r.active,r.active&&r.type==="HEADER")return(r==null?void 0:r.format)!=="TEXT"?(r==null||delete r.text,(X=r==null?void 0:r.example)==null||delete X.header_files,(he=r==null?void 0:r.example)==null||delete he.header_file_url,{...r,example:{header_handle:[J]}}):r;if(r.type==="FOOTER"){if((r==null?void 0:r.text)!=="")return r}else if(r.type==="BUTTONS"){if((r==null?void 0:r.buttons.length)>0)return r}else if(r.type==="BODY")return(fe=r==null?void 0:r.example)==null||delete fe.header_handle,{...r}}).filter(r=>r!==void 0);if(C){const r=await V.updateWaTemplateComponents(C,{components:ue,...Y!==""?{mediaUrl:Y}:{}});if(!r.success)throw Error(r.message);i(r.message),f(Math.random()),s()}}catch(Y){S(Y.message)}},q=l.exports.useCallback(()=>{g.length>0&&g.forEach(({type:h,text:M})=>{if(h==="BODY"){const Z=M.match(ee);Z&&W(Z.map((Y,J)=>J+1))}})},[g]),G=l.exports.useCallback(async()=>{try{if(C){const h=await V.getWaTemplateMessage(C);if(!h.success)throw Error(h.message);v(h.payload),A("components",h.payload.components)}}catch(h){S(h.message)}},[C]);return l.exports.useEffect(()=>{G()},[G]),l.exports.useEffect(()=>{q()},[q]),o(Ze,{anchor:"right",open:a,onClose:(h,M)=>{(!Ve(M)||x)&&s()},classes:{root:Be.WaTemplatePreview,paper:Be.WaTemplatePreviewPaper},children:[o(Me,{children:[a&&o(Xe,{children:[e(H,{onClick:()=>{s()},className:"icon-md-button",children:e(Ie,{})}),e(Qe,{children:z&&!x?"Enter Sample Values":"Preview Template"})]}),a&&o(Ge,{onSubmit:j(R),children:[(!z||x||n)&&F&&e(Le,{components:F.components}),b&&c&&(c.format==="IMAGE"||c.format==="VIDEO"||c.format==="DOCUMENT")&&e(U,{children:e(ja,{setValue:A,control:p,fileTypes:c.format==="IMAGE"?xe.IMAGE:c.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${c.format.charAt(0).toUpperCase()}${c.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileField:"components[0].example.header_file",fileURLField:"components[0].example.header_file_url",fileURL:I!=null?I:"",width:"100%"})}),b&&c&&c.format==="TEXT"&&c.text.includes("{{1}}")&&e(U,{children:e(_,{control:p,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:te})}),b&&P.length>0&&P.map((h,M)=>e(U,{children:e(_,{control:p,name:`components[1].example.body_text[0][${M}]`,label:`Body Variable ${h}`,placeholder:`Body ${h}`,required:!0,sx:te})},`bodyVar{{${h}}}`)),b&&N&&N.buttons&&N.buttons.length>0&&N.buttons.map((h,M)=>h.type==="URL"&&h.url.match(ee)?e(U,{children:e(_,{control:p,name:`components[3].buttons[${M}].example[0]`,label:`URL Button ${M+1}`,placeholder:`Url button ${M+1} variable 1`,required:!0,sx:te})},M):null),b&&e(Ae,{children:e(Q,{type:"submit",children:"Submit for Approval"})}),b&&o(Ae,{className:Be.ActionArea,children:[e(de,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(ia,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{B(C),y(!0),s()},children:"Continue Editing"})]})]})]}),!x&&a&&z&&T&&e(Me,{className:"ExtendedDrawer",children:e(Le,{components:g})})]})},Ga=()=>{const{isMobile:a,isTablet:s}=we(),{setErrorMessage:n}=re(),[T,S]=l.exports.useState(!0),[i,C]=l.exports.useState(!1),{waTemplatesData:F,waTemplateFilter:b,showWaTemplateForm:x,showWaPreviewForm:v,showWaTemplatePreview:B,reload:y}=ve(),{setWaTemplatesData:f,setTotalWaTemplates:P,setWaTemplateFilter:W,setShowWaTemplateForm:u,setShowWaPreviewForm:p,setShowWaTemplatePreview:j,setEditWaTemplateId:E,setPreviewWaTemplateId:A}=me(),{platformExist:g}=Ft(),c=l.exports.useCallback(async()=>{try{const w=await V.getWaTemplateMessages();if(!w.success)throw Error(w.message);P(w.payload.length),f(w.payload)}catch(w){n(w.message)}finally{S(!1)}},[y]);return l.exports.useEffect(()=>{typeof g=="boolean"&&g&&c()},[g,c]),T?e(_e,{className:jt.AbsCenter,children:e(Et,{height:72,width:72})}):o(l.exports.Fragment,{children:[e(Wt,{children:e("title",{children:"WhatsApp Template Messages"})}),a&&o(Pt,{children:[!i&&e(H,{component:Bt,to:"/business-settings",className:"icon-md-button",children:e(Ie,{})}),!i&&e(At,{children:"Template Messages"}),i&&e(qe,{children:o(De,{children:[e(H,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(ye,{})}),e(je,{onChange:({target:{value:w}})=>W(w),placeholder:"Search Template"}),e(H,{onClick:()=>{W(""),C(!i)},sx:{position:"absolute",right:0,top:0},children:e(ze,{})})]})}),!i&&F.length>0&&e(H,{onClick:()=>C(w=>!w),children:e(ye,{})})]}),e(Mt,{children:typeof g=="boolean"&&g===!1?e(Oe,{children:e(Dt,{})}):e(Oe,{children:!T&&e(_e,{elevation:0,children:e($t,{sx:{mx:{xs:-3.75,md:0}},children:F.length===0?o(Nt,{children:[e(Ut,{children:e(Q,{disableIcon:!0,onClick:()=>u(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Vt,{children:o(qt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):o(l.exports.Fragment,{children:[s&&e(Fa,{isSearchActive:i,setSearchActive:C}),s&&e(da,{}),F.filter(w=>{var N;return(N=w==null?void 0:w.name)==null?void 0:N.toLowerCase().includes(b==null?void 0:b.toLowerCase())}).map((w,N)=>e(Sa,{...w},N))]})})})})}),a&&F.length>0&&e(It,{children:e(Q,{onClick:()=>u(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(Aa,{open:x,closeDrawer:()=>{E(void 0),u(!1)}}),e(Qa,{open:v||B,closeDrawer:()=>{A(void 0),p(!1),j(!1)}})]})},Jo=()=>e(Ga,{});export{Jo as default};
