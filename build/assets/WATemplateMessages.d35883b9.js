import{i as Ct,k as bt,s as Te,g as ce,r as l,l as xt,_ as yt,T as ie,j as e,a as o,m as de,q as Tt,aj as oe,aP as pe,aQ as vt,V as k,aR as ve,aS as Ue,u as we,ax as Ve,U as Ne,I as wt,B as St,aH as Ft,an as Et,W as Wt,L as Bt}from"./index.1bdf1c1c.js";import{W as U,a as Le}from"./WaTemplatePreviewCard.a9832f3a.js";import{L as Ie}from"./LeftArrow.22d930e1.js";import{S as ye}from"./Search.8b7157ae.js";import{c as Pt,H as At,d as Mt,I as Oe,g as Nt,h as It}from"./Wrappers.e9d11d6c.js";import{a as z,F as $,c as Ce,V as Pe,d as be,e as ae,A as Ae,b as ge}from"./Form.84414eca.js";import{S as De,a as qe,b as je}from"./Search.9d88bcd7.js";import{b as Rt,c as Lt,d as Ot,e as _t,f as kt,g as Ht,C as _e,a as $t}from"./Card.a3d35dc0.js";import{C as Ut,a as Vt,b as Dt}from"./Cta.772034d3.js";import qt from"./LinkPlatForm.a774f382.js";import{p as jt}from"./Position.module.ff7b7fa6.js";import{W as zt,a as L}from"./WhatsApp.0df87c02.js";import{C as Yt}from"./PopupBoxes.445c49ef.js";import{L as Qt}from"./ListItem.5b81829f.js";import{a as Xt,L as Gt}from"./ListItemText.2f4e5468.js";import{C as Kt}from"./Chip.ad89bc78.js";import{M as Zt}from"./MoreVert.027985f5.js";import{M as Jt}from"./Menu.f89117c0.js";import{M as R}from"./MenuItem.8e9e9b19.js";import{C as ze}from"./Clear.5cebc531.js";import{F as O,u as Ye}from"./FormTextField.1b8afb4e.js";import{D as Me,a as Qe,b as Xe,c as Ge}from"./Drawer.2603397b.js";import{F as re,G as ne,S as ea}from"./Grid.9eb12f0e.js";import{F as X,a as le,d as Se}from"./Style.8807be1a.js";import{F as Fe}from"./FormIOSSwitch.3de52b4a.js";import{C as Ke}from"./Card.e77d490f.js";import{g as ta}from"./mui-tel-input.es.b73d29d4.js";import{F as aa,e as oa}from"./Styles.c059562f.js";import{T as sa}from"./TextField.cea424bf.js";import{D as Ze}from"./Drawer.6aea20ea.js";import{F as xe,a as ra,A as na}from"./FileType.118a3b25.js";import{A as ke}from"./AssetsApi.60f266c5.js";import{I as la,u as ca}from"./index.94719ce6.js";import{L as ia}from"./Link.9c6e34db.js";import{D as da}from"./Divider.6fc89bd6.js";import"./Play.3f894416.js";import"./ArrowRight.35ed408d.js";import"./CardContent.de0f47cf.js";import"./Styles.3864ecd6.js";import"./Tags.3121b613.js";import"./toConsumableArray.52b4c8e6.js";import"./styled.36533a38.js";import"./List.8aebed60.js";import"./CommonComponents.1f948d1c.js";import"./listItemTextClasses.e92723d6.js";import"./dividerClasses.9dba49fb.js";import"./listItemButtonClasses.0ebbeba2.js";import"./isMuiElement.2269eb7a.js";import"./Switch.31cb2fbd.js";import"./SwitchBase.57302e6d.js";import"./useFormControl.076aa989.js";import"./useControlled.4344e0b7.js";import"./InputAdornment.de53af3b.js";import"./Select.7344fd38.js";import"./tslib.es6.61e9e735.js";function pa(a){return bt("MuiCardHeader",a)}const ma=Ct("MuiCardHeader",["root","avatar","action","content","title","subheader"]),He=ma,ua=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],ha=a=>{const{classes:s}=a;return Tt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},pa,s)},fa=Te("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(a,s)=>ce({[`& .${He.title}`]:s.title,[`& .${He.subheader}`]:s.subheader},s.root)})({display:"flex",alignItems:"center",padding:16}),ga=Te("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(a,s)=>s.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Ca=Te("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(a,s)=>s.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ba=Te("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(a,s)=>s.content})({flex:"1 1 auto"}),xa=l.exports.forwardRef(function(s,n){const v=xt({props:s,name:"MuiCardHeader"}),{action:S,avatar:i,className:g,component:F="div",disableTypography:C=!1,subheader:b,subheaderTypographyProps:w,title:B,titleTypographyProps:x}=v,h=yt(v,ua),P=ce({},v,{component:F,disableTypography:C}),W=ha(P);let p=B;p!=null&&p.type!==ie&&!C&&(p=e(ie,ce({variant:i?"body2":"h5",className:W.title,component:"span",display:"block"},x,{children:p})));let f=b;return f!=null&&f.type!==ie&&!C&&(f=e(ie,ce({variant:i?"body2":"body1",className:W.subheader,color:"text.secondary",component:"span",display:"block"},w,{children:f}))),o(fa,ce({className:de(W.root,g),as:F,ref:n,ownerState:P},h,{children:[i&&e(ga,{className:W.avatar,ownerState:P,children:i}),o(ba,{className:W.content,ownerState:P,children:[p,f]}),S&&e(Ca,{className:W.action,ownerState:P,children:S})]}))}),Je=xa,ya=({color:a="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:a})}),Ta={px:{xs:3.75,md:2},"&:hover":{bgcolor:"#edfaff"}},va="yMNf",wa="xmX7",$e={WTMItem:va,OptionMenuPaper:wa},Sa=({template_status:a,name:s,id:n,description:v})=>{const{setErrorMessage:S,setSuccessMessage:i}=oe(),{setEditWaTemplateId:g,setShowWaTemplateForm:F,setPreviewWaTemplateId:C,setShowWaTemplatePreview:b}=pe(),[w,B]=l.exports.useState(null),[x,h]=l.exports.useState(!1),P=()=>{h(!0)},W=()=>{h(!1)},p=E=>{B(E.currentTarget)},f=()=>{B(null)},q=async()=>{try{const E=await U.deleteWaTemplateMessage(n);if(!E.success)throw Error(E.message);i(E.message),setTimeout(()=>window.location.reload(),1e3)}catch(E){S(E.message)}finally{W()}};return o(l.exports.Fragment,{children:[o(Qt,{component:"div",sx:Ta,children:[e(Xt,{primary:o("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:s}),e(Kt,{label:a,size:"small",sx:{bgcolor:zt[a]}})]}),secondary:vt(`${v.replaceAll(`
`," ").trim().slice(0,400)}${v.length>400?"...":""}`),className:$e.WTMItem}),e(Gt,{children:e(k,{onClick:p,children:e(Zt,{})})})]}),Boolean(w)&&o(Jt,{anchorEl:w,open:Boolean(w),onClose:f,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:$e.OptionMenuPaper},children:[a==="DRAFT"&&e(R,{onClick:()=>{g(n),F(!0),f()},children:"Edit"}),(a==="SUBMITTED"||a==="APPROVED")&&e(R,{onClick:()=>{C(n),b(!0),f()},children:"Preview"}),e(R,{onClick:()=>{P(),f()},children:"Delete"})]}),e(Yt,{title:"Delete",open:x,setOpen:h,onConfirm:async()=>await q(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},Fa=({isSearchActive:a,setSearchActive:s})=>{const{setErrorMessage:n,setSuccessMessage:v}=oe(),{totalWaTemplates:S}=ve(),{setWaTemplateFilter:i,setShowWaTemplateForm:g,setTotalWaTemplates:F,setWaTemplatesData:C}=pe(),[b,w]=l.exports.useState(!1),B=async()=>{try{w(!0);const x=await U.syncWaTemplateMessage();if(x.success){const h=await U.getWaTemplateMessages();if(!h.success)throw Error(x.message);F(h.payload.length),C(h.payload),v(x.message)}else n(x.message)}catch(x){n(x.message)}finally{w(!1)}};return o(Rt,{children:[e(Lt,{children:e(z,{disableIcon:!0,type:"button",onClick:()=>g(!0),className:"small",children:"New Template Message"})}),o(Ot,{children:[!a&&e(_t,{children:e(kt,{children:`${S} Template Messages`})}),o(Ht,{children:[a&&e(De,{children:o(qe,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(ye,{})}),e(je,{onChange:({target:{value:x}})=>i(x),placeholder:"Search Template"}),e(k,{onClick:()=>{i(""),s(!a)},sx:{position:"absolute",right:0,top:0},children:e(ze,{})})]})}),!a&&e(k,{onClick:()=>s(x=>!x),children:e(ye,{})}),!a&&e(z,{icon:e(ya,{color:b?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:b,onClick:()=>B(),className:"sync",children:b?"Syncing...":"Sync Messages"})]})]})]})},Q=/[{][{]\d{1,3}[}][}]/gm,Ea="oIEe",Wa="CaIb",et={QrButtonCard:Ea,CtaButtonCard:Wa},Ba=({index:a,control:s,removeQuickReply:n})=>o(Ke,{className:et.QrButtonCard,elevation:0,children:[e(Je,{title:`Quick Reply ${a+1}`,action:e(k,{"aria-label":`Remove Quick Reply ${a+1}`,onClick:()=>n(a),children:e(Ue,{})})}),e($,{sx:{my:2},children:e(O,{control:s,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:X})})]},a),Pa=({index:a,type:s,url:n,phone_number:v,waTemplateButtonCtaTypes:S,control:i,setValue:g,removeCallAction:F})=>{const{country:C}=we(),[b,w]=l.exports.useState(0),B=()=>{if(b===1)return;const h=`${n}{{${1}}}`;g(`components[3].buttons[${a}].url`,h),w(1)},x=l.exports.useCallback(()=>{if(n){const h=n.match(Q);h&&h.length>0?w(1):w(0)}},[n]);return l.exports.useEffect(()=>{x()},[x]),o(Ke,{className:et.CtaButtonCard,elevation:0,children:[e(Je,{title:`Call to Action ${a+1}`,action:e(k,{"aria-label":`Remove Call to Action ${a+1}`,onClick:()=>F(a),children:e(Ue,{})})}),e($,{sx:{my:2},children:o(O,{select:!0,control:i,label:"Action Type",name:`components[3].buttons[${a}].type`,sx:aa,required:!0,defaultValue:s,children:[e(R,{value:"",disabled:!0,children:"Select Action Type"}),S.map(({value:h,name:P},W)=>e(R,{value:h,children:P},W))]})}),s!==""&&e($,{sx:{my:2},children:e(O,{control:i,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:X})}),s==="PHONE_NUMBER"&&e($,{sx:{my:2},children:e(ta,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:C,value:v!=null?v:"",onChange:h=>{g(`components[3].buttons[${a}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:oa})}),s==="URL"&&o($,{sx:{my:2},children:[o(Ce,{children:[e(O,{control:i,name:`components[3].buttons[${a}].url`,label:"URL",required:!0,sx:{...X,pb:2,height:"auto"}}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",disabled:b===1,onClick:B,children:"ADD VARIABLE"})]}),o(be,{children:[o(ae,{children:[n?n.length:0,"/60 Characters"]}),o(ae,{children:[b,"/1 Variable"]})]})]})]},a)},Aa=({open:a,closeDrawer:s})=>{const{setErrorMessage:n,setSuccessMessage:v}=oe(),{businessId:S}=we(),{editWaTemplateId:i,waTemplatesData:g,waTemplateCategories:F,waTemplateLanguages:C,waTemplateTypes:b,waTemplateHeaderTypes:w,waTemplateButtonTypes:B,waTemplateButtonCtaTypes:x}=ve(),{setWaTemplatesData:h,setShowWaPreviewForm:P,setPreviewWaTemplateId:W}=pe(),p={name:"",category:"",language:"",template_type:"",businessId:S,components:[{format:"",text:"",type:L.HEADER,active:!1},{text:"",type:L.BODY},{text:"",type:L.FOOTER,active:!1},{buttons:[],type:L.BUTTONS,active:!1}]},{control:f,handleSubmit:q,watch:E,reset:y,setValue:r}=Ye({defaultValues:p}),{name:T,category:N,language:se,template_type:I,components:K}=E(),M=K.find(({type:t})=>t===L.HEADER),V=K.find(({type:t})=>t===L.BODY),Y=K.find(({type:t})=>t===L.FOOTER),_=K.find(({type:t})=>t===L.BUTTONS),[Z,D]=l.exports.useState(0),[m,A]=l.exports.useState(""),j=l.exports.useCallback(()=>{const d=T.match(/^[A-Za-z0-9_]+$/g)===null?T.slice(0,-1):T.replace(/\s/g,"").toLowerCase();r("name",d)},[T]),J=()=>{if(Z===1)return;const t=`${M.text}{{${1}}}`;r("components[0].text",t),D(1)},ee=()=>{const t=V.text.match(Q),d=t&&t.length>0?`${V.text}{{${t.length+1}}}`:`${V.text}{{${1}}}`;r("components[1].text",d)},te=l.exports.useCallback(()=>{const t=M.text.match(Q);t&&t.length>0?D(1):D(0)},[M.text]),me=l.exports.useCallback(()=>{const t=M.text.match(Q);if(t===null){D(0);return}if(t.length===0){D(0);return}r("components[0].text",t.reduce((d,u,H)=>H===0?d.replace(u,`{{${H+1}}}`):d.replace(u,""),t.reduce((d,u,H)=>d.replace(u,`{{${H+1}}}`),M.text))),D(1)},[M.text]),ue=()=>{const t=V.text.match(Q);t!==null&&t.length!==0&&r("components[1].text",t.reduce((d,u,H)=>d.replace(u,`{{${H+1}}}`),V.text))},c=t=>{A(t.target.value)},he=()=>{if(m===""&&n("Please Select button Type"),m==="QUICK_REPLY")if(_.buttons.length<3){const t=_.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else n("Limit exceeded");if(m==="CALL_TO_ACTION")if(_.buttons.length<2){const t=_.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else n("Limit exceeded")},fe=t=>{const d=_.buttons;d.splice(t,1),r("components[3].buttons",d)},tt=t=>{const d=_.buttons;d.splice(t,1),r("components[3].buttons",d)},at=e(O,{control:f,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:X}),ot=o(O,{select:!0,control:f,label:"Template Category",name:"category",sx:le,required:!0,defaultValue:N,children:[e(R,{value:"",disabled:!0,children:"Select Template Category"}),F.map(({value:t,name:d},u)=>e(R,{value:t,children:d},u))]}),st=o(O,{select:!0,control:f,label:"Language",name:"language",sx:le,required:!0,defaultValue:se,children:[e(R,{value:"",disabled:!0,children:"Select Language"}),C.map(({code:t,name:d},u)=>e(R,{value:t,children:d},u))]}),rt=o(O,{select:!0,control:f,label:"Template Type",name:"template_type",sx:le,required:!0,defaultValue:I,children:[e(R,{value:"",disabled:!0,children:"Select Template Type"}),b.map(({value:t,label:d},u)=>e(R,{value:t,children:d},u))]}),nt=o(re,{className:"justify-content-between flex-row",children:[e(ne,{children:e(ge,{children:"Header"})}),e(Fe,{control:f,name:"components[0].active"})]}),lt=o(O,{select:!0,control:f,label:"Header Type",name:"components[0].format",sx:le,required:!0,defaultValue:M.format,children:[e(R,{value:"",disabled:!0,children:"Select Header Type"}),w.map(({value:t,name:d},u)=>e(R,{value:t,children:d},u))]}),ct=o(l.exports.Fragment,{children:[o(Ce,{children:[e(O,{control:f,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Se}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",disabled:Z===1,onClick:J,children:"ADD VARIABLE"})]}),o(be,{children:[o(ae,{children:[M.text.length,"/60 Characters"]}),o(ae,{children:[Z,"/1 Variable"]})]})]}),it=e(ge,{children:"Body"}),dt=o(l.exports.Fragment,{children:[o(Ce,{children:[e(O,{control:f,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:ue,inputProps:{maxLength:1024},sx:Se}),e(Pe,{size:"small",focusRipple:!1,className:"add-variable",onClick:ee,children:"ADD VARIABLE"})]}),e(be,{children:o(ae,{children:[V.text.length,"/1024 Characters"]})})]}),pt=o(re,{className:"justify-content-between flex-row",children:[e(ne,{children:e(ge,{children:"Footer"})}),e(Fe,{control:f,name:"components[2].active"})]}),mt=o(l.exports.Fragment,{children:[e(Ce,{children:e(O,{control:f,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Se})}),e(be,{children:o(ae,{children:[Y.text.length,"/60 Characters"]})})]}),ut=o(re,{className:"justify-content-between flex-row",children:[e(ne,{children:e(ge,{children:"Buttons"})}),e(Fe,{control:f,name:"components[3].active"})]}),ht=o(l.exports.Fragment,{children:[o(re,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(ne,{children:o(sa,{select:!0,label:"Button Type",sx:le,required:!0,value:m,onChange:c,disabled:_.buttons.length>0,children:[e(R,{value:"",disabled:!0,children:"Select Button Type"}),B.map(({label:t,name:d},u)=>e(R,{value:d,children:t},u))]})}),e(ea,{children:e(z,{variant:"outlined",color:"primary",onClick:he,disableIcon:!0,children:"Add a Button"})})]}),I==="media"&&_.active&&_.buttons.length>0&&e(l.exports.Fragment,{children:_.buttons.map(({type:t,url:d,phone_number:u},H)=>{switch(t){case"QUICK_REPLY":return e(Ba,{index:H,removeQuickReply:fe,control:f},H);default:return e(Pa,{index:H,type:t,url:d,phone_number:u,waTemplateButtonCtaTypes:x,control:f,setValue:r,removeCallAction:tt},H)}})})]}),ft=[at,ot,st,rt,...I==="media"?[nt]:[],...I==="media"&&M.active?[lt]:[],...I==="media"&&M.active&&M.format==="TEXT"?[ct]:[],...I!==""?[it]:[],...I!==""?[dt]:[],...I==="media"?[pt]:[],...I==="media"&&Y.active?[mt]:[],...I==="media"?[ut]:[],...I==="media"&&_.active?[ht]:[]],gt=async t=>{var d;try{if(i){const u=await U.updateWaTemplateMessage(i,t);if(!u.success)throw Error(u.message);v(u.message),W((d=u.payload.id)!=null?d:i),y(p),s(),P(!0)}else{const u=await U.createWaTemplateMessage(t);if(!u.success)throw Error(u.message);v(u.message),h([u.payload,...g]),W(u.payload.id),y(p),s(),P(!0)}}catch(u){n(u.message)}},Re=l.exports.useCallback(async()=>{try{if(i){const t=await U.getWaTemplateMessage(i);if(!t.success)throw Error(t.message);y(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?A("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&A("CALL_TO_ACTION"))}}catch(t){n(t.message)}},[i]);return l.exports.useEffect(()=>{Re()},[Re]),l.exports.useEffect(()=>{j()},[j]),l.exports.useEffect(()=>{me()},[me]),l.exports.useEffect(()=>{te()},[te]),l.exports.useEffect(()=>{M.active||r("components[0].format","")},[M.active]),l.exports.useEffect(()=>{Y.active||r("components[2].text","")},[Y.active]),e(Ze,{anchor:"right",open:a,onClose:(t,d)=>{Ve(d)||(y(p),s())},sx:{zIndex:"modal"},children:o(Me,{children:[o(Qe,{children:[e(k,{onClick:()=>{y(p),s()},className:"icon-md-button",children:e(Ie,{})}),e(Xe,{children:`${i?"Update":"Create New"} Template`})]}),o(Ge,{onSubmit:q(gt),onReset:()=>{y(p),s()},children:[e(re,{children:e(ne,{children:ft.map((t,d)=>e($,{children:t},d))})}),o(Ae,{children:[e(z,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(z,{type:"submit",children:"Preview & Save"})]})]})]})})},Ma="gY2p",Na="-h1X",Ee={File_Added:Ma,PreFile:Na,"input-text":"xc1P"},Ia={display:"flex",justifyContent:"center",alignItems:"center",flex:1,padding:"20px",height:"100%",width:"100%",cursor:"pointer",textAlign:"center",borderRadius:"8px",borderColor:"#B8BAC2",borderStyle:"dashed",backgroundColor:" #F2F3F7",color:"#000000",opacity:"0.5",outline:"none",transition:"border .24s ease-in-out",boxSizing:"border-box"},Ra={borderColor:"#2196f3"},La={borderColor:"#00e676"},Oa={borderColor:"#ff1744"},_a="VHLL",ka="-OYq",Ha="NCM0",$a="EjoM",G={Upload_Overlay:_a,image_preview:ka,File_Preview:Ha,RemoveButton:$a},Ua=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:G.Upload_Overlay,children:e(Ne,{className:de("mt-1",G.RemoveButton),onClick:a,children:"Remove"})}),e(wt,{src:s,alt:"preview"})]}),Va=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:G.Upload_Overlay,children:e(Ne,{className:de("mt-1",G.RemoveButton),onClick:a,children:"Remove"})}),e("video",{className:de(G.image_preview,"w-100"),src:s,controls:!0,autoPlay:!0,muted:!0,loop:!0})]}),Da=({fileUrl:a,removeFile:s,fileName:n})=>e("div",{className:"d-flex justify-content-center",style:{height:"100%"},children:o("div",{className:G.File_Preview,children:[o("div",{className:"d-flex align-items-center",children:[e(la,{fontSize:"large"})," ",e("p",{children:n!==""?n:a==null?void 0:a.split("/").pop()})]}),e(Ne,{className:de("mt-1",G.RemoveButton),onClick:s,children:"Remove"})]})}),We={image:{label:"PNG / JPG",value:{"image/*":[]},component:({removeFile:a,fileUrl:s})=>e(Ua,{removeFile:a,fileUrl:s})},video:{label:"MP4 / 3GP / 4K",value:{"video/*":[]},component:({removeFile:a,fileUrl:s})=>e(Va,{removeFile:a,fileUrl:s})},file:{label:"DOC / XLS / PDF / ZIP",value:{"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-powerpoint":[".ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".pptx"],"application/vnd.ms-excel":[],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[],"application/pdf":[],"application/x-zip-compressed":[]},component:({fileUrl:a,removeFile:s,fileName:n})=>e(Da,{fileUrl:a,removeFile:s,fileName:n})}},qa=({onChange:a,fileType:s,removeFile:n,fileUrl:v,fileName:S,label:i})=>{var h;const{getRootProps:g,getInputProps:F,isDragActive:C,isDragAccept:b,isDragReject:w,open:B}=ca({maxFiles:1,maxSize:9e6,accept:We[s].value,noClick:!0,noKeyboard:!0,onDrop:a}),x=l.exports.useMemo(()=>({...Ia,...C?Ra:{},...b?La:{},...w?Oa:{}}),[C,b,w]);return e(l.exports.Fragment,{children:v===""?e("button",{type:"button",className:Ee.PreFile,onClick:B,children:o("div",{...g({style:x}),children:[e("input",{...F()}),o("div",{className:Ee["input-text"],children:[e("h1",{children:i}),e("p",{children:(h=We[s])==null?void 0:h.label})]})]})}):e("div",{className:Ee.File_Added,children:We[s].component({removeFile:n,fileUrl:v,fileName:S})})})},ja=({control:a,fileTypes:s=xe.IMAGE,setValue:n,label:v="Upload Image",defaultFieldName:S,fileURL:i,fileNameField:g,fileField:F,fileURLField:C,width:b,height:w})=>{const{setErrorMessage:B}=oe(),[x,h]=l.exports.useState(""),P=async(p,f,q)=>{try{if(p.length>0){const E=new FormData;E.append("file",p[0]),E.append("max_size","10000"),E.append("allowed_ext",ra[s]);const y=await ke.fileUpload(na.ENGAGE_ASSETS,E);if(!y.success)throw Error(y.message);h(y.payload.file_name),n(S,y.payload.url),n(F,p[0]),n(C,y.payload.url),g&&g!==""&&n(g,y.payload.file_name)}}catch(E){console.error(E),B(E.message)}},W=async()=>{try{if(i!==""){const p=await ke.fileRemoveByURL(i);if(!p.success)throw Error(p.message);n(S,"")}}catch(p){n(S,""),console.error(p),B(p.message)}};return e(St,{sx:{transition:"all 0.2s ease-in-out",width:{xs:b!=null?b:157,lg:180,xl:200},height:{xs:w!=null?w:157,lg:180,xl:200},margin:"auto"},children:e(qa,{label:v,fileType:s,removeFile:W,fileUrl:i,fileName:x,onChange:P})})},za="nOWk",Ya="_0oHa",Qa="Ef-W",Be={WaTemplatePreview:za,WaTemplatePreviewPaper:Ya,ActionArea:Qa},Xa=({open:a,closeDrawer:s})=>{var Y,_,Z,D;const{isMobile:n,isTablet:v}=we(),{setErrorMessage:S,setSuccessMessage:i}=oe(),{previewWaTemplateId:g,previewWaTemplateData:F,showWaPreviewForm:C,showWaTemplatePreview:b}=ve(),{setPreviewWaTemplateData:w,setEditWaTemplateId:B,setShowWaTemplateForm:x}=pe(),[h,P]=l.exports.useState([]),W={components:[{format:"",text:"",type:L.HEADER},{text:"",type:L.BODY},{text:"",type:L.FOOTER},{buttons:[],type:L.BUTTONS}]},{control:p,handleSubmit:f,watch:q,setValue:E}=Ye({defaultValues:W}),{components:y}=q(),r=y.find(({type:m})=>m===L.HEADER),T=y.find(({type:m})=>m===L.BODY),N=y.find(({type:m})=>m===L.BUTTONS),se=(_=(Y=r==null?void 0:r.example)==null?void 0:Y.header_handle)==null?void 0:_[0],I=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,T&&T.text&&T.text!==""&&T.text.includes("{{1}}"),N&&N.buttons.length>0&&((Z=N.buttons[0])==null?void 0:Z.type)==="URL"&&((D=N.buttons[0])==null?void 0:D.url.includes("{{1}}"))].reduce((m,A)=>m||A,!1),K=async m=>{var A,j;try{const J=(A=r==null?void 0:r.example)==null?void 0:A.header_file_url,ee=new FormData;ee.append("file",(j=r==null?void 0:r.example)==null?void 0:j.header_file);const te=await U.uploadTemplateFile(ee);if(!te.success)return S(te.message);const me=te.payload,ue=m.components.map(c=>{var he,fe;if(c==null||delete c.active,c.type==="HEADER")return(c==null?void 0:c.format)!=="TEXT"?(c==null||delete c.text,(he=c==null?void 0:c.example)==null||delete he.header_files,(fe=c==null?void 0:c.example)==null||delete fe.header_file_url,{...c,example:{header_handle:[me]}}):c;if(c.type==="FOOTER"){if((c==null?void 0:c.text)!=="")return c}else if(c.type==="BUTTONS"){if((c==null?void 0:c.buttons.length)>0)return c}else return c}).filter(c=>c!==void 0);if(console.log(ue),g){const c=await U.updateWaTemplateComponents(g,{components:ue,mediaUrl:J});if(!c.success)throw Error(c.message);i(c.message),s()}}catch(J){S(J.message)}},M=l.exports.useCallback(()=>{y.length>0&&y.forEach(({type:m,text:A})=>{if(m==="BODY"){const j=A.match(Q);j&&P(j.map((J,ee)=>ee+1))}})},[y]),V=l.exports.useCallback(async()=>{try{if(g){const m=await U.getWaTemplateMessage(g);if(!m.success)throw Error(m.message);w(m.payload),E("components",m.payload.components)}}catch(m){S(m.message)}},[g]);return l.exports.useEffect(()=>{V()},[V]),l.exports.useEffect(()=>{M()},[M]),o(Ze,{anchor:"right",open:a,onClose:(m,A)=>{(!Ve(A)||b)&&s()},classes:{root:Be.WaTemplatePreview,paper:Be.WaTemplatePreviewPaper},children:[o(Me,{children:[a&&o(Qe,{children:[e(k,{onClick:()=>{s()},className:"icon-md-button",children:e(Ie,{})}),e(Xe,{children:I&&!b?"Enter Sample Values":"Preview Template"})]}),a&&o(Ge,{onSubmit:f(K),children:[(!I||b||n)&&F&&e(Le,{components:F.components}),C&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e($,{children:e(ja,{setValue:E,control:p,fileTypes:r.format==="IMAGE"?xe.IMAGE:r.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileField:"components[0].example.header_file",fileURLField:"components[0].example.header_file_url",fileURL:se!=null?se:"",width:"100%"})}),C&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e($,{children:e(O,{control:p,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:X})}),C&&h.length>0&&h.map((m,A)=>e($,{children:e(O,{control:p,name:`components[1].example.body_text[${A}]`,label:`Body Variable ${m}`,placeholder:`Body ${m}`,required:!0,sx:X})},`bodyVar{{${m}}}`)),C&&N&&N.buttons&&N.buttons.length>0&&N.buttons.map((m,A)=>m.type==="URL"&&m.url.match(Q)?e($,{children:e(O,{control:p,name:`components[3].buttons[${A}].example[0]`,label:`URL Button ${A+1}`,placeholder:`Url button ${A+1} variable 1`,required:!0,sx:X})},A):null),C&&e(Ae,{children:e(z,{type:"submit",children:"Submit for Approval"})}),C&&o(Ae,{className:Be.ActionArea,children:[e(ie,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(ia,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{B(g),x(!0),s()},children:"Continue Editing"})]})]})]}),!b&&a&&I&&v&&e(Me,{className:"ExtendedDrawer",children:e(Le,{components:y})})]})},Ga=()=>{const{isMobile:a,isTablet:s}=we(),{setErrorMessage:n}=oe(),[v,S]=l.exports.useState(!0),[i,g]=l.exports.useState(!1),{waTemplatesData:F,waTemplateFilter:C,showWaTemplateForm:b,showWaPreviewForm:w,showWaTemplatePreview:B}=ve(),{setWaTemplatesData:x,setTotalWaTemplates:h,setWaTemplateFilter:P,setShowWaTemplateForm:W,setShowWaPreviewForm:p,setShowWaTemplatePreview:f,setEditWaTemplateId:q,setPreviewWaTemplateId:E}=pe(),{platformExist:y}=Ft(),r=l.exports.useRef(async()=>{try{const T=await U.getWaTemplateMessages();if(!T.success)throw Error(T.message);h(T.payload.length),x(T.payload)}catch(T){n(T.message)}finally{S(!1)}});return l.exports.useEffect(()=>{typeof y=="boolean"&&y&&r.current()},[y]),v?e(_e,{className:jt.AbsCenter,children:e(Et,{height:72,width:72})}):o(l.exports.Fragment,{children:[e(Wt,{children:e("title",{children:"WhatsApp Template Messages"})}),a&&o(Pt,{children:[!i&&e(k,{component:Bt,to:"/business-settings",className:"icon-md-button",children:e(Ie,{})}),!i&&e(At,{children:"Template Messages"}),i&&e(De,{children:o(qe,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(ye,{})}),e(je,{onChange:({target:{value:T}})=>P(T),placeholder:"Search Template"}),e(k,{onClick:()=>{P(""),g(!i)},sx:{position:"absolute",right:0,top:0},children:e(ze,{})})]})}),!i&&F.length>0&&e(k,{onClick:()=>g(T=>!T),children:e(ye,{})})]}),e(Mt,{children:typeof y=="boolean"&&y===!1?e(Oe,{children:e(qt,{})}):e(Oe,{children:!v&&e(_e,{elevation:0,children:e($t,{sx:{mx:{xs:-3.75,md:0}},children:F.length===0?o(Nt,{children:[e(Ut,{children:e(z,{disableIcon:!0,onClick:()=>W(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Vt,{children:o(Dt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):o(l.exports.Fragment,{children:[s&&e(Fa,{isSearchActive:i,setSearchActive:g}),s&&e(da,{}),F.filter(T=>{var N;return(N=T==null?void 0:T.name)==null?void 0:N.toLowerCase().includes(C==null?void 0:C.toLowerCase())}).map((T,N)=>e(Sa,{...T},N))]})})})})}),a&&F.length>0&&e(It,{children:e(z,{onClick:()=>W(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(Aa,{open:b,closeDrawer:()=>{q(void 0),W(!1)}}),e(Xa,{open:w||B,closeDrawer:()=>{E(void 0),p(!1),f(!1)}})]})},Jo=()=>e(Ga,{});export{Jo as default};
