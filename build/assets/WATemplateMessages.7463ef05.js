import{i as Ct,k as xt,s as ye,g as ce,r as c,l as bt,_ as yt,T as ie,j as e,a as o,m as de,q as Tt,aj as oe,aP as pe,aQ as vt,V as k,aR as Te,aS as $e,u as ve,ax as Ue,U as Me,I as wt,B as St,aH as Ft,an as Et,W as Wt,L as Bt}from"./index.7f82941f.js";import{W as U,a as Re}from"./WaTemplatePreviewCard.0c2f722c.js";import{L as Ne}from"./LeftArrow.d8255c35.js";import{S as be}from"./Search.21aa4e31.js";import{c as Pt,H as At,d as Mt,I as Le,g as Nt,h as It}from"./Wrappers.c2aef7a9.js";import{a as X,F as $,c as ge,V as Be,d as Ce,e as ae,A as Pe,b as fe}from"./Form.51dca0ed.js";import{S as Ve,a as qe,b as De}from"./Search.d8293799.js";import{b as Rt,c as Lt,d as Ot,e as _t,f as kt,g as Ht,C as Oe,a as $t}from"./Card.94b21a7c.js";import{C as Ut,a as Vt,b as qt}from"./Cta.a51de5f7.js";import Dt from"./LinkPlatForm.f23c4951.js";import{p as jt}from"./Position.module.ff7b7fa6.js";import{W as zt,a as L}from"./WhatsApp.0df87c02.js";import{C as Yt}from"./PopupBoxes.b055c154.js";import{L as Xt}from"./ListItem.f29cbb3e.js";import{a as Qt,L as Gt}from"./ListItemText.e793f45c.js";import{C as Kt}from"./Chip.0fbe1eb2.js";import{M as Zt}from"./MoreVert.9bd7ff56.js";import{M as Jt}from"./Menu.22af6717.js";import{M as R}from"./MenuItem.50616e83.js";import{C as je}from"./Clear.6f7c24d8.js";import{F as O,u as ze}from"./FormTextField.05f4b970.js";import{D as Ae,a as Ye,b as Xe,c as Qe}from"./Drawer.2b52f4ed.js";import{F as re,G as ne,S as ea}from"./Grid.a7877d24.js";import{F as K,a as le,d as we}from"./Style.8807be1a.js";import{F as Se}from"./FormIOSSwitch.80e44f95.js";import{C as Ge}from"./Card.273c3e06.js";import{g as ta}from"./mui-tel-input.es.eb17df33.js";import{F as aa,e as oa}from"./Styles.c059562f.js";import{T as sa}from"./TextField.bc8832bf.js";import{D as Ke}from"./Drawer.7d1b4dc8.js";import{F as xe,a as ra,A as na}from"./FileType.118a3b25.js";import{A as _e}from"./AssetsApi.ddbf23d8.js";import{I as la,u as ca}from"./index.5c94cc1a.js";import{L as ia}from"./Link.fbef9aee.js";import{D as da}from"./Divider.6de19a4b.js";import"./Play.6c3fb361.js";import"./ArrowRight.7cb9a070.js";import"./CardContent.f8f32f32.js";import"./Styles.3864ecd6.js";import"./Tags.367dafc5.js";import"./toConsumableArray.52b4c8e6.js";import"./styled.00f71db4.js";import"./List.771b1df1.js";import"./CommonComponents.123cce4d.js";import"./listItemTextClasses.9956a810.js";import"./dividerClasses.ea04d24b.js";import"./listItemButtonClasses.661acbb5.js";import"./isMuiElement.ea3f4046.js";import"./Switch.30da1276.js";import"./SwitchBase.b6bfb054.js";import"./useFormControl.95a504f2.js";import"./useControlled.15b67f87.js";import"./InputAdornment.1fb89a13.js";import"./Select.460c2a9d.js";import"./tslib.es6.61e9e735.js";function pa(a){return xt("MuiCardHeader",a)}const ma=Ct("MuiCardHeader",["root","avatar","action","content","title","subheader"]),ke=ma,ua=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],ha=a=>{const{classes:s}=a;return Tt({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},pa,s)},fa=ye("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(a,s)=>ce({[`& .${ke.title}`]:s.title,[`& .${ke.subheader}`]:s.subheader},s.root)})({display:"flex",alignItems:"center",padding:16}),ga=ye("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(a,s)=>s.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Ca=ye("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(a,s)=>s.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),xa=ye("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(a,s)=>s.content})({flex:"1 1 auto"}),ba=c.exports.forwardRef(function(s,l){const v=bt({props:s,name:"MuiCardHeader"}),{action:S,avatar:i,className:g,component:F="div",disableTypography:C=!1,subheader:x,subheaderTypographyProps:w,title:B,titleTypographyProps:b}=v,h=yt(v,ua),P=ce({},v,{component:F,disableTypography:C}),W=ha(P);let p=B;p!=null&&p.type!==ie&&!C&&(p=e(ie,ce({variant:i?"body2":"h5",className:W.title,component:"span",display:"block"},b,{children:p})));let f=x;return f!=null&&f.type!==ie&&!C&&(f=e(ie,ce({variant:i?"body2":"body1",className:W.subheader,color:"text.secondary",component:"span",display:"block"},w,{children:f}))),o(fa,ce({className:de(W.root,g),as:F,ref:l,ownerState:P},h,{children:[i&&e(ga,{className:W.avatar,ownerState:P,children:i}),o(xa,{className:W.content,ownerState:P,children:[p,f]}),S&&e(Ca,{className:W.action,ownerState:P,children:S})]}))}),Ze=ba,ya=({color:a="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:a})}),Ta={px:{xs:3.75,md:2},"&:hover":{bgcolor:"#edfaff"}},va="yMNf",wa="xmX7",He={WTMItem:va,OptionMenuPaper:wa},Sa=({template_status:a,name:s,id:l,description:v})=>{const{setErrorMessage:S,setSuccessMessage:i}=oe(),{setEditWaTemplateId:g,setShowWaTemplateForm:F,setPreviewWaTemplateId:C,setShowWaTemplatePreview:x}=pe(),[w,B]=c.exports.useState(null),[b,h]=c.exports.useState(!1),P=()=>{h(!0)},W=()=>{h(!1)},p=E=>{B(E.currentTarget)},f=()=>{B(null)},D=async()=>{try{const E=await U.deleteWaTemplateMessage(l);if(!E.success)throw Error(E.message);i(E.message),setTimeout(()=>window.location.reload(),1e3)}catch(E){S(E.message)}finally{W()}};return o(c.exports.Fragment,{children:[o(Xt,{component:"div",sx:Ta,children:[e(Qt,{primary:o("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:s}),e(Kt,{label:a,size:"small",sx:{bgcolor:zt[a]}})]}),secondary:vt(`${v.replaceAll(`
`," ").trim().slice(0,400)}${v.length>400?"...":""}`),className:He.WTMItem}),e(Gt,{children:e(k,{onClick:p,children:e(Zt,{})})})]}),Boolean(w)&&o(Jt,{anchorEl:w,open:Boolean(w),onClose:f,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:He.OptionMenuPaper},children:[a==="DRAFT"&&e(R,{onClick:()=>{g(l),F(!0),f()},children:"Edit"}),(a==="SUBMITTED"||a==="APPROVED")&&e(R,{onClick:()=>{C(l),x(!0),f()},children:"Preview"}),e(R,{onClick:()=>{P(),f()},children:"Delete"})]}),e(Yt,{title:"Delete",open:b,setOpen:h,onConfirm:async()=>await D(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},Fa=({isSearchActive:a,setSearchActive:s})=>{const{setErrorMessage:l,setSuccessMessage:v}=oe(),{totalWaTemplates:S}=Te(),{setWaTemplateFilter:i,setShowWaTemplateForm:g,setTotalWaTemplates:F,setWaTemplatesData:C}=pe(),[x,w]=c.exports.useState(!1),B=async()=>{try{w(!0);const b=await U.syncWaTemplateMessage();if(b.success){const h=await U.getWaTemplateMessages();if(!h.success)throw Error(b.message);F(h.payload.length),C(h.payload),v(b.message)}else l(b.message)}catch(b){l(b.message)}finally{w(!1)}};return o(Rt,{children:[e(Lt,{children:e(X,{disableIcon:!0,type:"button",onClick:()=>g(!0),className:"small",children:"New Template Message"})}),o(Ot,{children:[!a&&e(_t,{children:e(kt,{children:`${S} Template Messages`})}),o(Ht,{children:[a&&e(Ve,{children:o(qe,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(be,{})}),e(De,{onChange:({target:{value:b}})=>i(b),placeholder:"Search Template"}),e(k,{onClick:()=>{i(""),s(!a)},sx:{position:"absolute",right:0,top:0},children:e(je,{})})]})}),!a&&e(k,{onClick:()=>s(b=>!b),children:e(be,{})}),!a&&e(X,{icon:e(ya,{color:x?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:x,onClick:()=>B(),className:"sync",children:x?"Syncing...":"Sync Messages"})]})]})]})},G=/[{][{]\d{1,3}[}][}]/gm,Ea="oIEe",Wa="CaIb",Je={QrButtonCard:Ea,CtaButtonCard:Wa},Ba=({index:a,control:s,removeQuickReply:l})=>o(Ge,{className:Je.QrButtonCard,elevation:0,children:[e(Ze,{title:`Quick Reply ${a+1}`,action:e(k,{"aria-label":`Remove Quick Reply ${a+1}`,onClick:()=>l(a),children:e($e,{})})}),e($,{sx:{my:2},children:e(O,{control:s,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:K})})]},a),Pa=({index:a,type:s,url:l,phone_number:v,waTemplateButtonCtaTypes:S,control:i,setValue:g,removeCallAction:F})=>{const{country:C}=ve(),[x,w]=c.exports.useState(0),B=()=>{if(x===1)return;const h=`${l}{{${1}}}`;g(`components[3].buttons[${a}].url`,h),w(1)},b=c.exports.useCallback(()=>{if(l){const h=l.match(G);h&&h.length>0?w(1):w(0)}},[l]);return c.exports.useEffect(()=>{b()},[b]),o(Ge,{className:Je.CtaButtonCard,elevation:0,children:[e(Ze,{title:`Call to Action ${a+1}`,action:e(k,{"aria-label":`Remove Call to Action ${a+1}`,onClick:()=>F(a),children:e($e,{})})}),e($,{sx:{my:2},children:o(O,{select:!0,control:i,label:"Action Type",name:`components[3].buttons[${a}].type`,sx:aa,required:!0,defaultValue:s,children:[e(R,{value:"",disabled:!0,children:"Select Action Type"}),S.map(({value:h,name:P},W)=>e(R,{value:h,children:P},W))]})}),s!==""&&e($,{sx:{my:2},children:e(O,{control:i,name:`components[3].buttons[${a}].text`,label:"Label",required:!0,sx:K})}),s==="PHONE_NUMBER"&&e($,{sx:{my:2},children:e(ta,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:C,value:v!=null?v:"",onChange:h=>{g(`components[3].buttons[${a}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:oa})}),s==="URL"&&o($,{sx:{my:2},children:[o(ge,{children:[e(O,{control:i,name:`components[3].buttons[${a}].url`,label:"URL",required:!0,sx:{...K,pb:2,height:"auto"}}),e(Be,{size:"small",focusRipple:!1,className:"add-variable",disabled:x===1,onClick:B,children:"ADD VARIABLE"})]}),o(Ce,{children:[o(ae,{children:[l?l.length:0,"/60 Characters"]}),o(ae,{children:[x,"/1 Variable"]})]})]})]},a)},Aa=({open:a,closeDrawer:s})=>{const{setErrorMessage:l,setSuccessMessage:v}=oe(),{businessId:S}=ve(),{editWaTemplateId:i,waTemplatesData:g,waTemplateCategories:F,waTemplateLanguages:C,waTemplateTypes:x,waTemplateHeaderTypes:w,waTemplateButtonTypes:B,waTemplateButtonCtaTypes:b}=Te(),{setWaTemplatesData:h,setShowWaPreviewForm:P,setPreviewWaTemplateId:W}=pe(),p={name:"",category:"",language:"",template_type:"",businessId:S,components:[{format:"",text:"",type:L.HEADER,active:!1},{text:"",type:L.BODY},{text:"",type:L.FOOTER,active:!1},{buttons:[],type:L.BUTTONS,active:!1}]},{control:f,handleSubmit:D,watch:E,reset:y,setValue:r}=ze({defaultValues:p}),{name:T,category:N,language:se,template_type:I,components:J}=E(),M=J.find(({type:t})=>t===L.HEADER),V=J.find(({type:t})=>t===L.BODY),Q=J.find(({type:t})=>t===L.FOOTER),_=J.find(({type:t})=>t===L.BUTTONS),[ee,q]=c.exports.useState(0),[m,A]=c.exports.useState(""),j=c.exports.useCallback(()=>{const d=T.match(/^[A-Za-z0-9_]+$/g)===null?T.slice(0,-1):T.replace(/\s/g,"").toLowerCase();r("name",d)},[T]),z=()=>{if(ee===1)return;const t=`${M.text}{{${1}}}`;r("components[0].text",t),q(1)},te=()=>{const t=V.text.match(G),d=t&&t.length>0?`${V.text}{{${t.length+1}}}`:`${V.text}{{${1}}}`;r("components[1].text",d)},me=c.exports.useCallback(()=>{const t=M.text.match(G);t&&t.length>0?q(1):q(0)},[M.text]),n=c.exports.useCallback(()=>{const t=M.text.match(G);if(t===null){q(0);return}if(t.length===0){q(0);return}r("components[0].text",t.reduce((d,u,H)=>H===0?d.replace(u,`{{${H+1}}}`):d.replace(u,""),t.reduce((d,u,H)=>d.replace(u,`{{${H+1}}}`),M.text))),q(1)},[M.text]),Y=()=>{const t=V.text.match(G);t!==null&&t.length!==0&&r("components[1].text",t.reduce((d,u,H)=>d.replace(u,`{{${H+1}}}`),V.text))},ue=t=>{A(t.target.value)},he=()=>{if(m===""&&l("Please Select button Type"),m==="QUICK_REPLY")if(_.buttons.length<3){const t=_.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else l("Limit exceeded");if(m==="CALL_TO_ACTION")if(_.buttons.length<2){const t=_.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else l("Limit exceeded")},et=t=>{const d=_.buttons;d.splice(t,1),r("components[3].buttons",d)},tt=t=>{const d=_.buttons;d.splice(t,1),r("components[3].buttons",d)},at=e(O,{control:f,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:K}),ot=o(O,{select:!0,control:f,label:"Template Category",name:"category",sx:le,required:!0,defaultValue:N,children:[e(R,{value:"",disabled:!0,children:"Select Template Category"}),F.map(({value:t,name:d},u)=>e(R,{value:t,children:d},u))]}),st=o(O,{select:!0,control:f,label:"Language",name:"language",sx:le,required:!0,defaultValue:se,children:[e(R,{value:"",disabled:!0,children:"Select Language"}),C.map(({code:t,name:d},u)=>e(R,{value:t,children:d},u))]}),rt=o(O,{select:!0,control:f,label:"Template Type",name:"template_type",sx:le,required:!0,defaultValue:I,children:[e(R,{value:"",disabled:!0,children:"Select Template Type"}),x.map(({value:t,label:d},u)=>e(R,{value:t,children:d},u))]}),nt=o(re,{className:"justify-content-between flex-row",children:[e(ne,{children:e(fe,{children:"Header"})}),e(Se,{control:f,name:"components[0].active"})]}),lt=o(O,{select:!0,control:f,label:"Header Type",name:"components[0].format",sx:le,required:!0,defaultValue:M.format,children:[e(R,{value:"",disabled:!0,children:"Select Header Type"}),w.map(({value:t,name:d},u)=>e(R,{value:t,children:d},u))]}),ct=o(c.exports.Fragment,{children:[o(ge,{children:[e(O,{control:f,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:we}),e(Be,{size:"small",focusRipple:!1,className:"add-variable",disabled:ee===1,onClick:z,children:"ADD VARIABLE"})]}),o(Ce,{children:[o(ae,{children:[M.text.length,"/60 Characters"]}),o(ae,{children:[ee,"/1 Variable"]})]})]}),it=e(fe,{children:"Body"}),dt=o(c.exports.Fragment,{children:[o(ge,{children:[e(O,{control:f,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Y,inputProps:{maxLength:1024},sx:we}),e(Be,{size:"small",focusRipple:!1,className:"add-variable",onClick:te,children:"ADD VARIABLE"})]}),e(Ce,{children:o(ae,{children:[V.text.length,"/1024 Characters"]})})]}),pt=o(re,{className:"justify-content-between flex-row",children:[e(ne,{children:e(fe,{children:"Footer"})}),e(Se,{control:f,name:"components[2].active"})]}),mt=o(c.exports.Fragment,{children:[e(ge,{children:e(O,{control:f,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:we})}),e(Ce,{children:o(ae,{children:[Q.text.length,"/60 Characters"]})})]}),ut=o(re,{className:"justify-content-between flex-row",children:[e(ne,{children:e(fe,{children:"Buttons"})}),e(Se,{control:f,name:"components[3].active"})]}),ht=o(c.exports.Fragment,{children:[o(re,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(ne,{children:o(sa,{select:!0,label:"Button Type",sx:le,required:!0,value:m,onChange:ue,disabled:_.buttons.length>0,children:[e(R,{value:"",disabled:!0,children:"Select Button Type"}),B.map(({label:t,name:d},u)=>e(R,{value:d,children:t},u))]})}),e(ea,{children:e(X,{variant:"outlined",color:"primary",onClick:he,disableIcon:!0,children:"Add a Button"})})]}),I==="media"&&_.active&&_.buttons.length>0&&e(c.exports.Fragment,{children:_.buttons.map(({type:t,url:d,phone_number:u},H)=>{switch(t){case"QUICK_REPLY":return e(Ba,{index:H,removeQuickReply:et,control:f},H);default:return e(Pa,{index:H,type:t,url:d,phone_number:u,waTemplateButtonCtaTypes:b,control:f,setValue:r,removeCallAction:tt},H)}})})]}),ft=[at,ot,st,rt,...I==="media"?[nt]:[],...I==="media"&&M.active?[lt]:[],...I==="media"&&M.active&&M.format==="TEXT"?[ct]:[],...I!==""?[it]:[],...I!==""?[dt]:[],...I==="media"?[pt]:[],...I==="media"&&Q.active?[mt]:[],...I==="media"?[ut]:[],...I==="media"&&_.active?[ht]:[]],gt=async t=>{var d;try{if(i){const u=await U.updateWaTemplateMessage(i,t);if(!u.success)throw Error(u.message);v(u.message),W((d=u.payload.id)!=null?d:i),y(p),s(),P(!0)}else{const u=await U.createWaTemplateMessage(t);if(!u.success)throw Error(u.message);v(u.message),h([u.payload,...g]),W(u.payload.id),y(p),s(),P(!0)}}catch(u){l(u.message)}},Ie=c.exports.useCallback(async()=>{try{if(i){const t=await U.getWaTemplateMessage(i);if(!t.success)throw Error(t.message);y(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?A("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&A("CALL_TO_ACTION"))}}catch(t){l(t.message)}},[i]);return c.exports.useEffect(()=>{Ie()},[Ie]),c.exports.useEffect(()=>{j()},[j]),c.exports.useEffect(()=>{n()},[n]),c.exports.useEffect(()=>{me()},[me]),c.exports.useEffect(()=>{M.active||r("components[0].format","")},[M.active]),c.exports.useEffect(()=>{Q.active||r("components[2].text","")},[Q.active]),e(Ke,{anchor:"right",open:a,onClose:(t,d)=>{Ue(d)||(y(p),s())},sx:{zIndex:"modal"},children:o(Ae,{children:[o(Ye,{children:[e(k,{onClick:()=>{y(p),s()},className:"icon-md-button",children:e(Ne,{})}),e(Xe,{children:`${i?"Update":"Create New"} Template`})]}),o(Qe,{onSubmit:D(gt),onReset:()=>{y(p),s()},children:[e(re,{children:e(ne,{children:ft.map((t,d)=>e($,{children:t},d))})}),o(Pe,{children:[e(X,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(X,{type:"submit",children:"Preview & Save"})]})]})]})})},Ma="gY2p",Na="-h1X",Fe={File_Added:Ma,PreFile:Na,"input-text":"xc1P"},Ia={display:"flex",justifyContent:"center",alignItems:"center",flex:1,padding:"20px",height:"100%",width:"100%",cursor:"pointer",textAlign:"center",borderRadius:"8px",borderColor:"#B8BAC2",borderStyle:"dashed",backgroundColor:" #F2F3F7",color:"#000000",opacity:"0.5",outline:"none",transition:"border .24s ease-in-out",boxSizing:"border-box"},Ra={borderColor:"#2196f3"},La={borderColor:"#00e676"},Oa={borderColor:"#ff1744"},_a="VHLL",ka="-OYq",Ha="NCM0",$a="EjoM",Z={Upload_Overlay:_a,image_preview:ka,File_Preview:Ha,RemoveButton:$a},Ua=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:Z.Upload_Overlay,children:e(Me,{className:de("mt-1",Z.RemoveButton),onClick:a,children:"Remove"})}),e(wt,{src:s,alt:"preview"})]}),Va=({removeFile:a,fileUrl:s})=>o("div",{className:"d-flex justify-content-center",children:[e("div",{className:Z.Upload_Overlay,children:e(Me,{className:de("mt-1",Z.RemoveButton),onClick:a,children:"Remove"})}),e("video",{className:de(Z.image_preview,"w-100"),src:s,controls:!0,autoPlay:!0,muted:!0,loop:!0})]}),qa=({fileUrl:a,removeFile:s,fileName:l})=>e("div",{className:"d-flex justify-content-center",style:{height:"100%"},children:o("div",{className:Z.File_Preview,children:[o("div",{className:"d-flex align-items-center",children:[e(la,{fontSize:"large"})," ",e("p",{children:l!==""?l:a==null?void 0:a.split("/").pop()})]}),e(Me,{className:de("mt-1",Z.RemoveButton),onClick:s,children:"Remove"})]})}),Ee={image:{label:"PNG / JPG",value:{"image/*":[]},component:({removeFile:a,fileUrl:s})=>e(Ua,{removeFile:a,fileUrl:s})},video:{label:"MP4 / 3GP / 4K",value:{"video/*":[]},component:({removeFile:a,fileUrl:s})=>e(Va,{removeFile:a,fileUrl:s})},file:{label:"DOC / XLS / PDF / ZIP",value:{"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-powerpoint":[".ppt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".pptx"],"application/vnd.ms-excel":[],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[],"application/pdf":[],"application/x-zip-compressed":[]},component:({fileUrl:a,removeFile:s,fileName:l})=>e(qa,{fileUrl:a,removeFile:s,fileName:l})}},Da=({onChange:a,fileType:s,removeFile:l,fileUrl:v,fileName:S,label:i})=>{var h;const{getRootProps:g,getInputProps:F,isDragActive:C,isDragAccept:x,isDragReject:w,open:B}=ca({maxFiles:1,maxSize:9e6,accept:Ee[s].value,noClick:!0,noKeyboard:!0,onDrop:a}),b=c.exports.useMemo(()=>({...Ia,...C?Ra:{},...x?La:{},...w?Oa:{}}),[C,x,w]);return e(c.exports.Fragment,{children:v===""?e("button",{type:"button",className:Fe.PreFile,onClick:B,children:o("div",{...g({style:b}),children:[e("input",{...F()}),o("div",{className:Fe["input-text"],children:[e("h1",{children:i}),e("p",{children:(h=Ee[s])==null?void 0:h.label})]})]})}):e("div",{className:Fe.File_Added,children:Ee[s].component({removeFile:l,fileUrl:v,fileName:S})})})},ja=({control:a,fileTypes:s=xe.IMAGE,setValue:l,label:v="Upload Image",defaultFieldName:S,fileURL:i,fileNameField:g,fileField:F,fileURLField:C,width:x,height:w})=>{const{setErrorMessage:B}=oe(),[b,h]=c.exports.useState(""),P=async(p,f,D)=>{try{if(p.length>0){const E=new FormData;E.append("file",p[0]),E.append("max_size","10000"),E.append("allowed_ext",ra[s]);const y=await _e.fileUpload(na.ENGAGE_ASSETS,E);if(!y.success)throw Error(y.message);h(y.payload.file_name),l(S,y.payload.url),l(F,p[0]),l(C,y.payload.url),g&&g!==""&&l(g,y.payload.file_name)}}catch(E){console.error(E),B(E.message)}},W=async()=>{try{if(i!==""){const p=await _e.fileRemoveByURL(i);if(!p.success)throw Error(p.message);l(S,"")}}catch(p){l(S,""),console.error(p),B(p.message)}};return e(St,{sx:{transition:"all 0.2s ease-in-out",width:{xs:x!=null?x:157,lg:180,xl:200},height:{xs:w!=null?w:157,lg:180,xl:200},margin:"auto"},children:e(Da,{label:v,fileType:s,removeFile:W,fileUrl:i,fileName:b,onChange:P})})},za="nOWk",Ya="_0oHa",Xa="Ef-W",We={WaTemplatePreview:za,WaTemplatePreviewPaper:Ya,ActionArea:Xa},Qa=({open:a,closeDrawer:s})=>{var Q,_,ee,q;const{isMobile:l,isTablet:v}=ve(),{setErrorMessage:S,setSuccessMessage:i}=oe(),{previewWaTemplateId:g,previewWaTemplateData:F,showWaPreviewForm:C,showWaTemplatePreview:x}=Te(),{setPreviewWaTemplateData:w,setEditWaTemplateId:B,setShowWaTemplateForm:b}=pe(),[h,P]=c.exports.useState([]),W={components:[{format:"",text:"",type:L.HEADER},{text:"",type:L.BODY},{text:"",type:L.FOOTER},{buttons:[],type:L.BUTTONS}]},{control:p,handleSubmit:f,watch:D,setValue:E}=ze({defaultValues:W}),{components:y}=D(),r=y.find(({type:m})=>m===L.HEADER),T=y.find(({type:m})=>m===L.BODY),N=y.find(({type:m})=>m===L.BUTTONS),se=(_=(Q=r==null?void 0:r.example)==null?void 0:Q.header_handle)==null?void 0:_[0],I=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,T&&T.text&&T.text!==""&&T.text.includes("{{1}}"),N&&N.buttons.length>0&&((ee=N.buttons[0])==null?void 0:ee.type)==="URL"&&((q=N.buttons[0])==null?void 0:q.url.includes("{{1}}"))].reduce((m,A)=>m||A,!1),J=async m=>{var A,j;try{let z="",te="";if(r&&r.active&&r.format!=="TEXT"){z=(A=r==null?void 0:r.example)==null?void 0:A.header_file_url;const n=new FormData;n.append("file",(j=r==null?void 0:r.example)==null?void 0:j.header_file);const Y=await U.uploadTemplateFile(n);if(!Y.success)return S(Y.message);te=Y.payload}const me=m.components.map(n=>{var Y,ue,he;if(n==null||delete n.active,n.active&&n.type==="HEADER")return(n==null?void 0:n.format)!=="TEXT"?(n==null||delete n.text,(Y=n==null?void 0:n.example)==null||delete Y.header_files,(ue=n==null?void 0:n.example)==null||delete ue.header_file_url,{...n,example:{header_handle:[te]}}):n;if(n.type==="FOOTER"){if((n==null?void 0:n.text)!=="")return n}else if(n.type==="BUTTONS"){if((n==null?void 0:n.buttons.length)>0)return n}else if(n.type==="BODY")return(he=n==null?void 0:n.example)==null||delete he.header_handle,{...n}}).filter(n=>n!==void 0);if(g){const n=await U.updateWaTemplateComponents(g,{components:me,...z!==""?{mediaUrl:z}:{}});if(!n.success)throw Error(n.message);i(n.message),s()}}catch(z){S(z.message)}},M=c.exports.useCallback(()=>{y.length>0&&y.forEach(({type:m,text:A})=>{if(m==="BODY"){const j=A.match(G);j&&P(j.map((z,te)=>te+1))}})},[y]),V=c.exports.useCallback(async()=>{try{if(g){const m=await U.getWaTemplateMessage(g);if(!m.success)throw Error(m.message);w(m.payload),E("components",m.payload.components)}}catch(m){S(m.message)}},[g]);return c.exports.useEffect(()=>{V()},[V]),c.exports.useEffect(()=>{M()},[M]),o(Ke,{anchor:"right",open:a,onClose:(m,A)=>{(!Ue(A)||x)&&s()},classes:{root:We.WaTemplatePreview,paper:We.WaTemplatePreviewPaper},children:[o(Ae,{children:[a&&o(Ye,{children:[e(k,{onClick:()=>{s()},className:"icon-md-button",children:e(Ne,{})}),e(Xe,{children:I&&!x?"Enter Sample Values":"Preview Template"})]}),a&&o(Qe,{onSubmit:f(J),children:[(!I||x||l)&&F&&e(Re,{components:F.components}),C&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e($,{children:e(ja,{setValue:E,control:p,fileTypes:r.format==="IMAGE"?xe.IMAGE:r.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileField:"components[0].example.header_file",fileURLField:"components[0].example.header_file_url",fileURL:se!=null?se:"",width:"100%"})}),C&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e($,{children:e(O,{control:p,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:K})}),C&&h.length>0&&h.map((m,A)=>e($,{children:e(O,{control:p,name:`components[1].example.body_text[0][${A}]`,label:`Body Variable ${m}`,placeholder:`Body ${m}`,required:!0,sx:K})},`bodyVar{{${m}}}`)),C&&N&&N.buttons&&N.buttons.length>0&&N.buttons.map((m,A)=>m.type==="URL"&&m.url.match(G)?e($,{children:e(O,{control:p,name:`components[3].buttons[${A}].example[0]`,label:`URL Button ${A+1}`,placeholder:`Url button ${A+1} variable 1`,required:!0,sx:K})},A):null),C&&e(Pe,{children:e(X,{type:"submit",children:"Submit for Approval"})}),C&&o(Pe,{className:We.ActionArea,children:[e(ie,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(ia,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{B(g),b(!0),s()},children:"Continue Editing"})]})]})]}),!x&&a&&I&&v&&e(Ae,{className:"ExtendedDrawer",children:e(Re,{components:y})})]})},Ga=()=>{const{isMobile:a,isTablet:s}=ve(),{setErrorMessage:l}=oe(),[v,S]=c.exports.useState(!0),[i,g]=c.exports.useState(!1),{waTemplatesData:F,waTemplateFilter:C,showWaTemplateForm:x,showWaPreviewForm:w,showWaTemplatePreview:B}=Te(),{setWaTemplatesData:b,setTotalWaTemplates:h,setWaTemplateFilter:P,setShowWaTemplateForm:W,setShowWaPreviewForm:p,setShowWaTemplatePreview:f,setEditWaTemplateId:D,setPreviewWaTemplateId:E}=pe(),{platformExist:y}=Ft(),r=c.exports.useRef(async()=>{try{const T=await U.getWaTemplateMessages();if(!T.success)throw Error(T.message);h(T.payload.length),b(T.payload)}catch(T){l(T.message)}finally{S(!1)}});return c.exports.useEffect(()=>{typeof y=="boolean"&&y&&r.current()},[y]),v?e(Oe,{className:jt.AbsCenter,children:e(Et,{height:72,width:72})}):o(c.exports.Fragment,{children:[e(Wt,{children:e("title",{children:"WhatsApp Template Messages"})}),a&&o(Pt,{children:[!i&&e(k,{component:Bt,to:"/business-settings",className:"icon-md-button",children:e(Ne,{})}),!i&&e(At,{children:"Template Messages"}),i&&e(Ve,{children:o(qe,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(be,{})}),e(De,{onChange:({target:{value:T}})=>P(T),placeholder:"Search Template"}),e(k,{onClick:()=>{P(""),g(!i)},sx:{position:"absolute",right:0,top:0},children:e(je,{})})]})}),!i&&F.length>0&&e(k,{onClick:()=>g(T=>!T),children:e(be,{})})]}),e(Mt,{children:typeof y=="boolean"&&y===!1?e(Le,{children:e(Dt,{})}):e(Le,{children:!v&&e(Oe,{elevation:0,children:e($t,{sx:{mx:{xs:-3.75,md:0}},children:F.length===0?o(Nt,{children:[e(Ut,{children:e(X,{disableIcon:!0,onClick:()=>W(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Vt,{children:o(qt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):o(c.exports.Fragment,{children:[s&&e(Fa,{isSearchActive:i,setSearchActive:g}),s&&e(da,{}),F.filter(T=>{var N;return(N=T==null?void 0:T.name)==null?void 0:N.toLowerCase().includes(C==null?void 0:C.toLowerCase())}).map((T,N)=>e(Sa,{...T},N))]})})})})}),a&&F.length>0&&e(It,{children:e(X,{onClick:()=>W(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(Aa,{open:x,closeDrawer:()=>{D(void 0),W(!1)}}),e(Qa,{open:w||B,closeDrawer:()=>{E(void 0),p(!1),f(!1)}})]})},Jo=()=>e(Ga,{});export{Jo as default};
