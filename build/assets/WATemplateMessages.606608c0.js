import{l as Xe,m as je,n as ue,i as se,r as i,p as Ke,_ as Ge,T as re,j as e,a,q as Ze,w as Je,$ as oe,aY as ne,a0 as D,aZ as he,a_ as Be,u as fe,ar as He,aF as et,aq as tt,W as at,L as st}from"./index.b186592b.js";import{C as rt,W as q,a as We}from"./WaTemplatePreviewCard.26f9c091.js";import{L as we}from"./LeftArrow.b5872852.js";import{S as pe}from"./Search.779702db.js";import{c as ot,H as nt,d as lt,I as Me,g as it,h as ct}from"./Wrappers.1c8ff86f.js";import{a as me,p as dt}from"./Position.module.d7026604.js";import{S as Ae,a as Oe,b as Ne}from"./Search.dd01eb5d.js";import{b as pt,c as mt,d as ut,e as ht,f as ft,g as Ct,C as Le,a as gt}from"./Card.c8717ee4.js";import{C as bt,a as xt,b as Tt}from"./Cta.a5d4e787.js";import{L as yt}from"./LinkPlatForm.808d5195.js";import{c as wt,d as H}from"./WhatsApp.00540be5.js";import{L as vt}from"./ListItem.40de5bfa.js";import{a as St,L as Et}from"./ListItemText.1403819e.js";import{C as Wt}from"./Chip.71085200.js";import{M as Mt}from"./MoreVert.61c37ff7.js";import{M as Lt}from"./Menu.a1c4ed55.js";import{M as B}from"./MenuItem.46f15d95.js";import{C as Pe}from"./Clear.05d3687e.js";import{F as A,u as ke}from"./FormTextField.3f61f07e.js";import{D as It,b as Rt,c as Ft,d as Bt,F as te,G as ae,e as k,S as Ht,a as ie,A as Te}from"./CommonComponents.ab047aaf.js";import{F as ge}from"./FormIOSSwitch.93148efd.js";import{f as X,F as G,g as At,h as be}from"./Styles.5fa2ae96.js";import{u as _,a2 as ce,a3 as ye,a4 as de,a5 as Z,L as le,a6 as Ie,n as Ot,H as Nt,a7 as Pt}from"./Tags.f9f8608f.js";import{C as De}from"./Card.f9953836.js";import{g as kt}from"./mui-tel-input.es.eb81148d.js";import{D as $e}from"./Drawer.e7c63a2c.js";import{T as Dt}from"./TextField.7cfd5f8b.js";import{F as $t}from"./FileUpload.235e786a.js";import{F as xe}from"./index.a23f6f67.js";import{L as Vt}from"./Link.7de60bb3.js";import{D as Ut}from"./Divider.efbf425b.js";import"./Play.6d8091fe.js";import"./ArrowRight.e7fea676.js";import"./CardContent.fa9b6571.js";import"./List.1f5dafa3.js";import"./listItemButtonClasses.0f0ff00e.js";import"./isMuiElement.9a08466c.js";import"./listItemTextClasses.846cbc39.js";import"./SwitchBase.203953d1.js";import"./Select.9835b57c.js";import"./useControlled.ec723b61.js";import"./withStyles.e8acb61c.js";import"./InputAdornment.fe191e21.js";import"./AssetsApi.f2c283eb.js";function _t(s){return je("MuiCardHeader",s)}const qt=Xe("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Re=qt,Yt=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],zt=s=>{const{classes:r}=s;return Je({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},_t,r)},Qt=ue("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(s,r)=>se({[`& .${Re.title}`]:r.title,[`& .${Re.subheader}`]:r.subheader},r.root)})({display:"flex",alignItems:"center",padding:16}),Xt=ue("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(s,r)=>r.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),jt=ue("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(s,r)=>r.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),Kt=ue("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(s,r)=>r.content})({flex:"1 1 auto"}),Gt=i.exports.forwardRef(function(r,p){const w=Ke({props:r,name:"MuiCardHeader"}),{action:I,avatar:d,className:g,component:E="div",disableTypography:C=!1,subheader:T,subheaderTypographyProps:W,title:O,titleTypographyProps:f}=w,h=Ge(w,Yt),M=se({},w,{component:E,disableTypography:C}),v=zt(M);let b=O;b!=null&&b.type!==re&&!C&&(b=e(re,se({variant:d?"body2":"h5",className:v.title,component:"span",display:"block"},f,{children:b})));let m=T;return m!=null&&m.type!==re&&!C&&(m=e(re,se({variant:d?"body2":"body1",className:v.subheader,color:"text.secondary",component:"span",display:"block"},W,{children:m}))),a(Qt,se({className:Ze(v.root,g),as:E,ref:p,ownerState:M},h,{children:[d&&e(Xt,{className:v.avatar,ownerState:M,children:d}),a(Kt,{className:v.content,ownerState:M,children:[b,m]}),I&&e(jt,{className:v.action,ownerState:M,children:I})]}))}),Ve=Gt,Zt=({color:s="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:s})}),Jt={px:{xs:0,md:2}},ea="yMNf",ta="xmX7",Fe={WTMItem:ea,OptionMenuPaper:ta},aa=({template_status:s,name:r,id:p,description:w})=>{const{setErrorMessage:I,setSuccessMessage:d}=oe(),{setEditWaTemplateId:g,setShowWaTemplateForm:E,setPreviewWaTemplateId:C,setShowWaTemplatePreview:T}=ne(),[W,O]=i.exports.useState(null),[f,h]=i.exports.useState(!1),M=()=>{h(!0)},v=()=>{h(!1)},b=N=>{O(N.currentTarget)},m=()=>{O(null)},Y=async()=>{try{const N=await q.deleteWaTemplateMessage(p);if(!N.success)throw Error(N.message);d(N.message),setTimeout(()=>window.location.reload(),1e3)}catch(N){I(N.message)}finally{v()}};return a(i.exports.Fragment,{children:[a(vt,{component:"div",sx:Jt,children:[e(St,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:r}),e(Wt,{label:s,size:"small",sx:{bgcolor:wt[s]}})]}),secondary:w,className:Fe.WTMItem}),e(Et,{children:e(D,{onClick:b,children:e(Mt,{})})})]}),Boolean(W)&&a(Lt,{anchorEl:W,open:Boolean(W),onClose:m,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:Fe.OptionMenuPaper},children:[s==="DRAFT"&&e(B,{onClick:()=>{g(p),E(!0),m()},children:"Edit"}),(s==="SUBMITTED"||s==="APPROVED")&&e(B,{onClick:()=>{C(p),T(!0),m()},children:"Preview"}),e(B,{onClick:()=>{M(),m()},children:"Delete"})]}),e(rt,{title:"Delete",open:f,setOpen:h,onConfirm:async()=>await Y(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},sa=({isSearchActive:s,setSearchActive:r})=>{const{setErrorMessage:p,setSuccessMessage:w}=oe(),{totalWaTemplates:I}=he(),{setWaTemplateFilter:d,setShowWaTemplateForm:g,setTotalWaTemplates:E,setWaTemplatesData:C}=ne(),[T,W]=i.exports.useState(!1),O=async()=>{try{W(!0);const f=await q.syncWaTemplateMessage();if(f.success){const h=await q.getWaTemplateMessages();if(!h.success)throw Error(f.message);E(h.payload.length),C(h.payload),w(f.message)}else p(f.message)}catch(f){p(f.message)}finally{W(!1)}};return a(pt,{children:[e(mt,{children:e(me,{disableIcon:!0,type:"button",onClick:()=>g(!0),className:"small",children:"New Template Message"})}),a(ut,{children:[!s&&e(ht,{children:e(ft,{children:`${I} Template Messages`})}),a(Ct,{children:[s&&e(Ae,{children:a(Oe,{children:[e(D,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(pe,{})}),e(Ne,{onChange:({target:{value:f}})=>d(f),placeholder:"Search Template"}),e(D,{onClick:()=>{d(""),r(!s)},sx:{position:"absolute",right:0,top:0},children:e(Pe,{})})]})}),!s&&e(D,{onClick:()=>r(f=>!f),children:e(pe,{})}),!s&&e(me,{icon:e(Zt,{color:T?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:T,onClick:()=>O(),className:"sync",children:T?"Syncing...":"Sync Messages"})]})]})]})},Q=/[{][{]\d{1,3}[}][}]/gm,ra=({index:s,control:r,removeQuickReply:p})=>a(De,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Ve,{title:`Quick Reply ${s+1}`,action:e(D,{"aria-label":`Remove Quick Reply ${s+1}`,onClick:()=>p(s),children:e(Be,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(_,{sx:{my:2},children:e(A,{control:r,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:X})})]},s),oa=({index:s,type:r,url:p,phone_number:w,waTemplateButtonCtaTypes:I,control:d,setValue:g,removeCallAction:E})=>{const{country:C}=fe(),[T,W]=i.exports.useState(0),O=()=>{if(T===1)return;const h=`${p}{{${1}}}`;g(`components[3].buttons[${s}].url`,h),W(1)},f=i.exports.useCallback(()=>{if(p){const h=p.match(Q);h&&h.length>0?W(1):W(0)}},[p]);return i.exports.useEffect(()=>{f()},[f]),a(De,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e(Ve,{title:`Call to Action ${s+1}`,action:e(D,{"aria-label":`Remove Call to Action ${s+1}`,onClick:()=>E(s),children:e(Be,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(_,{sx:{my:2},children:a(A,{select:!0,control:d,label:"Action Type",name:`components[3].buttons[${s}].type`,sx:G,required:!0,defaultValue:r,children:[e(B,{value:"",disabled:!0,children:"Select Action Type"}),I.map(({value:h,name:M},v)=>e(B,{value:h,children:M},v))]})}),r!==""&&e(_,{sx:{my:2},children:e(A,{control:d,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:X})}),r==="PHONE_NUMBER"&&e(_,{sx:{my:2},children:e(kt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:C,value:w!=null?w:"",onChange:h=>{g(`components[3].buttons[${s}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:At})}),r==="URL"&&a(_,{sx:{my:2},children:[a(ce,{children:[e(A,{control:d,name:`components[3].buttons[${s}].url`,label:"URL",required:!0,sx:{...X,pb:2,height:"auto"}}),e(ye,{size:"small",focusRipple:!1,className:"add-variable",disabled:T===1,onClick:O,children:"ADD VARIABLE"})]}),a(de,{children:[a(Z,{children:[p?p.length:0,"/60 Characters"]}),a(Z,{children:[T,"/1 Variable"]})]})]})]},s)},na=({open:s,closeDrawer:r})=>{const{setErrorMessage:p,setSuccessMessage:w}=oe(),{businessId:I}=fe(),{editWaTemplateId:d,waTemplatesData:g,waTemplateCategories:E,waTemplateLanguages:C,waTemplateTypes:T,waTemplateHeaderTypes:W,waTemplateButtonTypes:O,waTemplateButtonCtaTypes:f}=he(),{setWaTemplatesData:h,setShowWaPreviewForm:M,setPreviewWaTemplateId:v}=ne(),b={name:"",category:"",language:"",template_type:"",businessId:I,components:[{format:"",text:"",type:H.HEADER,active:!1},{text:"",type:H.BODY},{text:"",type:H.FOOTER,active:!1},{buttons:[],type:H.BUTTONS,active:!1}]},{control:m,handleSubmit:Y,watch:N,reset:y,setValue:o}=ke({defaultValues:b}),{name:u,category:R,language:J,template_type:F,components:j}=N(),L=j.find(({type:t})=>t===H.HEADER),V=j.find(({type:t})=>t===H.BODY),z=j.find(({type:t})=>t===H.FOOTER),P=j.find(({type:t})=>t===H.BUTTONS),[K,U]=i.exports.useState(0),[l,x]=i.exports.useState(""),S=i.exports.useCallback(()=>{const n=u.match(/^[A-Za-z0-9_]+$/g)===null?u.slice(0,-1):u.replace(/\s/g,"").toLowerCase();o("name",n)},[u]),ee=()=>{if(K===1)return;const t=`${L.text}{{${1}}}`;o("components[0].text",t),U(1)},Ce=()=>{const t=V.text.match(Q),n=t&&t.length>0?`${V.text}{{${t.length+1}}}`:`${V.text}{{${1}}}`;o("components[1].text",n)},ve=i.exports.useCallback(()=>{const t=L.text.match(Q);t&&t.length>0?U(1):U(0)},[L.text]),Se=i.exports.useCallback(()=>{const t=L.text.match(Q);if(t===null){U(0);return}if(t.length===0){U(0);return}o("components[0].text",t.reduce((n,c,$)=>$===0?n.replace(c,`{{${$+1}}}`):n.replace(c,""),t.reduce((n,c,$)=>n.replace(c,`{{${$+1}}}`),L.text))),U(1)},[L.text]),Ue=()=>{const t=V.text.match(Q);t!==null&&t.length!==0&&o("components[1].text",t.reduce((n,c,$)=>n.replace(c,`{{${$+1}}}`),V.text))},_e=t=>{x(t.target.value)},qe=()=>{if(l===""&&p("Please Select button Type"),l==="QUICK_REPLY")if(P.buttons.length<3){const t=P.buttons;t.push({type:"QUICK_REPLY",text:""}),o("components[3].buttons",t)}else p("Limit exceeded");if(l==="CALL_TO_ACTION")if(P.buttons.length<2){const t=P.buttons;t.push({type:"",text:""}),o("components[3].buttons",t)}else p("Limit exceeded")},Ye=t=>{const n=P.buttons;n.splice(t,1),o("components[3].buttons",n)},ze=t=>{const n=P.buttons;n.splice(t,1),o("components[3].buttons",n)},Qe=async t=>{var n;try{if(d){const c=await q.updateWaTemplateMessage(d,t);if(!c.success)throw Error(c.message);w(c.message),v((n=c.payload.id)!=null?n:d),y(b),r(),M(!0)}else{const c=await q.createWaTemplateMessage(t);if(!c.success)throw Error(c.message);w(c.message),h([c.payload,...g]),v(c.payload.id),y(b),r(),M(!0)}}catch(c){p(c.message)}},Ee=i.exports.useCallback(async()=>{try{if(d){const t=await q.getWaTemplateMessage(d);if(!t.success)throw Error(t.message);y(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&o("components[0].active",!0),t.payload.components[2].text!==""&&o("components[2].active",!0),t.payload.components[3].buttons.length>0&&o("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?x("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&x("CALL_TO_ACTION"))}}catch(t){p(t.message)}},[d]);return i.exports.useEffect(()=>{Ee()},[Ee]),i.exports.useEffect(()=>{S()},[S]),i.exports.useEffect(()=>{Se()},[Se]),i.exports.useEffect(()=>{ve()},[ve]),i.exports.useEffect(()=>{L.active||o("components[0].format","")},[L.active]),i.exports.useEffect(()=>{z.active||o("components[2].text","")},[z.active]),e($e,{anchor:"right",open:s,onClose:(t,n)=>{He(n)||(y(b),r())},sx:{zIndex:"modal"},children:a(It,{sx:{width:{xs:"100vw",md:360}},children:[a(Rt,{children:[e(D,{onClick:()=>{y(b),r()},className:"icon-md-button",children:e(we,{})}),e(Ft,{children:`${d?"Update":"Create New"} Template`})]}),a(Bt,{onSubmit:Y(Qe),onReset:()=>{y(b),r()},children:[e(te,{children:a(ae,{children:[e(k,{children:e(A,{control:m,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:X})}),e(k,{children:a(A,{select:!0,control:m,label:"Template Category",name:"category",sx:G,required:!0,defaultValue:R,children:[e(B,{value:"",disabled:!0,children:"Select Template Category"}),E.map(({value:t,name:n},c)=>e(B,{value:t,children:n},c))]})}),e(k,{children:a(A,{select:!0,control:m,label:"Language",name:"language",sx:G,required:!0,defaultValue:J,children:[e(B,{value:"",disabled:!0,children:"Select Language"}),C.map(({code:t,name:n},c)=>e(B,{value:t,children:n},c))]})}),e(k,{children:a(A,{select:!0,control:m,label:"Template Type",name:"template_type",sx:G,required:!0,defaultValue:F,children:[e(B,{value:"",disabled:!0,children:"Select Template Type"}),T.map(({value:t,label:n},c)=>e(B,{value:t,children:n},c))]})}),F==="media"&&e(k,{children:a(te,{sx:{justifyContent:"space-between"},children:[e(ae,{children:e(le,{children:"Header"})}),e(ge,{control:m,name:"components[0].active"})]})}),F==="media"&&L.active&&e(k,{children:a(A,{select:!0,control:m,label:"Header Type",name:"components[0].format",sx:G,required:!0,defaultValue:L.format,children:[e(B,{value:"",disabled:!0,children:"Select Header Type"}),W.map(({value:t,name:n},c)=>e(B,{value:t,children:n},c))]})}),F==="media"&&L.active&&L.format==="TEXT"&&a(k,{children:[a(ce,{children:[e(A,{control:m,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:be}),e(ye,{size:"small",focusRipple:!1,className:"add-variable",disabled:K===1,onClick:ee,children:"ADD VARIABLE"})]}),a(de,{children:[a(Z,{children:[L.text.length,"/60 Characters"]}),a(Z,{children:[K,"/1 Variable"]})]})]}),F!==""&&e(k,{children:e(le,{children:"Body"})}),F!==""&&a(k,{children:[a(ce,{children:[e(A,{control:m,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Ue,inputProps:{maxLength:1024},sx:be}),e(ye,{size:"small",focusRipple:!1,className:"add-variable",onClick:Ce,children:"ADD VARIABLE"})]}),e(de,{children:a(Z,{children:[V.text.length,"/1024 Characters"]})})]}),F==="media"&&e(k,{children:a(te,{sx:{justifyContent:"space-between"},children:[e(ae,{children:e(le,{children:"Footer"})}),e(ge,{control:m,name:"components[2].active"})]})}),F==="media"&&z.active&&a(k,{children:[e(ce,{children:e(A,{control:m,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:be})}),e(de,{children:a(Z,{children:[z.text.length,"/60 Characters"]})})]}),F==="media"&&e(k,{children:a(te,{sx:{justifyContent:"space-between"},children:[e(ae,{children:e(le,{children:"Buttons"})}),e(ge,{control:m,name:"components[3].active"})]})}),F==="media"&&P.active&&a(k,{children:[a(te,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(ae,{children:a(Dt,{select:!0,label:"Button Type",sx:G,required:!0,value:l,onChange:_e,disabled:P.buttons.length>0,children:[e(B,{value:"",disabled:!0,children:"Select Button Type"}),O.map(({label:t,name:n},c)=>e(B,{value:n,children:t},c))]})}),e(Ht,{children:e(ie,{variant:"outlined",color:"primary",onClick:qe,disableIcon:!0,children:"Add a Button"})})]}),F==="media"&&P.active&&P.buttons.length>0&&e(i.exports.Fragment,{children:P.buttons.map(({type:t,url:n,phone_number:c},$)=>{switch(t){case"QUICK_REPLY":return e(ra,{index:$,removeQuickReply:Ye,control:m},$);default:return e(oa,{index:$,type:t,url:n,phone_number:c,waTemplateButtonCtaTypes:f,control:m,setValue:o,removeCallAction:ze},$)}})})]})]})}),a(Te,{children:[e(ie,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(ie,{type:"submit",children:"Preview & Save"})]})]})]})})},la=({open:s,closeDrawer:r})=>{var z,P,K,U;const{isMobile:p,isTablet:w}=fe(),{setErrorMessage:I,setSuccessMessage:d}=oe(),{previewWaTemplateId:g,previewWaTemplateData:E,showWaPreviewForm:C,showWaTemplatePreview:T}=he(),{setPreviewWaTemplateData:W,setEditWaTemplateId:O,setShowWaTemplateForm:f}=ne(),[h,M]=i.exports.useState([]),v={components:[{format:"",text:"",type:H.HEADER},{text:"",type:H.BODY},{text:"",type:H.FOOTER},{buttons:[],type:H.BUTTONS}]},{control:b,handleSubmit:m,watch:Y,setValue:N}=ke({defaultValues:v}),{components:y}=Y(),o=y.find(({type:l})=>l===H.HEADER),u=y.find(({type:l})=>l===H.BODY),R=y.find(({type:l})=>l===H.BUTTONS),J=(P=(z=o==null?void 0:o.example)==null?void 0:z.header_handle)==null?void 0:P[0],F=[o&&o.format!=="TEXT",o&&o.format==="TEXT"&&o.text&&o.text!==""?o.text.includes("{{1}}"):!1,u&&u.text&&u.text!==""&&u.text.includes("{{1}}"),R&&R.buttons.length>0&&((K=R.buttons[0])==null?void 0:K.type)==="URL"&&((U=R.buttons[0])==null?void 0:U.url.includes("{{1}}"))].reduce((l,x)=>l||x,!1),j=async l=>{try{const x=l.components.map(S=>{var ee;return S==null||delete S.active,S.type==="HEADER"&&((ee=S==null?void 0:S.example)==null||delete ee.header_files),S});if(g){console.log(x);const S=await q.updateWaTemplateComponents(g,{components:x});if(!S.success)throw Error(S.message);d(S.message),r()}}catch(x){I(x.message)}},L=i.exports.useCallback(()=>{y.length>0&&y.forEach(({type:l,text:x})=>{if(l==="BODY"){const S=x.match(Q);S&&M(S.map((ee,Ce)=>Ce+1))}})},[y]),V=i.exports.useCallback(async()=>{try{if(g){const l=await q.getWaTemplateMessage(g);if(!l.success)throw Error(l.message);W(l.payload),N("components",l.payload.components)}}catch(l){I(l.message)}},[g]);return i.exports.useEffect(()=>{V()},[V]),i.exports.useEffect(()=>{L()},[L]),a($e,{anchor:"right",open:s,onClose:(l,x)=>{(!He(x)||T)&&r()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[a(Ie,{sx:{width:{xs:"100vw",md:360}},children:[s&&a(Ot,{children:[e(D,{onClick:()=>{r()},className:"icon-md-button",children:e(we,{})}),e(Nt,{children:F&&!T?"Enter Sample Values":"Preview Template"})]}),s&&a(Pt,{onSubmit:m(j),children:[(!F||T||p)&&E&&e(We,{components:E.components}),C&&o&&(o.format==="IMAGE"||o.format==="VIDEO"||o.format==="DOCUMENT")&&e(_,{children:e($t,{setValue:N,control:b,fileTypes:o.format==="IMAGE"?xe.IMAGE:o.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${o.format.charAt(0).toUpperCase()}${o.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:J!=null?J:"",width:"100%"})}),C&&o&&o.format==="TEXT"&&o.text.includes("{{1}}")&&e(_,{children:e(A,{control:b,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:X})}),C&&h.length>0&&h.map((l,x)=>e(_,{children:e(A,{control:b,name:`components[1].example.body_text[${x}]`,label:`Body Variable ${l}`,placeholder:`Body ${l}`,required:!0,sx:X})},`bodyVar{{${l}}}`)),C&&R&&R.buttons&&R.buttons.length>0&&R.buttons.map((l,x)=>(console.log(l.url),l.type==="URL"&&l.url.match(Q)?e(_,{children:e(A,{control:b,name:`components[3].buttons[${x}].example[0]`,label:`URL Button ${x+1}`,placeholder:`Url button ${x+1} variable 1`,required:!0,sx:X})},x):null)),C&&e(Te,{children:e(ie,{type:"submit",children:"Submit for Approval"})}),C&&a(Te,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(re,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(Vt,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{O(g),f(!0),r()},children:"Continue Editing"})]})]})]}),!T&&s&&F&&w&&e(Ie,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(We,{components:y})})]})},ia=()=>{const{isMobile:s,isTablet:r}=fe(),{setErrorMessage:p}=oe(),[w,I]=i.exports.useState(!0),[d,g]=i.exports.useState(!1),{waTemplatesData:E,waTemplateFilter:C,showWaTemplateForm:T,showWaPreviewForm:W,showWaTemplatePreview:O}=he(),{setWaTemplatesData:f,setTotalWaTemplates:h,setWaTemplateFilter:M,setShowWaTemplateForm:v,setShowWaPreviewForm:b,setShowWaTemplatePreview:m,setEditWaTemplateId:Y,setPreviewWaTemplateId:N}=ne(),{platformExist:y}=et(),o=i.exports.useRef(async()=>{try{const u=await q.getWaTemplateMessages();if(!u.success)throw Error(u.message);h(u.payload.length),f(u.payload)}catch(u){p(u.message)}finally{I(!1)}});return i.exports.useEffect(()=>{typeof y=="boolean"&&y&&o.current()},[y]),w?e(Le,{className:dt.AbsCenter,children:e(tt,{height:72,width:72})}):a(i.exports.Fragment,{children:[e(at,{children:e("title",{children:"WhatsApp Template Messages"})}),s&&a(ot,{children:[!d&&e(D,{component:st,to:"/business-settings",className:"icon-md-button",children:e(we,{})}),!d&&e(nt,{children:"Template Messages"}),d&&e(Ae,{children:a(Oe,{children:[e(D,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ne,{onChange:({target:{value:u}})=>M(u),placeholder:"Search Template"}),e(D,{onClick:()=>{M(""),g(!d)},sx:{position:"absolute",right:0,top:0},children:e(Pe,{})})]})}),!d&&E.length>0&&e(D,{onClick:()=>g(u=>!u),children:e(pe,{})})]}),e(lt,{children:typeof y=="boolean"&&y===!1?e(Me,{children:e(yt,{})}):e(Me,{children:!w&&e(Le,{elevation:0,children:e(gt,{children:E.length===0?a(it,{children:[e(bt,{children:e(me,{disableIcon:!0,onClick:()=>v(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(xt,{children:a(Tt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(i.exports.Fragment,{children:[r&&e(sa,{isSearchActive:d,setSearchActive:g}),r&&e(Ut,{}),E.filter(u=>{var R;return(R=u==null?void 0:u.name)==null?void 0:R.toLowerCase().includes(C==null?void 0:C.toLowerCase())}).map((u,R)=>e(aa,{...u},R))]})})})})}),s&&E.length>0&&e(ct,{children:e(me,{onClick:()=>v(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(na,{open:T,closeDrawer:()=>{Y(void 0),v(!1)}}),e(la,{open:W||O,closeDrawer:()=>{N(void 0),b(!1),m(!1)}})]})},Ja=()=>e(ia,{});export{Ja as default};
