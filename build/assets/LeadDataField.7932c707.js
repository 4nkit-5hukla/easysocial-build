import{ai as k,at as T,r as o,a,j as e,$ as g,ao as V,ap as q,aq as z,ar as W,Z as N,au as x,av as B,an as X,u as $,aj as G,W as Z,L as K}from"./index.b6939ac4.js";import{L as H}from"./LeftArrow.8243e218.js";import{S as _}from"./Search.84b024b7.js";import{a as S,F as L,A as U}from"./Form.d6354f4c.js";import{f as Y,H as J,d as Q,I as ee,g as ae,h as te}from"./Wrappers.947cf4f4.js";import{S as O,a as R,b as j}from"./Search.8f0f49a4.js";import{a as re,b as ie,c as le,d as se,e as oe,f as ne,C as v,g as de}from"./Card.ad2a40c1.js";import{C as ce,a as me,b as pe}from"./Cta.2d719a2d.js";import{p as he}from"./Position.module.ff7b7fa6.js";import{L as ue}from"./ListItem.8eaa2bd4.js";import{L as fe}from"./ListItemText.8189d4ac.js";import{L as Fe}from"./ListItemIcon.a766ad45.js";import{M as ge}from"./MoreVert.3f91c9d2.js";import{M as ye}from"./Menu.ebd65fdc.js";import{M as D}from"./MenuItem.61818f9c.js";import{C as P}from"./Clear.f0a5f1e2.js";import{C as Ce,u as De}from"./index.esm.0195c433.js";import{F as E}from"./FormIOSSwitch.e0a9f4c6.js";import{F as I}from"./FormTextField.02b305ff.js";import{A as be}from"./Autocomplete.24ecb820.js";import{T as Le}from"./TextField.d30c805e.js";import{D as we,a as xe,b as _e,c as Se}from"./Drawer.4bc0ecb5.js";import{F as Ie,G as ke}from"./Grid.c94a65f1.js";import{b as Te,F as M,c as Ne}from"./Style.57c2f24e.js";import{D as ve}from"./Drawer.235ac29e.js";import{D as Ee}from"./Divider.5bf28fe6.js";import"./ArrowRight.60cb55a6.js";import"./Card.693f787f.js";import"./CardContent.6cf6a0bd.js";import"./List.cdccc7e3.js";import"./listItemButtonClasses.1e7433d2.js";import"./isMuiElement.b8c25462.js";import"./listItemTextClasses.ceb65530.js";import"./dividerClasses.5f8b1a07.js";import"./Switch.b6bca3ce.js";import"./SwitchBase.a60f2df5.js";import"./useFormControl.d77c63c8.js";import"./useControlled.4ac3feb9.js";import"./Select.479df9cf.js";import"./Close.d5ab550d.js";import"./Popper.d456f48c.js";import"./Chip.79007557.js";const Me="zTZ5",Ae="-wYE",A={LeadDataFieldItem:Me,OptionMenuPaper:Ae},Be={px:{xs:0,md:2}},He=({display_name:n,field_name:d,field_type:p,id:c})=>{const{setErrorMessage:s,setSuccessMessage:l}=k(),{setEditLeadDataId:h,setShowLeadDataForm:u}=T(),[m,f]=o.exports.useState(null),[w,y]=o.exports.useState(!1),F=()=>{y(!0)},b=()=>{y(!1)},C=i=>{f(i.currentTarget)},r=()=>{f(null)},t=async()=>{try{const i=await x.deleteLeadDataField(c);if(!i.success)throw Error(i.message);l(i.message),setTimeout(()=>window.location.reload(),1e3)}catch(i){s(i.message)}finally{b()}};return a(o.exports.Fragment,{children:[a(ue,{component:"div",sx:Be,children:[e(fe,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:n}),e("h2",{className:"type",children:p==="string"?"Text":p})]}),secondary:`[${d}]`,className:A.LeadDataFieldItem}),e(Fe,{children:e(g,{onClick:C,children:e(ge,{})})})]}),Boolean(m)&&a(ye,{anchorEl:m,open:Boolean(m),onClose:r,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:A.OptionMenuPaper},children:[e(D,{onClick:()=>{h(c),u(!0),r()},children:"Edit"}),e(D,{onClick:()=>{F(),r()},children:"Delete"})]}),a(V,{open:w,"aria-labelledby":"responsive-dialog-title",children:[e(q,{id:"responsive-dialog-title",children:"Delete"}),e(z,{children:"Are you sure you want to delete?"}),a(W,{children:[e(N,{color:"secondary",onClick:()=>{b()},children:"Cancel"}),e(N,{onClick:async()=>{await t()},autoFocus:!0,children:"Delete"})]})]})]})},Oe=({isSearchActive:n,setSearchActive:d})=>{const{setLeadDataFilter:p,setShowLeadDataForm:c}=T();return a(re,{children:[e(ie,{children:e(S,{disableIcon:!0,type:"button",onClick:()=>c(!0),className:"small",children:"New Lead Data Field"})}),a(le,{children:[!n&&e(se,{children:e(oe,{children:"Lead Data Fields"})}),a(ne,{children:[n&&e(O,{children:a(R,{children:[e(g,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(_,{})}),e(j,{onChange:({target:{value:s}})=>p(s),placeholder:"Search Field"}),e(g,{onClick:()=>{p(""),d(!n)},sx:{position:"absolute",right:0,top:0},children:e(P,{})})]})}),!n&&e(g,{onClick:()=>d(s=>!s),children:e(_,{})})]})]})]})},Re=({control:n,defaultValue:d,rules:p,name:c,children:s,setValue:l,...h})=>e(Ce,{rules:p,control:n,name:c,render:({field:u})=>e(be,{multiple:!0,options:d,onChange:(m,f)=>{l(u.name,f)},freeSolo:!0,renderInput:m=>e(Le,{...m,variant:"filled",label:h.label,sx:h.sx})})}),je=({open:n,closeDrawer:d})=>{const{setErrorMessage:p,setSuccessMessage:c}=k(),{editLeadDataId:s}=B(),{control:l,handleSubmit:h,watch:u,reset:m,setValue:f}=De({defaultValues:{field_type:"",display_name:"",field_name:"",display_in_filter:!1,use_lead_title:!1}}),{field_type:w,display_name:y,field_options:F}=u(),b=async t=>{try{if(console.log(t),s){const i=await x.updateLeadDataField(s,t);if(!i.success)throw Error(i.message);c(i.message),setTimeout(()=>window.location.reload(),1e3)}else{const i=await x.createLeadDataField(t);if(!i.success)throw Error(i.message);c(i.message),setTimeout(()=>window.location.reload(),1e3)}}catch(i){p(i.message)}finally{d()}},C=o.exports.useCallback(()=>f("field_name",y.toLowerCase().replaceAll(" ","_")),[y]),r=o.exports.useCallback(async()=>{try{if(s){const t=await x.getLeadDataField(s);if(!t.success)throw Error(t.message);m({field_type:t.payload.field_type,display_name:t.payload.display_name,field_name:t.payload.field_name,display_in_filter:t.payload.display_in_filter,use_lead_title:t.payload.mark_as_lead_title,field_options:t.payload.field_options?t.payload.field_options:[]})}}catch(t){console.error(t.message)}},[s]);return o.exports.useEffect(()=>{C()},[C]),o.exports.useEffect(()=>{r()},[r]),e(ve,{anchor:"right",open:n,onClose:(t,i)=>!X(i)&&d(),sx:{zIndex:"modal"},children:a(we,{children:[a(xe,{children:[e(g,{onClick:d,className:"icon-md-button",children:e(H,{})}),e(_e,{children:`${s?"Edit":"Create a"} Data Field`})]}),a(Se,{onSubmit:h(b),children:[e(Ie,{children:a(ke,{children:[e(L,{children:a(I,{select:!0,control:l,label:"Data Field Type",name:"field_type",sx:Te,required:!0,defaultValue:w,children:[e(D,{value:"",disabled:!0,children:"Select Data Field Type"}),e(D,{value:"numeric",children:"Number"}),e(D,{value:"string",children:"Text"}),e(D,{value:"boolean",children:"Boolean"}),e(D,{value:"date",children:"Date"})]})}),e(L,{children:e(I,{control:l,name:"display_name",label:"Display Name",placeholder:"Display Name",required:!0,sx:M})}),e(L,{children:e(I,{control:l,name:"field_name",label:"Field Name",placeholder:"Field Name",required:!0,sx:M})}),e(L,{children:e(Re,{control:l,setValue:f,defaultValue:F!=null?F:[],name:"field_options",label:"Options",sx:Ne})}),e(L,{children:a("div",{className:"d-flex justify-content-between",children:[a("div",{className:"grow",children:[e("h5",{className:"field-title",children:"Display Field in Filters & Analytics?"}),e("small",{className:"field-subtitle",children:"This field will be displayed in filter option and analytics can be drawn on this field."})]}),e(E,{control:l,name:"display_in_filter"})]})}),e(L,{children:a("div",{className:"d-flex justify-content-between",children:[a("div",{className:"grow",children:[e("h5",{className:"field-title",children:"Use as Lead Title"}),e("small",{className:"field-subtitle",children:"If a value is available in the field it will show as the default title instead of the phone number in the Chat section."})]}),e(E,{control:l,name:"use_lead_title"})]})})]})}),e(U,{children:e(S,{type:"submit",children:"Save"})})]})]})})},Pe=()=>{const{isMobile:n,isTablet:d}=$(),{setErrorMessage:p}=k(),[c,s]=o.exports.useState(!0),[l,h]=o.exports.useState(!1),{leadDataFields:u,leadDataFilter:m,showLeadDataForm:f}=B(),{setLeadDataFields:w,setLeadDataFilter:y,setShowLeadDataForm:F,setEditLeadDataId:b}=T(),C=o.exports.useCallback(async()=>{try{const r=await x.getLeadDataFields();if(!r.success)throw Error(r.message);w(r.payload),s(!1)}catch(r){p(r.message)}},[]);return o.exports.useEffect(()=>{C()},[C]),c?e(v,{className:he.AbsCenter,children:e(G,{height:72,width:72})}):a(o.exports.Fragment,{children:[e(Z,{children:e("title",{children:"Lead Data Fields"})}),n&&a(Y,{children:[!l&&e(g,{component:K,to:"/business-settings",className:"icon-md-button",children:e(H,{})}),!l&&e(J,{children:"Lead Data Fields"}),l&&e(O,{children:a(R,{children:[e(g,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(_,{})}),e(j,{onChange:({target:{value:r}})=>y(r),placeholder:"Search Field"}),e(g,{onClick:()=>{y(""),h(!l)},sx:{position:"absolute",right:0,top:0},children:e(P,{})})]})}),!l&&u.length>0&&e(g,{onClick:()=>h(r=>!r),children:e(_,{})})]}),e(Q,{children:e(ee,{children:!c&&e(v,{elevation:0,children:e(de,{children:u.length===0?a(ae,{children:[e(ce,{children:e(S,{disableIcon:!0,onClick:()=>F(!0),className:"small",children:"New Lead Data Field"})}),e(me,{children:e(pe,{children:"Lead Data Field creates an input field for your user, where the value input by a user can be stored and be later retrieved for different users to draw an analytical comparison or as a future reference."})})]}):a(o.exports.Fragment,{children:[d&&e(Oe,{isSearchActive:l,setSearchActive:h}),d&&e(Ee,{}),u.filter(r=>{var t;return(t=r==null?void 0:r.display_name)==null?void 0:t.toLowerCase().includes(m==null?void 0:m.toLowerCase())}).reverse().map((r,t)=>e(He,{...r},t))]})})})})}),n&&u.length>0&&e(te,{children:e(S,{onClick:()=>F(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Lead Data Field"})}),e(je,{open:f,closeDrawer:()=>{b(void 0),F(!1)}})]})},Ta=()=>e(o.exports.Fragment,{children:e(Pe,{})});export{Ta as default};
