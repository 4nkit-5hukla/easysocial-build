import{l as Ye,m as Qe,n as me,i as re,r as i,p as je,_ as Ke,T as oe,j as e,a,q as Ge,w as Ze,$ as ne,aY as le,a0 as N,as as Je,at as et,au as tt,av as at,e as We,aZ as ue,a_ as Le,u as he,ar as Re,aF as st,W as rt,L as ot}from"./index.c29906d9.js";import{W as q,a as Fe}from"./WaTemplatePreviewCard.03292bc5.js";import{a as z,D as nt,b as lt,c as it,d as ct,F as ae,G as se,e as O,S as dt,A as be}from"./CommonComponents.19bc1f38.js";import{L as ye}from"./LeftArrow.446c46a7.js";import{S as pe}from"./Search.e86890d3.js";import{L as pt}from"./LinkPlatForm.657e5615.js";import{c as mt,d as B}from"./WhatsApp.00540be5.js";import{L as ut}from"./ListItem.ed6b71ff.js";import{a as ht,L as ft}from"./ListItemText.f3cc5249.js";import{C as gt}from"./Chip.b0018fe7.js";import{M as Ct}from"./MoreVert.fc18116b.js";import{M as xt}from"./Menu.16825190.js";import{M as H}from"./MenuItem.4f2dea93.js";import{a2 as bt,a3 as Tt,a4 as yt,a5 as wt,a6 as vt,a7 as St,a8 as He,a9 as Be,aa as Ae,u as _,ab as ce,ac as Te,ad as de,ae as J,L as ie,af as Me,n as De,H as ke,ag as Et,ah as Wt,o as Ft,ai as Mt,p as It,q as Lt,aj as Rt,ak as Ht,l as Bt,m as At,al as Dt,J as kt,am as Pt,I as Ot,an as Nt}from"./Tags.6ca621ce.js";import{C as Pe}from"./Clear.2cc778af.js";import{F as A,u as Oe}from"./FormTextField.00a6841d.js";import{F as ge}from"./FormIOSSwitch.efaf5b0e.js";import{f as j,F as Z,g as $t,h as Ce}from"./Styles.5fa2ae96.js";import{C as we}from"./Card.3ffcfa5c.js";import{g as Vt}from"./mui-tel-input.es.0664b72c.js";import{D as Ne}from"./Drawer.ae54c5bf.js";import{T as Ut}from"./TextField.9bac1ff1.js";import{F as _t}from"./FileUpload.98757f5e.js";import{F as xe}from"./index.3f3fb2a1.js";import{L as qt}from"./Link.276d7e69.js";import{C as zt}from"./CardContent.0a2884b0.js";import{D as Xt}from"./Divider.7609976a.js";import"./Play.af81fde7.js";import"./ArrowRight.ff6eee72.js";import"./List.34ece043.js";import"./listItemButtonClasses.0531b597.js";import"./isMuiElement.428b02c5.js";import"./listItemTextClasses.790f16ab.js";import"./withStyles.5a0d8adc.js";import"./Switch.de4a5474.js";import"./SwitchBase.2f02fa63.js";import"./Select.fa6fb31f.js";import"./useControlled.ab47f4d5.js";import"./InputAdornment.dbca860e.js";import"./AssetsApi.5c02b8b4.js";function Yt(s){return Qe("MuiCardHeader",s)}const Qt=Ye("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Ie=Qt,jt=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],Kt=s=>{const{classes:o}=s;return Ze({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},Yt,o)},Gt=me("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(s,o)=>re({[`& .${Ie.title}`]:o.title,[`& .${Ie.subheader}`]:o.subheader},o.root)})({display:"flex",alignItems:"center",padding:16}),Zt=me("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(s,o)=>o.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),Jt=me("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(s,o)=>o.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ea=me("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(s,o)=>o.content})({flex:"1 1 auto"}),ta=i.exports.forwardRef(function(o,p){const S=je({props:o,name:"MuiCardHeader"}),{action:I,avatar:d,className:C,component:E="div",disableTypography:g=!1,subheader:T,subheaderTypographyProps:W,title:D,titleTypographyProps:f}=S,h=Ke(S,jt),F=re({},S,{component:E,disableTypography:g}),y=Kt(F);let x=D;x!=null&&x.type!==oe&&!g&&(x=e(oe,re({variant:d?"body2":"h5",className:y.title,component:"span",display:"block"},f,{children:x})));let m=T;return m!=null&&m.type!==oe&&!g&&(m=e(oe,re({variant:d?"body2":"body1",className:y.subheader,color:"text.secondary",component:"span",display:"block"},W,{children:m}))),a(Gt,re({className:Ge(y.root,C),as:E,ref:p,ownerState:F},h,{children:[d&&e(Zt,{className:y.avatar,ownerState:F,children:d}),a(ea,{className:y.content,ownerState:F,children:[x,m]}),I&&e(Jt,{className:y.action,ownerState:F,children:I})]}))}),$e=ta,aa=({color:s="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:s})}),sa=({template_status:s,name:o,id:p,description:S})=>{const{setErrorMessage:I,setSuccessMessage:d}=ne(),{setEditWaTemplateId:C,setShowWaTemplateForm:E,setPreviewWaTemplateId:g,setShowWaTemplatePreview:T}=le(),[W,D]=i.exports.useState(null),[f,h]=i.exports.useState(!1),F=()=>{h(!0)},y=()=>{h(!1)},x=k=>{D(k.currentTarget)},m=()=>{D(null)},X=async()=>{try{const k=await q.deleteWaTemplateMessage(p);if(!k.success)throw Error(k.message);d(k.message),setTimeout(()=>window.location.reload(),1e3)}catch(k){I(k.message)}finally{y()}};return a(i.exports.Fragment,{children:[a(ut,{component:"div",sx:{px:{xs:0,md:2}},children:[e(ht,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:o}),e(gt,{label:s,size:"small",sx:{bgcolor:mt[s],alignItems:"center",color:"#FFFFFF",borderRadius:1,height:20,"& .MuiChip-label":{px:.5,fontSize:10,fontWeight:900,lineHeight:"12px"}}})]}),secondary:S,sx:{"& .primary-block":{alignItems:"center",display:"flex",flexWrap:"wrap",gap:1.25,marginBottom:.75,"& .list-title":{color:"text.secondary",fontSize:15,fontWeight:500,lineHeight:"18px"}},"& .MuiListItemText-secondary":{color:"text.secondary",fontSize:12,fontWeight:400,lineHeight:"15px"}}}),e(ft,{children:e(N,{onClick:x,children:e(Ct,{})})})]}),Boolean(W)&&a(xt,{anchorEl:W,open:Boolean(W),onClose:m,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},sx:{"& .MuiPaper-root":{minWidth:120}},children:[s==="DRAFT"&&e(H,{onClick:()=>{C(p),E(!0),m()},children:"Edit"}),(s==="SUBMITTED"||s==="APPROVED")&&e(H,{onClick:()=>{g(p),T(!0),m()},children:"Preview"}),e(H,{onClick:()=>{F(),m()},children:"Delete"})]}),a(Je,{open:f,"aria-labelledby":"responsive-dialog-title",children:[e(et,{id:"responsive-dialog-title",children:"Delete"}),e(tt,{children:"Are you sure you want to delete?"}),a(at,{children:[e(We,{color:"secondary",onClick:()=>{y()},children:"Cancel"}),e(We,{onClick:async()=>{await X()},autoFocus:!0,children:"Delete"})]})]})]})},ra=({isSearchActive:s,setSearchActive:o})=>{const{setErrorMessage:p,setSuccessMessage:S}=ne(),{totalWaTemplates:I}=ue(),{setWaTemplateFilter:d,setShowWaTemplateForm:C,setTotalWaTemplates:E,setWaTemplatesData:g}=le(),[T,W]=i.exports.useState(!1),D=async()=>{try{W(!0);const f=await q.syncWaTemplateMessage();if(f.success){const h=await q.getWaTemplateMessages();if(!h.success)throw Error(f.message);E(h.payload.length),g(h.payload),S(f.message)}else p(f.message)}catch(f){p(f.message)}finally{W(!1)}};return a(bt,{children:[e(Tt,{children:e(z,{disableIcon:!0,type:"button",onClick:()=>C(!0),sx:{py:0,px:2,height:36,mt:0},children:"New Template Message"})}),a(yt,{children:[!s&&e(wt,{children:e(vt,{children:`${I} Template Messages`})}),a(St,{children:[s&&e(He,{children:a(Be,{children:[e(N,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ae,{onChange:({target:{value:f}})=>d(f),placeholder:"Search Template"}),e(N,{onClick:()=>{d(""),o(!s)},sx:{position:"absolute",right:0,top:0},children:e(Pe,{})})]})}),!s&&e(N,{onClick:()=>o(f=>!f),children:e(pe,{})}),!s&&e(z,{icon:e(aa,{color:T?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:T,onClick:()=>D(),sx:{alignSelf:"center",borderRadius:4,borderColor:"#0000003b",color:"#000000de",flexDirection:"row-reverse",fontSize:14,fontWeight:400,letterSpacing:"0.02857em",lineHeight:"16px",gap:1,height:30,py:.625,px:1.875,textTransform:"capitalize"},children:T?"Syncing...":"Sync Messages"})]})]})]})},Q=/[{][{]\d{1,3}[}][}]/gm,oa=({index:s,control:o,removeQuickReply:p})=>a(we,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e($e,{title:`Quick Reply ${s+1}`,action:e(N,{"aria-label":`Remove Quick Reply ${s+1}`,onClick:()=>p(s),children:e(Le,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(_,{sx:{my:2},children:e(A,{control:o,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:j})})]},s),na=({index:s,type:o,url:p,phone_number:S,waTemplateButtonCtaTypes:I,control:d,setValue:C,removeCallAction:E})=>{const{country:g}=he(),[T,W]=i.exports.useState(0),D=()=>{if(T===1)return;const h=`${p}{{${1}}}`;C(`components[3].buttons[${s}].url`,h),W(1)},f=i.exports.useCallback(()=>{if(p){const h=p.match(Q);h&&h.length>0?W(1):W(0)}},[p]);return i.exports.useEffect(()=>{f()},[f]),a(we,{sx:{border:"1px solid rgba(0, 0, 0, 0.12)",borderRadius:4,boxShadow:"0px 0px 20px 1px rgba(0, 0, 0, 0.1)",mb:3,p:2,pb:3},elevation:0,children:[e($e,{title:`Call to Action ${s+1}`,action:e(N,{"aria-label":`Remove Call to Action ${s+1}`,onClick:()=>E(s),children:e(Le,{})}),sx:{p:0,"& .MuiCardHeader-title":{fontSize:16,fontWeight:500,lineHeight:"22px"}}}),e(_,{sx:{my:2},children:a(A,{select:!0,control:d,label:"Action Type",name:`components[3].buttons[${s}].type`,sx:Z,required:!0,defaultValue:o,children:[e(H,{value:"",disabled:!0,children:"Select Action Type"}),I.map(({value:h,name:F},y)=>e(H,{value:h,children:F},y))]})}),o!==""&&e(_,{sx:{my:2},children:e(A,{control:d,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:j})}),o==="PHONE_NUMBER"&&e(_,{sx:{my:2},children:e(Vt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:g,value:S!=null?S:"",onChange:h=>{C(`components[3].buttons[${s}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:$t})}),o==="URL"&&a(_,{sx:{my:2},children:[a(ce,{children:[e(A,{control:d,name:`components[3].buttons[${s}].url`,label:"URL",required:!0,sx:{...j,pb:2,height:"auto"}}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",disabled:T===1,onClick:D,children:"ADD VARIABLE"})]}),a(de,{children:[a(J,{children:[p?p.length:0,"/60 Characters"]}),a(J,{children:[T,"/1 Variable"]})]})]})]},s)},la=({open:s,closeDrawer:o})=>{const{setErrorMessage:p,setSuccessMessage:S}=ne(),{businessId:I}=he(),{editWaTemplateId:d,waTemplatesData:C,waTemplateCategories:E,waTemplateLanguages:g,waTemplateTypes:T,waTemplateHeaderTypes:W,waTemplateButtonTypes:D,waTemplateButtonCtaTypes:f}=ue(),{setWaTemplatesData:h,setShowWaPreviewForm:F,setPreviewWaTemplateId:y}=le(),x={name:"",category:"",language:"",template_type:"",businessId:I,components:[{format:"",text:"",type:B.HEADER,active:!1},{text:"",type:B.BODY},{text:"",type:B.FOOTER,active:!1},{buttons:[],type:B.BUTTONS,active:!1}]},{control:m,handleSubmit:X,watch:k,reset:w,setValue:r}=Oe({defaultValues:x}),{name:u,category:L,language:ee,template_type:R,components:K}=k(),M=K.find(({type:t})=>t===B.HEADER),V=K.find(({type:t})=>t===B.BODY),Y=K.find(({type:t})=>t===B.FOOTER),P=K.find(({type:t})=>t===B.BUTTONS),[G,U]=i.exports.useState(0),[l,b]=i.exports.useState(""),v=i.exports.useCallback(()=>{const n=u.match(/^[A-Za-z0-9_]+$/g)===null?u.slice(0,-1):u.replace(/\s/g,"").toLowerCase();r("name",n)},[u]),te=()=>{if(G===1)return;const t=`${M.text}{{${1}}}`;r("components[0].text",t),U(1)},fe=()=>{const t=V.text.match(Q),n=t&&t.length>0?`${V.text}{{${t.length+1}}}`:`${V.text}{{${1}}}`;r("components[1].text",n)},ve=i.exports.useCallback(()=>{const t=M.text.match(Q);t&&t.length>0?U(1):U(0)},[M.text]),Se=i.exports.useCallback(()=>{const t=M.text.match(Q);if(t===null){U(0);return}if(t.length===0){U(0);return}r("components[0].text",t.reduce((n,c,$)=>$===0?n.replace(c,`{{${$+1}}}`):n.replace(c,""),t.reduce((n,c,$)=>n.replace(c,`{{${$+1}}}`),M.text))),U(1)},[M.text]),Ve=()=>{const t=V.text.match(Q);t!==null&&t.length!==0&&r("components[1].text",t.reduce((n,c,$)=>n.replace(c,`{{${$+1}}}`),V.text))},Ue=t=>{b(t.target.value)},_e=()=>{if(l===""&&p("Please Select button Type"),l==="QUICK_REPLY")if(P.buttons.length<3){const t=P.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else p("Limit exceeded");if(l==="CALL_TO_ACTION")if(P.buttons.length<2){const t=P.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else p("Limit exceeded")},qe=t=>{const n=P.buttons;n.splice(t,1),r("components[3].buttons",n)},ze=t=>{const n=P.buttons;n.splice(t,1),r("components[3].buttons",n)},Xe=async t=>{var n;try{if(d){const c=await q.updateWaTemplateMessage(d,t);if(!c.success)throw Error(c.message);S(c.message),y((n=c.payload.id)!=null?n:d),w(x),o(),F(!0)}else{const c=await q.createWaTemplateMessage(t);if(!c.success)throw Error(c.message);S(c.message),h([c.payload,...C]),y(c.payload.id),w(x),o(),F(!0)}}catch(c){p(c.message)}},Ee=i.exports.useCallback(async()=>{try{if(d){const t=await q.getWaTemplateMessage(d);if(!t.success)throw Error(t.message);w(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?b("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&b("CALL_TO_ACTION"))}}catch(t){p(t.message)}},[d]);return i.exports.useEffect(()=>{Ee()},[Ee]),i.exports.useEffect(()=>{v()},[v]),i.exports.useEffect(()=>{Se()},[Se]),i.exports.useEffect(()=>{ve()},[ve]),i.exports.useEffect(()=>{M.active||r("components[0].format","")},[M.active]),i.exports.useEffect(()=>{Y.active||r("components[2].text","")},[Y.active]),e(Ne,{anchor:"right",open:s,onClose:(t,n)=>{Re(n)||(w(x),o())},sx:{zIndex:"modal"},children:a(nt,{sx:{width:{xs:"100vw",md:360}},children:[a(lt,{children:[e(N,{onClick:()=>{w(x),o()},className:"icon-md-button",children:e(ye,{})}),e(it,{children:`${d?"Update":"Create New"} Template`})]}),a(ct,{onSubmit:X(Xe),onReset:()=>{w(x),o()},children:[e(ae,{children:a(se,{children:[e(O,{children:e(A,{control:m,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:j})}),e(O,{children:a(A,{select:!0,control:m,label:"Template Category",name:"category",sx:Z,required:!0,defaultValue:L,children:[e(H,{value:"",disabled:!0,children:"Select Template Category"}),E.map(({value:t,name:n},c)=>e(H,{value:t,children:n},c))]})}),e(O,{children:a(A,{select:!0,control:m,label:"Language",name:"language",sx:Z,required:!0,defaultValue:ee,children:[e(H,{value:"",disabled:!0,children:"Select Language"}),g.map(({code:t,name:n},c)=>e(H,{value:t,children:n},c))]})}),e(O,{children:a(A,{select:!0,control:m,label:"Template Type",name:"template_type",sx:Z,required:!0,defaultValue:R,children:[e(H,{value:"",disabled:!0,children:"Select Template Type"}),T.map(({value:t,label:n},c)=>e(H,{value:t,children:n},c))]})}),R==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Header"})}),e(ge,{control:m,name:"components[0].active"})]})}),R==="media"&&M.active&&e(O,{children:a(A,{select:!0,control:m,label:"Header Type",name:"components[0].format",sx:Z,required:!0,defaultValue:M.format,children:[e(H,{value:"",disabled:!0,children:"Select Header Type"}),W.map(({value:t,name:n},c)=>e(H,{value:t,children:n},c))]})}),R==="media"&&M.active&&M.format==="TEXT"&&a(O,{children:[a(ce,{children:[e(A,{control:m,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Ce}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",disabled:G===1,onClick:te,children:"ADD VARIABLE"})]}),a(de,{children:[a(J,{children:[M.text.length,"/60 Characters"]}),a(J,{children:[G,"/1 Variable"]})]})]}),R!==""&&e(O,{children:e(ie,{children:"Body"})}),R!==""&&a(O,{children:[a(ce,{children:[e(A,{control:m,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Ve,inputProps:{maxLength:1024},sx:Ce}),e(Te,{size:"small",focusRipple:!1,className:"add-variable",onClick:fe,children:"ADD VARIABLE"})]}),e(de,{children:a(J,{children:[V.text.length,"/1024 Characters"]})})]}),R==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Footer"})}),e(ge,{control:m,name:"components[2].active"})]})}),R==="media"&&Y.active&&a(O,{children:[e(ce,{children:e(A,{control:m,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:Ce})}),e(de,{children:a(J,{children:[Y.text.length,"/60 Characters"]})})]}),R==="media"&&e(O,{children:a(ae,{sx:{justifyContent:"space-between"},children:[e(se,{children:e(ie,{children:"Buttons"})}),e(ge,{control:m,name:"components[3].active"})]})}),R==="media"&&P.active&&a(O,{children:[a(ae,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(se,{children:a(Ut,{select:!0,label:"Button Type",sx:Z,required:!0,value:l,onChange:Ue,disabled:P.buttons.length>0,children:[e(H,{value:"",disabled:!0,children:"Select Button Type"}),D.map(({label:t,name:n},c)=>e(H,{value:n,children:t},c))]})}),e(dt,{children:e(z,{variant:"outlined",color:"primary",onClick:_e,disableIcon:!0,children:"Add a Button"})})]}),R==="media"&&P.active&&P.buttons.length>0&&e(i.exports.Fragment,{children:P.buttons.map(({type:t,url:n,phone_number:c},$)=>{switch(t){case"QUICK_REPLY":return e(oa,{index:$,removeQuickReply:qe,control:m},$);default:return e(na,{index:$,type:t,url:n,phone_number:c,waTemplateButtonCtaTypes:f,control:m,setValue:r,removeCallAction:ze},$)}})})]})]})}),a(be,{children:[e(z,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(z,{type:"submit",children:"Preview & Save"})]})]})]})})},ia=({open:s,closeDrawer:o})=>{var Y,P,G,U;const{isMobile:p,isTablet:S}=he(),{setErrorMessage:I,setSuccessMessage:d}=ne(),{previewWaTemplateId:C,previewWaTemplateData:E,showWaPreviewForm:g,showWaTemplatePreview:T}=ue(),{setPreviewWaTemplateData:W,setEditWaTemplateId:D,setShowWaTemplateForm:f}=le(),[h,F]=i.exports.useState([]),y={components:[{format:"",text:"",type:B.HEADER},{text:"",type:B.BODY},{text:"",type:B.FOOTER},{buttons:[],type:B.BUTTONS}]},{control:x,handleSubmit:m,watch:X,setValue:k}=Oe({defaultValues:y}),{components:w}=X(),r=w.find(({type:l})=>l===B.HEADER),u=w.find(({type:l})=>l===B.BODY),L=w.find(({type:l})=>l===B.BUTTONS),ee=(P=(Y=r==null?void 0:r.example)==null?void 0:Y.header_handle)==null?void 0:P[0],R=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,u&&u.text&&u.text!==""&&u.text.includes("{{1}}"),L&&L.buttons.length>0&&((G=L.buttons[0])==null?void 0:G.type)==="URL"&&((U=L.buttons[0])==null?void 0:U.url.includes("{{1}}"))].reduce((l,b)=>l||b,!1),K=async l=>{try{const b=l.components.map(v=>{var te;return v==null||delete v.active,v.type==="HEADER"&&((te=v==null?void 0:v.example)==null||delete te.header_files),v});if(C){console.log(b);const v=await q.updateWaTemplateComponents(C,{components:b});if(!v.success)throw Error(v.message);d(v.message),o()}}catch(b){I(b.message)}},M=i.exports.useCallback(()=>{w.length>0&&w.forEach(({type:l,text:b})=>{if(l==="BODY"){const v=b.match(Q);v&&F(v.map((te,fe)=>fe+1))}})},[w]),V=i.exports.useCallback(async()=>{try{if(C){const l=await q.getWaTemplateMessage(C);if(!l.success)throw Error(l.message);W(l.payload),k("components",l.payload.components)}}catch(l){I(l.message)}},[C]);return i.exports.useEffect(()=>{V()},[V]),i.exports.useEffect(()=>{M()},[M]),a(Ne,{anchor:"right",open:s,onClose:(l,b)=>{(!Re(b)||T)&&o()},sx:{zIndex:"modal","& .MuiPaper-root.MuiDrawer-paper":{flexDirection:"row-reverse"}},children:[a(Me,{sx:{width:{xs:"100vw",md:360}},children:[s&&a(De,{children:[e(N,{onClick:()=>{o()},className:"icon-md-button",children:e(ye,{})}),e(ke,{children:R&&!T?"Enter Sample Values":"Preview Template"})]}),s&&a(Et,{onSubmit:m(K),children:[(!R||T||p)&&E&&e(Fe,{components:E.components}),g&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e(_,{children:e(_t,{setValue:k,control:x,fileTypes:r.format==="IMAGE"?xe.IMAGE:r.format==="VIDEO"?xe.VIDEO:xe.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:ee!=null?ee:"",width:"100%"})}),g&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e(_,{children:e(A,{control:x,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:j})}),g&&h.length>0&&h.map((l,b)=>e(_,{children:e(A,{control:x,name:`components[1].example.body_text[${b}]`,label:`Body Variable ${l}`,placeholder:`Body ${l}`,required:!0,sx:j})},`bodyVar{{${l}}}`)),g&&L&&L.buttons&&L.buttons.length>0&&L.buttons.map((l,b)=>(console.log(l.url),l.type==="URL"&&l.url.match(Q)?e(_,{children:e(A,{control:x,name:`components[3].buttons[${b}].example[0]`,label:`URL Button ${b+1}`,placeholder:`Url button ${b+1} variable 1`,required:!0,sx:j})},b):null)),g&&e(be,{children:e(z,{type:"submit",children:"Submit for Approval"})}),g&&a(be,{sx:{alignItems:"center",justifyContent:"center",gap:.625,my:2},children:[e(oe,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(qt,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{D(C),f(!0),o()},children:"Continue Editing"})]})]})]}),!T&&s&&R&&S&&e(Me,{sx:{borderRight:"1px solid #24272c1a",py:11.25,px:6.25,width:360},children:e(Fe,{components:w})})]})},ca=()=>{const{isMobile:s,isTablet:o}=he(),{setErrorMessage:p}=ne(),[S,I]=i.exports.useState(!0),[d,C]=i.exports.useState(!1),{waTemplatesData:E,waTemplateFilter:g,showWaTemplateForm:T,showWaPreviewForm:W,showWaTemplatePreview:D}=ue(),{setWaTemplatesData:f,setTotalWaTemplates:h,setWaTemplateFilter:F,setShowWaTemplateForm:y,setShowWaPreviewForm:x,setShowWaTemplatePreview:m,setEditWaTemplateId:X,setPreviewWaTemplateId:k}=le(),{platformExist:w}=st(),r=i.exports.useCallback(async()=>{try{if(typeof w=="boolean"&&w){const u=await q.getWaTemplateMessages();if(!u.success)throw Error(u.message);h(u.payload.length),f(u.payload)}}catch(u){p(u.message)}finally{I(!1)}},[w]);return i.exports.useEffect(()=>{r()},[r]),a(i.exports.Fragment,{children:[e(rt,{children:e("title",{children:"WhatsApp Template Messages"})}),s&&a(De,{sx:Wt,children:[!d&&e(N,{component:ot,to:"/business-settings",className:"icon-md-button",children:e(ye,{})}),!d&&e(ke,{children:"Template Messages"}),d&&e(He,{children:a(Be,{children:[e(N,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(pe,{})}),e(Ae,{onChange:({target:{value:u}})=>F(u),placeholder:"Search Template"}),e(N,{onClick:()=>{F(""),C(!d)},sx:{position:"absolute",right:0,top:0},children:e(Pe,{})})]})}),!d&&E.length>0&&e(N,{onClick:()=>C(u=>!u),children:e(pe,{})})]}),e(Ft,{sx:Mt,children:typeof w=="boolean"&&w===!1?e(It,{sx:Lt,children:e(pt,{})}):e(Rt,{sx:Ht,children:!S&&e(we,{elevation:0,sx:Bt,children:e(zt,{sx:At,children:E.length===0?a(Dt,{children:[e(kt,{children:e(z,{disableIcon:!0,onClick:()=>y(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Pt,{children:a(Ot,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(i.exports.Fragment,{children:[o&&e(ra,{isSearchActive:d,setSearchActive:C}),o&&e(Xt,{}),E.filter(u=>{var L;return(L=u==null?void 0:u.name)==null?void 0:L.toLowerCase().includes(g==null?void 0:g.toLowerCase())}).map((u,L)=>e(sa,{...u},L))]})})})})}),s&&E.length>0&&e(Nt,{children:e(z,{onClick:()=>y(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(la,{open:T,closeDrawer:()=>{X(void 0),y(!1)}}),e(ia,{open:W||D,closeDrawer:()=>{k(void 0),x(!1),m(!1)}})]})},Ka=()=>e(ca,{});export{Ka as default};
