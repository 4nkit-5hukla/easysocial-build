import{i as pt,k as mt,s as pe,g as se,r as n,l as ut,_ as ht,T as oe,j as e,a,m as ft,q as Ct,am as re,aP as ne,aQ as gt,V as k,aR as me,aS as Le,u as ue,ax as Ie,aH as Tt,an as bt,W as yt,L as xt}from"./index.cec7120b.js";import{C as vt,W as _,a as Fe}from"./WaTemplatePreviewCard.7e2c45e7.js";import{L as ve}from"./LeftArrow.6eedcb3f.js";import{S as de}from"./Search.38359f57.js";import{c as Re,H as Pe,d as wt,I as We,g as St,h as Et}from"./Wrappers.abfff74b.js";import{a as q,F as D,c as ie,V as be,d as ce,e as G,A as ye,b as le}from"./Form.eda6b8a2.js";import{S as Ne,a as He,b as Oe}from"./Search.6a491723.js";import{b as Ft,c as Wt,d as Mt,e as Bt,f as At,g as Lt,C as Me,a as It}from"./Card.7d81a84a.js";import{C as Rt,a as Pt,b as Nt}from"./Cta.dafc182e.js";import Ht from"./LinkPlatForm.f6de4b11.js";import{p as Ot}from"./Position.module.ff7b7fa6.js";import{W as kt,a as R}from"./WhatsApp.0df87c02.js";import{L as $t}from"./ListItem.50acb701.js";import{a as Dt,L as Vt}from"./ListItemText.81891b6a.js";import{C as Ut}from"./Chip.d20e2cb4.js";import{M as _t}from"./MoreVert.cefa0d3b.js";import{M as qt}from"./Menu.ad604829.js";import{M as I}from"./MenuItem.d46dccf0.js";import{C as ke}from"./Clear.7aeecb79.js";import{F as P,u as $e}from"./FormTextField.019c4658.js";import{D as xe,a as Qt,b as Yt,c as De}from"./Drawer.325bda58.js";import{F as ee,G as te,S as Xt}from"./Grid.4237a7b2.js";import{F as z,a as ae,d as fe}from"./Style.ced39dc3.js";import{F as Ce}from"./FormIOSSwitch.2c45b0d3.js";import{C as Ve}from"./Card.f238ca4f.js";import{g as zt}from"./mui-tel-input.es.906b34ab.js";import{F as jt,e as Kt}from"./Styles.c059562f.js";import{T as Gt}from"./TextField.9a0b3901.js";import{D as Ue}from"./Drawer.ef286880.js";import{F as Zt}from"./FileUpload.d0c28750.js";import{F as ge}from"./FileType.118a3b25.js";import{L as Jt}from"./Link.947db9d7.js";import{D as ea}from"./Divider.d6fdd8a2.js";import"./Play.84bd0e9f.js";import"./ArrowRight.1466b508.js";import"./CardContent.cf5d0c9f.js";import"./Styles.3864ecd6.js";import"./Tags.ee0d55e5.js";import"./toConsumableArray.52b4c8e6.js";import"./styled.d7c606db.js";import"./List.f61e1c40.js";import"./CommonComponents.cbef5ad1.js";import"./listItemTextClasses.1b518b65.js";import"./dividerClasses.25d8e604.js";import"./listItemButtonClasses.bb70bebf.js";import"./isMuiElement.d9d5f399.js";import"./Switch.c4c1f1d9.js";import"./SwitchBase.6c03fb46.js";import"./useFormControl.2e215265.js";import"./useControlled.5f64f480.js";import"./InputAdornment.ebd1d839.js";import"./Select.ed33f368.js";import"./AssetsApi.e8d049af.js";import"./index.de7cc619.js";import"./tslib.es6.61e9e735.js";function ta(s){return mt("MuiCardHeader",s)}const aa=pt("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Be=aa,sa=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],oa=s=>{const{classes:o}=s;return Ct({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},ta,o)},ra=pe("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(s,o)=>se({[`& .${Be.title}`]:o.title,[`& .${Be.subheader}`]:o.subheader},o.root)})({display:"flex",alignItems:"center",padding:16}),na=pe("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(s,o)=>o.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),la=pe("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(s,o)=>o.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),ia=pe("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(s,o)=>o.content})({flex:"1 1 auto"}),ca=n.exports.forwardRef(function(o,p){const y=ut({props:o,name:"MuiCardHeader"}),{action:B,avatar:d,className:g,component:E="div",disableTypography:C=!1,subheader:x,subheaderTypographyProps:F,title:N,titleTypographyProps:f}=y,h=ht(y,sa),W=se({},y,{component:E,disableTypography:C}),w=oa(W);let T=N;T!=null&&T.type!==oe&&!C&&(T=e(oe,se({variant:d?"body2":"h5",className:w.title,component:"span",display:"block"},f,{children:T})));let m=x;return m!=null&&m.type!==oe&&!C&&(m=e(oe,se({variant:d?"body2":"body1",className:w.subheader,color:"text.secondary",component:"span",display:"block"},F,{children:m}))),a(ra,se({className:ft(w.root,g),as:E,ref:p,ownerState:W},h,{children:[d&&e(na,{className:w.avatar,ownerState:W,children:d}),a(ia,{className:w.content,ownerState:W,children:[T,m]}),B&&e(la,{className:w.action,ownerState:W,children:B})]}))}),_e=ca,da=({color:s="#4D4D4D"})=>e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"//www.w3.org/2000/svg",children:e("path",{d:"M12.537 9.457H9.366C9.18035 9.457 9.0023 9.53075 8.87103 9.66203C8.73975 9.7933 8.666 9.97135 8.666 10.157C8.666 10.3427 8.73975 10.5207 8.87103 10.652C9.0023 10.7832 9.18035 10.857 9.366 10.857H11.046C10.2739 11.6639 9.27808 12.2215 8.18661 12.4582C7.09515 12.6948 5.95785 12.5997 4.92084 12.1851C3.88384 11.7704 2.99451 11.0552 2.36711 10.1312C1.73972 9.20727 1.40292 8.11683 1.4 7C1.4 6.81435 1.32625 6.6363 1.19497 6.50503C1.0637 6.37375 0.885652 6.3 0.7 6.3C0.514348 6.3 0.336301 6.37375 0.205025 6.50503C0.0737498 6.6363 0 6.81435 0 7C0.00370066 8.36696 0.407555 9.70292 1.16172 10.843C1.91589 11.9831 2.98737 12.8775 4.24392 13.4157C5.50047 13.9539 6.88711 14.1124 8.23271 13.8716C9.57831 13.6309 10.824 13.0015 11.816 12.061V13.3C11.816 13.4857 11.8897 13.6637 12.021 13.795C12.1523 13.9263 12.3303 14 12.516 14C12.7017 14 12.8797 13.9263 13.011 13.795C13.1423 13.6637 13.216 13.4857 13.216 13.3V10.15C13.2143 9.96914 13.1426 9.79598 13.016 9.66679C12.8895 9.5376 12.7178 9.46242 12.537 9.457ZM7 0C5.20547 0.00511853 3.48144 0.69924 2.184 1.939V0.7C2.184 0.514348 2.11025 0.336301 1.97897 0.205025C1.8477 0.0737498 1.66965 0 1.484 0C1.29835 0 1.1203 0.0737498 0.989025 0.205025C0.85775 0.336301 0.784 0.514348 0.784 0.7V3.85C0.784 4.03565 0.85775 4.2137 0.989025 4.34497C1.1203 4.47625 1.29835 4.55 1.484 4.55H4.634C4.81965 4.55 4.9977 4.47625 5.12897 4.34497C5.26025 4.2137 5.334 4.03565 5.334 3.85C5.334 3.66435 5.26025 3.4863 5.12897 3.35503C4.9977 3.22375 4.81965 3.15 4.634 3.15H2.954C3.72573 2.34351 4.72086 1.78605 5.81168 1.54918C6.90249 1.3123 8.03921 1.40682 9.07592 1.8206C10.1126 2.23439 11.002 2.94855 11.63 3.87142C12.2579 4.7943 12.5957 5.88377 12.6 7C12.6 7.18565 12.6737 7.3637 12.805 7.49497C12.9363 7.62625 13.1143 7.7 13.3 7.7C13.4857 7.7 13.6637 7.62625 13.795 7.49497C13.9263 7.3637 14 7.18565 14 7C14 6.08075 13.8189 5.17049 13.4672 4.32122C13.1154 3.47194 12.5998 2.70026 11.9497 2.05025C11.2997 1.40024 10.5281 0.884626 9.67878 0.532843C8.8295 0.18106 7.91925 0 7 0Z",fill:s})}),pa={px:{xs:3.75,md:2},"&:hover":{bgcolor:"#edfaff"}},ma="yMNf",ua="xmX7",Ae={WTMItem:ma,OptionMenuPaper:ua},ha=({template_status:s,name:o,id:p,description:y})=>{const{setErrorMessage:B,setSuccessMessage:d}=re(),{setEditWaTemplateId:g,setShowWaTemplateForm:E,setPreviewWaTemplateId:C,setShowWaTemplatePreview:x}=ne(),[F,N]=n.exports.useState(null),[f,h]=n.exports.useState(!1),W=()=>{h(!0)},w=()=>{h(!1)},T=H=>{N(H.currentTarget)},m=()=>{N(null)},Q=async()=>{try{const H=await _.deleteWaTemplateMessage(p);if(!H.success)throw Error(H.message);d(H.message),setTimeout(()=>window.location.reload(),1e3)}catch(H){B(H.message)}finally{w()}};return a(n.exports.Fragment,{children:[a($t,{component:"div",sx:pa,children:[e(Dt,{primary:a("div",{className:"primary-block",children:[e("h2",{className:"list-title",children:o}),e(Ut,{label:s,size:"small",sx:{bgcolor:kt[s]}})]}),secondary:gt(`${y.replaceAll(`
`," ").trim().slice(0,400)}${y.length>400?"...":""}`),className:Ae.WTMItem}),e(Vt,{children:e(k,{onClick:T,children:e(_t,{})})})]}),Boolean(F)&&a(qt,{anchorEl:F,open:Boolean(F),onClose:m,keepMounted:!0,MenuListProps:{"aria-labelledby":"Options"},anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},classes:{paper:Ae.OptionMenuPaper},children:[s==="DRAFT"&&e(I,{onClick:()=>{g(p),E(!0),m()},children:"Edit"}),(s==="SUBMITTED"||s==="APPROVED")&&e(I,{onClick:()=>{C(p),x(!0),m()},children:"Preview"}),e(I,{onClick:()=>{W(),m()},children:"Delete"})]}),e(vt,{title:"Delete",open:f,setOpen:h,onConfirm:async()=>await Q(),positiveLabel:"Delete",negativeLabel:"Cancel",children:"Are you sure you want to delete?"})]})},fa=({isSearchActive:s,setSearchActive:o})=>{const{setErrorMessage:p,setSuccessMessage:y}=re(),{totalWaTemplates:B}=me(),{setWaTemplateFilter:d,setShowWaTemplateForm:g,setTotalWaTemplates:E,setWaTemplatesData:C}=ne(),[x,F]=n.exports.useState(!1),N=async()=>{try{F(!0);const f=await _.syncWaTemplateMessage();if(f.success){const h=await _.getWaTemplateMessages();if(!h.success)throw Error(f.message);E(h.payload.length),C(h.payload),y(f.message)}else p(f.message)}catch(f){p(f.message)}finally{F(!1)}};return a(Ft,{children:[e(Wt,{children:e(q,{disableIcon:!0,type:"button",onClick:()=>g(!0),className:"small",children:"New Template Message"})}),a(Mt,{children:[!s&&e(Bt,{children:e(At,{children:`${B} Template Messages`})}),a(Lt,{children:[s&&e(Ne,{children:a(He,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute",right:0,top:0},children:e(de,{})}),e(Oe,{onChange:({target:{value:f}})=>d(f),placeholder:"Search Template"}),e(k,{onClick:()=>{d(""),o(!s)},sx:{position:"absolute",right:0,top:0},children:e(ke,{})})]})}),!s&&e(k,{onClick:()=>o(f=>!f),children:e(de,{})}),!s&&e(q,{icon:e(da,{color:x?"#00000042":"#4D4D4D"}),variant:"outlined",type:"button",disabled:x,onClick:()=>N(),className:"sync",children:x?"Syncing...":"Sync Messages"})]})]})]})},X=/[{][{]\d{1,3}[}][}]/gm,Ca="oIEe",ga="CaIb",qe={QrButtonCard:Ca,CtaButtonCard:ga},Ta=({index:s,control:o,removeQuickReply:p})=>a(Ve,{className:qe.QrButtonCard,elevation:0,children:[e(_e,{title:`Quick Reply ${s+1}`,action:e(k,{"aria-label":`Remove Quick Reply ${s+1}`,onClick:()=>p(s),children:e(Le,{})})}),e(D,{sx:{my:2},children:e(P,{control:o,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:z})})]},s),ba=({index:s,type:o,url:p,phone_number:y,waTemplateButtonCtaTypes:B,control:d,setValue:g,removeCallAction:E})=>{const{country:C}=ue(),[x,F]=n.exports.useState(0),N=()=>{if(x===1)return;const h=`${p}{{${1}}}`;g(`components[3].buttons[${s}].url`,h),F(1)},f=n.exports.useCallback(()=>{if(p){const h=p.match(X);h&&h.length>0?F(1):F(0)}},[p]);return n.exports.useEffect(()=>{f()},[f]),a(Ve,{className:qe.CtaButtonCard,elevation:0,children:[e(_e,{title:`Call to Action ${s+1}`,action:e(k,{"aria-label":`Remove Call to Action ${s+1}`,onClick:()=>E(s),children:e(Le,{})})}),e(D,{sx:{my:2},children:a(P,{select:!0,control:d,label:"Action Type",name:`components[3].buttons[${s}].type`,sx:jt,required:!0,defaultValue:o,children:[e(I,{value:"",disabled:!0,children:"Select Action Type"}),B.map(({value:h,name:W},w)=>e(I,{value:h,children:W},w))]})}),o!==""&&e(D,{sx:{my:2},children:e(P,{control:d,name:`components[3].buttons[${s}].text`,label:"Label",required:!0,sx:z})}),o==="PHONE_NUMBER"&&e(D,{sx:{my:2},children:e(zt,{label:"Phone",placeholder:"Phone",required:!0,fullWidth:!0,defaultCountry:C,value:y!=null?y:"",onChange:h=>{g(`components[3].buttons[${s}].phone_number`,h.replaceAll(" ",""))},variant:"filled",sx:Kt})}),o==="URL"&&a(D,{sx:{my:2},children:[a(ie,{children:[e(P,{control:d,name:`components[3].buttons[${s}].url`,label:"URL",required:!0,sx:{...z,pb:2,height:"auto"}}),e(be,{size:"small",focusRipple:!1,className:"add-variable",disabled:x===1,onClick:N,children:"ADD VARIABLE"})]}),a(ce,{children:[a(G,{children:[p?p.length:0,"/60 Characters"]}),a(G,{children:[x,"/1 Variable"]})]})]})]},s)},ya=({open:s,closeDrawer:o})=>{const{setErrorMessage:p,setSuccessMessage:y}=re(),{businessId:B}=ue(),{editWaTemplateId:d,waTemplatesData:g,waTemplateCategories:E,waTemplateLanguages:C,waTemplateTypes:x,waTemplateHeaderTypes:F,waTemplateButtonTypes:N,waTemplateButtonCtaTypes:f}=me(),{setWaTemplatesData:h,setShowWaPreviewForm:W,setPreviewWaTemplateId:w}=ne(),T={name:"",category:"",language:"",template_type:"",businessId:B,components:[{format:"",text:"",type:R.HEADER,active:!1},{text:"",type:R.BODY},{text:"",type:R.FOOTER,active:!1},{buttons:[],type:R.BUTTONS,active:!1}]},{control:m,handleSubmit:Q,watch:H,reset:v,setValue:r}=$e({defaultValues:T}),{name:u,category:A,language:Z,template_type:L,components:j}=H(),M=j.find(({type:t})=>t===R.HEADER),V=j.find(({type:t})=>t===R.BODY),Y=j.find(({type:t})=>t===R.FOOTER),O=j.find(({type:t})=>t===R.BUTTONS),[K,U]=n.exports.useState(0),[i,b]=n.exports.useState(""),S=n.exports.useCallback(()=>{const l=u.match(/^[A-Za-z0-9_]+$/g)===null?u.slice(0,-1):u.replace(/\s/g,"").toLowerCase();r("name",l)},[u]),J=()=>{if(K===1)return;const t=`${M.text}{{${1}}}`;r("components[0].text",t),U(1)},he=()=>{const t=V.text.match(X),l=t&&t.length>0?`${V.text}{{${t.length+1}}}`:`${V.text}{{${1}}}`;r("components[1].text",l)},we=n.exports.useCallback(()=>{const t=M.text.match(X);t&&t.length>0?U(1):U(0)},[M.text]),Se=n.exports.useCallback(()=>{const t=M.text.match(X);if(t===null){U(0);return}if(t.length===0){U(0);return}r("components[0].text",t.reduce((l,c,$)=>$===0?l.replace(c,`{{${$+1}}}`):l.replace(c,""),t.reduce((l,c,$)=>l.replace(c,`{{${$+1}}}`),M.text))),U(1)},[M.text]),Qe=()=>{const t=V.text.match(X);t!==null&&t.length!==0&&r("components[1].text",t.reduce((l,c,$)=>l.replace(c,`{{${$+1}}}`),V.text))},Ye=t=>{b(t.target.value)},Xe=()=>{if(i===""&&p("Please Select button Type"),i==="QUICK_REPLY")if(O.buttons.length<3){const t=O.buttons;t.push({type:"QUICK_REPLY",text:""}),r("components[3].buttons",t)}else p("Limit exceeded");if(i==="CALL_TO_ACTION")if(O.buttons.length<2){const t=O.buttons;t.push({type:"",text:""}),r("components[3].buttons",t)}else p("Limit exceeded")},ze=t=>{const l=O.buttons;l.splice(t,1),r("components[3].buttons",l)},je=t=>{const l=O.buttons;l.splice(t,1),r("components[3].buttons",l)},Ke=e(P,{control:m,name:"name",label:"Template Name",placeholder:"Template Name",required:!0,sx:z}),Ge=a(P,{select:!0,control:m,label:"Template Category",name:"category",sx:ae,required:!0,defaultValue:A,children:[e(I,{value:"",disabled:!0,children:"Select Template Category"}),E.map(({value:t,name:l},c)=>e(I,{value:t,children:l},c))]}),Ze=a(P,{select:!0,control:m,label:"Language",name:"language",sx:ae,required:!0,defaultValue:Z,children:[e(I,{value:"",disabled:!0,children:"Select Language"}),C.map(({code:t,name:l},c)=>e(I,{value:t,children:l},c))]}),Je=a(P,{select:!0,control:m,label:"Template Type",name:"template_type",sx:ae,required:!0,defaultValue:L,children:[e(I,{value:"",disabled:!0,children:"Select Template Type"}),x.map(({value:t,label:l},c)=>e(I,{value:t,children:l},c))]}),et=a(ee,{className:"justify-content-between",children:[e(te,{children:e(le,{children:"Header"})}),e(Ce,{control:m,name:"components[0].active"})]}),tt=a(P,{select:!0,control:m,label:"Header Type",name:"components[0].format",sx:ae,required:!0,defaultValue:M.format,children:[e(I,{value:"",disabled:!0,children:"Select Header Type"}),F.map(({value:t,name:l},c)=>e(I,{value:t,children:l},c))]}),at=a(n.exports.Fragment,{children:[a(ie,{children:[e(P,{control:m,rows:5,multiline:!0,name:"components[0].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:fe}),e(be,{size:"small",focusRipple:!1,className:"add-variable",disabled:K===1,onClick:J,children:"ADD VARIABLE"})]}),a(ce,{children:[a(G,{children:[M.text.length,"/60 Characters"]}),a(G,{children:[K,"/1 Variable"]})]})]}),st=e(le,{children:"Body"}),ot=a(n.exports.Fragment,{children:[a(ie,{children:[e(P,{control:m,rows:5,multiline:!0,name:"components[1].text",placeholder:"Message",required:!0,onBlur:Qe,inputProps:{maxLength:1024},sx:fe}),e(be,{size:"small",focusRipple:!1,className:"add-variable",onClick:he,children:"ADD VARIABLE"})]}),e(ce,{children:a(G,{children:[V.text.length,"/1024 Characters"]})})]}),rt=a(ee,{className:"justify-content-between",children:[e(te,{children:e(le,{children:"Footer"})}),e(Ce,{control:m,name:"components[2].active"})]}),nt=a(n.exports.Fragment,{children:[e(ie,{children:e(P,{control:m,rows:5,multiline:!0,name:"components[2].text",placeholder:"Message",required:!0,inputProps:{maxLength:60},sx:fe})}),e(ce,{children:a(G,{children:[Y.text.length,"/60 Characters"]})})]}),lt=a(ee,{className:"justify-content-between",children:[e(te,{children:e(le,{children:"Buttons"})}),e(Ce,{control:m,name:"components[3].active"})]}),it=a(n.exports.Fragment,{children:[a(ee,{sx:{alignItems:"center",columnGap:2,justifyContent:"space-between",mb:2.5},children:[e(te,{children:a(Gt,{select:!0,label:"Button Type",sx:ae,required:!0,value:i,onChange:Ye,disabled:O.buttons.length>0,children:[e(I,{value:"",disabled:!0,children:"Select Button Type"}),N.map(({label:t,name:l},c)=>e(I,{value:l,children:t},c))]})}),e(Xt,{children:e(q,{variant:"outlined",color:"primary",onClick:Xe,disableIcon:!0,children:"Add a Button"})})]}),L==="media"&&O.active&&O.buttons.length>0&&e(n.exports.Fragment,{children:O.buttons.map(({type:t,url:l,phone_number:c},$)=>{switch(t){case"QUICK_REPLY":return e(Ta,{index:$,removeQuickReply:ze,control:m},$);default:return e(ba,{index:$,type:t,url:l,phone_number:c,waTemplateButtonCtaTypes:f,control:m,setValue:r,removeCallAction:je},$)}})})]}),ct=[Ke,Ge,Ze,Je,...L==="media"?[et]:[],...L==="media"&&M.active?[tt]:[],...L==="media"&&M.active&&M.format==="TEXT"?[at]:[],...L!==""?[st]:[],...L!==""?[ot]:[],...L==="media"?[rt]:[],...L==="media"&&Y.active?[nt]:[],...L==="media"?[lt]:[],...L==="media"&&O.active?[it]:[]],dt=async t=>{var l;try{if(d){const c=await _.updateWaTemplateMessage(d,t);if(!c.success)throw Error(c.message);y(c.message),w((l=c.payload.id)!=null?l:d),v(T),o(),W(!0)}else{const c=await _.createWaTemplateMessage(t);if(!c.success)throw Error(c.message);y(c.message),h([c.payload,...g]),w(c.payload.id),v(T),o(),W(!0)}}catch(c){p(c.message)}},Ee=n.exports.useCallback(async()=>{try{if(d){const t=await _.getWaTemplateMessage(d);if(!t.success)throw Error(t.message);v(t.payload),t.payload.components[0].format!==""&&t.payload.components[0].text!==""&&r("components[0].active",!0),t.payload.components[2].text!==""&&r("components[2].active",!0),t.payload.components[3].buttons.length>0&&r("components[3].active",!0),t.payload.components[3].buttons[0]&&(t.payload.components[3].buttons[0].type==="QUICK_REPLY"?b("QUICK_REPLY"):(t.payload.components[3].buttons[0].type==="URL"||t.payload.components[3].buttons[0].type==="PHONE_NUMBER")&&b("CALL_TO_ACTION"))}}catch(t){p(t.message)}},[d]);return n.exports.useEffect(()=>{Ee()},[Ee]),n.exports.useEffect(()=>{S()},[S]),n.exports.useEffect(()=>{Se()},[Se]),n.exports.useEffect(()=>{we()},[we]),n.exports.useEffect(()=>{M.active||r("components[0].format","")},[M.active]),n.exports.useEffect(()=>{Y.active||r("components[2].text","")},[Y.active]),e(Ue,{anchor:"right",open:s,onClose:(t,l)=>{Ie(l)||(v(T),o())},sx:{zIndex:"modal"},children:a(xe,{children:[a(Qt,{children:[e(k,{onClick:()=>{v(T),o()},className:"icon-md-button",children:e(ve,{})}),e(Yt,{children:`${d?"Update":"Create New"} Template`})]}),a(De,{onSubmit:Q(dt),onReset:()=>{v(T),o()},children:[e(ee,{children:e(te,{children:ct.map((t,l)=>e(D,{children:t},l))})}),a(ye,{children:[e(q,{type:"reset",variant:"outlined",color:"primary",sx:{height:48},disableIcon:!0,children:"Cancel"}),e(q,{type:"submit",children:"Preview & Save"})]})]})]})})},xa="nOWk",va="_0oHa",wa="Ef-W",Te={WaTemplatePreview:xa,WaTemplatePreviewPaper:va,ActionArea:wa},Sa=({open:s,closeDrawer:o})=>{var Y,O,K,U;const{isMobile:p,isTablet:y}=ue(),{setErrorMessage:B,setSuccessMessage:d}=re(),{previewWaTemplateId:g,previewWaTemplateData:E,showWaPreviewForm:C,showWaTemplatePreview:x}=me(),{setPreviewWaTemplateData:F,setEditWaTemplateId:N,setShowWaTemplateForm:f}=ne(),[h,W]=n.exports.useState([]),w={components:[{format:"",text:"",type:R.HEADER},{text:"",type:R.BODY},{text:"",type:R.FOOTER},{buttons:[],type:R.BUTTONS}]},{control:T,handleSubmit:m,watch:Q,setValue:H}=$e({defaultValues:w}),{components:v}=Q(),r=v.find(({type:i})=>i===R.HEADER),u=v.find(({type:i})=>i===R.BODY),A=v.find(({type:i})=>i===R.BUTTONS),Z=(O=(Y=r==null?void 0:r.example)==null?void 0:Y.header_handle)==null?void 0:O[0],L=[r&&r.format!=="TEXT",r&&r.format==="TEXT"&&r.text&&r.text!==""?r.text.includes("{{1}}"):!1,u&&u.text&&u.text!==""&&u.text.includes("{{1}}"),A&&A.buttons.length>0&&((K=A.buttons[0])==null?void 0:K.type)==="URL"&&((U=A.buttons[0])==null?void 0:U.url.includes("{{1}}"))].reduce((i,b)=>i||b,!1),j=async i=>{try{const b=i.components.map(S=>{var J;return S==null||delete S.active,S.type==="HEADER"&&((J=S==null?void 0:S.example)==null||delete J.header_files),S});if(g){console.log(b);const S=await _.updateWaTemplateComponents(g,{components:b});if(!S.success)throw Error(S.message);d(S.message),o()}}catch(b){B(b.message)}},M=n.exports.useCallback(()=>{v.length>0&&v.forEach(({type:i,text:b})=>{if(i==="BODY"){const S=b.match(X);S&&W(S.map((J,he)=>he+1))}})},[v]),V=n.exports.useCallback(async()=>{try{if(g){const i=await _.getWaTemplateMessage(g);if(!i.success)throw Error(i.message);F(i.payload),H("components",i.payload.components)}}catch(i){B(i.message)}},[g]);return n.exports.useEffect(()=>{V()},[V]),n.exports.useEffect(()=>{M()},[M]),a(Ue,{anchor:"right",open:s,onClose:(i,b)=>{(!Ie(b)||x)&&o()},classes:{root:Te.WaTemplatePreview,paper:Te.WaTemplatePreviewPaper},children:[a(xe,{children:[s&&a(Re,{children:[e(k,{onClick:()=>{o()},className:"icon-md-button",children:e(ve,{})}),e(Pe,{children:L&&!x?"Enter Sample Values":"Preview Template"})]}),s&&a(De,{onSubmit:m(j),children:[(!L||x||p)&&E&&e(Fe,{components:E.components}),C&&r&&(r.format==="IMAGE"||r.format==="VIDEO"||r.format==="DOCUMENT")&&e(D,{children:e(Zt,{setValue:H,control:T,fileTypes:r.format==="IMAGE"?ge.IMAGE:r.format==="VIDEO"?ge.VIDEO:ge.FILE,label:`Drag & Drop ${r.format.charAt(0).toUpperCase()}${r.format.slice(1).toLowerCase()}`,defaultFieldName:"components[0].example.header_handle[0]",fileNameField:"components[0].example.header_files[0]",fileURL:Z!=null?Z:"",width:"100%"})}),C&&r&&r.format==="TEXT"&&r.text.includes("{{1}}")&&e(D,{children:e(P,{control:T,name:"components[0].example.header_text[0]",label:"Header Variable 1",placeholder:"Header {{1}}",required:!0,sx:z})}),C&&h.length>0&&h.map((i,b)=>e(D,{children:e(P,{control:T,name:`components[1].example.body_text[${b}]`,label:`Body Variable ${i}`,placeholder:`Body ${i}`,required:!0,sx:z})},`bodyVar{{${i}}}`)),C&&A&&A.buttons&&A.buttons.length>0&&A.buttons.map((i,b)=>i.type==="URL"&&i.url.match(X)?e(D,{children:e(P,{control:T,name:`components[3].buttons[${b}].example[0]`,label:`URL Button ${b+1}`,placeholder:`Url button ${b+1} variable 1`,required:!0,sx:z})},b):null),C&&e(ye,{children:e(q,{type:"submit",children:"Submit for Approval"})}),C&&a(ye,{className:Te.ActionArea,children:[e(oe,{component:"p",sx:{color:"#686C72",fontSize:14,fontWeight:400,lineHeight:"16px"},children:"Not happy?"}),e(Jt,{type:"button",component:"button",variant:"body2",underline:"none",onClick:()=>{N(g),f(!0),o()},children:"Continue Editing"})]})]})]}),!x&&s&&L&&y&&e(xe,{className:"ExtendedDrawer",children:e(Fe,{components:v})})]})},Ea=()=>{const{isMobile:s,isTablet:o}=ue(),{setErrorMessage:p}=re(),[y,B]=n.exports.useState(!0),[d,g]=n.exports.useState(!1),{waTemplatesData:E,waTemplateFilter:C,showWaTemplateForm:x,showWaPreviewForm:F,showWaTemplatePreview:N}=me(),{setWaTemplatesData:f,setTotalWaTemplates:h,setWaTemplateFilter:W,setShowWaTemplateForm:w,setShowWaPreviewForm:T,setShowWaTemplatePreview:m,setEditWaTemplateId:Q,setPreviewWaTemplateId:H}=ne(),{platformExist:v}=Tt(),r=n.exports.useRef(async()=>{try{const u=await _.getWaTemplateMessages();if(!u.success)throw Error(u.message);h(u.payload.length),f(u.payload)}catch(u){p(u.message)}finally{B(!1)}});return n.exports.useEffect(()=>{typeof v=="boolean"&&v&&r.current()},[v]),y?e(Me,{className:Ot.AbsCenter,children:e(bt,{height:72,width:72})}):a(n.exports.Fragment,{children:[e(yt,{children:e("title",{children:"WhatsApp Template Messages"})}),s&&a(Re,{children:[!d&&e(k,{component:xt,to:"/business-settings",className:"icon-md-button",children:e(ve,{})}),!d&&e(Pe,{children:"Template Messages"}),d&&e(Ne,{children:a(He,{children:[e(k,{disableTouchRipple:!0,disableFocusRipple:!0,disableRipple:!0,sx:{position:"absolute"},children:e(de,{})}),e(Oe,{onChange:({target:{value:u}})=>W(u),placeholder:"Search Template"}),e(k,{onClick:()=>{W(""),g(!d)},sx:{position:"absolute",right:0,top:0},children:e(ke,{})})]})}),!d&&E.length>0&&e(k,{onClick:()=>g(u=>!u),children:e(de,{})})]}),e(wt,{children:typeof v=="boolean"&&v===!1?e(We,{children:e(Ht,{})}):e(We,{children:!y&&e(Me,{elevation:0,children:e(It,{sx:{mx:{xs:-3.75,md:0}},children:E.length===0?a(St,{children:[e(Rt,{children:e(q,{disableIcon:!0,onClick:()=>w(!0),sx:{borderRadius:2,boxShadow:"0px 8px 8px rgba(50, 197, 255, 0.1)",fontSize:16,fontWeight:700,height:36,lineHeight:"19px",margin:"auto",textTransform:"capitalize"},children:"New Template Message"})}),e(Pt,{children:a(Nt,{children:["In order to initiate a conversation message your customers. Create a new template message. Send a template message to masses from ",e("strong",{children:"Broadcast"})," option in ",e("strong",{children:"Engage"})," workspace."]})})]}):a(n.exports.Fragment,{children:[o&&e(fa,{isSearchActive:d,setSearchActive:g}),o&&e(ea,{}),E.filter(u=>{var A;return(A=u==null?void 0:u.name)==null?void 0:A.toLowerCase().includes(C==null?void 0:C.toLowerCase())}).map((u,A)=>e(ha,{...u},A))]})})})})}),s&&E.length>0&&e(Et,{children:e(q,{onClick:()=>w(!0),variant:"outlined",color:"primary",disableIcon:!0,children:"New Template Message"})}),e(ya,{open:x,closeDrawer:()=>{Q(void 0),w(!1)}}),e(Sa,{open:F||N,closeDrawer:()=>{H(void 0),T(!1),m(!1)}})]})},Ws=()=>e(Ea,{});export{Ws as default};
